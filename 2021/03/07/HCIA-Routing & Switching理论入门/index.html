<!-- build time:Tue Jul 13 2021 18:03:10 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#008000"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="I" href="https://manshan.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="I" href="https://manshan.top/atom.xml"><link rel="alternate" type="application/json" title="I" href="https://manshan.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="HUAWEI"><link rel="canonical" href="https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/"><title>HCIA-Routing & Switching理论入门 - 技术 | Manshan = I</title><meta name="generator" content="Hexo 5.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs right"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">HCIA-Routing & Switching理论入门</h1><div class="meta"><span class="item" title="创建时间：2021-03-07 13:52:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-07T13:52:40+08:00">2021-03-07</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>73k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>1:06</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Manshan</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://s3.ax1x.com/2021/03/07/6KsYp6.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="item" rel="index" title="分类于 技术"><span itemprop="name">技术</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/1.jpg"><meta itemprop="name" content="Manshan"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="I"></span><div class="body md" itemprop="articleBody"><h1 id="第一章传输介质简介"><a class="anchor" href="#第一章传输介质简介">#</a> 第一章【传输介质简介】</h1><details class="primary"><summary>前言</summary><div><ul><li>通信网络除了包含通信设备本身之外，还包含连接这些设备的传输介质，如，同轴电缆，双绞线和光纤等。不同的传输介质具有不同的特性，这些特性直接影响到通信的诸多方面，如，线路编码方式，传输速度和传输距离等。</li></ul></div></details><p class="red">1，简单网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MGv3d.png" alt="图片"></li><li>上图，两个终端，用一条能够承载数据传输的物理介质 (也称传输介质) 连接起来，就组成了一个简单网络。</li><li>[2] 终端相互传递信息和资源共享的需求是网络产生的主要原因。</li><li>[3] 终端可以产生，发送和接收数据，网络是终端建立通信的媒介，终端通过网络建立连接，用来传输数据的载体称为介质，网络可以使用各种介质进行数据传送，包括物理线缆，无线电波等。</li><li>[4] 网络就是通过介质把终端互联而成的一个规模大，功能强的系统，从而使得众多的终端可以方便地互相传递信息，共享信息资源。</li></ul><p class="red">2，介质 —— 同轴电缆：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 简介如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MYMQA.png" alt="图片"></li><li>[2] 同轴电缆是一种早期使用的传输介质，同轴电缆的标准分为两种，10BASE2 和 10BASE5. 这两种标准都支持 10Mbps 的传输数据，最长传输距离分别为 184m 和 500m 一般情况下，10BASE2 同轴电缆使用 BNC 接头，10BASE5 使用 N 型接头。</li><li>[3] 10BASE5 和 10BASE2 是早期的两种以太网标准，它们均采用同轴电缆作为传输介质。10BASE5 和 10BASE2 所使用的同轴电缆的直径分别为 9.5mm 和 5mm，所以前者又称为粗电缆，后者又称为细电缆。</li><li>[4] 现在 10Mbps 的传输速率早已不满足目前企业网络的需求，因此同轴电缆在目前企业网络中很少应用。</li></ul><p class="red">3，介质 —— 交叉线：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MsexK.png" alt="图片"></li><li>[2] 与同轴电缆相比双绞线 (Twisted Pair) 具有更低的制造和部署成本，因此在企业网络中被广泛应用。</li><li>[3] 双绞线可分为屏蔽双绞线 (Shielded Twisted Pair STP) 和非屏蔽双绞线 (Unshielded Twisted Pair UTP)。</li><li>[4] 屏蔽双绞线在双绞线与外层绝缘封套之间有一个金属屏蔽层，可以屏蔽电磁干扰。</li><li>[5] 双绞线有很多种类型，不同类型的双绞线所支持的传输速率一般也不相同，例如，3 类双绞线支持 10Mbps 传输速率，5 类双绞线支持 100Mbps 传输速率，超 5 类双绞线及更高级别的双绞线支持千兆以太网传输。</li><li>[6] 双绞线使用 RJ-45 接头连接网络设备，为了保证终端能够正常收发数据，RJ-45 的针脚必须按照一定的线序排列。</li><li>[7] 排序：</li><li>568A 排线顺序：绿白，绿，橙白，蓝，蓝白，橙，棕白，棕。</li><li>568B 排线顺序：橙白，橙，绿白，蓝，蓝白，绿，棕白，棕。</li></ul><p class="red">4，介质 —— 光纤：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M6hCR.png" alt="图片"></li><li>[2] 双绞线和同轴电缆传输数据时使用的是电信号，而光纤传输数据时使用的是光信号。</li><li>[3] 光纤支持的传输速率包括：10Mbps，100Mbps，1Gbps，10Gbps 甚至更高。</li><li>[4] 根据光纤传输光信号模式的不同，光纤又可以分为单模光纤和多模光纤。</li><li>[5] 单模光纤只能传输一种模式的光，不存在膜间色散，因此适用于长距离高速传输。</li><li>[6] 多模光纤允许不同模式的光在一根光纤上传输，由于膜间色散较大而导致信号脉冲展宽严重，因此多模光纤主要用于局域网中短距离传输。</li><li>[7] 光纤连接器种类很多，常用的连接器包括 ST，FC，SC，LC 连接器。</li></ul><p class="red">5，介质 —— 串口电缆：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M2cb8.png" alt="图片"></li><li>[2] 网络通信中常常会用到各种各样的串口电缆，常用的串口电缆标准为 RS-232，同时也是推荐的标准。但是 RS-232 的传输速率有限，传输距离仅为 6m。</li><li>[3] 其他的串口电缆标准可以支持更长的传输距离，例如：RS-422 和 RS-485 的传输距离可达到 1200m，RS-422 和 RS-485 串口电缆通常使用 V.35 接头，这种接头在上世纪 80 年代已被淘汰，但是，现在仍在帧中继，ATM 等传统网络上使用。</li><li>[4] V.24 是 RS-232 标准的欧洲版，RS-232 本身没有定义接头标准，常用的接头类型为 DB-9 和 DB-25.</li><li>[5] 现在，RS-232 已逐渐被 FireWire，USB 等新标准取代，新产品和新设备已普遍使用 USB 标准。</li></ul><p class="red">6，冲突域：</p><div class="note info"><p>如下如下</p></div><ul><li><p>[1] 如图：</p></li><li><p><img data-src="https://s3.ax1x.com/2021/03/07/6MWFO0.png" alt="图片"></p></li><li><p>注：共享式网络中可能会出现信号冲突现象。</p></li><li><p>[2] 上图是一个 10BASE5 以太网，每个主机都使用同一根同轴电缆来与其他主机进行通信，因此，这里的同轴电缆又被称为共享介质，相应的网络被称为共享介质网络，或称为共享式网络，在共享式网络中，不同的主机同时发送数据时，就会产生信号冲突的问题，解决这一问题的方法一般是采用<ins class="wavy"> CSMA/CD (载波侦听多路访问 / 冲突检测技术)。</ins></p></li><li><p>[3]<ins class="wavy success"> CSMA/CD 的基本工作过程如下：</ins></p></li><li><p><ins class="wavy success">终端设备不停地检测共享线路的状态，如果线路空闲，则可以发送数据，如果线路不空闲，则等待一段时间后继续检测 (延时时间由退避算法决定)。</ins></p></li><li><p><ins class="wavy success">如果有另一台设备同时发送数据，两个设备发送的数据会产生冲突。</ins></p></li><li><p><ins class="wavy success">终端设备检测到冲突之后，会马上停止发送自己的数据，并发送特殊阻塞信息，以强化冲突信号，使线路上其他站点能够尽早检测到冲突。</ins></p></li><li><p><ins class="wavy success">终端设备检测到冲突后，等一段时间之后再进行数据发送 (延时时间有退避算法决定)。</ins></p></li><li><p><ins class="wavy success">CSMA/CD 的工作原理可简单总结为：先听后发，边发边听，冲突停发，随机延迟后重发。</ins></p></li></ul><p class="red">7，双工模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M4Q6s.png" alt="图片"></li><li>注：两种双工模式都支持双向数据传输。</li><li>[2] 半双工：</li><li>在半双工 (Half-duplex mode) 下，通信双方都能发送和接收数据，但不能同时进行。当一台设备发送时，另一台只能接收，反之亦然。对讲机就是半双工的典型例子。</li><li>[3] 全双工：</li><li>在全双工 (Full-duplex mode) 下，通信双方都能同时接收和发送数据，电话网络是典型的全双工例子。</li><li>[4] 以太网上的通信模式包括全双工和半双工两种。</li><li>[5] 半双工模式下，共享物理介质的通信双方必须采用 CSMA/CD 机制来避免冲突，例如，10BASE5 以太网的通信模式就必须是半双工模式。</li><li>[6] 全双工模式下，通信双方可以同时实现双向通信，这种模式不会产生冲突，因此，不需要使用 CSMA/CD 机制，例如，10BASE-T 以太网的通信模式就可以是全双工模式。</li><li>[7] 同一物理链路上相连的两台设备的双工模式必须保持一致。</li></ul><p class="red">8，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>千兆以太网传输必须使用超 5 类标准及以上的双绞线，或者使用千兆级更高等级的光纤。</li><li>冲突域是一个通过共享物理介质进行双向传输的所有节点的集合，当同一个冲突与域中的主机同时发送数据时，数据到达目的地之前可能会发生冲突。</li><li>CSMA/CD 是一种在共享式网络上检测并避免冲突的机制。</li></ul><h1 id="第二章以太网帧结构"><a class="anchor" href="#第二章以太网帧结构">#</a> 第二章【以太网帧结构】</h1><details class="primary"><summary>前言</summary><div><ul><li>网络中传输数据时需要定义并遵循一些标准，以太网是根据 IEEE 802.3 标准来管理和控制数据帧的。了解 IEEE 802.3 标准是充分了解以太网中链路层通信的基础。</li></ul></div></details><p class="red">1，网络通信协议：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MTD2D.png" alt="图片"></li><li>注：不同的协议栈用于定义和管理不同网络的数据转发规则。</li><li>[2] 网络通信中，“协议” 和 “标准” 这两个词汇常常可以混用，同时，协议或标准本身又常常具有层次的特点。</li><li>[3] 一般地，关注于逻辑数据关系的协议通常被称为上层协议，而关注于物理数据流的协议通常被称为底层协议。</li><li>[4] IEEE 802 就是一套用来管理物理数据流在局域网中传输的标准，包括在局域网中传输物理数据的 802.3 以太网标准。除此之外，还有一些用来管理物理数据流在广域网中传输的标准，如，PPP (Point-To-Point Protocol)，高级数据链路控制 HDLC (High-Level Data Link Control)。</li></ul><p class="red">2，分层模型 ——OSI：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M7oY6.png" alt="图片"></li><li>[2] OSI 参考模型具有以下优点：</li><li>简化了相关的网络操作。</li><li>提供了不同厂商之间的兼容性。</li><li>促进了标准化工作。</li><li>结构上进行了分层。</li><li>易于学习和操作。</li><li>[3] OSI 各个层次的基本功能如下：</li><li><ins class="dot">物理层：</ins></li><li>在设备之间传输比特流，规定了电平，速度和电缆针脚。</li><li><ins class="dot">数据链路层：</ins></li><li>将比特组合成字节，再将字节组合成帧，使用链路层地址 (以太网使用 MAC 地址) 来访问介质，并进行差错检测。</li><li><ins class="dot">网络层：</ins></li><li>提供逻辑地址，供路由器确认路径。</li><li><ins class="dot">传输层</ins></li><li>提供面向连接或非面向连接的数据传递以及进行重传前的差错检测。</li><li><ins class="dot">会话层</ins></li><li>负责建立，管理，终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和相应组成。</li><li><ins class="dot">表示层</ins></li><li>提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。</li><li><ins class="dot">应用层</ins></li><li>OSI 参考模型中最靠近用户的一层，为应用程序提供网络服务。</li></ul><p class="red">3，分层模型 ——TCP/IP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MqezT.png" alt="图片"></li><li>[2] TCP/IP 模型同样采用了分层结构，层与层相对独立但是相应之间也具备非常密切的协作关系。</li><li>[3] TCP/IP 模型将网络分为四层，TCP/IP 模型不关注底层物理介质，主要关注于终端之间的逻辑数据流转发，</li><li>[4] TCP/IP 模型的核心是网络层和传输层，网络层解决网络之间的逻辑转发问题，传输层保证源端到目的端之间的可靠传输。最上层的应用层通过各种协议向终端用户提供业务应用。</li></ul><p class="red">4，数据封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QC5WQ.png" alt="图片"></li><li>[2] 应用数据需要经过 TCP/IP 每一层处理之后才能通过网络传输到目的端，每一层上都是用该层的数据单元 PDU (Protocol Data Unit) 彼此交换信息。不同层的 PDU 中包含有不同的信息，因此 PDU 在不同层被赋予了不同的名称。</li><li>[3] 如上层数据在传输层添加 TCP 报头后得到的 PDU 被称为数据段 (Segmet), 数据段被传递给网络层，网络层添加 IP 报头得到的 PDU 被称为数据包 (Packet), 数据包被传递到数据链路层，封装数据链路层报头得到的 PDU 被称为数据帧 (Frame), 最后，帧被转换为比特，通过网络介质传输，这种协议栈逐层向下传递数据，并添加报头和报尾的过程称为封装。</li></ul><p class="red">5，终端之间的通信：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QPkTK.png" alt="图片"></li><li>注：数据链路层控制数据帧在物理线路上传输。</li><li>[2] 数据包在以太网物理介质传播之前必须封装头部和尾部信息，封装后的数据包被称为数据帧，数据帧中封装的信息决定了数据如何传输，以太网中传输的数据帧有两种格式。选择哪种格式，由 TCP/IP 协议族中的网络层决定。</li></ul><p class="red">6，帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QPQmt.png" alt="图片"></li><li>[2] 以太网上使用两种标准帧格式，第一种是上世纪八十年代提出的 DIX v2 格式，即 Ethernet II 帧格式，Ethernet II 后来被 IEEE 802 标准接纳，并写进了 IEEE 802.3	X-1997 的 3.2.6 节。</li><li>[3] 第二种是 1983 年提出的 IEEE 802.3 格式，这两种格式的主要区别在与 Ethernet II 格式中包含一个 Type 字段，标识以太帧处理完成之后将被发送到哪个上层协议进行处理，IEEE 802.3 格式中，同样的位置是长度字段。</li><li>[4] 不同的 Type 字段值可以用来区别这两种帧的类型，当 Type 字段值小于等于 1500 (或者 16 进制的 0x05DC) 时，帧使用的是 IEEE 802.3 格式。当 Type 值大于等于 1536 (或者 16 进制 0x0600) 时，帧使用的是 Ethernet II 格式。<ins class="wavy">以太网中大多数的数据帧使用的是 Ethernet II 格式。</ins></li><li>[5]<ins class="wavy"> 以太帧中还包括源和目的 MAC 地址，分别代表发送者的 MAC 和接收者的 MAC，此外还有帧校验序列字段，用于校验传输过程中帧的完整性。</ins></li></ul><p class="red">7，Ethernet II 帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QzZoF.png" alt="图片"></li><li><ins class="wavy">注：Ethernet II 帧类型值大于等于 1536 (0x0600)，以太网数据帧的长度在 64-1518 字节之间。</ins></li><li>[2] Ethernet II 的帧中各种字段说明如下：</li><li><ins class="wavy">DMAC(Destination MAC)：</ins></li><li>是目的 MAC 地址，DMAC 字段长度为 6 个字节，标识帧的接收者。</li><li><ins class="wavy">SMAC(Source MAC)：</ins></li><li>是源 MAC 地址，SMAC 字段长度为 6 个字节，标识帧的发送者。</li><li><ins class="wavy">Type (类型字段)：</ins></li><li>用于标识数据字段中包含的高层协议，该字段长度为 2 个字节，<ins class="wavy">类型字段取值为 0x0800 的帧代表 IP 协议帧。类型字段取值为 0x0806 的帧代表 ARP 协议帧。</ins></li><li><ins class="wavy">Data (数据字段)：</ins></li><li>是网络层数据，最小长度必须为 46 字节以保证帧长至少为 64 字节，数据字段的最大长度为 1500 字节。</li><li><ins class="wavy">FCS (循环冗余检验字段)：</ins></li><li>提供了一种错误检测机制，该字段长度为 4 个字节。</li></ul><p class="red">8，IEEE 802.3 帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lFCAP.png" alt="图片"></li><li><ins class="wavy">注：IEEE 802.3 帧长度字段值小于等于 1500 (0x05DC)。</ins></li><li>[2] IEEE 802.3 帧格式类似于 Ethernet II 帧，只是 Ethernet II 帧的 type 域被 802.3 帧的 Length 域取代，并且占用了 Data 字段的 8 个字节作为 LLC 和 SNAP 字段。</li><li><ins class="wavy">Leagth 字段：</ins></li><li>定义了 Data 字段包含的字节数。</li><li><ins class="wavy">逻辑链路控制 LLC (Logical Link Control)：</ins></li><li>由目的服务访问点 DSAP (Destination Service Access Point)，源服务访问点 SSAP (Source Service Access Point) 和 Control 字段组成。</li><li><ins class="wavy">SNAP(Sub-network Access Point)：</ins></li><li>由机构代码 (Org Code) 和类型 (Type) 字段组成，Org Code 三个字节都为零，Type 字段的含义与 Ethernet II 帧中的 Type 字段相同。</li><li><ins class="wavy">IEEE 802.3 帧根据 DSAP，SSAP 字段的取值又可以分为以下几类：</ins></li><li>1) 当 DSAP 和 SSAP 都取特定值 0xff 时，802.3 帧就变成了 Netware-ETHERNET 帧，用来承载 NetWare 类型的数据。</li><li>2) 当 DSAP 和 SSAP 都取特定值 0xaa 时，802.3 帧就变成了 ETHERNET-SNAP 帧，ETHERNER_SNAP 帧可以用于传输多种协议。</li><li>3)<ins class="wavy"> DSAP 和 SSAP 其他的取值均为纯 IEEE 802.3 帧。</ins></li></ul><p class="red">9，数据帧传输：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lVFVs.png" alt="图片"></li><li><ins class="wavy">注：数据链路层基于 MAC 地址进行帧的传输。</ins></li><li>[2] 以太网在二层链路上通过 MAC 地址来唯一标识网络设备，并且实现局域网上网络设备之间的通信。</li><li>[3] MAC 地址也叫物理地址，大多数网卡厂商把 MAC 地址烧入了网卡的 ROM 中，发送端使用接收端的 MAC 地址作为目的地址，以太帧封装完成之后会通过物理层转换成比特流在物理介质上传输。</li></ul><p class="red">10，以太网的 MAC 地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lek90.png" alt="图片"></li><li>++ 注：MAC 地址由两部分组成，分别是供应商代码和序列号。其中前 24 位代表该供应商代码，由 IEEE 管理和分配，剩下的 24 位序列号由厂商自己分配。</li><li>[2] 网络设备的 MAC 地址是全球唯一的，MAC 地址长度为 48 比特，通常用 16 进制标识。</li><li>[3] MAC 地址包含两个部分：前 24 比特是组织唯一标识符 (OUI) 由 IEEE 统一分配给设备制造商，例如，华为网络产品的 MAC 地址前 24 比特是 0x00e0fc。后 24 位序列号是厂商厂商分配给每个产品的唯一数值，由各个厂商自行分配。</li></ul><p class="red">11，单播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6ln06f.png" alt="图片"></li><li>[2] 局域网中的帧可以通过三种方式发送，第一种是单播，指从单一的源端单一的目的端，每个主机接口由一个 MAC 地址唯一标识，<ins class="wavy">MAC 地址的 OUI 中，第一个字节第八个比特标识比特类型。</ins></li><li>[3] 对于主机 MAC 地址，这个比特固定为零，表示目的 MAC 地址为此 MAC 地址的帧都是发送到某个唯一的目的端。</li><li>[4] 在冲突与中，所有主机都能接收到源主机发送的单播帧，都是其他主机发现目的地址与本地 MAC 地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧。</li></ul><p class="red">12，广播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lKLy6.png" alt="图片"></li><li>[2] 第二种方式是广播，表示帧从单一的源发送到共享以太网上的所有主机。广播帧的目的 MAC 地址为十六进制的 FF:FF:FF:FF:FF:FF，所有收到该广播帧的主机都要接收并处理这个帧。</li><li>[3]<ins class="wavy"> 广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能。</ins></li><li>[4]<ins class="wavy"> 当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式。</ins></li></ul><p class="red">13，组播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lQQ4H.png" alt="图片"></li><li>[2] 第三种发送方式为组播，组播比广播更加高效，组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的 MAC 地址为该组播 MAC 地址的帧。</li><li>[3] 组播 MAC 地址和单播 MAC 地址是通过<ins class="wavy">第一个字节中的第八个比特区分的。组播 MAC 地址的第八个比特为 1，而单播 MAC 地址的第八个比特为 0。</ins></li><li>[4] 当需要网络上的一组主机 (而不是全部主机) 接收相同的信息，并且其他主机不受影响的情况下通常会使用组播方式。</li></ul><p class="red">14，数据帧的发送和接收：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6l3GvR.png" alt="图片"></li><li><ins class="wavy">注：当主机接收到数据帧所包含的目的 MAC 地址是自己时，会把以太网封装剥掉后送往上层协议。</ins></li><li>[2] 帧从主机的物理口发送出来后，通过传输介质传输到目的端，共享网络中，这个帧可能到达多个主机，主机检测帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢弃收到的帧。</li><li>[3] 如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检测帧检验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保存了完整性。如果帧的 FCS 值与本机计算的值不同，主机会认为帧已被破坏，并会丢弃该帧。如果该帧通过了 FCS 校验，则主机会根据帧头部的 Type 字段来确定将帧发送给上层哪一个协议处理，本列中，Type 字段的值为 0x0800，表明该帧需要发送到 IP 协议上处理，在发送给 IP 协议之前，帧的头部和尾部会被剥掉。</li></ul><p class="red">15，本章总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 网络设备如何确定以太网数据帧的上层协议？</li><li>以太网帧中包含一个 Type 字段，表示帧中的数据应该发送到上层哪个协议处理，比如，IP 协议对应的 Type 值为 0x0800，ARP 协议对应的 Type 值为 0x0806。</li><li>[2] 终端设备接收到数据帧时，会如何处理？</li><li>主机检查帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢掉收到的帧，如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检查帧校验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保持了完整性。如果检查通过，就会剥离帧头和帧尾，然后根据帧头中的 Type 字段来决定把数据发送到哪个上层协议进行后续处理。</li></ul><h1 id="第三章ip编址"><a class="anchor" href="#第三章ip编址">#</a> 第三章【IP 编址】</h1><details class="primary"><summary>前言</summary><div><ul><li>网络层位于数据链路层与传输层之间，网络层包含了许多协议其中最为重要的就是 IP 协议，网络层提供了 IP 路由功能，理解 IP 路由除了要熟悉 IP 协议的工作机制外，还必须理解 IP 编址以及如何合理地使用 IP 地址来设计网络。</li></ul></div></details><p class="red">1，上层协议类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61SXYF.png" alt="图片"></li><li>++ 注：以太网帧中的 Type 字段值为 0x0800，表示该帧的网络层协议为 IP 协议。</li><li>[2] 在剥掉帧的头部和尾部之前网络设备需要根据帧头中 Type 字段来确定下一步将帧发送到哪个上层协议进行处理。本列中的帧头部 Type 字段表示该帧需要上送到 IP 协议进行处理，以下将介绍帧的头部和尾部剥离之后，IP 协议将如何处理帧中的数据。</li></ul><p class="red">2，IP 报文头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/619nCF.png" alt="图片"></li><li>[2] IP 报文头部信息用于指导网络设备对报文进行路由和分片。同一个网段内的数据转发通过数据链路层即可实现，而跨网段的数据转发需要使用网络设备的路由功能。分片是指数据包超过一定长度时，需要被划分成不同的片段使其能够在网络中传输。</li><li>[3] IP 报文头部长度为 20——60 字节，报文头部中的信息可以用来指导网络设备如何将报文从原设备发送到目的设备，其中，版本字段表示当前支持的 IP 协议版本，当前的版本号为 4。DS 字段早期用来表示业务类型，现在用于支持 QoS 中的差分服务模型，实现网络流量优化。</li><li>[4] 源和目的 IP 地址是分配给自己的逻辑地址，用于在网络层标识报文的发送方和接收方，根据源和目的 IP 地址可以判断目的端是否与发送端位于同一网段，如果二者不在同一网段，则需要采用<ins class="wavy">路由机制</ins>进行跨网段转发。</li></ul><p class="red">3，IP 编址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61Pd0I.png" alt="图片"></li><li><ins class="wavy">注：IP 地址分为网络部分和主机部分</ins></li><li><ins class="wavy">注：IP 地址由 32 个二进制位组成，通常用点分十进制来表示</ins></li></ul><p class="red">4，二进制，十进制，十六进制 ———— 略</p><p class="red">5，IP 地址分类：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61iGEq.png" alt="图片"></li><li>[2] IP 地址被划分为 A,B,C,D,E 五类，每类地址的网络号包含不同的字节数。A，B，C 类地址可以分配 IP 地址。每类地址支持的网络数和主机数不同，例如：A 类地址可支持 126 个网络每个网络支持 2*24 (16777216) 个主机地址，另外每个网段中的网络地址和广播地址不能分配给主机，C 类地址支持 200 多万个网络，每个网络支持 256 个主机地址，其中 254 个地址可以分配给主机使用。</li><li>[3] D 类地址为组播地址，主机收到以 D 类地址为目的地址的报文后，且该主机是该组播组的成员，就会接收并处理该报文。</li></ul><p class="red">6，IP 地址类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61FzlD.png" alt="图片"></li><li>[2] 默认情况下，网络中的主机无法使用使用私网地址与公网通信，当需要与公网通信时，私网地址必须转换成公网地址。</li><li>[3] 127.0.0.1 网段中的地址为环回地址。用于诊断网络是否正常。</li><li>[4] IPv4 中的第一个地址 0.0.0.0 表示任何网络。IPv4 最后一个地址 255.255.255.255 是 0.0.0.0 网络中的广播地址。</li></ul><p class="red">7，网络通信：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68rxnP.png" alt="图片"></li><li>[2] 源主机必须知道目的主机的 IP 地址后才能将数据发送到目的地，源主机向其他目的主机发送报文之前，需要检查目的 IP 地址和源 IP 地址是否属于同一网段，如果是则报文将被下发到底层协议进行以太网封装处理。如果目的地址和源地址属于不同网段，则主机需要获取下一跳路由器的 IP 地址，然后将报文下发到底层协议处理。</li></ul><p class="red">8，子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68yZ2d.png" alt="图片"></li><li>[2] 子网掩码用于区分网络部分和主机部分。</li><li>[3] 子网掩码与 IP 地址的表示方式相同，每个 IP 地址和子网掩码一起可以用来唯一的标识一个网段中的某台网络设备。</li><li>[4] 子网掩码中的 1 表示网络位，0 表示主机位。</li></ul><p class="red">10，默认子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68yjdf.png" alt="图片"></li><li>[2] 每类 IP 地址有一个缺省子网掩码，A 类地址的为 8 位，即第一个字节表示网络位，其他三个字节表示主机位，B 类 16 位，因此 B 类支持更多的网络，但是主机数也相应减少。C 类 24 位，支持的网络最多，但是也限制了单个网络中主机的数量。</li></ul><p class="red">11，地址规划：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68c8js.png" alt="图片"></li><li>[2] 通过子网掩码可以判断主机所属的网段，网段上的广播地址以及网段上支持的主机数。</li></ul><p class="red">12，地址规划举例：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68gJRe.png" alt="图片"></li></ul><p class="red">13，有类 IP 编址的缺陷：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68WYzF.png" alt="图片"></li><li><ins class="wavy">注：在设计网络时使用有类 IP 地址会造成地址的浪费。</ins></li><li>[2] 使用缺省子网掩码就会存在一定的局限性，网络中划分多个网段后，每个网段中的实际主机数量可能很有限，导致很多地址未被使用，地址使用率低。</li></ul><p class="red">14，变长子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src alt="图片"></li><li>[2] 采用可变长子网掩码可解决上述问题	，缺省子网掩码可以进一步划分，称为变长子网掩码 (VLSM)。</li><li>[3] 通过改变子网掩码，可以将网络划分为多个子网，上图借用了一个主机位作为网络位，借用的主机位变成了子网位。所以有 2*7-2 个主机地址，即 126 个。</li></ul><p class="red">15，无类域间路由 (CIDR)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/6850XD.png" alt="图片"></li><li><ins class="wavy">注：CIDR 增强了网络的可拓展性。</ins></li><li>[2] 无类域间路由 CIDR 由 RFC1817 定义，CIDR 突破了传统 IP 地址的分类边界，将路由表中的若干条路由汇总为一条路由，减少了路由表的规模，提高了路由器的可拓展性。</li></ul><p class="red">16，网关：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68IJKS.png" alt="图片"></li><li><ins class="wavy">注：网关用来转发来自不同网段之间的数据包。</ins></li><li>[2] 报文转发过程中，首先需要确定转发路径以及通往目的网段的接口，然后将报文封装在以太帧中通过指定的物理接口转发出去。如果目的主机与源主机不在同一网段，报文需要先转发到网关，然后通过网关将报文转发到目的网段。</li><li>[3] 网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备，为实现此功能，网关必须知道目的网段的 IP 地址，网关设备上连接本地网段的接口地址即为该网段的网关地址。</li></ul><p class="red">17，IP 包分片：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/68qjiQ.png" alt="图片"></li><li>[2]<ins class="wavy"> 网络中转发的 IP 报文长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输，将报文分割成多个片段的过程叫做分片。</ins></li><li>[3] 接收端根据分片报文中的<ins class="wavy">标识符 (Identification)，标志 (Flags)，及片偏移 (Fragment Offset) 字段</ins>对分片报文进行重组。</li><li>[4]<ins class="wavy"> 标识符 (Identification): 用于识别属于同一个数据包的分片，以区别于同一主机或其他	主机发送的其他数据包分片，保证分片被正确的重新组合。</ins></li><li>[5]<ins class="wavy"> 标志字段 (Flags): 用于判断是否已经收到最后一个分片，最后一个分片的标志字段设置为 0，其他分片的标志字段设置为 1. 目的端在收到标志字段为 0 的分片后，开始重组报文。</ins></li><li>[6]<ins class="wavy"> 片偏移字段 (Fragment Offset): 表示每个分片在原始报文中的位置。第一个分片的片偏移为 0，第二个分片的片偏移表示紧跟第一个分片后的第一个比特的位置，比如，如果首片报文包含 1259 比特，那么第二分片报文的片偏移字段值就应该为 1260。</ins></li></ul><p class="red">18，生存时间：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/68OO3j.png" alt="图片"></li><li>[2] 报文在网段间转发时，如果网络设备上的路由规划不合理，就可能会重新环路，导致报文在网络中无限循环，无法到达目的端。环路发生后，所有发往这个目的地的报文的都会被循环转发，随着这种报文逐渐增多，网络将会发送拥塞。</li><li>[3] 为了避免环路导致的网络拥塞，IP 报文头中包含一个生存时间 TTL (Time To Live) 字段，报文每经过一台<ins class="wavy">三层设备，</ins>TTL 值减 1。初始 TTL 值由源端设备设置。当报文中的 TTL 降为 0 时，报文会被丢弃。同时，丢弃报文的设备会根据报文头中的源 IP 地址向源端发送 ICMP 错误消息。</li></ul><p class="red">19，协议号：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6Gjy8g.png" alt="图片"></li><li>[2] 目的端的网络层在接受并处理报文之后，需要决定下一步对报文该做如何的处理。IP 报文头部中的协议字段标识了将会继续处理报文的协议。与以太帧头部中的 Type 字段类似，协议字段也是一个十六进制数，该协议可以标识网络层协议，如，ICMP (因特网控制报文协议)，也可以标识上层协议，如，TCP (传输控制协议，对应值 0x06)，UDP (用户数据包协议，对应值 0x11)</li></ul><p class="red">20，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 子网掩码的专用是什么？</li><li>32 位的 IP 子网掩码用于区分 IP 地址中的网络号和主机号，网络号表示网络或子网，主机号表示网络或子网中的主机。</li><li>[2] IP 报文头部中 TTL 字段的作用是什么？</li><li>如果网络中存在环路，则 IP 报文可能会在网络中循环而无法达到目的端，TTL 字段限定了 IP 报文的生存时间，保证无法到达目的端口的报文最终被丢弃。</li><li>[3] 网关的作用是什么？</li><li>网关是指接收并处理本地网段主机发送出来的报文并转发到目的网段的设备。</li></ul><h1 id="第四章icmp协议"><a class="anchor" href="#第四章icmp协议">#</a> 第四章【ICMP 协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>Internet 控制消息协议 ICMP (Internet Control Message Protocol) 是网络层的一个重要协议。</li><li>ICMP 协议用来在网络设备间传递各种差错和控制信息，并，<ins class="wavy">对于收集各种网络信息，诊断和排除各种网络故障等方面起着至关重要的作用。</ins></li><li>使用基于 ICMP 的应用时，需要对 ICMP 的工作原理非常熟悉。</li></ul></div></details><p class="red">1，ICMP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JCwQO.png" alt="图片"></li><li><ins class="wavy">注：ICMP 用来传递差错，控制，查询等信息。</ins></li><li>[2]<ins class="wavy"> ICMP 是 TCP/IP 协议族的核心协议之一，它用于在 IP 网络设备之间发送控制报文，传递差错，控制，查询等消息。</ins></li></ul><p class="red">2，ICMP 重定向：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JPQht.png" alt="图片"></li><li>[2] ICMP Redirect 重定向消息用于支持路由功能。</li><li>[3]<ins class="wavy"> 上图，主机 A 希望发送报文到服务器 A，于是根据配置的默认网关地址向网关 RTB 发送报文，网关 RTB 收到报文后，检查报文信息，发现报文应该转发到与源主机在同一网段的另一个网关设备 RTA，因为此转发路径是更优的路径，所以 RTB 会向主机发送一个 Redirect 消息，通知主机直接向另一个网关 RTA 发送该报文，主机收到 Redirect 消息后，会向 RTA 发送报文，然后 RTA 会该报文再转发给服务器 A。</ins></li></ul><p class="red">3，ICMP 差错检测：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JENYd.png" alt="图片"></li><li><ins class="wavy">注：ICMP Echo Requests 和 ICMP Echo Reply 分别用来查询和响应某些消息，进行差错检测。</ins></li><li>[2]<ins class="wavy"> ICMP Echo 消息常用于诊断源和目的地之间的网络连通性，同时，还可以提供其他信息，如报文往返时间等。</ins></li></ul><p class="red">4，ICMP 错误报告：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JVrg1.png" alt="图片"></li><li><ins class="wavy">注：当网络设备无法访问目标网络时，会自动发送 ICMP 目的不可达报文到发送端设备。</ins></li><li>[2]<ins class="wavy"> ICMP 定义了各种错误消息，用于诊断网络连通性问题，根据这些错误消息，源设备可以判断出数据传输失败的原因。</ins></li><li>[3]<ins class="wavy"> 比如，如果网络中发生了环路，导致报文在网络中循环，且最终 TTL 超时，这种情况下网络设备会发送 TTL 超时消息个发送端设备。</ins></li><li>[4]<ins class="wavy"> 又比如，如果目的地址不可达，则中间的网络设备会发送目的不可达的消息给发送端设备。</ins></li><li>[5]<ins class="wavy"> 目的不可达的情况有多种，如果是网络设备无法找到目的网络。则发送目的网络不可达消息，如果是网络设备无法找到目的网络中的目的主机，则发送目的主机不可达消息。</ins></li></ul><p class="red">5，ICMP 数据包格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JKmBq.png" alt="图片"></li><li><ins class="wavy">注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同消息。</ins></li><li>[2] ICMP 消息封装在 IP 报文中。<ins class="wavy">ICMP 消息的格式取决于 Type 和 Code 字段。其中 Type 字段为消息类型，Code 字段包含该消息类型的具体参数。</ins></li><li>[3]<ins class="wavy"> 后面的校验和字段用于检测消息是否完整，消息中包含 32 比特的可变参数，这个字段一般不使用，通常设置为 0。在 ICMP Redirect 消息中，这个字段用来指定网关 IP 地址，主机根据这个地址将报文重定向到指定网关。</ins></li><li>[4]<ins class="wavy"> 在 Echo 请求消息中，这个字段包含标识符和序号，源端根据这两个参数将收到的回复消息与本端发送的 Echo 请求消息进行关联，尤其是当源端向目的端发送多个 Echo 请求消息时，需要根据标识符和序号将 Echo 请求和回复消息进行一一对应。</ins></li></ul><p class="red">6，ICMP 消息类型和编码类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JNBjK.png" alt="图片"></li><li>[2] ICMP 定义了多种消息类型，并用于不同的场景，这些消息不需要 Code 字段来描述具体的类型参数，仅用 Type 字段表示消息类型，比如，ICMP Echo 回复消息的 Type 字段设置为 0。</li><li>[3]<ins class="wavy"> 有些 ICMP 消息使用 Type 字段定义消息大类，用 Code 字段表示消息的具体类型。比如，类型为三的消息表示目的不可达，不同的 Code 值表示不可达的原因，包括目的网络不可达 (Code=0)，目的主机不可达 (code=1), 协议不可达 (Code=2)，目的 TCP/UDP 端口不可达 (Code=3) 等。</ins></li></ul><p class="wavy">7，ICMP 应用 - Ping (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6YVbwT.png" alt="图片"></li><li>[2] ICMP 的一个典型应用时 Ping，Ping 是检测网络连通性的常用工具，同时也能收集其他相关信息。</li><li>[3] 用户可以在 Ping 命令中指定不同的参数，如 ICMP 报文长度，发送的 ICMP 报文个数，等待回复相应的超时时间等，设备根据配置的参数来构造并发送 ICMP 报文，进行 Ping 测试。</li><li>[4] Ping 常用的配置参数说明如下：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①：-a source-ip-address指定发送ICMP ECHO—REQUEST报文的源IP地址。如果不指定源IP地址，将采用出接口的IP地址作为ICMP ECHO—REQUEST报文发送的源地址。</pre></td></tr><tr><td data-num="2"></td><td><pre>②：-c count 指定发送ICMP ECHO—REQUEST报文次数，缺省情况下发送5个ICMP ECHO-REQUEST报文。</pre></td></tr><tr><td data-num="3"></td><td><pre>③：-h ttl-value指定TTL的值，缺省值是255。</pre></td></tr><tr><td data-num="4"></td><td><pre>④：-t <span class="token function">time</span> out指定发送完ICMP ECHO-REQUEST后，等待ICMP ECHO-<span class="token environment constant">REPLY</span>的超时时间。</pre></td></tr></table></figure><p class="red">8，ICMP 应用 - Ping (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6Ym0W4.png" alt="图片"></li><li>[2]<ins class="wavy"> Ping 命令的输出信息中包括目的地址，ICMP 报文长度，序号，TTL 值以及往返时间。</ins></li><li>[3]<ins class="wavy"> 序号是包含在 Echo 回复消息 (Type=0) 中的可变参数字段，TTL 和往返时间包含在消息的 IP 头中。</ins></li></ul><p class="red">9，ICMP 应用 - Tracert (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6YDV6s.png" alt="图片"></li><li>[2] ICMP 的另一个典型的应用是 Tracrt，<ins class="wavy">Traceret 基于报头中的 TTL 值来逐跳跟踪报文的转发路径。</ins></li><li>[3] 为了跟踪到达某特定目的地址的路径，源端首先将报文的 TTL 值设置为 1，该报文到达第一个节点后，TTL 超时，于是该字节向源端发送 TTL 超时消息，消息中携带时间戳。然后源端将报文的 TTL 值设置为 2，报文到达第二个节点超时后，该节点同样返回 TTL 超时消息，以此类推，直到报文到达目的地。这样，源端根据返回的报文中的消息可以跟踪到报文经过的每一个节点，并根据时间戳信息计算往返时间，Tracert 是检测网络丢包及时延的有效手段，同时可以帮助管理员发现网络中的路由环路。</li><li>[4] Tracertc 常用的配置参数说明如下：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①：-a source-ip-address指定Tracert报文的源地址。</pre></td></tr><tr><td data-num="2"></td><td><pre>②：-f first-ttl指定初始TTL，缺省值是1。</pre></td></tr><tr><td data-num="3"></td><td><pre>③：-m max-ttl指定最大TTL，缺省值是30。</pre></td></tr><tr><td data-num="4"></td><td><pre>④：-name使能显示每一跳的主机名。</pre></td></tr><tr><td data-num="5"></td><td><pre>⑤：-p port指定目的主机的UDP端口。</pre></td></tr></table></figure><p class="red">10，ICMP 应用 ——Tracert (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6YyqHI.png" alt="图片"></li><li>[2]<ins class="wavy"> 注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同信息。</ins></li><li>[3] 上图，源端 (RTA) 向目的端 (主机 B) 发送一个 UDP 报文，TTL 值为 1，目的 UDP 端口号是大于 30000 的一个数，因此在大多数情况下，大于 30000 的 UDP 端口号是任何一个应用程序都不可能使用的端口号。</li><li>[4] 第一跳 (RTB) 接收到源端发送的 UDP 报文后，判断出报文的目的 IP 地址不是本机 IP 地址，将 TTL 减一后，判断出 TTL 值等于 0，将丢弃报文并向源端发送一个 ICMP 超时 (Time Exceeded) 报文。(该报文中含有第一跳的 IP 地址 10.0.0.2)，这样源端就得到了 RTB 的地址。</li><li>[5] 源端收到 RTB 的 ICMP 超时报文后，再次向目的端发送一个 UDP 报文，TTL 值为 2。</li><li>[6] 第二跳 (RTC) 收到源端发送出的 UDP 报文后，回应一个 ICMP 超时报文，这样源端就得到了 RTC 的地址 (20.0.0.2)</li><li>[7] 以上过程不断进行，直到目的端收到收到源端发送的 UDP 报文，判断出目的 IP 地址是本机 IP 地址，则处理此报文，根据报文中目的 UDP 端口号寻找占用此端口号的上层协议。因目的端没有应用程序使用该 UDP 端口号，则向源端返回一个 ICMP 不可达 (Destination Unreachable) 报文。</li><li>[8] 源端收到 ICMP 端口不可达报文后，判断出 UDP 报文已经到达目的端。则停止 Tracert 程序，从而得到数据报文从源端到目的端所经历的路径 (10.0.0.2,20.0.0.2,30.0.0.2)。</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] Ping 使用的是哪两类 ICMP 消息？</li><li>Ping 利用 ICMP Echo 请求消息 (Type 值为 0) 来发起检测目的可达性，目的端收到 ICMP Echo 请求消息后，根据 IP 报头中的源地址向源端发送 ICMP Echo 回复消息 (Type 值为 0)。</li><li>[2] 当网络设备收到 TTL 值为 0 的报文时，会如何操作？</li><li>如果 IP 数据包在到达目的地之前 TTL 值已经将为 0，则收到 IP 数据包的网络设备会丢弃该数据包，并向源端发送 ICMP 消息通知源端 TTL 超时。</li></ul><h1 id="第五章arp协议"><a class="anchor" href="#第五章arp协议">#</a> 第五章【ARP 协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>当网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址 (即 IP 地址)。</li><li>IP 地址由网络层来提供，但是仅有 IP 地址是不够的，IP 数据报文必须封装成帧才能通过数据链路层进行发送。</li><li>数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址，通过目的 IP 地址来获取目的 MAC 地址的过程是由 ARP (Address Resolution Protocol) 协议来实现的。</li></ul></div></details><p class="red">1，ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NKKYV.png" alt="图片"></li><li><ins class="wavy">注：数据链路层在进行数据封装时，需要目的 MAC 地址。</ins></li><li>[2] 一个网络设备要发送数据给另一个网络设备时，必须要知道对方的 IP 地址，但是仅有 IP 地址是不够的，因为 IP 数据报文必须封装成帧才能通过数据链路层进行发送，而数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址。</li><li>[3] 每一个网络设备在数据封装前都需要获取下一跳的 MAC 地址。</li><li>[4] IP 地址由网络层提供，MAC 地址通过 ARP 协议来获取。</li><li>[5] ARp 协议是 TCP/IP 协议族中的重要组成部分，它能够通过目的 IP 地址获取目标设备的 MAC 地址，从而实现数据链路层的可达性。</li></ul><p class="red">2，ARP 数据包格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NQV5q.png" alt="图片"></li><li><ins class="wavy">注：ARP 报文不能穿越路由器，不能被转发到其他广播域。</ins></li><li>[2] 网络设备通过 ARP 报文来发现目的 MAC 地址，ARP 报文中包含以下字段：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Hard Type表示硬件地址类型，一般为以太网。</pre></td></tr><tr><td data-num="2"></td><td><pre>Protocol Type表示三层协议地址类型，一般为IP。</pre></td></tr><tr><td data-num="3"></td><td><pre>Hard Length和Protocol Length为MAC地址和IP地址的长度，单位是字节。</pre></td></tr><tr><td data-num="4"></td><td><pre>Operation Code指定了ARP报文的类型，包括ARP Requested和ARP Reply。</pre></td></tr><tr><td data-num="5"></td><td><pre>Source Hardware Address指的是发送ARP报文的设备MAC地址。</pre></td></tr><tr><td data-num="6"></td><td><pre>Source Protocol Address指的是发送ARP报文的设备IP地址。</pre></td></tr><tr><td data-num="7"></td><td><pre>Destination Hardware Address指的是接收者MAC地址，在ARP Request报文中，该字段为0。</pre></td></tr><tr><td data-num="8"></td><td><pre>Destination Protocol Address指的是接收者的IP地址。</pre></td></tr></table></figure><p class="red">3，ARP 工作过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N1s8P.png" alt="图片"></li><li><ins class="wavy">注：主机 A 发送一个数据包给主机 C 之前，首先要获取主机 C 的 MAC 地址。</ins></li><li>[2] 通过 ARP 协议，网络设备可以建立目标 IP 地址和 MAC 地址之间的映射，网络设备通过网络层获取到目的 IP 地址之后，还要判断目的 MAC 地址是否已知。</li></ul><p class="red">4，ARP 缓存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N3nRP.png" alt="图片"></li><li>[2] 网络设备一般都有一个 ARP 缓存 (ARP Cache)，<ins class="wavy">ARP 缓存用来存放 IP 地址和 MAC 地址的关联信息。</ins></li><li>[3] 在发送数据之前，设备会先检查 ARP 缓存表，如果缓存表中存在对方设备的 MAC 地址，则直接采用该 MAC 地址来封装帧，然后将帧发送出去，如果缓存表中不存在相应信息，则通过发送<ins class="wavy"> ARP Request</ins> 报文来获取它。</li><li>[4] 学习到的 IP 地址和 MAC 地址的映射关系会被放入 ARP 缓存表中存放一段时间，在有效时间内，设备可以直接从这个表中查找目的 MAC 地址来进行数据封装，而无需进行 ARP 查询，过了这段有效期，ARP 表项会被自动删除。</li><li>[5] 如果目标设备位于其他网络，则源设备会在 ARP 缓存表中查找网关的 MAC 地址，然后将数据发送给网关，网关再把数据转发给目的设备。</li></ul><p class="red">5，ARP 请求：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NGpnO.png" alt="图片"></li><li>[2] 上图，主机 A 的 ARP 缓存表中不存在主机 C 的 MAC 地址，所以主机 A 会发送 ARP Request 来获取目的 MAC 地址。</li><li>[3] ARP Request 报文封装在以太帧里，帧头中的源 MAC 地址为发送端主机 A 的 MAC 地址，此时，由于主机 A 不知道主机 C 的 MAC 地址，所以目的 MAC 地址为广播地址 FF-FF-FF-FF-FF-FF。</li><li>[4] ARP Request 报文中包含源 IP 地址，目的 IP 地址，源 MAC 地址，目的 MAC 地址，其中目的 MAC 的值为 0，ARP Request 报文会在整个网络上传播，该网络上的所有主机包括网关都会接收到此 ARP Request 报文。</li><li>[5]<ins class="wavy"> 网关将会阻止该报文发送到其他网络上。</ins></li></ul><p class="red">6，ARP 响应 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NYIjP.png" alt="图片"></li><li>[2] 所有的主机接收到该 ARP Request 报文之后，都会检查它的目的协议地址字段与本身的 IP 地址是否匹配。如果不匹配，则该主机将不会响应该 ARP Request 报文，如果匹配，则该主机会将 ARP 报文中的源 MAC 地址和源 IP 地址信息记录到自己的 ARP 缓存表中，然后通过 ARP Reply 报文进行相应。</li></ul><p class="red">7，ARP 响应 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6Ntk4J.png" alt="图片"></li><li>[2] 主机 C 会向主机 A 回应 ARP Reply 报文，ARP Reply 报文中的源协议地址是主机 C 自己的 IP 地址，目标协议地址是主机 A 的 IP 地址，目的 MAC 地址是主机 A 的 MAC 地址，源 MAC 地址是自己的 MAC 地址，同时 Operation Code 被设置为 Reply。</li><li>[3] ARP Reply 报文通过单播传输。</li></ul><p class="red">8，ARP 缓存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NNuzn.png" alt="图片"></li><li>[2] 主机 A 收到 ARP Reply 以后，会检查 ARP 报文中目的 MAC 地址是否与自己的 MAC 匹配，如果匹配，ARP 报文中的源 IP 地址和源 MAC 地址会被记录到主机 A 的 ARP 缓存表中。</li></ul><p class="red">9，ARP 代理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图:</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NUPfJ.png" alt="图片"></li><li><ins class="wavy">注：同一网段，不同物理网络上的计算机之间，可以通过 ARP 代理实现相互通信。</ins></li><li>[2] 上图组网中，主机 A 需要与主机 B 通信，目的 IP 地址与本机的 IP 地址在同一个网段，所以 A 将会以广播形式发送 ARP Request 报文请求主机 B 的 MAC 地址，但是，广播报文无法被路由器转发，所以主机 B 无法收到主机 A 的 ARP 请求报文，当然也就无法应答。</li><li>[3] 在路由器上启用代理 ARP 功能，就可以解决这个问题，启用代理 ARP 后，路由器收到这样的请求，会查找路由表，如果存在主机 B 的路由表项，路由器将会使用自己的 G0/0/0 接口的 MAC 地址来回应 ARP Request，主机 A 收到 ARP Reply 后，将以路由器的 G0/0/0 接口的 MAC 地址作为目的 MAC 地址进行数据转发。</li></ul><p class="red">10，免费 ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src alt="图片"></li><li><ins class="wavy">注：免费 ARP 可以用来探测 IP 地址是否冲突。</ins></li><li>[2] 主机被分配了 IP 地址或者 IP 地址发生变更后，必须立刻检测其所分配的 IP 地址在网络上是否是唯一的，以避免地址冲突，<ins class="wavy">主机通过发送 ARP Request 报文来进行地址冲突检测。</ins></li><li>[3] 主机 A 将 ARP Request 广播报文中的目的 IP 地址字段设置为自己的 IP 地址，且该网络中所有主机包括网关都会接收到此报文。当目的 IP 地址已经被某一个主机或网关使用时，该主机或者网关就会回应 ARP Reply 报文，通过这种方式，主机 A 就能探测到 IP 地址冲突了。</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 网络设备在什么情况下会发送 ARP Request？</li><li>源设备在发送数据给目的设备前，会首先查看自身的 ARP 缓存，查找 ARP 缓存中是否存在目的设备的 IP 地址和 MAC 地址的映射，如果存在则直接使用，如果不存在则会发送 ARP Request。</li><li>[2] 网络设备什么时候会产生免费 ARP？</li><li>当网络上的一个设备被分配了 IP 地址或者 IP 地址发生变更后，可以通过免费 ARP 来检测 IP 地址是否冲突。</li></ul><h1 id="第六章传输层协议"><a class="anchor" href="#第六章传输层协议">#</a> 第六章【传输层协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>传输层定义了主机应用程序之间端到端的连通性，传输层最为常见的两个协议分别是传输控制协议 TCP (Transmission Control Protocol) 和用户数据包协议 UDP (User datagram Protocol)。</li></ul></div></details><p class="red">1，TCP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N06xJ.png" alt="图片"></li><li><ins class="wavy">注：TCP 是一种面向连接的传输层协议，可提供可靠的传输服务。</ins></li><li>[2] TCP 位于 TCP/IP 模型的传输层，它是一种面向连接的端到端协议。</li><li>[3] TCP 作为传输控制协议，可以为主机提供可靠的数据传输，上图，在通信之前，需要 TCP 在他们之间建立可靠的传输通道。</li></ul><p class="red">2，TCP 端口号：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NBmJU.png" alt="图片"></li><li><ins class="wavy">注：端口号用来区分不同的网络服务。</ins></li><li>[2] TCP 允许一个主机同时运行多个应用进程，m 每台主机可以拥有多个应用端口，每对端口号，源和目标 IP 地址的组合唯一的标识了一个会话。</li><li>[3] 端口分为知名端口和动态端口，<ins class="wavy">有些网络服务会使用固定的端口，这类端口称为知名端口，端口范围为 0-1023。如，FTP，HTTP，Telnet，SNMP 服务均使用知名端口。</ins></li><li>[4]<ins class="wavy"> 动态端口范围从 1024-65535，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。</ins></li></ul><p class="wavy">3，TCP 头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NrECT.png" alt="图片"></li><li>[2] TCP 通常使用 IP 作为网络层协议，这时 TCP 数据段被封装在 IP 数据包内。</li><li>[3] TCP 数据段由 TCP Header (头部)，和 TCP Data (数据) 组成，TCP 最多可以有 60 个字节的头部，如果没有 Options 字段，正常的长度是 20 字节。</li><li>[4] TCP Header 是由上图标识的一些字段组成这里列出几个常用字段：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①16位源端口号：源主机的应用程序使用的端口号。</pre></td></tr><tr><td data-num="2"></td><td><pre>②16位目的端口号：目的主机的应用程序使用的端口号。每个TCP头部都包含源和目的端的端口号，这两个值加上IP头部中的源IP地址和目的IP地址可以唯一确定一个TCP连接。</pre></td></tr><tr><td data-num="3"></td><td><pre>③32位序列号：用于标识从发送端发出的不同的TCP数据段的序号，数据段在网络中传输时，他们的顺序可能会发生变化，接收端依据此序列号，便可按照正确的顺序重组数据。</pre></td></tr><tr><td data-num="4"></td><td><pre>④32位确认序列号：用于标识接收端确认收到的数据段，确认序列号为成功收到的数据数列号加1.</pre></td></tr><tr><td data-num="5"></td><td><pre>⑤4位头部长度：表示头部占用32bit字的数目，它能表达的TCP头部最大长度为60字节。</pre></td></tr><tr><td data-num="6"></td><td><pre>⑥16位窗口大小：表示接收端期望通过单次确认而收到的数据的大小，由于该字段为16位，所以窗口大小的最大值为65535字节，该字节通常用来进行流量控制。</pre></td></tr><tr><td data-num="7"></td><td><pre>⑦16位校验和：校验整个TCP报文段，包括TCP头部和TCP数据，该值由发送端计算和记录并由接收端进行验证。</pre></td></tr></table></figure><p class="red">4，TCP 建立连接的过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6NsgfK.png" alt="图片"></li><li><ins class="wavy">注：TCP 通过三次握手建立可靠连接。</ins></li><li>[2] TCP 是一种可靠的，面向连接的全双工传输层协议。</li><li>[3] TCP 连接的建立是一个三次握手的过程，如图所示：</li><li>[4] 主机 A (通常也称为客户端) 发送一个标识了 SYN 的数据段，表示期望与服务器 A 建立连接，此数据段的序列号 (seq) 为 a。</li><li>[5] 服务器 A 回复了标识了 SYN+ACK 的数据阶段，此数据段的序列号 (seq) 为 b，确认序列号为主机 A 的序列号加 1 (a+1)，以此作为对主机 A 的 SYN 报文确认。</li><li>[6] 主机 A 发送一个标识了 ACK 的数据段，此数据段的序列号 (seq) 为 a+1，确认序列号为服务器 A 的序列号加 1 (b+1)，以此作为对服务器 A 的 SYN 报文的确认。</li></ul><p class="red">5，TCP 的传输过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6aPmi4.png" alt="图片"></li><li>[2] TCP 的可靠传输还体现在 TCP 使用了确认技术来确保目的设备收到了从源设备而发来的数据。并且是正确无误的。</li><li>[3] 确认技术的工作原理如下：</li><li>目的设备接收到源设备发送的数据段时，会向源端发送确认报文，源设备收到确认报文后，继续发送数据段，如此重复。</li><li>[4] 上图，主机 A 向服务器 A 发送 TCP 数据段，假定每个数据段的长度都是 500 个字节。当服务器 A 成功收到序列号是 M+1499 字节以及之前的所有字节时，会以序列号 M+1499+1=M+1500 进行确认。另外，由于数据段 N+3 传输失败，所以服务器 A 未能收到序列号为 M+1500 的字节，因此服务器 A 还会再次以序列号 M+1500 进行确认。</li></ul><p class="red">6，TCP 流量控制：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6ai1pj.png" alt="图片"></li><li>[2]<ins class="wavy"> TCP 滑动窗口技术通过动态改变窗口大小来实现对端到端设备之间的数据进行流量控制。</ins></li><li>[3] 上图，主机 A 和服务器 A 之间通过滑动窗口来实现流量控制，为方便理解，上图只考虑主机 A 发送数据给服务器 A 时，服务器 A 通过滑动窗口进行流量控制。</li><li>[4] 主机 A 向服务器发送 4 个长度为 1024 字节的数据段，其中主机的窗口大小为 4096 个字节。服务器 A 收到第三个数据段后，缓存区满。第四个数据段被丢弃，服务器以 ACK 3073 响应，窗口大小调整为 3072，表明服务器的缓冲区只能处理 3072 个字节的数据段，于是主机 A 改变其发送的速率，发送窗口大小为 3072 的数据段。</li></ul><p class="red">7，TCP 关闭连接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6aFUKI.png" alt="图片"></li><li><ins class="wavy">注：主机在关闭连接之前，要确认收到来自对方的 ACK。</ins></li><li>[2] TCP 支持全双工模式传输数据，这意味着同一时刻两个方向都可以进行数据的效数据的传输，在传输数据之前，TCP 通过三次握手建立的实际上是两个方向的连接，因此，在传输完毕之后，两个方向的连接必须都关闭。</li><li>[3]<ins class="wavy"> TCP 的建立是一个三次握手的过程，而 TCP 连接的终止则要经过四次握手。</ins></li><li>[4] 如上图：</li><li><ins class="wavy">主机 A 想要终止连接，于是发送了一个标识了 FIN，ACK 的数据段，序列号为 a，确认序列号为 b。</ins></li><li><ins class="wavy">服务器 A 回应了一个标识了 ACK 的数据段，序列号为 b，确认序号为 a+1，作为对主机 A 的 FIN 报文的确认。</ins></li><li><ins class="wavy">服务器 A 想要终止连接，于是向主机 A 发送了一个标识了 FIN，ACK 的数据段，序列号为 b，确认序列号为 a+1。</ins></li><li><ins class="wavy">主机 A 回应了一个 ACK 的数据段，序列号为 a+1，确认序列号为 b+1，作为对服务器 A 的 FIN 报文的确定。</ins></li><li>[5] 以上四次交互便完成了两个方向连接的关闭。</li></ul><p class="red">8，UDP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a4rK1.png" alt="图片"></li><li><ins wavy>注：UDP 是一种面向无连接的传输层协议，传输可靠性没有保障。</ins></li><li>[2] 当应用程序对传输的可靠性要求不高时，但是对传输速度和延迟要求较高时，可以用 UDP 协议来代替 TCP 协议在传输层控制数据的转发。</li><li>[3] UDP 将数据从源端发送到目的端时，无需事先建立连接。</li><li>[4] UDP 采用了简单，易操作的机制在应用程序之间传输数据，没有使用 TCP 中的确认技术或滑动窗口机制，因此，UDP 不能保证数据传输的可靠性，也无法避免接收到重复数据的情况。</li></ul><p class="red">9，UDP 头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a4TqP.png" alt="图片"></li><li><ins class="wavy">注：UDP 头部仅占 8 字节，传输数据时没有确认机制。</ins></li><li>[2] UDP 报文分为 UDP 报文头和 UDP 数据两部分。报头由源端口，目的端口，报文长度以及校验和组成，UDP 适合于实时数据的传输，如语音和视频通信。</li><li>[3] 相比于 TCP，UDP 的传输效率更高，开销更小，但是无法保证数据传输的可靠性。</li><li>[4] UDP 头部的标识如下：</li><li>16 位源端口号：源主机的应用程序使用的端口号。</li><li>16 位目的端口号：目的主机的应用程序使用的端口号。</li><li>16 位 UDP 长度：是指 UDP 头部和 UDP 数据的字节长度，因为 UDP 头部长度为 8 字节，所以该字节的最小值为 8。</li><li>16 位 UDP 校验和：该字节提供了与 TCP 校验字段同样的功能，该字段是可选的。</li></ul><p class="red">10，UDP 的传输过程 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a5CZV.png" alt="图片"></li><li><ins class="wavy">注：使用 UDP 传输数据时，由应用程序根据需要提供报文到达确认，排序，流量控制等功能。</ins></li><li>[2] 主机 A 发送数据包时，这些数据包是以有序的方式发送到网络中的，每个数据包独立地在网络中被发送，所以不同的数据包可能会通过不同的网络路径到达主机 B。</li><li>[3] 这样的情况下，先发的数据包不一定先到达主机 B，因为 UDP 数据包没有序号，主机 B 将无法通过 UDP 协议将数据包按照原来的顺序重新组合，所以此时需要应用程序提供报文的到达确认，排序和流量控制等功能。</li><li>[4] 通常情况下，UDP 采用实时传输机制和时间戳来传输语音和视频数据。</li></ul><p class="red">11，UDP 的传输过程 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a58RH.png" alt="图片"></li><li><ins class="wavy">注：UDP 不提供重传机制，占用资源小，处理效率高。</ins></li><li><ins class="wavy">注：一些时延敏感的流量，如语音，视频等，通常使用 UDP 作为传输协议。</ins></li><li>[2] UDP 适合传输对时延敏感的流量，如，语音和视频。</li><li>[3] 在使用 TCP 协议传输数据时，如果一个数据段丢失或者接收端对某个数据段没有确认，发送端会重新发送该数据段。</li><li>[4] TCP 重新发送数据会带来延迟和重复数据，降低了用户体验。对于时延敏感的应用，少量的数据丢失一般可以被忽略，这时使用 UDP 传输将能够提升用户的体验。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] TCP 头部中的确认标识位由什么作用？</li><li>TCP 报文头中的 ACK 标志位用于目的端对已收到数据的确认，目的端成功收到序列号为 X 的字节及之前的所有字节后，会以序列号 X+1 进行确认。</li><li>[2] TCP 头部中有哪些标识位参与 TCP 三次握手？</li><li>在 TCP 的三次握手过程中，要使用 SYN 和 ACK 标识位来请求建立连接和确认建立连接。</li></ul><h1 id="第七章数据转发过程"><a class="anchor" href="#第七章数据转发过程">#</a> 第七章【数据转发过程】</h1><details class="primary"><summary>前言</summary><div><ul><li>TCP/IP 协议族和底层协议配合，保证了数据能够实现端到端地连接。数据传输过程是一个非常复杂的过程，例如，数据在转发地过程中会进行一系列的封装和解封装。对于网络工程师来说，只有深刻地了解数据在各种不同设备上的转发过程，才能对网络进行正确的分析和检测。</li></ul></div></details><p class="red">1，数据转发过程的概述：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6duWB4.png" alt="图片"></li><li><ins class="wavy">注：数据包在相同网段内或不同网段之间转发所依据的原理基本一致。</ins></li><li>[2]<ins class="wavy"> 数据可以在同一网络内或者在不同网络间传输，数据转发过程也分为本地转发和远程转发，但两者的数据转发原理是基本一致的，都是遵循 TCP/IP 协议族。</ins></li><li>上图，主机 A 需要访问服务器 A 的 WEB 服务，并假设两者之间已经建立了 TCP 连接，接下来会以上图来讲解数据在不同网络间的传输过程。</li></ul><p class="red">2，TCP 封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dKyad.png" alt="图片"></li><li><ins class="wavy">注当主机建立了到达目的地的 TCP 连接后，便开始对应用层数据进行封装。</ins></li><li>[2]<ins class="wavy"> 主机 A 会对待发送的应用数据首先执行加密和压缩等相关操作，之后进行传输层封装。</ins></li><li>[3] Web 应用是基于传输层的 TCP 协议传输数据的，主机 A 使用 TCP 进行报文封装时，必须填充源端口和目的端口字段，初始序列号和确认序列号字段，标识位，窗口字段以及校验和字段。</li><li>[4] 此列中，数据段的源端口号为主机 A 随机的 1027 号端口，目的端口号为服务器 A 的 TCP 知名端口 80。</li></ul><p class="wavy">3，IP 封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dMDS0.png" alt="图片"></li><li>[2] 主机 A 完成传输层封装后，一般会进行网络层数据封装，在使用 IP 进行封装时，需要明确 IP 报文的源和目的地址，如果报文的大小大于网络的最大传输单元 (MTU)，则该报文有可能在传输过程中被分片。</li><li>[3] 生存时间 (TTL) 字段用来减少网络环路造成的影响。ARG3 系列路由器产生的数据包，默认 TTL 值为 255，路由器转发一个数据包时，该值会被减一，如果路由器发现该值被减为 0，就会丢弃该数据包。这样，即使网络中存在环路，数据包也不会在网络上一直被转发。</li><li>[4] 协议字段标识了传输层所使用的协议，本列中，传输层使用的是 TCP 协议，所以该字段的填充值为 0x06。</li></ul><p class="red">4，查找路由：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dQ1AJ.png" alt="图片"></li><li><ins class="wavy">注：主机 A 必须要拥有到达目的地的路由。</ins></li><li>[2]<ins class="wavy"> 每个主机都会独自维护各自的路由表项，主机 A 在发送数据前需要先检测是否能够到达目的端，这个过程是通过查找路由来完成的。</ins></li><li>[3] 上图，主机 A 拥有一条到达 “任何网络” 的路由。它发往其他网络的数据都会通过 IP 地址为 10.1.1.1 的接口转发到下一跳，即网关 10.1.1.254。</li></ul><p class="red">5，ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dlK2t.png" alt="图片"></li><li><ins class="wavy">注：通过 ARP 缓存表找到下一跳的 MAC 地址。</ins></li><li><ins class="wavy">注：如果表项里没有下一跳的 MAC 地址，主机 A 会发送 ARP 请求。</ins></li><li>[2] 接下来，由于数据包要被封装成数据帧，所以主机 A 需要获取下一跳的 MAC 地址，也就是网关的 MAC 地址，主机首先会查询 ARP 缓存表。上图，主机 A 的 ARP 缓存表中存在网关 MAC 地址的表项。</li><li>[3]<ins class="wavy"> 如果没有查找到网关的 MAC 地址表项，主机 A 会通过发送 ARP 请求来获取网关的 MAC 地址。</ins></li></ul><p class="red">6，以太网封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6d1WkQ.png" alt="图片"></li><li>[2] 主机 A 在链路层封装数据帧时，会遵循 IEEE 802.3 或 Ethernet II 标准，Ethernet II 帧头中的类型字段填充为 0x0800，以表示网络层使用的是 IP 协议，源 MAC 地址为主机 A 的 MAC 地址，目的 MAC 地址为网关路由器的 E0/0 接口的 MAC 地址。</li></ul><p class="red">7，数据帧转发过程：</p><div class="note infojie'fu"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6d80Mt.png" alt="图片"></li><li><ins class="wavy">注：主机工作在半双工模式下，所以会使用 CSMA/CD 来检测链路是否空闲。</ins></li><li><ins class="wavy">注：前导码用于使接收者进入同步状态，定界符用于指示帧的开始。</ins></li><li>[2] 主机 A 工作在半双工模式下，所以会使用 CSMA/CD 里检测链路是否空闲，如果链路空闲，++ 主机 A 会将一个前导码 (Preamble) 和一个帧首定界符 (SFD) 附加到帧头然后进行传输。</li><li>[3]<ins class="wavy"> 前导码的作用是使接收设备进行同步并做好接收数据帧的准备。前导码是包括了 7 个字节的二进制 &quot;1&quot;,&quot;0&quot; 交替的代码，即 1010...10 共 56 位。</ins></li><li>[4]<ins class="wavy"> 帧首定界符是长度为 1 个字节的 10110101 二进制序列，它的作用是使接收端对帧的第一位进行定位。</ins></li></ul><p class="red">8，数据帧转发过程 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dRyPH.png" alt="图片"></li><li><ins class="wavy">注：每个冲突域里的设备都会收到主机 A 发送的数据帧。</ins></li><li><ins class="wavy">注：只有网关 (RTA) 会处理该数据帧，并继续转发。</ins></li><li>[2] 上图，主机 A 发送数据帧到共享以太网，此网络中的所有设备都会收到数据帧。设备收到帧之后，首先会进行 FCS 校验，如果 FCS 未能通过，则帧被立即丢弃。</li><li>[3] 对于通过了 FCS 校验的帧，设备会检察帧中的目的 MAC 地址，如果帧中的目的 MAC 地址与自己的 MAC 地址不同，设备将丢弃帧，如果相同，则会继续处理。</li><li>[4] 在处理过程中，帧头帧尾会被剥去 (也就是解封装)，剩下的数据报文会被根据帧头中的类型字段的值来送到网络层中的对应协议模块去处理。</li></ul><p class="red">9，数据帧转发过程 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6doKfS.png" alt="图片"></li><li><ins class="wavy">注：网关检查是否具有到达目的网络的路由条目。</ins></li><li><ins class="wavy">注：如果存在转发路径，则为数据包添加一个新的二层帧头和帧尾，并继续转发。</ins></li><li>[2] RTA 收到此数据报文后，网络层会对该报文进行处理。RTA 首先根据 IP 头部信息中的校验和字段，检查 IP 数据报文头部的完整性，然后根据目的 IP 地址查看路由表，确定是否能够将数据包转发到目的端。RTA 还必须对 TTL 的值进行处理，另外，报文大小不能超过 MTU 值。如果报文大小超过 MTU 值，则报文将被分片。</li><li>[3] 网络层处理完成之后，报文将被收到数据链路层重新进行封装，成为一个新的数据帧，该帧的头部会封装新的源 MAC 地址和目的 MAC 地址，如果当前设备不知道下一跳的 MAC 地址，将会使用 ARP 来获得。</li></ul><p class="red">10，数据包解封装 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wtRIK.png" alt="图片"></li><li><ins class="wavy">注：服务器 A 检查数据包的目的 IP 地址，发现目的 IP 与自己的 IP 地址相同。</ins></li><li><ins class="wavy">注：服务器 A 剥掉数据包的 IP 报头后，会往上层协议 TCP 继续进行处理。</ins></li><li>[2] 服务器 A 通过 IP 协议来处理该报文，首先会通过校验和字段来验证报文头的完整性，然后检查 IP 报文头中的目的 IP 地址是否与自己当前的 IP 地址匹配。</li><li>[3] 如果在源和目的之间的数据传输期间数据发生了报文分片，则报文会被目的端重新组合。标识字段用于标识属于同一数据源的分片报文，偏移量标识该分片在源分组中的相对位置。</li><li>[4] 标志字段目前只有两位有意义，标志字段最低位为 1，表示后面还有分片，为 0 表示这已经是最后一个数据片，中间一位为 1 表示不能分片，为 0 表示可以分片。所有的分片报文必须被目的端全部接收到后才能进行重新组合。</li><li>[5] 协议字段表示此数据包携带的上层数据是上层数据的哪种协议的数据，需要注意的是，下一个报头并非总在传输层报头，例如，ICMP 报文也是使用 IP 协议封装，协议字段值为 0x01。</li></ul><p class="red">11，数据段解封装 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wUA0I.png" alt="图片"></li><li><ins class="wavy">注：服务器 A 检查 TCP 头部的目的端口，然后将数据段发送给应用层的 HTTP 协议进行处理。</ins></li><li>[2] 当 IP 报文头被处理完并剥离后，数据段会被发送到传输层进行处理。</li><li>[3] 上图，传输层协议使用的是 TCP，且发送端和接收端已经通过三次握手建立了连接。</li><li>[4] 传输层收到该数据段后，TCP 协议会查看并处理该数据段头部信息，其中目的端口号为 80，用于表示处理该数据的应用层协议为 HTTP 协议。</li><li>[5] TCP 处理完头部信息后会将此数据段头部进行剥离，然后将剩下的应用数据发送到 HTTP 协议进行处理。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 数据在进行二层和三层封装之前，主机需要了解哪些信息？</li><li>主机在封装数据包之前，必须要知道目的端 IP 地址，在封装数据帧之前，必须要知道去往目的网络的路由以及下一跳的 MAC 地址。</li><li>[2] 当数据帧发送到非目的主机时，非目的主机将会如何处理？</li><li>如果主机接收到一个不是发往自己的数据帧，在检验帧头中的目的 MAC 地址之后会丢弃该帧。</li><li>[3] 传输层如何能够准确的将数据交给特定应用？</li><li>传输层会检查 TCP 或 UDP 报文头中的目的端口号，以此来识别特定应用。</li><li>[4] 当两台主机同时访问服务器的 HTTP 服务，该服务器如何区分数据属于哪个会话？</li><li>服务器可以只通过源 IP 地址识别两台主机的 HTTP 流量，另外 TCP 报文头中包含的源端口也可以被用来区分同一台主机通过不同的浏览器发起的不同的会话。例如，两个来自源 IP 为 10.1.1.1 的 HTTP 流量使用的目的端口号都是 80，但源端口号为 1028 和 1035。</li></ul><h1 id="第八章vrp基础"><a class="anchor" href="#第八章vrp基础">#</a> 第八章【VRP 基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>交换机可以隔离冲突与，路由器可以隔离广播域。这两种设备在企业网络中应用越来越广泛，随着越来越多的终端接入到网络中，网络设备的负担也越来越重，这时网络设备可以通过华为专有的 VRP 系统来提升运行效率。</li><li>通用路由平台 VRP (Versatile Routing Platform) 是华为公司数据通信产品的通用操作系统，它以 IP 业务为核心，采用组件化的体系结构，在实现丰富功能特性的同时，还提供了基于应用的可裁剪和可拓展的功能，使得路由器和交换机的运行效率大大增加，能对 VRP 熟练地进行配置和操作是对网络工程师的一种基本要求。</li></ul></div></details><p class="red">1，交换机的应用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wwYNt.png" alt="图片"></li><li><ins class="wavy">注：如果使用 Hub，则主机 A 发送数据时，其他主机都不能发送数据，否则会发送冲突。使用交换机时，则不会出现这种现象。</ins></li><li>[2] 由集线器 [HUB] 和中继器组建的以太网，实质上是一种共享式以太网，共享式以太网的主要缺陷有：<ins class="wavy">冲突严重，广播泛滥，安全性差。</ins></li><li>[3] 交换机是工作在数据链路层的设备，交换机可以将一个共享式以太网分割为多个冲突域，链路层流量被隔离在不同的冲突域中进行转发，如此便极大地提升了以太网的性能。</li><li>[4] 更进一步说，通常主机和交换机之间以及交换机与交换机之间都使用全双工技术进行通信，这时冲突现象会被彻底消除。</li><li>[5] 上图，由 HUB 搭建的网络中，所有的主机都处于同一个冲突域，主机 A 在发送数据给主机 B 时，其他主机都将收到此数据，但同时这些主机都不能发送数据。</li><li>[6] 用交换机替代 HUB 后，因为交换机分割了冲突域，所以在主机 A 发送数据给主机 B 时，主机 C 和主机 D 之间也可以同时互相发送数据。</li></ul><p class="red">2，路由器的应用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wDyEd.png" alt="图片"></li><li><ins class="wavy">注：路由器可以分割广播域。</ins></li><li>[2] 交换机虽然可以隔离冲突域，但是当一台设备发送广播帧时，其他设备仍然都会收到该广播帧，随着网络规模的增大，广播会越来越多，这样就会影响网络的效率，路由器可以用来分割广播域，减少广播对网络效率的影响。</li><li>[3]<ins class="wavy"> 一般情况下，广播帧的转发被限制在广播域内，广播域的边缘是路由器，因为，通常路由器不会转发广播帧。</ins></li><li>[4] 路由器负责在网络间转发报文，它能够在自身的路由表里查找到达目的地的下一跳地址，将报文转发给下一跳路由器，如此重复，并最终将报文送达目的地。</li></ul><p class="red">3，VRP 介绍：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w6Ax0.png" alt="图片"></li><li>[2] VRP 是华为公司具有完全自主知识产权的网络操作系统，可以运行在多种硬件平台上，VRP 拥有一致的网络界面，用户界面和管理界面，为用户提供了灵活丰富的应用解决方案。</li><li>[3] VRP 平台以 TCP/IP 协议族为核心，实现了数据链路层，网络层和应用层的多种协议，在操作系统中集成了路由交换技术，Qos 技术，安全技术和 IP 语音技术等数据通信功能。并以<ins class="wavy"> IP 转发引擎技术为基础。</ins>为网络设备提供了出色的数据转发能力。</li></ul><p class="red">4，VRP 的发展：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w6oQ0.png" alt="图片"></li><li>[2] 随着网络技术和应用的飞速发展，VRP 平台在处理机制，业务能力，产品支持等方面也在持续演进。到目前为止，VRP 以及开发出了五个版本，分别是 VRP1，VRP2，VRP3，VRP5，VRP8。</li><li>[3] VRP5 是一款分布式网络操作系统，具有高可靠性，高性能，可拓展的架构设计。目前，绝大多数华为设备使用的都是 VRP5 版本。</li><li>[4] VRP8 是新一代网络操作系统，具有分布式，多线程，组件化架构，支持分布式应用和虚拟化技术，能够适应未来的硬件发展趋势和企业急剧膨胀的业务需求。</li></ul><p class="red">5，设备管理接口：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wgDDf.png" alt="图片"></li><li>[2] AR 系列企业路由器由多个型号，包括 AR150，AR200，AR1200，AR2200，AR3200。它们是华为第三代路由器产品，提供路由，交换，无线，语音和安全等功能，AR 路由器被部署在企业网络和公网之间，作为两个网络间传输数据的入口和接口。在 AR 路由器上部署多种业务能降低企业的网络建设成本和运维成本，根据一个企业的用户数和业务的复杂程度可以选择不同型号的 AR 路由器，来部署到网络中。</li><li>[3] 华为 X7 系列以太网交换机提供数据交换的功能，满足企业网络上多业务的可靠接入和高质量传输的要求，这个系列的交换机位于企业网络的接入层，汇聚层和核心层，提供大容量交换，高密度接口，实现高效的报文转发。X7 系列以太网交换机包括了 S1700，S2700，S3700，S5700，S7700，S9700 等。</li><li>[4] ARG3 系列路由器和 X7 系列交换机都提供了 Console 口作为管理口，AR2200 额外提供了 Mini USB 口作为管理口。</li></ul><p class="red">6，Console 口登录：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w2CIe.png" alt="图片"></li><li>[2] 使用 Console 线缆来链接交换机或路由器的 Console 口与计算机的 COM 口，这样就可以通过计算机实现本地调试和维护，S5720 和 AR2200E 的 Console 口是一种符合 RS232 串口标准的 RJ-45 接口。目前大多数台式电脑提供的 COM 口都可以与 Console 口连接。笔记本电脑一般不提供 COM 口，需要使用 USB 到 RS232 的转换接口。</li></ul><p class="red">7，参数配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w2kRA.png" alt="图片"></li><li>[2] 很多终端模拟程序都能发起 Console 连接，例如，可以使用超级终端程序连接到 VRP 操作系统。</li><li>[3] 上图，使用超级终端连接 VRP 时，必须设置端口参数，上图是端口参数设置的实列，如果对参数值做了修改，需要恢复默认参数值。</li><li>[4] 完成设置以后，点击 &quot;确认&quot; 按钮即可与 VRP 建立连接。</li><li>[5] 在缺少超级终端程序的计算机上，可以使用	putty 或 Secure CRT 程序发起 Console 连接，并连接到 VRP，配置参数与上图一致。</li></ul><p class="red">8，Mini USB 口登录：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6w2DzR.png" alt="图片"></li><li>[2] 华为 AR2200 系列路由器还支持 Mini USB 口与主机 USB 口建立连接，实现对设备的调试和维护。</li><li>[3]<ins class="wavy"> 在管理设备时，Console 口和 Mini USB 口互斥，即同一时刻只能使用其中一个接口连接 VRP。</ins></li></ul><p class="red">9，Mini USB 驱动安装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6w2bef.png" alt="图片"></li><li>[2] 在使用 Mini USB 口建立连接前，需要在主机上安装驱动程序，可以从华为企业官方支持的网站下载到所需的驱动程序。</li><li>[3]++ 目前，Mini USB 的驱动程序只能安装在 Win XP，Win Vista 和 Win7 操作系统上。</li><li>[4] 华为企业官方网站网址：<span class="exturl" data-url="aHR0cDovL3d3dy5zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS8lRTMlODAlODI=">http://www.support.huawei.com/enterprise/。</span></li></ul><p class="red">10，参数配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wRVfJ.png" alt="图片"></li><li>[2] 安装驱动程序后，主机上会增加一个新的虚拟 COM 接口，终端模拟软件可以通过该虚拟 COM 接口连接到 VRP，</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如果路由器收到了网络中主机发送的广播报文，会如何操作？</li><li>当路由器收到该广播报文时，路由器会根据数据包内容尽享处理，可能会对必要广播报文 (如请求路由器 MAC 地址的 ARP 广播) 进行回应，但不会将该数据包转发到其他广播域。</li><li>[2] 华为数通设备目前使用的 VRP 版本是多少？</li><li>目前，大多数华为数通产品，使用的是 VRP5 版本，少数产品如 NE 系列路由器使用的是 VRP8 版本。</li></ul><h1 id="第九章命令行基础"><a class="anchor" href="#第九章命令行基础">#</a> 第九章【命令行基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>熟悉 VRP 命令行并且熟练掌握 VRP 配置是高效管理华为网络设备的必备基础。</li></ul></div></details><p class="red">1，设备初始化启动：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wWBK1.png" alt="图片"></li><li>[2] 管理员和工程师如果要访问在通用路由平台 VRP 上运行的华为产品，首先要进入启动程序。</li><li>[3] 开机界面信息提供了系统启动的运行程序和正在运行的 VRP 版本及其加载路径。</li><li>[4] 启动完成以后，系统提示目前正在运行的是自动配置模式，用户可以选择继续使用自动配置模式或是进入手动配置模式。</li><li>[5]<ins class="wavy"> 如果选择手动配置模式，在提示符处输入 Y，在没有特别要求的情况下，我们选择手动配置模式。</ins></li></ul><p class="red">2，命令行视图：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wf6Lq.png" alt="图片"></li><li>[2] VRP 分层的命令结构定义了很多命令行视图，每条命令只能在特定的视图中执行。</li><li>[3] 上图，介绍了常见的命令行视图，每个命令都注册在一个或多个命令视图下，用户只有先进入这个命令所在的视图，才能运行相应的命令。</li><li>[4]<ins class="wavy"> 进入到 VRP 系统的配置界面后，VRP 上最先出现的视图是用户视图，在该视图下，用户可以查看设备的运行状态和统计信息。</ins></li><li>[5] 若要修改系统参数，用户必须进入系统视图，用户还可以通过系统视图进入其他的功能配置视图，如接口视图和协议视图。</li><li>[6]<ins class="wavy"> 通过提示符可以判断当前所处的视图，例如，&quot;&lt;&gt;&quot; 表示用户视图，&quot;[]&quot; 表示除用户视图以外的其他视图。</ins></li></ul><p class="wavy">3，命令行功能：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6whn6s.png" alt="图片"></li><li>[2] 其他快捷键功能如下：</li><li>CTRL + B 将光标向左移动一个字符。</li><li>CTRL + D 删除当前光标所在位置的字符。</li><li>CTRL + E 将光标移动到当前行的末尾。</li><li>CTRL + F 将光标向右移动一个字符。</li><li>CTRL + H 删除光标左侧的一个字符。</li><li>CTRL + N 显示历史命令缓冲区中的后一条命令。</li><li>CTRL + P 显示历史命令缓冲区中的前一条命令。</li><li>CTRL + W 删除光标左侧的一个字符串。</li><li>CTRL + X 删除光标左侧所有的字符。</li><li>CTRL + Y 删除光标所在位置及其右侧所有的字符。</li><li>ESC + B 将光标向左移动一个字符串。</li><li>ESC + D 删除光标右侧的一个字符串。</li></ul><p class="red">4，命令行功能：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60NT2D.png" alt="图片"></li></ul><p class="red">5，命令行在线帮助：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60U9xg.png" alt="图片"></li><li>[2] VRP 提供两种帮助功能，分别是部分帮助和完全帮助。</li><li>[3] 部分帮助是，当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符。可以使用命令行的部分帮助获取以该字符串开头的所有关键字，如上图所示。</li><li>[4] 完全帮助是，在任一命令视图下，用户可以键入 “ ？” 获取该命令视图下所有的命令及其简单描述，如果建入一条命令关键字，后接以空格分割的 “ ？”，如果该位置为关键字，则列出全部关键字及其描述。</li></ul><p class="red">6，基本配置步骤：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60U6FP.png" alt="图片"></li><li>[2] 网络上一般都会部署不止一台设备，管理员需要 i 对这些设备进行统一管理，在进行设备调试的时候，首要任务是设置设备名。</li><li>[3] 设备名用来唯一的标识一台设备。</li><li>[4] AR2200E 路由器默认的设备名是 Huawei，而 S5720 交换机默认的设备名是 HUAWEI。</li><li>[5] 设备名称一旦设置，立刻生效。</li></ul><p class="red">7，配置系统时钟：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60adhV.png" alt="图片"></li><li>[2] 系统时钟是设备上的系统时间戳，由于地域的不同，用户可以根据当地的规定时钟系统时钟，用户必须正确设置系统时钟以确保其与其他设备保持同步。</li></ul><p class="red">8，配置标题消息：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60dQER.png" alt="图片"></li><li>[2] header 命令用来设置用户登录设备时终端上显示的标题信息。</li><li>[3] Login 参数指定当用户在登录设备认证过程中，激活终端连接 s 时显示的标题信息。</li><li>[4] shell 参数指定当用户成功登录到设备上，已经建立会话时显示的标题信息。</li><li>[5] header 的内容可以是字符串或文件名。当 header 的内容为字符串时，标题信息以第一个英文字符作为起使符号，最后一个相同的英文字符作为结束符，通常情况下，建议使用英文特殊符号，并需要确保在信息正文中没有此符号。</li><li>[6] 上图，header 的内容时字符串，字符串可以包含 1-2000 字符，包含空格。使用 header {login|shell} information text 命令能设置字符串形式的 header。</li><li>[7] 若要设置文件形式的 header，使用 header {login|shell} file file-name 命令。file name 参数 z 指定了标题信息所使用的文件名，登录前后，该文件的内容将以文本的形式显示。</li></ul><p class="red">9，命令等级：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60wYiq.png" alt="图片"></li><li>[2] 缺省情况下命令级别分为 0<sub>3 级，用户级别分为 0</sub>15 级。</li><li>[3]<ins class="wavy"> 用户 0 级为访问级别，对应网络诊断工具命令 (Ping，Tracert)，从设备出发访问外部的命令 (Telnet 客户端)，部分 display 命令等。</ins></li><li>[4]<ins class="wavy"> 用户 1 级为监控级别，对应命令级 0，1 级，包括用于系统维护的命令以及 display 等命令。</ins></li><li>[5]<ins class="wavy"> 用户 2 级是配置级，包括向用户提供直接网络服务，包括路由，各个网络层次的命令。</ins></li><li>[6]<ins class="wavy"> 用户 3-15 级是管理级别，对应命令 3 级，该级别主要用于系统运行的命令，对业务提供支撑作用，包括文件系统，FTP，TFTP 下载，文件交换配置，电源供应配置，备份板控制，用户管理，命令级别设置，系统内部参数配置以及用于业务故障诊断的 debugging 命令。</ins></li><li>[7] 上图，展示了如何修改命令级别，在用户视图下执行 save 命令，需要 3 级权限。</li><li>[8]<ins class="wavy"> 在具体使用中，如果我们有多个管理员账号，但只允许某一个管理员保存系统配置，则可以将 save 命令的级别提高到 4 级，并定义只有该管理员有 4 级权限，这样在不影响其他用户的情况下，可以实现对命令的使用控制。</ins></li></ul><p class="red">10，用户界面：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60DisU.png" alt="图片"></li><li><ins class="wavy">注：VTY 接口最大可配置范围为 0-14。</ins></li><li>[2] 每类用户界面都有对应的用户界面视图，用户界面 (User-interface) 视图是系统提供的一种命令行视图，用来配置和管理所有工作在异步交互方式下的物理接口和逻辑接口。从而达到统一管理各种用户界面的目的。</li><li>[3] 在连接设备前，用户要设置用户界面参数，系统支持的用户界面包括 Console 用户界面和 VTY 用户界面。</li><li>[4] 控制口 (Console Port) 是一种通信串行端口，由设备的主控板提供。</li><li>[5] 虚拟类型终端 (Virtual Type Terminal) 是一种虚拟线路端口，用户通过终端与设备建立 Telnet 或 SSH 连接后，也就建立了一条 VTY。即用户可以通过 VTY 方式登录设备。</li><li>[6] 设备一般最多支持 15 个用户同时通过 VTY 方式访问。</li><li>[7] 执行 user-interface maximum-vty number 命令可以配置同时登录到设备的 VTY 类型用户界面的最大个数，如果将最大登录用户数设为 0，则任何用户都不能通过 Telnet 或 SSH 登录到路由器。display user-interface 命令来查看用户界面信息。</li><li>[8]<ins class="wavy"> 不同的设备，或使用不同版本的 VRP 软件系统，具体可以被使用的 VTY 接口的最大数量可能不同。</ins></li></ul><p class="red">11，配置用户界面命令：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60sNKf.png" alt="图片"></li><li>[2] 用户可以设置 Console 界面和 VTY 界面属性，以提高系统安全性。如果一个连接上设备的用户一直处于空闲状态而不断开，可能会给系统带来很大的风险，所以在等待一个超时时间后，系统会自动中断连接，这个闲置切断时间又称为超时时间，默认为 10 分钟。</li><li>[3] 当 display 命令输出的信息超过一页时，系统会对输出内容进行分页，使用空格切换下一页。</li><li>[4] 如果一页输出的内容过少或过多，用户可以执行 screen-length 命令修改信息输出时一页的行数，默认行数为 24，最大支持 512 行，不建议将行数设置为 0，因为这样不会显示任何内容。</li><li>[5] 每条命令执行后，执行的记录都保存在历史命令缓存区。历史命令缓存区	默认能存储 10 条命令，可以通过运行 history-command max-size 改变可存储的命令数，最多可存储 256 条。</li></ul><p class="red">12，配置登录权限：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/606zvt.png" alt="图片"></li><li>[2] 如果没有权限限制，未授权的用户就可以，使用设备获取信息并更改配置，从设备安全角度考虑，限制用户的访问和操作权限是很有必要的，<ins class="wavy">用户权限和用户认证</ins>是提升终端安全的两种方式。用户权限要求规定用户的级别，一定级别的用户只能 z 执行特定级别的命令。</li><li>[3] 配置用户界面的用户认证方式后。用户登录设备时，需要输入密码 j 进行认证，这样就 x 限制了用户访问设备的权限，在通过 VTY 进行 Telnet 连接时，所有接入设备的 y 用户都必须要经过认证。</li><li>[4] 设备提供三种认证模式，AAA 模式，密码认证模式和不认证模式。AAA 认证模式具有很高的安全性，因为登陆时必须输入用户名和密码。密码认证只需要输入登录密码就行，所以所有的用户使用的都是同一个密码，使用不认证模式就是不需要对用户认证直接登录到设备，需要注意的是，Console 界面默认使用不认证模式。</li><li>[5] 对于 Telnet 登录用户，授权是非常必要的，最好设置用户名，密码和指定和账号相关联的权限。</li><li>[6] 注：不同 VRP 版本执行 set authentication password cipher 命令有差异，有些平台需要回车后 s 输入密码，另外一些平台可以直接在命令行后输入密码，故，在操作具体产品时，需要查阅相应的 VRP 版本。</li></ul><p class="red">13，配置接口地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BQdoD.png" alt="图片"></li><li>[2] 要在接口运行 IP 服务，必须为接口配置一个 IP 地址，一个接口一般只需要一个 IP 地址，在特殊情况下，也有可能为接口配置一个次要的 IP 地址。</li><li>[3] 例如，当路由器 AR2200E 的接口连接到一个物理网络时，该物理网络中的主机属于两个网段，为让两个网段的主机都可以通过路由器 AR2200E 访问其他网络，可以配置一个主 IP 地址和一个次要 IP 地址，一个接口只能有一个主 IP 地址，如果接口配置了新的主 IP 地址，那么新的主 IP 地址就代替了原来的主 IP 地址。</li><li>[4] Lookback 接口是一个逻辑接口，可用来虚拟一个网络或者一个 IP 主机，在运行多种协议的时候，由于 Lookback 接口稳定可靠，所以也可以用来做管理接口。</li><li>[5] 如果接口处于 Down 状态，应使用 undo shuttdown 打开该接口。</li></ul><p class="red">14，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 华为网络设备支持多少个用户同时使用 console 口登录？</li><li>华为网络设备同时只能有一个用户登录 Console 界面，因此 Console 用户的编号固定为 0</li><li>[2] 在使用命令 interface lookback interface 0 之后，lookback 0 接口的状态是什么？</li><li>Lookback 口是一种逻辑接口，在未创建之前，Lookback 接口并不存在，从创建开始，Lookback 口就一直存在，并一直保持 Up 状态，除非被手动关闭。</li></ul><h1 id="第十章文件系统基础"><a class="anchor" href="#第十章文件系统基础">#</a> 第十章【文件系统基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>华为网络设备的配置文件和 VRP 系统文件都保存在物理储存介质中，所以文件系统是 VRP 正常运行的基础。只有掌握了对文件系统的基本操作，网络工程师才能对设备的配置文件和 VRP 系统文件进行高效的管理。</li></ul></div></details><p class="red">1，基本查询命令：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BlvHf.png" alt="图片"></li><li>[2] 上图，在用户始于中使用 dir 命令，可以查看 flash 中的文件信息。</li></ul><p class="red">2，目录操作：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BGLi8.png" alt="图片"></li></ul><p class="red">3，文件操作 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BGjzQ.png" alt="图片"></li><li>[2] 文件操作包括：复制，移动，重命名，压缩，删除，恢复等。</li></ul><p class="red">4，文件操作 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BJFiT.png" alt="图片"></li></ul><p class="red">5，配置文件管理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTCS1.png" alt="图片"></li><li>++ 注：设备启动时，会加载保存的配置文件到 RAM，并作为当前配置文件。</li><li>[2] 设备中的配置文件分为两种类型：<ins class="wavy">当前配置文件和保存的配置文件。</ins>。</li><li>[3] 当前配置文件保存在设备的 RAM 中，用户可以通过命令行对设备进行配置，配置完成后使用 save 命令保存当前配置到储存设备中，形成保存的配置文件。</li><li>[4]++ 保存的配置文件都是以 “.cfg” 或 “.zip” 作为扩展名，存放在储存设备的根目录下。</li><li>[5] 在设备启动时，会从默认的储存路径下加载保存的配置文件到 RAM 中，如果默认储存路经中没有保存的配置文件，则设备会使用缺省参数进行初始化配置。</li></ul><p class="red">6，配置文件查询：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTapn.png" alt="图片"></li></ul><p class="red">7，配置文件保存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTHtH.png" alt="图片"></li><li>[2] SAVE 命令可以用来保存当前配置信息到系统默认的储存路径中。</li></ul><p class="red">8，系统启动文件查询：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6y79Ag.png" alt="图片"></li><li>[2] display startup 命令用来查看设备本次及下次启动相关的系统软件，备份系统软件，配置文件，License 文件，补丁文件以及语音文件。</li><li>[3] Startup system software 表示的是本次系统启动所使用的 VRP 文件。</li><li>[4] Next startup system software 表示的是下次系统启动所使用的 VRP 文件。</li><li>[5] Startup save-configuration file 表示得是本次系统启动所使用的配置文件。</li><li>[6] Next startup save-configuration file 表示得是下次系统启动所使用的配置文件。</li></ul><p class="red">9，系统启动配置文件修改：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yHVGd.png" alt="图片"></li><li>[2] 设备启动时，会从储存设备中加载配置文件并进行初始化，如果储存设备中，没有配置文件，设备将会使用默认参数进行初始化。</li><li>[3] configuration-file 参数为系统启动配置文件的名称。</li></ul><p class="red">10，比较当前配置和保存的配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yHldS.png" alt="图片"></li><li>[2] compare configuration (configuration-file)(current-line-number save-line-number) 命令用来比较当前的配置与下次启动的配置文件内容的区别，configuration-file 指定需要与当前配置进行比较的配置文件名，current-line-number 表示从当前配置的该行号开始比较，save-line-number 表示从指定配置的该行号开始比较。</li><li>[3] 当执行该命令后，系统默认会将保存的配置与当前得到配置从第一行开始逐行比较。</li><li>[4] 系统比较出不同之处后，将从两者有差别的地方开始显示字符，默认显示 120 个字符。如果从该不同之处到文件末尾不足 120 个字符，将显示到文件尾为止。</li></ul><p class="red">11，配置文件重置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybVTU.png" alt="图片"></li><li>[2] reset saved-configuration 命令用来清除储存设备中启动配置文件的内容。</li><li>[3] 执行该命令后，如果不使用该命令 startup save-configuration 重新指定设备下次启动时使用的配置文件，也不使用 save 命令保存配置文件，则设备下次启动时会采用缺省的配置参数进行初始化。</li></ul><p class="red">12，存储设备：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybd1A.png" alt="图片"></li><li>[2] 存储设备包括 SDRAM，Flash，NVRAM，SD 卡，U 盘等。例如，AR2200E 的路由器有内置的闪存，该路由器提供了两个预留的 USB 插槽 (USB0 和 USB1) 和一个 SD 卡插槽 (SD0)。</li><li>[3] S5720 交换机包含了一个内置闪存，该闪存根据型号不同，存储容量也不同，S5720-EI 支持 340M 内存，S5720-HI 支持 400M 闪存。</li><li>[4]++ 执行 display version 命令可以查看华为存储设备的详细信息。</li></ul><p class="red">13，存储设备修复：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybbh4.png" alt="图片"></li><li><ins class="wavy">注：当存储设备的文件系统出现异常时，可以通过 fixdisk 命令进行修复。</ins></li><li>[2] fixdisk 命令用来对文件系统出现异常的存储设备进行修复，当存储设备上的文件系统出现异常时，终端会给出提示信息，此时建议使用此命令进行修复，但不确保修复成功。</li><li>[3]<ins class="wavy"> 执行此命令后，如果仍然收到系统建议修复的信息，则表示物理介质可能已经损坏。</ins></li><li>此命令是问题修复类命令，在系统未出现问题时，建议用户不要执行此命令。</li><li><ins class="wavy">有些 VRP 版本不支持 fixdisk 命令，在操作具体产品时请查阅相应的 VRP 文档。</ins></li></ul><p class="red">14，存储设备格式化：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yqF9H.png" alt="图片"></li><li><ins class="wavy">注：格式化会导致数据丢失。</ins></li><li>[2] 当文件系统出现异常无法修复时，并且确认不在需要存储器上的所有数据时，可格式化存储设备。格式化存储设备会导致设备上的数据丢失，且这些文件不能恢复。</li><li>[3] format (devicename) 命令用来格式化存储器，在执行 format 命令时，需要指定 devicename 参数，表示格式化特定的存储器，在执行此命令后，会清空指定存储器中的所有文件和目录，并且不可恢复，所以谨慎使用 format 命令！</li><li>[4] 有些 VRP 版本不支持 format 命令。</li></ul><p class="red">15，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 设备中的文件属性有 drw，其中 d 代表什么含义？</li><li>d 表明是个目录，r，w，是可读出，可写入的意思。</li><li>[2] 如果设备中有多个配置文件，如何指定下次启动时使用的配置文件？</li><li>配置文件可以不使用默认的文件名 vrp.cfg, 而用其他指定的名称保存到路由器或交换机中，如果需要指定某一个配置文件为下次启动时使用的配置文件，可以执行 startup saved-configuration (configuration-file-name) 命令，这里的配置文件名包括文件名称和拓展名。</li></ul><h1 id="第十一章vrp系统管理"><a class="anchor" href="#第十一章vrp系统管理">#</a> 第十一章【VRP 系统管理】</h1><details class="primary"><summary>前言</summary><div><ul><li>为了满足企业业务对网络的需求，网络设备中的系统文件需要不断进行升级，另外，网络设备中的配置文件也需要时常进行备份，以防设备故障或其他灾害个业务带来损害。</li><li>在升级和备份系统文件或配置文件时，经常会使用 FTP 和 TFTP 来传输文件。</li><li>++ 注：使用 FTP，TFTP，SFTPv1 协议存在安全风险，建议使用 SFTPv2 方式进行文件操作。</li></ul></div></details><p class="red">1，升级 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yLnMR.png" alt="图片"></li><li><ins class="wavy">注：随着 VRP 版本的更新，VRP 支持的特性也越来越多，可根据需求更新 VRP 版本。</ins></li></ul><p class="red">2，文件传输：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yOCSH.png" alt="图片"></li><li><ins class="wavy">注：网络设备可以从服务器获取 VRP 系统文件，也可以将日志文件，配置文件保存到服务器作为备份。</ins></li><li>[2] 文件传输是指发送文件到远程服务器，或者从远程服务器获取文件的过程。</li><li>[3] 在实际场景中，为满足企业业务的需求。设备的 VRP 文件需要更新，如上图所示，设备在与服务器建立连接之后，可以从服务器获取新的 VRP，完成更新工作。</li><li>[3] 为避免数据丢失对业务造成影响，设备的配置文件和日志文件也通常会进行备份，如上图所示，设备在与服务器建立连接之后，可以将配置文件，日记文件传输到服务器上，完成备份工作，当设备上的文件丢失后，可以恢复之前服务器上备份的配置文件和日志文件。</li></ul><p class="red">3，文件传输协议：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cTK61.png" alt="图片"></li><li><ins class="red">注：常用的文件传输协议有 FTP 和 TFTP 两种。</ins></li><li>[2] FTP (File Transfer Protocol) 是 TCP/IP 协议族中一种<ins class="wavy">应用层协议</ins>，称为文件传输协议。</li><li>[3] FTP 的主要功能是向用户提供本地和远程主机之间的文件传输。++ 在进行版本升级，日记下载和配置保存等业务操作时，会广泛地使用到 FTP，</li><li>[4] FTP 采用两个 TCP 连接：<ins class="wavy">控制连接和数据连接</ins>。其中控制连接用于连接控制端口，传输控制命令。数据连接用于连接数据端口。传输数据。在控制连接建立后，数据连接通过控制端口的命令建立起连接，进行数据的传输。</li><li>[5] FTP 数据连接的建立有两种：<ins class="wavy">主动模式和被动模式。</ins>两者之间的区别在于数据连接是由服务器发起还是客户端发起。</li><li>[6] ARG3 系列路由器既可以作为 FTP Client 又可以作为 FTP Server。缺省情况下，AR2200 采用主动模式建立数据连接。</li><li>[7] TFTP (Trivial File Transfer Protocol) 是一种简化的文件传输协议，TFTP 协议使用 UDP 协议进行文件的传输，由客户端发起 TFTP 传输请求，实现文件的上传和下载。ARG3 系列路由器只可以作为 TFTP 客户端。</li></ul><p class="red">4，VRP 系统文件更新配置 —— 与 FTP 服务器连接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cHERJ.png" alt="图片"></li><li><ins class="wavy">注：在通过 FTP 传输任何数据之前，首先必须保证 FTP 客户端和 FTP 服务器之间可以通信。</ins></li></ul><p class="red">5，VRP 系统文件更新配置 —— 查看剩余存储空间：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cHgLq.png" alt="图片"></li><li><ins class="wavy">注：当剩余存储空间不足时，可以删除无关的 VRP 文件或其他文件以释放空间。</ins></li><li>[2] 在获取 VRP 文件之前，还要确认设备有足够的存储空间来存储新获取的 VRP 文件，可以用 dir 命令来检查当前目录中的文件和可用空间，如果存储空间不足，需要删除无关文件来释放足够的空间，上图，通过 delete 命令删除以存在的无关 VRP 文件来获取了足够的空间。</li></ul><p class="red">6，VRP 系统文件更新配置 - 从 FTP 服务器获取 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cXcVI.png" alt="图片"></li><li>[2] 如需从 FTP 服务器获取文件，客户端需要使用 ftp [ip address] 命令来发起 FTP 连接请求，其中 ip address 指的是 FTP 服务器的 IP 地址，客户端和 FTP 服务器建立连接之后，客户端需要使用 FTP 服务器中配置的用户名和密码进行认证。认证通过后，客户端可以访问 FTP 服务器，并且能够查看和下载存储在服务器中的文件。</li><li>[3] 上图，客户端使用 ftp 10.1.1.2 和 FTP 服务器建立了连接，使用 get AR2220E-V200R007C00SPC600.cc 命令可以获取位于 FTP 服务器上的 VRP 文件。</li></ul><p class="red">7，VRP 系统文件更新配置 —— 从 TFTP 服务器获取 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cxMPP.png" alt="图片"></li><li><ins class="wavy">注：ARG3 路由器只需使用上述命令即可从 TFTP 服务器获取 VRP 文件。</ins></li><li>[2] 如果客户端需要从 TFTP 服务器获取 VRP 文件，则不需要首先和 TFTP 服务器建立连接。</li><li>[3]<ins class="wavy"> ARG3 系列路由器和 X7 系列交换机只能作为 TFTP 客户端。</ins></li><li>[4] 上图，客户端通过配置 TFTP 10.1.1.2 get AR2220E-V200R003SPC600.cc 就可以从 TFTP 服务器获取 VRP 文件。</li></ul><p class="red">8，VRP 系统文件更新配置 - 指定下次启动时加载的 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6czTpV.png" alt="图片"></li><li>[2] 从服务器成功获取 VRP 文件后，还需要配置此文件为设备下次启动时的系统文件，否则，设备仍会使用旧版本的 VRP 系统文件。</li><li>[3] 在设备上通过使用 startup system-software 命令可以指定下次启动的系统文件。</li><li>[4] VRP 系统文件必须存储在根目录。否则。系统不能正常运行。</li><li>[5] 上图，可以使用 display startup 命令去验证系统启动文件是否已经变更，显示信息中 Startup system software 显示当前系统启动使用的 VRP 文件，Next startup system software 显示下次系统启动使用的 VRP 文件。</li></ul><p class="red">9，VRP 系统文件更新配置 —— 重启设备：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gPyqO.png" alt="图片"></li><li><ins class="wavy">注：设备重启后，将会加载新的 VRP 系统。</ins></li><li>[2] 确认系统下次启动软件正确后，需要重启设备，使用 reboot 命令可以重启设备，输入此命令后，系统会提示是否保存配置文件，实际中，可根据需要进行选择，上图选择了不保存配置。</li></ul><p class="red">10，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 设备作为 FTP 客户端时，如何从服务器下载 VRP?</li><li>首先必须保证客户端和服务器之间可以通信，然后客户端需要使用 ftp [IP address] 命令与服务器建立 FTP 连接，建立连接之后需要输入正确的用户名和密码进行验证，验证通过后使用 get 命令即可下载 VRP。</li><li>[2] 在完成 VRP 升级并重启之后，管理员如何确认升级成功？</li><li>管理员可以使用 display startup 命令验证系统启动的 VRP 软件。以此来判断	VRP 升级是否成功。</li></ul><h1 id="第十二章交换网络基础"><a class="anchor" href="#第十二章交换网络基础">#</a> 第十二章【交换网络基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>常见的以太网设备包括 Hub，交换机等。交换机工作在数据链路层，它有效地隔离了以太网中的冲突域，极大地提升了以太网的性能。</li></ul></div></details><p class="red">1，小型交换网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gi5tJ.png" alt="图片"></li><li><ins class="wavy">注：交换机工作在数据链路层，转发数据帧。</ins></li><li>[2] 随着企业网络的发展，越来越多的用户需要接入到网络，交换机提供了大量的接入接口能够很好地满足了这种需求，同时，交换机也彻底解决了困扰早期以太网冲突问题，极大地提升了以太网的性能，同时也提供了以太网的安全性。</li><li>[3] 交换机工作在数据链路层，对数据帧进行操作，在收到数据帧后，交换机会根据数据帧的头部信息对数据帧进行转发。</li></ul><p class="red">2，交换机的转发行为：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gFWvt.png" alt="图片"></li><li>[2] 交换机中有一个 MAC 地址库，里面存放了 MAC 地址与交换机端口的映射关系，MAC 地址表也称为 CAM (Content Addressable Memory) 表。</li><li>[3] 上图，++ 交换机对帧的转发操作行为一共有三种：泛洪 (Flooding)，转发 (Forwarding)，丢弃 (Discarding)。</li><li>[4] 泛洪 (Flooding)：交换机把从某一个端口进来的帧通过所有其他的端口转发出去 (注意，&quot;所有其他的端口&quot; 是指除了这个帧进入交换机的那个端口以外的所有端口)。</li><li>[5] 转发 (Forwarding)：交换机把从某一端口进来的帧通过另一个端口转发出去 (注意，&quot;另一个端口&quot; 是指不是这帧进入交换机得到那个端口).。</li><li>[6] 丢弃 (Discarding)：交换机把从某一端口进来的帧直接丢弃。</li><li>[7] 交换机的基本工作原理可以概括地描述如下：</li><li>①如果进入交换机的是一个单播帧，则交换机会去 MAC 地址表中查找这个帧的目的 MAC 地址。</li><li>如果查不到这个 MAC 地址，则交换机执行泛洪操作。</li><li>如果查到了这个 MAC 地址，则比较这个 MAC 地址在 MAC 地址表中对应的端口是不是这个帧进入交换机的那个端口，如果不是，则交换机执行转发操作，如果是，则交换机执行丢弃操作。</li><li>[8] 如果进入交换机的是一个广播帧，则交换机不会去查 MAC 地址表，而是执行泛洪操作。</li><li>[9] 如果进入交换机的是一个组播组，则交换机的处理行为比较复杂，另外，交换机还具有学习功能，当一个帧进入交换机后，交换机会检查这个帧的源 MAC 地址，并将该源 MAC 地址与这个帧进入交换机的那个端口进行映射，然后将这个映射关系存放进 MAC 地址表。</li></ul><p class="red">3，交换机初始状态：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gACef.png" alt="图片"></li><li><ins class="wavy">注：初始状态下，交换机 MAC 地址表为空。</ins></li><li>[1] 初始状态下，交换机并不知道所连接主机的 MAC 地址，所以 MAC 地址表为空，上图，SWA 为初始状态，在收到主机 A 发送的数据帧之前，MAC 地址表中没有任何表项。</li></ul><p class="red">4，学习 MAC 地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gAQTU.png" alt="图片"></li><li><ins class="wavy">注：交换机将收到的数据帧的源 MAC 地址和对应接口记录到 MAC 地址表中。</ins></li><li>[2] 主机 A 发送数据给主机 C 时，一般会首先发送 ARP 请求来获取主机 C 的 MAC 地址，此 ARp 请求帧中的目的 MAC 地址是广播地址，源 MAC 地址是自己的 MAC 地址。</li><li>[3] SWA 收到该帧后，会将源 MAC 地址和接收端口的映射关系添加到 MAC 地址表中，缺省情况下，X7 系列交换机学习到的 MAC 地址表项的老化时间为 300 秒。</li><li>[4] 如果在老化时间内再次收到主机 A 发送的数据帧，SWA 中保存的主机 A 的 MAC 地址和 G0/0/1 的映射的老化时间会被刷新。</li><li>[5] 此后，如果交换机收到目标 MAC 地址为 00-01-02-03-04-AA 的数据帧时，都将通过 G0/0/1 端口转发。</li></ul><p class="red">5，转发数据帧：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gAxNF.png" alt="图片"></li><li>++ 注：当数据帧的目的 MAC 地址不在 MAC 表中，或者目的 MAC 地址为广播地址时，交换机会泛洪该帧。</li><li>[2] 上图，主机 A 发送的数据帧的目的 MAC 地址为广播地址，所以交换机会将此数据帧通过 G0/0/2 和 G0/0/3 端口广播到主机 B 和主机 C。</li></ul><p class="red">6，目标主机回复：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gEe4e.png" alt="图片"></li><li><ins class="wavy">注：交换机根据 MAC 地址表将目的主机的回复信息单播转发给源主机。</ins></li><li>[2] 主机 B 和主机 C 收到此数据帧后，都会查看该 ARP 数据帧，但是主机 B 不会回复该帧，主机 C 会处理该帧并发送 ARP 回应。此回复数据帧的目的 MAC 地址为主机 A 的 MAC 地址，源 MAC 地址为主机 C 的 MAC 地址。</li><li>[3] SWA 收到回复数据帧时，会将该帧的源 MAC 地址和接口的映射关系添加到 MAC 地址表中。</li><li>[3] 如果此映射关系在 MAC 地址表已经存在，则会被刷新，然后 SWA 查询 MAC 地址表，根据帧的目的 MAC 地址找到对应的转发端口后，从 G0/0/1 转发此数据帧。</li></ul><p class="red">7，基本配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gVpa8.png" alt="图片"></li><li>[2] 早期的以太网的工作模式都是 10M 半双工的，随着技术的发展，出现了全双工模式，接着又出现了百兆和千兆以太网，采用不同工作模式的设备无法直接相互通信，自协商技术的出现解决了不同以太网工作模式之间的兼容性问题。</li><li>[3]<ins class="wavy"> 自协商的内容主要包括双工模式和运行速率，一旦协商通过，链路两端的设备就具有相同的工作参数。</ins></li><li>[4] negotiation auto 命令用来设置以太网端口的自协商功能，端口是否应该使能自协商模式，要考虑对接双方设备的端口是否都支持自动协商，如果对端设备的以太网端口不支持自协商模式，则需要在本端端口上先使用 undo negotiation	auto 命令配置为非自协商模式，之后，修改本端端口的速率和双工模式保持与对端一致，确保通信正常。</li><li>[5] duplex 命令用来设置以太网端口的双工模式，GE 电口工作速率为 1000Mbit/s 时，只支持全双工模式，不需要与链路对端的端口共同协商双工模式。</li><li>[6] speed 命令用来设置端口的工作速率，配置端口的速率和双工模式之前需要先配置端口为非自协商模式。</li><li>[7] 因产品型号的不同，华为交换机可能不支持更改端口双工模式。</li></ul><p class="red">8，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gZLnI.png" alt="图片"></li><li>[2] display interface () interface-type (interface-number (.sumnumber))) 命令用来查看端口当前运行状态和统计信息。</li><li>[3] current state 表示端口的物理状态，如果为 UP，表示端口处于打开状态。</li><li>[4] Line protocol current state 表示端口的链路协议状态，如果为 UP，表示端口的链路协议处于正常的启动状态。</li><li>[5] Speed 表示端口的工作速率，SWA 的 G0/0/1 端口工作速率为 100Mbits/s。</li><li>[6] duplex 表示端口的双工模式，SWA 的 G0/0/1 端口双工模式为全双工。</li></ul><p class="red">9，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 当一台主机从交换机的一个端口移动到另一个端口时，交换机的 MAC 地址表会发生什么变化？</li><li>当一台主机从交换机的一个端口移除时，交换机检测到物理链路 Down 因此会从 MAC 地址表中清除对应主机的 MAC 表项，一旦主机连接到交换机的另一个端口，交换机会检测到新端口对应的物理链路 UP。主机发送报文后，交换机就会学习到主机的 MAC 地址和新端口映射关系，并且添加到 MAC 地址表中。</li></ul><h1 id="第十三章stp原理与配置"><a class="anchor" href="#第十三章stp原理与配置">#</a> 第十三章【STP 原理与配置】</h1><details class="primary"><summary>前言</summary><div><ul><li>为了提高网络的可靠性，交换网络中通常会使用冗余链路。然而，冗余链路会给交换网络带来环路风险，并导致广播风暴以及 MAC 地址表不稳定等问题，进而会影响到用户的通信质量，生成树协议 STP (Spanning Tree Protocol) 可以在提高可靠性的同时又能避免环路带来的各种问题。</li></ul></div></details><p class="red">1，二层交换网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g1NjS.png" alt="图片"></li><li><ins class="wavy">注：交换机之间通过多条链路互联时，虽然能够提升网络可靠性，但同时也会带来环路问题。</ins></li><li>[2] 随着局域网规模的不断扩大，越来越多的交换机被用来实现主机之间的互联，如果交换机之间仅使用一条链路互联，则可能会出现单点故障，导致业务中断。为了解决此类问题，交换机在互联时一般都会使用冗余链路来实现备份。</li><li>[3] 冗余链路虽然增强了网络的可靠性，但是也会产生环路，而环路会带来一系列的问题，继而导致通信质量下降和通信业务中断等问题。</li></ul><p class="red">2，广播风暴：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g3FKS.png" alt="图片"></li><li><ins class="wavy">注：环路会产生广播风暴。</ins></li><li><ins class="wavy">注：网络中的主机会收到重复数据帧。</ins></li><li>[2] 根据交换机的转发原则，如果交换机从一个端口上接收到的是一个广播帧，或者是一个目的 MAC 地址未知的单播帧，则会将这个帧向除源端口之外的使用其他端口转发。如果交换网络中有环路，则这个帧会被无限转发，此时便会形成广播风暴，网络中也会充斥着重复的数据帧。</li><li>[3] 上图，主机 A 向外发送了一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在。SWB 接收到此帧后，将其转发到 SWA 和 SWC，SWA 和 SWC 也会将此帧转发到除了接收此帧的其他所有的接口，结果此帧又会被再次转发给 SWB，这种循环会一直持续，于是便产生了广播风暴，交换机性能会因此急剧下降，并会导致业务中断。</li></ul><p class="red">3，MAC 地址表震荡：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g3U8x.png" alt="图片"></li><li><ins class="wavy">注：环路会引起 MAC 地址表震荡。</ins></li><li>[2] 交换机是根据所收到的数据帧的源地址和接收端口生成 MAC 地址表项的。</li><li>[3] 主机 A 向外发送一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在，SWB 收到此数据帧后，在 MAC 地址表中生成一个 MAC 地址表项，00-01-02-03-04-AA，对应端口为 G0/0/3，并将其从 G0/0/1 和 G0/0/2 端口转发，上图仅以 G0/0/1 转发此帧。</li><li>[4] SWA 收到此帧后，由于 MAC 地址表中没有对应此帧目的 MAC 地址的表项，所以 SWA 会将此帧从 G0/0/2 端口发送出去。</li><li>[5] SWC 接收到此帧后，由于 MAC 地址表中也没有对应此帧的目的 MAC 地址的表项，所以 SWC 会将此帧从 G0/0/2 端口发送回 SWB，也会发给主机 B。</li><li>[6] SWB 从 G0/0/2 接口接收到此数据帧之后，会在 MAC 地址表中删除原有的相关表项，生成一个新的表项，00-01-02-03-04-AA，对应端口为 G0/0/2。此过程会不断重复，从而导致 MAC 地址表震荡。</li></ul><p class="red">4，STP 的作用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g8Okd.png" alt="图片"></li><li><ins class="wavy">注：STP 通过阻塞端口来消除回路，并能够实现链路备份的目的。</ins></li><li>[2] 在以太网中，二层网络的环路会带来广播风暴，MAC 地址表震荡，重复数据帧等问题，为了解决交换网络中的环路问题，提出了 STP。</li><li>[3] STP 的主要作用：</li><li>消除环路：通过阻断冗余链路来消除网络中可能存在的环路。</li><li>链路备份：当活动路径发送故障时，激活备份链路，及时恢复网络连通性。</li></ul><p class="red">5，STP 操作：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gG5Nj.png" alt="图片"></li><li>[2] STP 通过改造一棵树来消除交换网络中的环路。</li><li>[3] 每个 STP 网络中，都会存在一个根桥，其他交换机为非根桥，根桥或者根交换机位于整个逻辑树的根部，是 STP 网络的逻辑中心，非根桥是根桥的下游设备，当现有根桥产生故障时，非根桥之间会交互信息并重新选举根桥，交互的这种信息被称为 BPDU，BPDU 中包含交换机在参加	生成树计算时的各种参数信息。</li><li>[4] STP 中定义了三种端口角色：指定端口，根端口和预备端口。</li><li>[5] 指定端口是交换机向所连网段转发配置 BPDU 的端口，每个网段有且只能有一个指定端口。一般情况下，根桥的每一个端口总是指定端口。</li><li>[6] 根端口是非根交换机去往根桥路径最优的端口，在一个运行 STP 的交换机上最多只有一个根端口，但根桥上没有根端口。</li><li>[7] 如果一个端口既不是指定端口也不是根端口，则此端口为预备端口，预备端口将被阻塞。</li></ul><p class="red">6，根桥选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gYxpR.png" alt="图片"></li><li><ins class="wavy">注：每一台交换机启动 STP 后，都认为自己是根桥。</ins></li><li>[2]<ins class="wavy"> STP 中根桥的选举依据是桥 ID，</ins>STP 中的每个交换机都会有一个桥 ID (Bridge ID)。桥 ID 由 16 位桥优先级 (Bridge priority) 和 48 位的 MAC 地址构成，在 STP 网络中，桥优先级是可以配置的，取值范围 0~65535，默认值 32768，优先级最高的设备 (数值越小越优先) 会被选举为根桥，如果优先级相同，则会比较 MAC 地址，MAC 地址越小则越优先。</li><li>[3] 交换机启动后就自动进行生成树收敛计算，默认情况下，所有交换机启动时都认为自己是根桥，自己的所有端口都为指定端口，这样 BPDU 报文就可以通过所有端口转发，对在端交换机收到 BPDU 报文后，会比较 BPDU 中的根桥 ID 和自己的桥 ID。如果收到的 BPDU 报文中的桥 ID 优先级最高，则交换机会修改自己的 BPDU 报文的根桥 ID 字段，宣告新的根桥。</li></ul><p class="red">7，根端口选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gN1r6.png" alt="图片"></li><li><ins class="wavy">注：非根交换机在选举根端口时分别依据该端口的路径开销，对端 BID，对端 PID 和本端 PIN。</ins></li><li>[2] 非根交换机在选举根端口时分别依据该端口的根路径开销，对端 BID (Bridge ID)，对端 PID (Port ID) 和本端 PID。</li><li>[3] 交换机的每个端口都有一个端口开销 (Port Cost) 参数，此参数表示该端口在 STP 中的开销值。默认情况下端口的开销和端口的带宽有关，带宽越高，开销越低。从一个	非根桥到达根桥的路径可能有多条，每一条路径都有一个总的开销值，此开销值是该路径上所有接收 BPDU 端口的端口开销总和 (即 BPDU 的入方向端口)，称为路径开销。非根桥通过对比多条路径的 lu 路径开销，选出到达根桥的最短路径，这条最短路径的路径开销被称为 RPC (Root Path Cost，根路径开销)，并生成无环树状网络，根桥的根路径开销是 0。</li><li>[4] 一年情况下，企业网络中会存在多厂商的交换设备，华为 X7 系列交换机支持多种 STP 的路径开销计算标准，提供最大程度的兼容性，缺省情况下，华为 X7 系列交换机使用 IEEE 802.1t 标准来计算路径开销。</li><li>[5] 运行 STP 交换机的每个端口都有一个端口 ID，端口 ID 由端口优先级和端口号构成，端口优先级取值范围是 0~240，步长为 16，即取值必须为 16 的整倍数。缺省情况下，端口优先级是 128，端口 ID (Port ID) 可以用来确定端口角色。</li><li>[6] 每个非根桥都要选举一个根端口，根端口是距离根桥最近的端口，这个最近的衡量标准是靠路径开销来判定的，即路径开销最小的端口就是根端口，端口收到一个 BPDU 报文后，抽取该 BPDU 报文中根路径开销字段的值，加上该端口本身的端口开销即为本端口路径开销，如果有两个或两个以上的端口计算得到的累计路径开销相同，那么选择收到发送者 BID 最小的那个端口作为根端口。</li><li>[7] 如果两个或两个以上的端口连接到同一台交换机上，则选择发送者 PID 最小的那个端口作为根端口。如果两个或两个以上的端口通过 HUB 连接到同一台交换机的同一个接口上，则选择本交换机的这些端口中的 PID 最小的作为根端口。</li></ul><p class="red">8，指定端口选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fEegg.png" alt="图片"></li><li><ins class="wavy">注：非根交换机在选举指定端口时分别依据根路径的开销，BID，PID。</ins></li><li><ins class="wavy">注：未被选举为根端口或指定端口的端口为预备端口，将会被阻塞。</ins></li><li>[2] 在网段上抑制其他端口 (无论是自己的还是其他设备的) 发送 BPDU 报文的端口，就是该网段的指定端口。每个网段都应该有一个指定端口，根桥的所有端口都是指定端口 (除非根桥在物理上存在环路)。</li><li>[3] 指定端口的选举也是首先比较累计路径开销，累计路径开销最小的端口就是指定端口，如果累计路径开销相同，则比较端口所在交换机的桥 ID，所以桥 ID 最小的端口被选举为指定端口。如果通过累计路径开销和所在桥 ID 选举不出来，则比较端口 ID，端口 ID 最小的被选举为指定端口。</li><li>[4] 网络收敛后，只有指定端口和根端口可以转发数据，其他端口为预备端口，被阻塞，不能转发数据，只能够从所连网段的指定交换机接收到 BPDU 报文，并以此来监视链路的状态。</li></ul><p class="red">9，端口状态转换：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fV8eA.png" alt="图片"></li><li>[2] 上图所示，为 STP 的端口状态迁移机制，运行 STP 协议的设备上端口状态有 5 种。</li><li>[3] Forwarding：转发状态，端口既可以转发用户流量也可以转发 BPDU 报文，只有根端口或指定端口才能进入 Forwarding 状态。</li><li>[4] Learning：学习状态。端口可个根据收到的用户流量构建 MAC 地址表，但不转发用户流量，增加 Learing 状态是为了防止临时环路。</li><li>[5] Listening：倾听状态。端口可以转发 BPDU 报文，但不转发用户流量。</li><li>[6] Blocking：阻塞状态。端口仅仅能接收并处理 BPDU，不能转发 BPDU，也不能转发用户流量，此状态是预备端口的最终状态。</li><li>[7] Disabled：禁用状态。端口既不处理和转发 BPDU 报文，也不转发用户流量。</li></ul><p class="red">10，BPDU：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fZdtx.png" alt="图片"></li><li><ins class="wavy">注：BPDU 包含桥 ID，路径开销，端口 ID，计时器等参数。</ins></li><li>[2] 为了计算生成树，交换机之间需要交换相关的信息和参数，这些信息和参数被封装在 BPDU (Bridge Proticol Data Unit) 中。</li><li>[3] BPDU 有两种类型：配置 BPDU 和 TCN BPDU。</li><li>[4] 配置 BPDU 包含了桥 ID，路径开销和端口 ID 等参数。STP 协议通过在交换机之间传递配置 BPDU 来选举根交换机，以及确定每个交换机端口的角色和状态。在初始化过程中，每个桥都主动发送配置 BPDU，在网络拓扑稳定后，只有根桥主动发送配置 BPDU，其他交换机在收到上游传来的配置 BPDU 后，才会发送自己的配置 BPDU。</li><li>[5] TCN BPDU 是指下游交换机感知到拓扑发生变化时向上游发送的拓扑变化通知。</li><li>[6] 配置 BPDU 中包含了足够的信息来保证设备完成生成树计算，其中包含的重要信息如下：</li><li>根桥 ID：由根桥的优先级和 MAC 地址组成，每个 STP 网络中有且仅有一个根桥。</li><li>根路径开销：到根桥的最短路径开销。</li><li>指定桥 ID：由指定桥的优先级和 MAC 地址组成。</li><li>指定端口 ID：由指定端口的优先级和端口号组成。</li><li>Message Age：配置 BPDU 在网络中传播的生存期。</li><li>MAX Age：配置 BPDU 在设备中能够保存的最大生存期。</li><li>Hello Time：配置 BPDU 发送的周期。</li><li>Foeward Delay：端口状态迁移的延时。</li></ul><p class="red">11，计时器：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fmKzT.png" alt="图片"></li><li><ins class="wavy">注：配置 BPDU 报文每经过一个交换机，Message Age 都加 1。</ins></li><li><ins class="wavy">注：如果 Message Age 大于 MAx age，非根桥会丢弃该配置 BPDU。</ins></li><li>[2] STP 协议包含一些重要的时间参数，如下：</li><li>Hello Time 是指运行 STP 协议的设备发送配置 BPDU 的时间间隔，用于检测链路是否在故障，交换机每隔 Hello Time 时间会向周围的交换机发送配置 BPDU 报文，以确认链路是否存在故障。当网络拓扑稳定后，该值只有在根桥上修改才有效。</li><li>Message Age 是从根桥发送到当前交换机接收到 BPDU 的总时间，包括传输延时等，如果配置 BPDU 是根桥发出的，则 Message Age 为 0，实际现实中，配置 BPDU 报文每经过一个交换机，Message Age 增加 1。</li><li>Max Age 是指 BPDU 报文的老化时间，可在根桥上通过命令人为改动这个值，Max Age 通过配置 BPDU 报文的传递，可以保证 Max Age 在整网中一致。非根桥设备收到配置 BPDU 报文后，会将报文中的 Message Age 和 Max Age 进行比较，如果 Message Age 小于等于 Max Age，则该非根桥设备会继续转发配置 BPDU 报文。如果 Message Age 大于 Max Age，则该配置 BPDU 报文将被老化掉，该非根桥设备将直接丢弃改配置 BPDU，并认为是网络直径过大，导致了根桥连接失败。</li></ul><p class="red">12，根桥故障：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fu5Is.png" alt="图片"></li><li><ins class="wavy">注：非根桥会在 BPDU 老化之后开始根桥的重新选举。</ins></li><li>[2] 在稳定的 STP 拓扑中，非根桥会定期收到来自根桥的 BPDU 报文。</li><li>[3] 如果根桥发生了故障，停止发送 BPDU 报文，下游交换机就无法收到来自根桥的 BPDU 报文。</li><li>[4] 如果下游交换机一直接收不到 BPDU 报文，Max Age 定时器就会超时 (Max Age 的默认值为 20 秒)，从而导致已经收到的 BPDU 报文失效，此时，非根交换机会互相发送配置 BPDU 报文，重新选举新的根桥。</li><li>[5] 根桥故障会导致 50 秒左右的恢复时间，恢复时间约等于 Max Age 加上两倍的 Forward Delay 收敛时间。</li></ul><p class="red">13，直连链路故障：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fKznS.png" alt="图片"></li><li><ins class="wavy">注：SWB 检测到直连链路物理故障后，会将预备端口转换为根端口。</ins></li><li><ins class="wavy">注：SWB 新的根端口会在 30 秒后恢复到转发状态。</ins></li><li>[2] 上图：SWA 和 SWB 使用了两条链路互联，其中一条是主线路，另外一条是备份链路，生成树正常收敛后，如果 SWB 检测到根端口的链路发生物理故障，则其 Alternate 端口会迁移到 Listening，Learning，Forwarding 状态，经过两倍的 Forwarding Delay 后恢复到转发状态。</li></ul><p class="red">14，非直连链路故障：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fQPbD.png" alt="图片"></li><li><ins class="wavy">注：非直连链路故障后，SWC 的预备端口恢复到转发状态大约需要 50 秒。</ins></li><li>[2] 上图，SWB 和 SWA 之间的链路发生了某种故障 (非物理层故障)，SWB 因此一直收不到来自 SWA 的 BPDU 报文，等待 Max Age 定时器超时后，SWB 会认为根桥 SWA 不再有效，并认为自己是根桥，于是开始发送自己的 BPDU 报文给 SWC，通知 SWC 自己作为新的根桥。</li><li>[3] 在此期间，由于 SWC 的 Alternate 端口再也不能收到包含原根桥 ID 的 BPDU 报文，其 Max Age 定时器超时后，SWC 会切换 Alternate 端口为指定端口并且转发来自其根端口的 BPDU 报文给 SWB，所以，Max Age 定时器超时后，SWB SWC 几乎同时会收到对方发来的 BPDU。</li><li>[4] 经过 STP 重新计算后，SWB 放弃宣称自己是根桥并重新确定端口角色。</li><li>[5] 非直连链路故障后，由于需要等待 Max Age 加上两倍的 Forwarding Delay 时间，端口大约 50 秒才能恢复到转发状态。</li></ul><p class="red">15，拓扑改变导致 MAC 地址表错误 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6flvX6.png" alt="图片"></li><li><ins class="wavy">注：MAC 地址表项的默认老化时间是 300 秒，在这段时间内，SWB 无法将数据从 G0/0/2 端口转发给主机 B。</ins></li><li>[2] 在交换网络中，交换机依赖 MAC 地址表转发数据帧，缺省情况下，MAC 地址表的老化时间是 300 秒，如果生成树拓扑发生变化，交换机转发数据的路径也会随着发生变化，此时 MAC 地址表中未及时老化掉的表项会导致数据转发错误，因此在拓扑发生变化后需要及时更新 MAC 地址表项。</li><li>[3] 上图，SWB 的 MAC 地址表项定义了通过端口 G0/0/3 可以到达主机 A，通过端口 G0/0/1 可以到达主机 B，由于 SWC 的根端口发生故障，导致生成树拓扑重新收敛，在生成树拓扑完成收敛之后，从主机 A 到主机 B 的帧仍然不能到达目的地，这是因为 MAC 地址表项老化时间是 300 秒主机 A 发往主机 B 的帧到达 SWB 后，SWB 会继续通过端口 G0/0/1 转发该数据帧。</li></ul><p class="red">16，拓扑改变导致 MAC 地址表错误 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6f1X5Q.png" alt="图片"></li><li>[2] 拓扑变化过程中，根桥通过 TCN BPDU 报文获知生成树拓扑里发生了故障，根桥生成 TC 以来通知其他交换机加速老化现有的 MAC 地址表项。</li><li>[3] 拓扑变更以及 MAC 地址表项更新的具体过程如下：</li><li>SWC 感知到网络拓扑发生变化后，会不间段地向 SWB 发生 TCN BPDU 报文。</li><li>SWB 收到 SWC 发来的 TCN BPDU 报文后，会把配置 BPDU	报文中的 Flags 的 TCA 位设置 1，然后发送给 SWC，告知 SWC 停止发送 TCN BPDU 报文。</li><li>SWB 向根桥转发 TCN BPDU 报文。</li><li>SWA 把配置 BPDU 报文中的 Flags 的 TC 位置设置为 1 后发送，通知下游设备把 MAC 地址表项的老化时间由默认的 300 秒修改为 Forward Delay 的时间 (默认为 15 秒)。</li><li>最多等待 15 秒后，SWB 中的错误 MAC 地址表项会被自动清除，此后，SWB 就能重新开始 MAC 表项的学习及转发操作。</li></ul><p class="red">17，STP 模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fGbb6.png" alt="图片"></li><li>[2] 华为 X7 系列交换机支持三种生成树协议模式。</li><li>[3] stp mode {mstp|stp|rstp} 命令用来配置交换机的生成树协议模式，缺省情况下，华为 X7 系列交换机工作在 MSTP 模式，在使用 STP 前，STP 模式必须重新配置。</li></ul><p class="red">18，配置交换机优先级：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fJ2QA.png" alt="图片"></li><li><ins class="wavy">注：通过修改交换机的优先级，可以配置交换机为根交换机。</ins></li><li>[2] 基于企业业务对网络的需求，一般建议手动指定网络中配置高，性能好的交换机为根桥。</li><li>[3] 可以通过配置桥优先级来指定网络中的根桥，以确保企业网络里面的数据流量使用的是最优路径转发。</li><li>[4] stp priority 命令用来配置设备优先级值，priority 值为整数，取值范围为 0 到 61440，步长为 4096. 缺省情况下，交换设备的优先级取值是 32768。另外，可以通过 Stp root primary 命令指定生成树里的根桥。</li></ul><p class="red">19，配置路径开销：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fYG0P.png" alt="图片"></li><li>[2] 华为 X7 系列交换机支持三种路径开销标准，以确保和友商设备保持兼容。缺省情况下，路基开销标准为 IEEE 802.1t。</li><li>[3] stp pathcost-standard {dot1d-1998|dot1t|legacy} 命令用来配置指定交换机上路径开销值的标准。</li><li>[4] 每个端口的路径开销也可以手动指定。此 STP 路径开销控制方法须谨慎使用，手动指定端口的路径开销可能会生成次优生成树拓扑。</li><li>stp cost cost 命令取决于路径开销计算方法：</li><li>使用华为的私有计算方法时，cost 取值范围是 1~200000。</li><li>使用 IEEE 802.1d 标准方法时，cost 取值范围是 1~65535。</li><li>使用 IEEE 802.1t 标准方法时，cost 取值范围是 1~200000000。</li></ul><p class="red">20，配置验证 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6ftdUK.png" alt="图片"></li><li>[2] display stp 命令用来检查当前交换机的 stp 配置，命令输出中信息介绍如下：</li><li>CIST Bridge 参数标识指定交换机当前桥 ID，包含交换机的优先级和 MAC 地址。</li><li>Bridge Time 参数标识 HEllo 计时器，Forward Delay 计时器，Max Age 计时器</li><li>CIST Root/ERPC 参数标识根桥 ID 以及交换机到根桥的根路径开销。</li></ul><p class="red">21，配置验证 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] display stp 命令显示交换机上所有端口信息。</li><li>[2] display stp interface interface 命令显示交换机上指定端口信息。</li><li>[3] 其他一些信息还包括端口角色，端口状态，以及使用的保护机制等。</li></ul><p class="red">22，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 根桥产生故障后，其他交换机会被选举为根桥，那么原来的根桥恢复正常后，网络又会发生什么变化呢？</li><li>如果生成树网络里面根桥发生了故障，则其他交换机中优先级最高的交换机会被选举为新的根桥。如果原来的根桥再次激活，则网络又会根据 BID 来重新选举新的根桥。</li><li>[2] 端口开销和根路径开销的区别是什么？</li><li>根路径开销是到根桥的路径的总开销，而端口开销指的是交换机某个端口的开销。</li></ul><h1 id="第十四章rstp原理与配置"><a class="anchor" href="#第十四章rstp原理与配置">#</a> 第十四章【RSTP 原理与配置】</h1><p>+++primarily 前言</p><ul><li class="red">STP 协议虽然能够解决环路问题，但是收敛速度慢，影响用户通信质量，如果 STP 网络的拓扑结构频繁变化，网络也会频繁失去连通性，从而导致用户通信频繁中断，IEEE 于 2001 年发布的 802.1w 标准定义了快速生成树协议 RSTP (Rapid Spanning-Tree Protocol)，RSTP 在 STP 的基础上进行了改进，实现了网络拓扑快速收敛。<br>+++<br>1，STP 不足：</li></ul><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fdvwR.png" alt="图片"></li><li>[2] STP 能够提供无环网络，但是收敛速度较慢，如果 STP 网络的拓扑结构频繁变化，网络也会随之频繁失去连通性，从而导致用户通信频繁中断。</li><li>[3] RSTP 使用了 Proposal/Agreement 机制保证链路及时协商，从而有效避免收敛计时器在生成树收敛前超时，如上图，在交换网络中，P/A 过程可以从根桥向下游级联传递。</li></ul><p class="red">2，RSTP 端口角色：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fwMp8.png" alt="图片"></li><li>[2] 运行 RSTP 的交换机使用了两个不同的端口角色来实现冗余备份，当到根桥的当前路径出现故障时，作为根端口的备份端口，Alternate 端口提供了从一个交换机到根桥的另一条可切换路径。</li><li>[3] Backup 端口作为指定端口的备份，提供了另一条从根桥到相应 LAN 网段的备份路径，当一个交换机和一个共享媒介设备，例如 Hub 建立两个或者多个连接时，可以使用 Backup 端口，同样，当交换机上两个或者多个端口和同一个 LAN 网段链连接时，也可以使用 Backup 端口。</li></ul><p class="red">3，RSTP 边缘端口：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fwoBd.png" alt="图片"></li><li><ins class="wavy">注：边缘端口不接收处理配置 BPDU，不参与 RSTP 运算。</ins></li><li>[2] RSTP 里，位于网络边缘的指定端口被称为边缘端口，边缘端口一般与用户终端设备直接连接，不与任何交换设备连接。</li><li>[3] 边缘端口不接收配置 BPDU 报文，不参与 RSTP 运算，可以由 Disabled 状态直接转到 Forwarding 状态，且不经历时延，就像在端口上将 STP 禁用了一样。</li><li>[4] 但是，一旦边缘端口收到配置 BPDU 报文，就丧失了边缘端口的属性，成为普通 STP 端口，并重新进行生成树计算，从而引起网络震荡。</li></ul><p class="red">4，端口状态：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6f0mDJ.png" alt="图片"></li><li>[2] RSTP 把原来的 STP 的五种端口状态简化成了三种。</li><li>Discarding 状态：端口既不转发用户流量也不学习 MAC 地址。</li><li>Learning 状态：端口不转发用户流量但是学习 MAC 地址。</li><li>Forwarding 状态：端口即转发用户流量又学习 MAC 地址。</li></ul><p class="red">5，RST BPDU(1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6f0gbj.png" alt="图片"></li><li><ins class="wavy">注：STP 的配置 BPDU 中 Flag 字段的中间 6 位在 RSTP 中得到了应用。</ins></li><li>[2] 除了部分参数不同，RSTP 使用了类似 STP 的 BPDU	报文，即 RST BPDU 报文。BPDU Type 原来区分 STP 的 BPDU 报文和 RST (Rapid Spanning Tree) BPDU 报文。</li><li>[3] STP 的配 BPDU 报文的 BPDU Type 值为 0 (0X00)，TCN BPDU 报文的 BPDU Type 值为 128 (0X80)，RST BPDU 报文的 BPDU Type 值为 2 (	0X02)。</li><li>[4] STP 的 BPDU 报文的 Flags 字段只定义了拓扑变化 TC (Topology Change) 标志和拓扑变化确认 TCA (Topology Change Acknowledgment) 标志，其他字段保留。</li><li>[5] 在 RST BPDU 报文里的 Flags 字段，还使用了其他字段，包括 P/A 进程字段和定义端口状态的字段。Forward，Learning，与 Port Role 表示发出的 BPDU 的端口的状态和角色。</li></ul><p class="red">6，RST BPDU(2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/19/6fBYWV.png" alt="图片"></li><li><ins class="wavy">注：非根桥设备无论是否接收到根桥发送的配置 BPDU，都会按照 Hello Timer 规定的时间间隔发送配置 BPDU。</ins></li><li>[2] STP 中，当网络拓扑稳定后，根桥依据 Hello Timer 规定的时间间隔发送配置 BPDU 报文，其他非根桥设备在收到上游设备发送过来的配置 BPDU 报文后，才会触发发出配置 BPDU 报文。</li><li>[3] 此方式使得 STP 协议计算复杂且缓慢，RSTP 对此进行了改进，即在拓扑稳定后，无论非根桥设备是否接收到根桥传来的配置 BPDU 报文，非根桥设备都会仍然按照 Hello Timer 规定的时间间隔发送配置 BPDU，该行为完全由每台设备自主进行。</li></ul><p class="red">7，RSTP 收敛过程 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/20/6fBql8.png" alt="图片"></li><li><ins class="wavy">注：每台交换机启动 RSTP 后，都认为自己是 “根桥”，并且发送 RST BPDU。所有端都为指定端口，处于 Discarding 状态。</ins></li><li>[2] RSTP 收敛遵循 STP 的基本原理，网络初始化时，网络中所有的 RSTP 交换机都认为自己是 &quot;根桥&quot;，并设置每个端口为指定端口。此时，端口为 Discarding 状态。</li></ul><p class="red">8，RSTP 收敛过程 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s4.ax1x.com/2021/03/20/6fD9f0.png" alt="图片"></li><li><ins class="wavy">注：交换机互相发送 Proposal 置位的 RST BPDU。</ins></li><li><ins class="wavy">注：SWA 收到 SWB 的 RST BPDU，会忽略。</ins></li><li>[2] 每个认为自己是 “根桥” 的交换机生成一个 RST BPDU 报文来协商指定网段的端口状态，此 RST BPDU 报文的 Flags 字段里面的 Proposal 位需要置位。</li><li>[3] 当一个端口收到 RST BPDU 报文时，此端口会比较收到的 RST BPDU 报文和本地的 RST BPDU 报文，如果本地的 RST BPDU 报文优于接收到的 RST BPDU 报文，则端口会丢弃接收到的 RST BPDU 报文，并发送 Proposal 置位的本地 RST BPDU 报文来回复对端设备。</li></ul><p class="red">9，RSTP 收敛过程 (3)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/20/64QIJJ.png" alt="图片"></li><li><ins class="wavy">注：SWB 收到了更优的 RST BPDU，于是停止发送 RST BPDU，并开始执行同步。</ins></li><li>[2] 交换机使用同步机制来实现端口角色协商管理，当收到 Proposal 置位并且优先级最高的 BPDU 报文时，接收交换机必须设置所有下游指定端口为 Discarding 状态。</li><li>[3] 如果下游端口是 Alternate 端口或者边缘端口，则端口状态保持不变。</li><li>[4] 上图，说明了下游指定端口暂时迁移到 Discarding 状态的情形，因此，P/A 进程中任何帧转发都将被阻止。</li></ul><p class="red">10，RSTP 收敛过程 (4)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/20/64lCQI.png" alt="图片"></li><li><ins class="wavy">注：阻塞所有非边缘端口之后，SWB 将发送一个 Agreement 置位的 RST BPDU。</ins></li><li>[2] 当确认下游指定端口迁移到 Discarding 状态后，设备发送 RST BPDU 报文回复上游交换机发送的 Proposal 消息。</li><li>[3] 上图，端口已经确认为根端口，因此 RST BPDU 报文 Flags 字段里面设置了 Agreement 标记位和根端口角色。</li></ul><p class="red">11，RSTP 收敛过程 (5)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/20/64lUp9.png" alt="图片"></li><li><ins class="wavy">注：P/A 进程向下游继续传递，SWB 和 SWC 会继续进行收敛。</ins></li><li>[2] 在 P/A 进程的最后阶段，上游交换机收到 Agreement 置位的 RST BPDU 报文后指定端口立即从 Discarding 状态迁移到 Forwarding 状态，然后，下游网段开始使用同样的 P/A 进程协商端口角色。</li></ul><p class="red">12，链路故障 / 根桥失效：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/20/64lW6I.png" alt="图片"></li><li><ins class="wavy">注：链路故障或者根桥失效都会导致交换机收不到邻居发送的 RST BPDU。在 RSTP 中，3 倍的 Hello Timer 内收不到邻居的 BPDU 即认为邻居是失效。</ins></li><li>[2] 在 STP 中，当出现链路故障或者根桥失效导致交换机收不到 BPDU 时，交换机需要等待 Max Age 时间后才能确认出现了故障。</li><li>[3] 而在 RSTP 中，如果交换机的端口在连续 3 次 Hello Timer 规定的时间间隔内没有收到上游交换机发送的 RST BPDU，便会确认本端口和对端端口的通信失败，从而需要重新进行 RSTP 的计算来确定交换机及端口角色。</li></ul><p class="red">13，RSTP 拓扑变化处理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/6411gA.png" alt="图片"></li><li><ins class="wavy">注：其他交换机收到 TC 置位的 BPDU 后，清空所有其他端口学习到的 MAC 导致，收到 TC BPDU 的端口 b 不清空。</ins></li><li>[2] RSTP 拓扑变化的处理类似 STP 拓扑变化的处理，但也有些细微的差别。</li><li>[3] 上图，SWC 发生链路故障，SWA 和 SWC 立即检测出链路故障并清除连接此链路的端口上的 MAC 地址表项。</li><li>[4] 接下来 SWC 选举出新的根端口并立即进入 Forwarding 状态，因此，触发 SWC 向外发送 TC 置位的 BPDU 报文 (简称 TC 报文)，通知上游交换机清除所有其他端口上的 MAC 地址表项，除了接收到 TC 报文的端口。</li><li>[5] TC 报文周期性的转发给邻居，在此周期内，所有相关接口上 MAC 地址表项将会被清除，重新学习 MAC 地址表项。</li><li>[6] 上图，图形里面红色 X 表示，由于拓扑变化导致端口上的 MAC 地址表项被清除。</li></ul><p class="red">14，STP 兼容：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/643mMn.png" alt="图片"></li><li><ins class="wavy">注：运行 RSTP 的交换设备在谋端口上接收到运行 STP 的交换设备发出的配置 BPDU，会把该端口转换到 STP 工作模式。</ins></li><li>[2] RSTP 是可以与 STP 实现后向兼容的，但在实际中，并不推荐这种做法，原因是 RSTP 会失去其快速收敛的优势，而 STP 慢速收敛的缺点会被暴露出来。</li><li>[3] 当同一个网段里既有运行 STP 的交换机又有运行 RSTP 的交换机时，STP 交换机会忽略接收到的 RST BPDU，而 RSTP 交换机在某端口上接收到 STP BPDU 时。会等待两个 Hello Timer 时间之后，把自己的端口转换到 STP 工作模式，此后便发送 STP BPDU，这样就实现了兼容性操作。</li></ul><p class="red">15，配置 STP 模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/643Oe0.png" alt="图片"></li><li><ins class="wavy">注：执行命令后，SWA 所有端口都工作在 RSTP 模式。</ins></li><li>[2] 在 Sx7 交换机上，可以使用 stp mode rstp 命令来配置交换机工作在 RSTP 模式。</li><li>[3] stp mode rstp 命令在系统视图下执行，此命令必须在所有参与快速生成树拓扑计算机的交换机上配置。</li></ul><p class="red">16，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64GsKA.png" alt="图片"></li><li>[2] display stp 命令可以显示 RSTP 配置信息的参数，根据显示信息可以确认交换机是否工作在 RSTP 模式。</li></ul><p class="red">17，配置边缘端口：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64GoKs.png" alt="图片"></li><li><ins class="wavy">注：边缘端口可以由 Disable 直接转到 Forwarding 状态，不经历时延。</ins></li><li><ins class="wavy">注：Sx7 系列交换机默认所有端口都工作在非边缘端口。</ins></li><li>[2] 边缘端口完全不参与 STP 或 RSTP 计算，边缘端口的状态要么是 Disabled，要么是 Forwarding，终端上电工作后，他就直接由 Disabled 状态转到 Forwarding 状态，终端下电后，他就直接由 Forwarding 状态转到 Disabled 状态。</li><li>[3] 交换机所有端口默认为非边缘端口。</li><li>[4] stp edged-port enable 命令用来配置交换机的端口为边缘端口，它是一个针对某一具体端口的命令。</li><li>[5] stp edged-port default 命令用来配置交换机的所有端口为边缘端口。</li><li>[6] stp edged-port disable 命令用来将边缘端口的属性去掉，使之成为非边缘端口，他也是一个针对某一具体端口的命令。</li><li>[7] 需要注意的是，华为 Sx7 系列交换机运行 STP 时也可以使用边缘端口设置。</li></ul><p class="red">18，根保护：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64YR1g.png" alt="图片"></li><li><ins class="wavy">注：根保护功能确保了根桥的指定端口不会因为一些网络问题而改变端口角色。</ins></li><li>[2] 由于错误配置根交换机或网络中的恶意攻击，根交换机有可能会收到优先级更高的 BPDU 报文，使得根交换机变长非根交换机，从而引起网络拓扑结构的变动。</li><li>[3] 这种不合法的拓扑变化，可能会导致原来应该通过高速链路的流量被牵引到低速链路上，造成链路阻塞。</li><li>[4] 交换机提供了根保护功能来解决此问题，根保护功能通过维持指定端口角色从而保护根交换机。</li><li>[5] 一旦启用了根保护功能的指定端口收到了优先级更高的 BPDU 报文时，端口会停止转发报文并进入 Listening 状态，经过一段时间后，如果端口一直没有在收到优先级较高的 BPDU 报文，端口就会自动恢复到原来的状态。</li><li>[6] 根保护功能仅在指定端口生效，不能配置在边缘端口或者使能了环路保护功能的端口上。</li></ul><p class="red">19，BPDU 保护：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64tZDA.png" alt="图片"></li><li><ins class="wavy">注：配置 BPDU 保护功能后，如果边缘端口收到 BPDU 报文，边缘端口将会被立即关闭，并通知网管系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</ins></li><li>[2] 正常情况下，边缘端口是不会收到 BPDU 的，但是，如果有人发送 BPDU 来进行恶意攻击时，边缘端口就会收到这些 BPDU，并自动变为非边缘端口，且开始参与网络拓扑计算，从而会增加整个网络的计算工作量，并可能引起网络震荡。</li><li>[3] 为了防止上述情况发生，可以使用 BPDU 保护功能。使能 BPDU 保护功能后的交换机的边缘端口在收到 BPDU 报文时，会立刻关闭该端口，并通知网络管理系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</li><li>[4] 如果使能 BPDU 保护功能，可在系统试图下执行 stp bpdu-protection 命令。</li></ul><p class="red">20，环路保护：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64tUU0.png" alt="图片"></li><li><ins class="wavy">注：根端口如果长时间收不到来自上游的 BPDU，则进入 Discarding 状态，避免在网络中形成环路。</ins></li><li>[2] 交换机通过从上游交换机持续收到 BPDU 报文来维护根端口和阻塞端口的状态，当由于链路拥塞或者单项链路故障时，交换机不能收到上游交换机发送的 BPDU 报文，交换机重新选择根端口，最初的根端口会变成指定端口，阻塞端口进入 Forwarding 状态，这就有可能造成网络环路。</li><li>[3] 交换机提供了环路保护功能来避免这种环路的产生，环路保护功能使能后，如果根端口不能收到上游交换机发送的 BPDU 报文，则向网管发出通知信息，根端口会被阻塞，阻塞端口仍然将保持阻塞状态，这样就避免了可能发生的网络环路。</li><li>[4] 如需使能环路保护功能，可以在接口视图下执行 stp loop-protection 命令。</li></ul><p class="red">21，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64tR56.png" alt="图片"></li><li>[2] display stp interface (接口名) 命令可以显示端口的 RSTP 配置情况，包括端口状态，端口优先级，端口开销，端口角色，是否为边缘端口等待。</li></ul><p class="red">22，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] P/A 机制中同步的作用是什么？</li><li>P/A 机制是 RSTP 网络中的一种拓扑收敛机制，P/A 机制中同步的作用是避免临时环路的产生。</li></ul><h1 id="第十五章ip路由基础"><a class="anchor" href="#第十五章ip路由基础">#</a> 第十五章【IP 路由基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>以太网交换机工作在数据链路层，用于在网络内进行数据的转发，而企业网络的拓扑结构一般会比较复杂，不同的部门，或者总部和分支可能处在不同的网络中，此时就需要使用路由器来连接不同的网络，实现网络之间的是数据转发。</li></ul></div></details><p class="red">1，自治系统：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64NPZn.png" alt="图片"></li><li><ins class="wavy">注：自治系统 (AS)：由同一个管理机构管理，使用统一路由策略的路由器的集合。</ins></li><li>[2] 一般情况下，我们可以把一个企业网络认为是一个自治系统 AS (Autonomous System)。根据 RFC1030 的定义，自治系统是由一个单一实体管辖的网络。这个实体可以是一个互联网服务提供商，或一个大型组织机构。</li><li>[3] 自治系统内部遵循一个单一且明确的路由策略，最初，自治系统内部只考虑运行单个路由协议，然而，随着网络的发展，一个自治系统内现在也可以支持同时运行多种路由协议。</li></ul><p class="red">2，LAN 和广播域：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64N3i6.png" alt="图片"></li><li>[2] 一个 AS 通常由多个不同的局域网组成，以企业网络为例，各个部门属于不同的局域网，或者各个分支机构和总部也可以属于不同的局域网。</li><li>[3] 局域网内的主机可以通过交换机来实现通信，不同局域网之间的主机要想相互通信，可以通过路由器来实现。</li><li>[4] 路由器工作在网络层，隔离了广播域，并可以作为每个局域网的网关，发现到达目的网络的最优路径，最终实现报文在不同网络间的转发。</li><li>[5] 上图，RTA 和 RTB 把整个网络分成了三个不同的局域网，每个局域网为一个广播域。</li><li>[6] LAN1 内部的主机直接可以通过交换机实现相互通信，LAN2 内部的主机也是如此，但是 LAN1 内部的主机与 LAN2 内部的主机之间则必须要通过路由器才能实现相互通信。</li></ul><p class="red">3，路由选路：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/645FG8.png" alt="图片"></li><li><ins class="wavy">注：路由器负责为数据包选择一条最优路径，并进行转发。</ins></li><li>[2] 路由器收到数据包后，会根据数据包中的目的 IP 地址选择一条最优路径，并将数据包转发到下一个路由器，路径上最后的路由器负责将数据包送交目的主机。</li><li>[3] 数据包在网络上的传输就好像是体育运动中的接力赛一样，每个路由器负责将数据包按照最优的路径向下一跳路由器进行转发，通过多个路由器一站一站的接力，最终将数据包通过最优路径转发到目的地，当然有时候由于实施了一些特别的路由策略，数据包通过的路径可能并不是最佳的。</li><li>[4] 路由器能够决定数据报文的转发路径，如果由多条路径可以到达目的地，则路由器会通过进行计算来决定最佳下一跳，计算的原则会随实际使用的路由协议不同而不同。</li></ul><p class="red">4，IP 路由表：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64ISlF.png" alt="图片"></li><li><ins class="wavy">注：路由表中包含了路由器可以到达的目的网络，目的网络在路由表中不存在的数据包会被丢弃。</ins></li><li>[2] 路由器转发数据包的关键是路由表，每个路由器都保存着一张路由表，表中每条路由表项都指明了数据包要到达某网络或者某主机应通过路由器的那个物理接口发送，以及可到达该路径的哪个下一跳路由器，或者不再别的路由器而直接可以到达目的地。</li><li>[3] 路由表中包含了下列关键项：</li><li>目的地址 (Destination)：用来标识 IP 数据包的目的地址或目的网络。</li><li>网络掩码 (Mask)：IP 地址与网络掩码进行逻辑与运算便可以得到相应的网段信息，上图，目的地址为 8.0.0.0 255.0.0.0 相与后便可以得到一个 A 类的网段信息 (8.0.0.0/8)。网络掩码的另一个作用还表现在当路由表中由多条目的地址相同的路由信息时，路由器将选择其掩码最长的一项作为匹配项。</li><li>[4] 输出端口 (Interface)：指明 IP 数据包将从该路由器的哪个接口转发出去。</li><li>[5] 下一跳 IP 地址 (NextHop)：指明 IP 数据包所经由的下一跳路由器的接口地址。</li><li>[6] 路由器中的优先级，度量值等其他的字段以后介绍。</li></ul><p class="red">5，路由优先级：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/64oMgU.png" alt="图片"></li><li>[2] 路由器可以根据多种不同协议学习到去往同一目的网络的路由，当这些路由都符合最长匹配原则时，必须决定哪个路由优先。</li><li>[3] 每个路由协议都由一个协议优先级 (取值最小，优先级越高)。当有多个路由信息时，选择最高优先级的路由作为最佳路由。</li><li>[4] 上图，路由器通过两种路由协议学习到了网段 10.1.1.0 的路由，虽然 RIP 协议提供了一条看起来更加近的路线，但是由于 OSPF 具有更高的优先级，因而成为优选路由，并被加入路由表中。</li></ul><p class="red">6，路由度量：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65p3Af.png" alt="图片"></li><li>[2] 如果路由器无法用优先级来判断最优路由，则使用度量值 (Metric) 来决定需要加入路由表的路由。</li><li>[3] 一些常用的度量值有：跳数，带宽，时延，代价，负载，可靠性等。</li><li>[4] 跳数是指到达目的地所通过的路由器数目。</li><li>[5] 带宽是指链路的容量，高速链路开销 (度量值) 较小。</li><li>[6] metric 值越小，路由越优先，因此上图中 metric=1+1=2 的路由是到达目的地的最优路由，其表项可以在路由表中找到。</li></ul><p class="red">7，建立路由表：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/659rqI.png" alt="图片"></li><li>[2] 根据比较 “路由优先级” 和 “路由度量”，设备可以产生最优路径的 IP 路由表。</li><li>[3] 根据来源的不同，路由表中的路由通常可分为以下三类：</li><li>链路层协议发现的路由 (也称为接口路由或直连路由)。</li><li>由网络管理员手工配置的静态路由。</li><li>动态路由协议发现的路由。</li></ul><p class="red">8，最长匹配原则：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/659HoV.png" alt="图片"></li><li><ins class="wavy">注：路由表中如果有多个匹配目的网络的路由条目，则路由器会选择掩码最长的条目。</ins></li><li>[2] 路由器在转发数据时，需要选择路由表中的最优路由，当数据报文到达路由器时，路由器首先提取出报文的目的 IP 地址，然后查找路由表，将报文的目的 IP 地址与路由表中某表项的掩码字段做 “与” 操作，“与” 操作后的结构跟路由表该表项的目的 IP 地址比较，相同则匹配上，否则就没有匹配上，当与所有的路由表项都进行匹配后，路由器会选择一个掩码最长的匹配项。</li><li>[3] 如上图，路由表中有两个表项到达目的网段 10.1.1.0，下一跳地址都是 20.1.1.2。如果要将报文转发至网段 10.1.1.1，则 10.1.1.0/30 符合最长匹配原则。</li></ul><p class="red">9，路由器转发数据包：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65Cq0I.png" alt="图片"></li><li><ins class="wavy">注：路由器需要找到下一跳和出接口才能将数据转发出去。</ins></li><li>[2] 路由器收到一个数据包后，会检查其目的 IP 地址，然后查找路由表，查找到匹配的路由表项之后，路由器会根据该表项所指示的出接口信息和下一跳信息将数据包转发出去。</li></ul><p class="red">10，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 路由器选择最优路由的顺序是什么？</li><li>路由器在选择最优路由时，会首先根据路由的优先级选择哪些路由可以放入路由表，如果优先级相等，再比较 metric 数值，决定哪些路由放入路由表，最后在查路由表时根据最长掩码匹配原则选择路由表项指导数据报文转发。</li><li>[2] Preference 字段在路由表中代表什么含义？</li><li>Preference 字段在路由表中代表了路由优先级，设备厂商会在各自的产品中为不同的路由协议规定不同的优先级。</li></ul><h1 id="第十六章静态路由基础"><a class="anchor" href="#第十六章静态路由基础">#</a> 第十六章【静态路由基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>静态路由是指由管理员手动配置和维护的路由</li><li>静态路由配置简单，被广泛地应用于网络中，另外，静态路由还可以实现负载均衡和路由备份，因此，学习并掌握好静态路由的应用与配置是非常必要的。</li></ul></div></details><p class="red">1，静态路由应用场景：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65F9wn.png" alt="图片"></li><li><ins class="wavy">注：静态路由是指由管理员手动配置和维护的路由。</ins></li><li>[2] 静态路由是指由管理员手动配置和维护的路由，静态路由配置简单，并且无需像动态路由那样占用路由的 CPU 资源来计算和分析路由更新。</li><li>[3] 静态路由的缺点在于，当网络拓扑发生变化时，静态路由不会自动适应拓扑改变，而是需要管理员手动进行调整。</li><li>[4] 静态路由一般适用于结构简单的网络，在复杂网络环境中，一般会使用动态路由协议来生成动态路由。不过，即使在复杂的网络环境中，合理地配置一些静态路由也可以改进网络的性能。</li></ul><p class="red">2，静态路由配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65k6C6.png" alt="图片"></li><li>[2] ip route-static 命令用来配置静态路由，参数 ip-address 指定了一个网络或者主机的目的地址，参数 mask 指定了一个子网掩码或者前缀长度。</li><li>[3] 如果使用了广播接口如以太网接口作为出接口，则必须要指定下一跳地址，如果使用了串口作为出接口，则可以通过参数 interface-type 和 interface-number (如，Serial1/0/0) 来配置出接口。此时不必指定下一跳地址。</li></ul><p class="red">3，静态路由 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65AAr4.png" alt="图片"></li><li><ins class="wavy">注：在串行接口上，可以通过指定下一跳地址或者出接口来配置静态路由。</ins></li><li>[2] 静态路由可以应用在串行网络或者以太网中，但静态路由在这两种网络中的配置有所不同。</li><li>[3] 在串行网络中配置静态路由时，可以只指定下一跳地址或只指定出接口。华为 ARG3 下列路由器中，串行接口默认封装 PPP 协议，对于这种类型的接口，静态路由的下一跳地址就是与接口相连的对端接口的地址，所以在串行网络中配置静态路由时可以只配置出接口。</li><li>[4] 以太网是广播类型的网络。和串行网络情况不同，在以太网中配置静态路由，必须指定下一跳地址。</li></ul><p class="red">4，静态路由 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65AxyD.png" alt="图片"></li><li><ins class="wavy">注：在广播类型的接口 (如以太网接口) 上配置静态路由时，必须要指定下一跳地址。</ins></li><li>[2] 在广播型的接口上配置静态路由时，必须明确指定下一跳地址，以太网中同一网络可能连接了多台路由器，如果在配置静态路由时只指定了出接口，则路由器无法将报文转发到正确的下一跳。</li><li>[3] 上图，RTA 需要将数据转发到 192.168.2.0/24 网络，在配置静态路由时，需要明确指定下一跳地址为 10.0.123.2，否则，RTA 将无法将报文转发到 RTB 所连接的 192.168.2.0/24 网络，因为 RTA 不知道应该通过 RTB 还是 RTC 才能到达目的地。</li></ul><p class="red">5，负载分担：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65VwDg.png" alt="图片"></li><li><ins class="wavy">注：静态路由支持到达同一目的地的等价负载分担。</ins></li><li>[2] 当源网络和目的网络之间存在多条链路时，可以通过等价路由来实现流量负载分担。这些等价路由具有相同的目的网络和掩码，优先级和度量值。</li><li>[3] 上图，RTA 和 RTB 之间有两条链路相连，通过使用等价的静态路由来实现流量负载分担。</li><li>[4] 在 RTB 上配置了两条静态路由，他们具有相同的目的 IP 地址和子网掩码，优先级 (都为 60)，路由开销 (都为 0)，但下一跳不同。在 RTB 需要转发数据给 RTA 时，就会使用这两条等价静态路由将数据进行负载分担。</li><li>[5] 在 RTA 上也应该配置对应的两条等价的静态路由。</li></ul><p class="red">6，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65Z4Qf.png" alt="图片"></li><li>[2] 在配置完成静态路由后，可以使用 display ip routing-table 命令来验证配置结果。</li><li>[3] 上图所示，红色高亮的部分代表路由表中的静态路由，这两条路由具有相同的目的地址和掩码，并且有相同的优先级和度量值，但是他们的下一跳地址和出接口不同，此时，RTB 就可以通过这两条等价路由实现负载分担。</li></ul><p class="red">7，路由备份：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65eZ6K.png" alt="图片"></li><li><ins class="wavy">注：浮动静态路由在网络中主路由失效的情况下，会加入到路由表并承担数据转发业务。</ins></li><li>[2] 在配置多条静态路由时，可以修改静态路由的优先级。使一条静态路由的优先级高于其他静态路由，从而实现静态路由的备份，也叫浮动静态路由。</li><li>[3] 如上图所示，RTB 上配置了两条静态路由，正常情况下，这两条静态路由是等价的，通过配置 preference 100，使第二条静态路由的优先级要低于第一条 (值越大优先级越低)。</li><li>[4] 路由器只把优先级最高的静态路由加入到路由表中，当加入到路由表中的静态路由出现故障时，优先级低的静态路由才会加入到路由表并承担数据转发业务。</li></ul><p class="red">8，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65e7jK.png" alt="图片"></li><li><ins class="wavy">注：在主链路正常情况下，只有主路由会出现在路由表中。</ins></li><li>[2] 从 display ip routing-table 命令的回显消息中可以看出，通过修改静态路由优先级实现了浮动静态路由，</li><li>[3] 正常情况下，路由表中应该显示两条有相同目的地，但不同下一跳和出接口的等价路由。由于修改了优先级，回显中只有一条默认优先级为 60 的静态路由，另一个静态路由的优先级是 100，该路由优先级低，所以不会显示在路由表中。</li></ul><p class="red">9，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65m3E4.png" alt="图片"></li><li><ins class="wavy">注：在主链路出现故障时，浮动静态路由会被激活并加入到路由表中，承担数据转发业务。</ins></li><li>[2] 当主要静态路由出现物理链路故障或者接口故障时，该静态路由不能再提供到达目的地的路径，所以再路由表中会被删除。</li><li>[3] c 此时，浮动静态路由会被加入到路由表，以保证报文能够从备份链路成功转发到目的地。</li><li>[4] 在主用静态路由的物理链路恢复正常后，主用静态路由会重新被加入到路由表，并且数据转发业务会从浮动静态路由切换到主用静态路由，而浮动静态路由会在路由表中再次被隐藏。</li></ul><p class="red">10，缺省路由：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65nSIJ.png" alt="图片"></li><li><ins class="wavy">注：缺省路由是目的地址和掩码全为 0 的特殊路由。</ins></li><li><ins class="wavy">注：如果报文的目的地址无法匹配路由表中的任何一项，路由器将选择依照缺省路由来转发报文。</ins></li><li>[2] 当路由表中没有与报文的目的地址匹配的表项时，设备可以选择缺省路由作为报文的转发路径。</li><li>[3] 在路由表中，缺省路由的目的网络地址为 0.0.0.0 掩码也为 0.0.0.0。如上图所示，RTA 使用缺省路由转发到达未知目的地址的报文，缺省静态路由的默认优先级也是 60。在路由选择过程中，缺省路由会被最后匹配。</li></ul><p class="red">11，验证配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65nx6P.png" alt="图片"></li><li>[2] 配置缺省路由后，可以使用 display ip routing-table 命令来查看该路由的详细信息。</li><li>[3] 如上图所示，目的地址在路由表中没能匹配的所有报文都将通过 G0/0/0 接口转发到下一跳地址 10.0.12.2。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如何配置能够将静态路由配置为浮动静态路由？</li><li>在配置静态路由时，需要调整其中一条静态路由的优先级，就可将其修改为浮动静态路由。</li><li>[2] 配置缺省路由时，目的网络的地址是什么？</li><li>在配置缺省路由时，目的网络为 0.0.0.0 代表的是任意网络。</li></ul><h1 id="第十七章链路状态路由协议ospf"><a class="anchor" href="#第十七章链路状态路由协议ospf">#</a> 第十七章【链路状态路由协议 ——OSPF】</h1><details class="primary"><summary>前言</summary><div><ul><li>开放式最短路径优先 OSPF (Open Shortest Path First) 协议是 IETF 定义的一种基于链路状态的内部网关路由协议。</li><li>RIP 是一种基于距离矢量算法的路由协议，存在着收敛慢，易产生路由环路，可拓展性差等问题，目前已逐渐被 OSPF 取代。</li></ul></div></details><p class="red">1，开放式最短路径优先 (OSPF)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65Tx2V.png" alt="图片"></li><li>[2] OSPF 是一种基于链路状态的路由协议，它从设计上就保证了无路由环路，OSPF 支持区域的划分，区域内部的路由器使用 SPF 最短路径算法保证了区域内部的无环路。OSPF 还利用区域间的连接规则保证了区域之间无路由环路。</li><li>[3] OSPF 支持触发更新，能够快速检测并通告自治系统内的拓扑变化。</li><li>[4] OSPF 可以解决网络扩容带来的问题，当网络上的路由器越来越多，路由信息流量急剧增长的时候，OSPF 可以将每个自治系统划分为多个区域，并限制每个区域的范围。OSPF 这种分区域的特点，使得 OSPF 特别适合大中型网络，OSPF 可以提供认证功能，OSPF 路由器之间的报文可以配置成必须经过认证才能进行交换。</li></ul><p class="red">2，OSPF 原理介绍：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65q9r8.png" alt="图片"></li><li>[2] OSPF 要求每台运行 OSPF 的路由器都连接整个网络的链路状态信息，这样才能计算出到达目的地的最优路径。</li><li>[3] OSPF 的收敛过程由链路状态公告 LSA (Link State Advertisement) 泛洪开始，LSA 中包含了路由器已知的接口 IP 地址，掩码，开销和网络类型等信息。</li><li>[4] 收到 LSA 的路由器都可以根据 LSA 提供的信息建立自己的链路状态数据库 LSDB (Link State Database)，并在 LSDB 的基础上使用 SPF 算法进行运算，建立起到达每个网络的最短路径树。</li><li>[5] 最后，通过最短路径树得到到达目的网络的最优路由，并将其加入到 IP 路由表中。</li></ul><p class="red">3，OSPF 报文：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65L6k4.png" alt="图片"></li><li>[2] OSPF 直接运行在 IP 协议之上，使用 IP 协议号 89。</li><li>[3] OSPF 有五种报文类型，每种报文都使用相同的 OSPF 报文头。</li><li>Hello 报文：最常用的一种报文，用于发现，维护邻居关系。并在广播和 NBMA (None-Broadcast Multi-Access) 类型的网络中选举指定路由器 DR (Designated Router) 和备份指定路由器 BDR (Backup Designated Router)。</li><li>DD 报文：两台路由器进行 LSDB 数据库同步时，用 DD 报文来描述自己的 LSDB。DD 报文的内容包括 LSDB 中每一条 LSA 的头部 (LSA 的头部可以唯一标识一条 LSA)。LSA 头部只占一条 LSA 的整个数据量的一小部分，所以，这样就可以减少路由器之间的协议报文流量。</li><li>LSR 报文：两台路由器相互交换过 DD 报文之后，知道对端的路由器有哪些 LSA 是本地 LSDB 所缺少的，这时需要发送 LSR 报文向对方请求缺少的 LSA，LSR 只包含了所需要的 LSA 的摘要信息。</li><li>LSU 报文：用来向对端路由器发送所需要的 LSA。</li><li>LSACK 报文：用来对接收到的 LSU 报文进行确认。</li></ul><p class="red">4，邻居状态机：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65japd.png" alt="图片"></li><li>[2] 邻居和邻接关系建立的过程如下：</li><li>Down：这是邻居的初始状态，表示没有在邻居失效时间间隔内收到来自邻居路由器的 Hello 数据包。</li><li>Attempt：此状态只在 NBMA 网络上存在，表示没有收到邻居的任何信息，但是已经周期性的向邻居发送报文，发送间隔为 HelloInterval。如果 RouterDeadInterval 间隔内未收到邻居的 Hello 报文，则转为 Down 状态。</li><li>Init：在此状态下，路由器已经从邻居收到了 Hello 报文，但是自己不在所收到的 Hello 报文的邻居列表中，尚未与邻居建立双向的通信关系。</li><li>2-Way：在此状态下，双向通信已经建立，但是没有与邻居建立邻接关系，这是建立邻接关系以前的最高级状态。</li><li>ExStart：这是形成邻接关系的第一个步骤，邻居状态变成此状态以后，路由器开始向邻居发送 DD 报文，主从关系是在此状态下形成的，初始 DD 序列号也是在此状态下决定的，在此状态下发送的 DD 报文不包含链路状态描述，</li><li>Exchange：此状态下路由器相互发送包含链路状态信息摘要的 DD 报文，描述本地 LSDB 的内容。</li><li>Loading：相互发送 LSR 报文请求 LSA，发送 LSU 报文通告 LSA。</li><li>Full：路由器的 LSDB 已经同步。</li></ul><p class="red">5，Router ID，邻居和邻接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65xyWQ.png" alt="图片"></li><li>[2] Router ID 是一个 32 位的值，它唯一标识了一个自治系统内的路由器，管理员可以为每台运行 OSPF 的路由器手动配置一个 Router ID。如果未手动指定，设备会按照以下规则自动选举 Router ID：</li><li>[3] 如果设备存在多个逻辑接口地址，则路由器使用逻辑接口中最大的 IP 地址作为 Router ID。</li><li>[4] 如果没有配置逻辑接口，则路由器使用物理接口的最大 IP 地址作为 Router ID。</li><li>[5] 在为一台运行 OSPF 的路由器配置新的 Router ID 后，可以在路由器上通过重置 OSPF 进程来更新 Router ID。通常建议手动配置 Router ID，以防 Router ID 因为接口地址的变化而改变。</li><li>[6] 运行 OSPF 的路由器之间需要交换链路状态信息和路由信息，在交换这些信息之前路由器之间首先需要建立邻接关系。</li><li>[7] 邻居 (Neighbor)：</li><li>OSPF 路由器启动后，便会通过 OSPF 接口向外发送 Hello 报文用于发现邻居，收到 Hello 报文的 OSPF 路由器会检查报文中所定义的以下参数，如果双方的参数一致，就会彼此形成邻居关系，状态到达 2-Way 即可称为建立了邻居关系。</li><li>[8] 邻接 (Adjacency)：</li><li>形成邻居的双方不一定都能形成邻接关系，这要根据网络类型而定。只有当双方成功交换 DD 报文，并同步 LSDB 后，才形成了真正意义上的邻接关系。</li><li>上图所示，RTA 通过以太网连接了三个路由器，所以 RTA 有三个邻居，但不能说 RTA 有三个邻接关系。</li></ul><p class="red">6，邻居发现：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/65zjjs.png" alt="图片"></li><li><ins class="wavy">注：Hello 报文用来发现和维持 OSPF 邻居关系。</ins></li><li>[2] OSPF 的邻居发现过程是基于 Hello 报文来实现的，Hello 报文中的主要字段解释如下：</li><li>Network Mask：发送 Hello 报文的接口的网络掩码。</li><li>Hello interval：发送 Hello 报文的时间	间隔，单位为秒。</li><li>Options：标识发送此报文的 OSPF 路由器所支持的可选功能，具体的可选功能未来解释。</li><li>Router Priority：发送 Hello 报文的接口的 Router Priority，用于选举 DR 和 BDR。</li><li>Router Dead Interval：失效时间，如果在此时间内未收到邻居发来的 Hello 报文，则认为邻居失效，单位为秒，通常为 4 倍 Hello Interval。</li><li>Designated Router：发送 Hello 报文的路由器所选举的 DR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 DR 路由器。</li><li>Backup Designated Router：发送 Hello 报文的路由器所选举出的 BDR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 BDR。</li><li>Neighbor：邻居得到 Router ID 列表，表示本路由器已经从这些邻居收到了合法的 Hello 报文。</li><li>如果路由器发现所接收的合法 Hello 报文的邻居列表中有自己的 Router ID，则认为已经和邻居建立了双向邻接，表示邻居关系已经建立。</li><li>[3] 验证一个接收到的 Hello 报文是否合法包括：</li><li>如果接收端口的网络类型是广播型，点到多点或者 NBMA，所接收的 Hello 报文中 Network Mask 字段必须和接受端口的网络掩码一致，如果接收端口的网络类型为点到点类型或者是虚连接，则不检查 Network Mask 字段。</li><li>所接收的 Hello 报文中 Hello Interval 字段必须和接收端口的配置一致。</li><li>所接收的 Hello 报文中 Router Dead Interval 字段必须和接收端口的配置一致。</li><li>所接收的 Hello 报文中 Options 字段中的 E-bit (表示是否接收外部路由信息) 必须和相关区域的配置一致。</li></ul><p class="red">7，数据库同步：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/6I9Xge.png" alt="图片"></li><li><ins class="wavy">注：路由器使用 DD 报文来进行主从路由器的选举和数据库摘要信息的交互。</ins></li><li><ins class="wavy">注：DD 报文包含 LSA 的头部信息，用来描述 LSDB 的摘要信息。</ins></li><li>[2] 如上图所示，路由器在建立完成邻居关系之后，便开始进行数据库同步，具体关系如下：</li><li>[3] 邻居状态变为 ExStart 以后，RTA	向 RTB 发送第一个 DD 报文，在这个报文中，DD 序列号被设置为 X (假设)，RTA 宣告自己为主路由器。</li><li>[4] RTB 也向 RTA 发送第一个 DD 报文，在这个报文中。DD 序列号被设置为 Y (假设)。RTB 也宣告自己为主路由器，由于 RTB 的 Router ID 比 RTA 的大，所以 RTB 应当为真正的主路由器。</li><li>[5] RTA 发送一个新的 DD 报文，在这个新的报文中包含 LSDB 的摘要信息，序列号设置为 RTB 在步骤 2 里使用的序列号，因此 RTB 将邻居状态改变为 Exchange。</li><li>[6] 邻居状态变为 Exchange 以后，RTB 发送一个新的 DD 报文，该报文中包含 LSDB 的描述信息。DD 序列号设置为 Y+1 (上次使用的序列号加 1)</li><li>[7] 即使 RTA 不需要新的 DD 报文描述自己的 LSDB，但是作为从路由器，RTA 需要对主路由器 RTB 发送的每一个 DD 报文进行确认。所以，RTA 向 RTB 发送一个内容为空的 DD 报文，序列号为 Y+1</li><li>[8] 发送完最后一个 DD 报文之后，RTA 将邻居状态改变为 Loading，RTB	收到最后一个 DD 报文之后，改变状态为 Full (假设 RTB 的 LSDB 是最新最全的，不需要向 RTA 请求更新)。</li></ul><p class="red">8，建立完全邻接关系：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/6IiwcD.png" alt="图片"></li><li><ins class="wavy">注：LSR 用于向对方请求所需的 LSA。</ins></li><li><ins class="wavy">注：LSU 用于向对方发送其所需的 LSA。</ins></li><li><ins class="wavy">注：LSACK 用于向对方发送收到 LSA 的确认。</ins></li><li>[2] 邻居状态变为 Loading 之后，RTA 开始向 RTB 发送 LSR 报文，请求那些在 Exchange 状态下通过 DD 报文发现的，而且在本地 LSDB 中没有的链路状态信息。</li><li>[3] RTB 收到 LSR 报文之后，向 RTA 发送 LSU 报文，在 LSU 报文中，包含了那些被请求的链路状态的详细信息。RTA 收到 LSU 报文后，将邻居状态从 Loading 改变成 Full。</li><li>[4] RTA 向 RTB 发送 LSACK 报文，用于对已接受 LSA 的确认。</li><li>[5] 此时，RTA 和 RTB 之间的邻居状态变为 Full，表示达到完全邻接状态。</li></ul><p class="red">9，OSPF 支持的网络类型 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/21/6IFAgO.png" alt="图片"></li><li><ins class="wavy">注：缺省情况下，OSPF 认为以太网的网络类型是广播类型，PPP，HDLC 的网络类型是点到点类型。</ins></li><li>[2] OSPF 定义了四种网络类型，分别是点到点网络，广播型网络，NBMA 网络和点到多点网络。</li><li>[3] 点到点网络是指只把两台路由器直接相连的网络，一个运行 PPP 的 64k 串行线路就是一个点到点的网络例子。</li><li>[4] 广播型网络是指支持两台以上路由器，并且具有广播功能的网络，一个含有三台路由器的以太网就是一个广播型网络的例子。</li></ul><p class="red">10，OSPF 支持的网络类型 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6IFrxU.png" alt="图片"></li><li><ins class="wavy">注：缺省情况下，OSPF 认为帧中继，ATM 的网络类型是 NBMA。</ins></li><li>[2] OSPF 可以在不支持广播的多路访问网络上运行，此类网络包括在 hub~spoke 拓扑上运行的帧中继 (FR) 和异步传输模式 (ATM) 网络，这些网络的通信依赖于虚电路，OSPF 定义了两种支持多路访问的网络类型：非广播多路访问网络 (NBMA) 和点到多点网络 (Point To Multi-Points)。</li><li>[3] NBMA：在 NBMA 网络上，OSPF 模拟在广播型网络上的操作，但是每个路由器的邻居需要手动配置，NBMA 方式要求网络中的路由器组成全连接。</li><li>[4] P2MP：将整个网络看成是一组点到点网络，对于不能组成全连接的网络应当使用点到多点方式，例如只使用 PVC 的不完全连接的帧中继网络。</li></ul><p class="red">11，DR&amp;BDR：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6IkcSf.png" alt="图片"></li><li><ins class="wavy">注：DR 可以减少广播型网络中的邻接关系的数量。</ins></li><li>[2] 每一个含有至少两个路由器的广播型网络和 NBMA 网络都有一个 DR 和 BDR。</li><li>[3] DR 和 BDR 可以减少邻接关系的数量，从而减少链路状态信息以及路由信息的交换次数，这样可以节省带宽，降低对路由器处理能力的压力。</li><li>[4] 一个既不是 DR 也不是 BDR 的路由器只与 DR 和 BDR 形成邻接关系并交换链路状态信息以及路由信息。这样就大大减少了大型广播型网络和 NBMA 网络中的邻接关系数量，在没有 DR 的广播网络上，邻接关系的数量可以根据公式 n (n-1)/2 计算出，n 代表参与 OSPF 的路由器接口的数量。</li><li>[5] 如上图所示，使用路由器之间有 6 个邻接关系，当指定 DR 后，所有的路由器都与 DR 建立起邻接关系，DR 成为该广播网络上的中心点。</li><li>[6] BDR 在 DR 发生故障时接管业务，一个广播网络上所有路由器都必须同 BDR 建立邻接关系，上图使用 DR 和 BDR 将邻接关系从 6 减少到了 5，RTA 和 RTB 都只需要同 DR 和 BDR 建立邻接关系，RTA 和 RTB 之间建立的是邻居关系。</li><li>[7] 上图中，邻接关系数量的减少效果并不明显，但是，当网络上部署了大量路由器时，比如 100 台，那么情况就不一样了。</li></ul><p class="red">12，DR&amp;BDR 选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6IEUVH.png" alt="图片"></li><li><ins class="wavy">注：DR 是基于端口的 DR 优先级的值进行选举的。</ins></li><li>[2] 在邻居发现完成之后，路由器会根据网段类型进行 DR 选举，在广播和 NBMA 网络上，路由器会根据参与选举的每个接口的优先级进行 DR 选举，优先级取值范围为 0-255，值越高越优先，缺省情况下，接口优先级为 1，如果一个接口优先级为 0，那么该端口将不会参与 DR 或者 BDR 的选举，如果优先级相同时，则比较 Router ID，值越大越优先被选举为 DR。</li><li>[3] 为了给 DR 做备份，每个广播和 NBMA 网络上还要选举一个 BDR。BDR 也会与 2 网络上所有的路由器建立邻接关系。</li><li>[4] 为了维护网络上邻接关系的稳定性，如果网络中已经存在 DR 和 BDR，则新添加进该网络的路由器不会成为 DR 和 BDR，不管该路由器的 Router Priority 是否最大，如果当前 DR 发生故障，则当前 BDR 自动成为新的 DR，网络中重新选举 BDR，如果当前 BDR 发生故障，则 DR 不变，重新选举 BDR，这种机制的目的是为了保持邻接关系的稳定，使拓扑结构的改变对邻接关系的影响尽量小。</li></ul><p class="red">13，OSPF 区域：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6IVrk9.png" alt="图片"></li><li><ins class="wavy">注：每个区域都维护一个独立的 LSDB。</ins></li><li><ins class="wavy">注：Area 0 是骨干区域，其他区域都必须与此区域相连。</ins></li><li>[2] OSPF 支持将一组网段组合在一起，这样的一个组合称为一个区域。</li><li>[3] 划分 OSPF 区域可以缩小路由器的 LSDB 规模，减少网络流量。</li><li>[4] 区域内的详细拓扑信息不向其他区域发送，区域间传递的是抽象的路由信息，而不是详细的描述拓扑结构的链路状态信息，每个区域都有自己的 LSDB，不同区域的 LSDB 是不同的，路由器会为每一个自己所连接到的区域维护一个单独的 LSDB，由于详细链路状态信息不会被发布到区域以外，因此 LSDB 的规模大大缩小了。</li><li>[5] Area0 为骨干区域，为了避免区域间路由环路，非骨干区域之间不允许直接相互发布路由信息，因此，每个区域都必须连接到骨干区域。</li><li>[6] 运行在区域之间的路由器叫做区域边界路由器 ABR (Ares Boundary Router)，它包含所有相连的区域的 LSDB，自治系统边界路由器 ASBR (Autonomous System Boundary Router) 是指和其他 AS 中的路由器交换路由信息的路由器，这种路由器会向整个 AS 通告 AS 外部路由信息。</li><li>[7] 在规模较小的企业网络中，可以把所有的路由器划分到同一个区域中，同一个 OSPF 区域中的路由器中的 LSDB 是完全一致的，OSPF 区域号可以手动配置，为了便于将来的网络拓展，推荐将该区域设置为 0，即骨干区域。</li></ul><p class="red">14，OSPF 开销：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6IZhvV.png" alt="图片"></li><li><ins class="wavy">注：OSPF 的开销计算公式为带宽参考值 / 带宽。</ins></li><li><ins class="wavy">注：可以通过 bandwidth-reference 命令来设置带宽参考值。</ins></li><li>[2] OSPF 基于接口带宽计算开销，计算公式为：接口开销 = 带宽参考值 / 带宽。带宽参考值可配置，缺省为 100Mbit/s。以此，一个 64Kbit/s 串口的开销为 1562，一个 E1 接口 (2.048Mbit/s) 的开销为 48。</li><li>[3] 命令 bandwidth-reference 可以用来调整带宽参考值，从而可以改变接口开销，带宽参考值越大，开销越准确，在支持 10Gbit/s 速率的情况下，推荐将带宽参考值提高到 10000Mbit/s 来分别为 10Gbit/s，1Gbit/s 和 100Mbit/s 的链路提供 1，10，100 的开销。注意，配置带宽参考值时，需要在整个 OSPF 网络中统一进行调整。</li><li>[4] 另外，还可以通过 OSPF cost 命令来手动为一个接口调整开销，开销取值 f 范围是 1~65535，缺省值为 1。</li></ul><p class="red">15，OSPF 配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TnY4g.png" alt="图片"></li><li>[2] 在配置 OSPF 时。需要首先使能 OSPF 进程。</li><li>[3] 命令 OSPF (process id ) 用来使能 OSPF，在该命令中可以配置进程 ID，如果没有配置进程 ID。则使用 1 作为缺省进程 ID。</li><li>[4] 命令 OSPF (process id) (Router-id	) 即可以使能 OSPF 进程，还同时可以用于配置 Router ID，在该命令中，Router -ID 代表路由器 ID。</li><li>[5] 命令 network 用于指定运行 OSPF 协议的接口，在该命令中需要指定一个反掩码。反掩码中，“0” 代表此位必须严格匹配，“1” 表示该地址可以为任意值。</li></ul><p class="red">16，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TnxqP.png" alt="图片"></li><li>[2] 命令 display ospf peer 可以用来查看邻居相关的属性，包括区域，邻居的状态，邻接协商的主从状态以及 DR 和 BDR 情况。</li></ul><p class="red">17，OSPF 认证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TuwJe.png" alt="图片"></li><li><ins class="wavy">注：华为 ARG3 系列路由器运行 OSPF 时，支持两种认证方式：区域认证和接口认证。</ins></li><li>[2] OSPF 支持简单认证及加密认证功能，加密认证对潜在的攻击行为有更强的防范行。OSPF 认证可以配置在接口上或者区域上，配置接口认证方式的优先级高于区域认证方式。</li><li>[3] 接口或区域上都可以运行 OSPF authentication-mode 命令来配置简单认证，参数 simple 表示使用明文传输密码，参数 plain 表示密码以明文形式存放在设备中，参数 cipher 表示密码以密文形式存放在设备中，参数 Null 表示不认证。</li><li>[4] 命令 OSPF authentication-mode 用于配置加密认证，MD5 是一种保证链路认证安全的加密算法，参数 key-id 表示接口加密认证中的认证密钥 ID，它必须与对端的 key-id 一致。</li></ul><p class="red">18，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TKBkT.png" alt="图片"></li><li>[2] 在启用认证功能后，可以在终端上进行调试来查看认证过程。</li><li>[3] debugging ospf packet 命令用来指定调试 OSPF 报文，然后便可以查看认证过程，以确定认证配置是否成功。</li></ul><p class="red">19，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] OSPF Hello 报文中 Router Dead Interval 字段的作用是什么？</li><li>Hello 报文中的 Router Dead Interval 字段代表死亡间隔，如果在此时间内未收到邻居发送来的 Hello 报文，则认为邻居失效，死亡间隔时 Hello 间隔的四倍，在广播网络上缺省为 40 秒 (因为 Hello 间隔缺省为 10 秒)</li><li>[2] 在广播网络中，DR 和 BDR 用来接收链路状态更新报文的目的地址是什么？</li><li>在广播网络上，DR 和 BDR 都使用组播地址 224.0.0.6 来接收链路状态更新报文。</li></ul><h1 id="第十八章dhcp原理与配置"><a class="anchor" href="#第十八章dhcp原理与配置">#</a> 第十八章【DHCP 原理与配置】</h1><details class="primary"><summary>前言</summary><div><ul><li>在大型企业网络中，会有大量的主机或设备需要获取 IP 地址等网络参数，如果采用手工配置，工作量大且不好管理，如果有用户擅自修改网络参数，还可能会造成	IP 地址冲突等问题，使用动态主机配置协议 DHCP (Dynamic Host Configuration Protocol) 来分配 IP 地址等网络参数，可以减少管理员的工作量，避免用户手动配置网络参数时造成的地址冲突。</li></ul></div></details><p class="red">1，DHCP 应用场景：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TQndP.png" alt="图片"></li><li><ins class="wavy">注：DHCP 服务器能够为大量主机分配 IP 地址，并能集中管理。</ins></li><li>[2] 在大型企业网络中，一般会有大量的主机等终端设备，每个终端设备都需要配置 IP 地址等网络参数才能接入网络。</li><li>[3] 在小型网络中，终端数量小，可以手动配置 IP 地址，但是在大中型网络中，终端数量很多，手动配置 IP 地址工作量大，而且配置时容易导致 IP 地址冲突等错误。</li><li>[4] DHCP 可以为网络终端动态分配 IP 地址，解决了手动配置 IP 地址时的各种问题。</li></ul><p class="red">2，DHCP 报文类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/22/6TQ0WF.png" alt="图片"></li><li>[2] DHCP 客户端初次接入网络时，会发送 DHCP 发现报文 (DHCP Discover)，用于查找和定位 DHCP 服务器。</li><li>[3] DHCP 服务器在接收到 DHCP 发现报文后，发送 DHCP 提供报文 (DHCP Offer)，此报文中包含 IP 地址等配置信息。</li><li>[4] 在 DHCP 客户端收到服务器发送的 DHCP 提供报文后，会发送 DHCP 请求报文 (DHCP Request)，另外在 DHCP 客户端获取 IP 地址并重启之后，同样也会发送 DHCP 请求报文，用于确认分配的 IP 地址等配置信息。DHCP 客户端获取的 IP 地址租期快要到期时，也发送 DHCP 请求报文向服务器申请延长 IP 地址租期。</li><li>[5] 收到 DHCP 客户端发送的 DHCP 请求报文后，DHCP 服务器会回复 DHCP 确认报文 (DHCP ACK)。客户端收到 DHCP 确认报文后，会将获取的 IP 地址等信息进行配置和使用。</li><li>[6] 如果 DHCP 服务器收到 DHCP-REQUEST 报文后，没有找到相应的租约记录，则发送 DHCP-NAK 报文作为回应，告知 DHCP 客户端无法分配合适的 IP 地址。</li><li>[7] DHCP 客户端通过发送 DHCP 释放报文 (DHCP Release) 来释放 IP 地址，收到 DHCP 释放报文后，DHCP 服务器可以把该 IP 地址分配给其他 DHCP 客户端。</li></ul><p class="red">3，地址池：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TlT9U.png" alt="图片"></li><li><ins class="wavy">注：ARG3 系列路由器支持两种地址池：全局地址池和接口地址池。</ins></li><li>[2] ARG3 系列路由器和 X7 系列交换机都可以作为 DHCP 服务器，为主机等设备分配 IP 地址。DHCP 服务器的地址池是用来定义分配给主机的 IP 地址范围，有两种形式。</li><li>[3] 接口地址池为连接到同一网段的主机或终端分配 IP 地址。可以在服务器的接口下执行 dhcp select interface 命令，配置 DHCP 服务器采用接口地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li><li>[4] 全局地址池为所有连接到 DHCP 服务器的终端分配 IP 地址，可以在服务器的接口下执行 dhcp select global 命令，配置 DHCP 服务器采用全局地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li><li>[5] 接口地址池的优先级比全局地址池高，配置了全局地址池后，如果又在接口上配置了地址池，客户端将会从接口地址池中获取 IP 地址，在 X7 系列交换机上，只能在 VLAN IF 逻辑接口上配置接口地址池。</li></ul><p class="red">4，DHCP 工作原理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T1MvQ.png" alt="图片"></li><li>[2] 为了获取 IP 地址等配置信息，DHCP 客户端需要和 DHCP 服务器进行报文交互。</li><li>[3] 首先。DHCP 客户端发送 DHCP 发现报文来发现 DHCP 服务器，DHCP 服务器会选取一个未分配的 IP 地址，向 DHCP 客户端发送 DHCP 提供报文，此报文中包含分配给客户端的 IP 地址和其他配置信息。如果存在多个 DHCP 服务器，每个 DHCP 服务器都会响应。</li><li>[4] 如果有多个 DHCP 服务器向 DHCP 客户端发送 DHCP 提供报文，DHCP 客户端会选择收到的第一个 DHCP 提供报文，然后发送 DHCP 请求报文，报文中包含请求的 IP 地址，收到 DHCP 请求报文后，提供该 IP 地址的 DHCP 服务器会向 DHCP 客户端发送一个 DHCP 确认报文，包含提供的 IP 地址和其他配置信息。</li><li>[5] DHCP 客户端收到 DHCP 确认报文后，会发送免费 ARP 报文，检查网络中是否有其他主机使用分配的 IP 地址，如果指定时间内没有收到 ARP 应答，DHCP 客户端会使用这个 IP 地址，如果有主机使用该 IP 地址，DHCP 客户端会向 DHCP 服务器发送 DHCP 拒绝报文，通知服务器该 IP 地址已被占用，然后 DHCP 客户端会向服务器重新申请一个 IP 地址。</li></ul><p class="red">5，DHCP 租期更新：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T1Tat.png" alt="图片"></li><li><ins class="wavy">注：IP 租约期限到达 50% 时，DHCP 客户端会请求更新 IP 地址租约。</ins></li><li>[2] 申请到 IP 地址后，DHCP 客户端中会保存三个定时器，分别用来控制租约更新，租期重绑定和租期失效。</li><li>[3] DHCP 服务器为 DHCP 客户端分配 IP 地址时会指定三个定时器的值，如果，DHCP 服务器没有指定定时器的值，DHCP 客户端会使用缺省值，缺省租期为 1 天。</li><li>[4] 默认情况下，还剩下 50% 的租期时，DHCP 客户端开始租约更新过程，DHCP 客户端向分配 IP 地址的服务器发送 DHCP 请求报文来申请延迟 IP 地址的租期，DHCP 服务器向客户端发送 DHCP 确认报文，给予 DHCP 客户端一个新的租期。</li></ul><p class="red">6，DHCP 重绑定：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T3FRU.png" alt="图片"></li><li><ins class="wavy">注：DHCP 客户端在租约期限到达 87.5% 时，还没有收到服务器响应，会申请重绑定 IP。</ins></li><li>[2] DHCP 客户端发送 DHCP 请求报文续租时，如果 DHCP 客户端没有收到 DHCP 服务器的 DHCP 应答报文，默认情况下，重绑定定时器在租期剩余 12.5% 的时候超时，超时后，DHCP 客户端就会认为原 DHCP 服务器不可用，开始重新发送 DHCP 请求报文，网络上任何一台 DHCP 服务器都可以应答 DHCP 确认或 DHCP 非确认报文。</li><li>[3] 如果收到 DHCP 确认报文，DHCP 客户端重新进入绑定状态，复位租期更新计时器和重绑定计时器，如果收到 DHCP 非确认报文，DHCP 客户端进入初始化状态，此时，DHCP 客户端必须立即停止使用现有 IP 地址，重新申请 IP 地址。</li></ul><p class="red">7，IP 地址释放：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T3QJK.png" alt="图片"></li><li><ins class="wavy">注：如果 IP 租约到期前都没有收到服务器响应，客户端停止使用此 IP 地址。</ins></li><li>++ 注：如果 DHCP 客户端不再使用分配的 IP 地址，也可以主动向 DHCP 服务器发送 DHCP Release 报文，释放该 IP 地址。</li><li>[2] 租期计时器是地址失效进程中的最后一个定时器，超时时间为 IP 地址的租期时间，如果 DHCP 客户端在租期失效定时器超时前没有收到服务器的任何回应，DHCP 客户端必须立刻停止使用现有 IP 地址，发送 DHCP Release 报文，并进入初始化状态，然后，DHCP 客户端重新发送 DHCP 发现报文，申请 IP 地址。</li></ul><p class="red">8，DHCP 接口地址池的配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T3TOJ.png" alt="图片"></li><li>[2] DHCP 支持配置两种地址池，包括全局地址池和接口地址池。</li><li>[3] DHCP enable 命令用来使能 DHCP 功能，在配置 DHCP 服务器时，必须先执行 dhcp enable 命令，才能配置 DHCP 的其他功能并生效。</li><li>[4] dhcp select interface 命令用来关联接口和接口地址池，为连接到接口的主机提供配置信息，上图所示，接口 G0/0/0 被加入到接口地址池中。</li><li>[5] dhcp server dns-list 命令用来指定接口地址池下的 DNS 服务器地址。</li><li>[6] dhcp server excluded-ip-address 命令用来配置接口地址池中不参与自动分配的 IP 地址范围</li><li>[7] dhcp server lease 命令用来配置 DHCP 服务器接口地址池中 IP 地址的租用有效期限功能。缺省情况下，接口地址池中 IP 地址的租用有效期限为 1 天。</li></ul><p class="red">9，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T8NX4.png" alt="图片"></li><li>[2] 每个 DHCP 服务器可以定义一个或多个全局地址池和接口地址池，上图中执行 display ip pool 命令查看接口地址池的属性。</li><li>[3] display 信息中包含地址池的 IP 地址范围，还包括 IP 网关	，子网掩码等信息。</li></ul><p class="red">10，DHCP 全局地址池配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T8z40.png" alt="图片"></li><li>[2] 上图所示，配置了一个 DHCP 全局地址池。</li><li>ip pool 命令用来创建全局地址池。</li><li>network 命令用来配置全局地址池下可分配的网段。</li><li>gateway-list 命令用来配置 DHCP 服务器全局地址池的出口网关地址。</li><li>lease 命令用来配置 DHCP 全局地址池下的地址租期，缺省情况下，IP 地址租期是 1 天。</li><li>dhcp select global 命令用来使能接口的 DHCP 服务器功能。</li></ul><p class="red">11，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TGlKe.png" alt="图片"></li><li>[2] display ip pool 命令可以查看全局 IP 地址池信息，管理员可以查看地址池的网关，子网掩码，IP 地址统计信息等内容，监控地址池的使用情况，了解已分配的 IP 地址数量，以及其他使用统计信息。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 地址池中的那些 IP 地址一般会被保留？</li><li>在 IP 地址池中，应该排除分配给 DNS 等服务器的 IP 地址，DHCP 服务器接口的 IP 地址等，避免 IP 地址冲突。</li><li>[2] DHCP 服务器的 IP 地址租期默认是多久？</li><li>默认的 IP 地址租期是 86400 秒。即一天。</li></ul><h1 id="第十九章ftp原理与配置"><a class="anchor" href="#第十九章ftp原理与配置">#</a> 第十九章【FTP 原理与配置】</h1><details class="primary"><summary>前言</summary><div><ul><li>FTP 是用来传输文件的协议	，使用 FTP 实现远程文件传输的同时，也可以保证数据传输的可靠性和高效性。</li></ul></div></details><p class="red">1，FTP 的应用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TG0Kg.png" alt="图片"></li><li><ins class="wavy">注：FTP 提供了一种在服务器和客户机之间上传和下载文件的有效方式。</ins></li><li>[2] 在企业网络中部署一台 FTP 服务器，将网络设备配置为 FTP 客户端，则可以使用 FTP 来备份或更新 VRP 文件和配置文件。也可以把网络设备配置为 FTP 服务器，将设备的日志文件保存到某台主机上方便查看。</li></ul><p class="red">2，FTP 传输文件的过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TanPA.png" alt="图片"></li><li><ins class="wavy">注：使用 FTP 传输数据时，需要在服务器和客户机之间建立控制连接和数据连接。</ins></li><li>[2] 使用 FTP 进行文件传输时，会使用两个 TCP 连接，第一个连接是 FTP 客户端和 FTP 服务器间的控制连接，FTP 服务器开启 21 号端口，等待 FTP 客户端发送链接请求，FTP 客户端随机开启端口，向服务器发送建立连接的请求，控制连接用于在服务器和客户端之间传输控制命令。</li><li>[3] 第二个连接是 FTP 客户端和 FTP 服务器间的数据连接，服务器使用 TCP 的 20 号端口与客户端建立数据连接，通常情况下，服务器主动建立或中断数据连接。</li></ul><p class="red">3，FTP 传输模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6Ta0MV.png" alt="图片"></li><li><ins class="wavy">注：传输模式定义了数据在客户端和服务器之间传输时的格式。</ins></li><li>[2] FTP 传输数据时支持两种传输模式：ASCII 模式和二进制模式。</li><li>[3] ASCII 模式用于传输文本，发送端的字符在发送前被转换成 ASCII 码格式之后进行传输，接收端收到之后再将其转换成字符。</li><li>[4] 二进制模式常用于发送图片文件和程序文件，发送端在发送这些文件时无需转换格式，即可传输。</li></ul><p class="red">4，FTP 配置 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6Ta7IH.png" alt="图片"></li><li>[2] ARG3 系列路由器和 X7 系列路由器均可提供 FTP 功能。</li><li>[3] 执行 ftp server enable 命令使能 FTP 功能。</li><li>[4] 执行 set default ftp-directory 命令设置 FTP 用户的默认工作目录。</li></ul><p class="red">5，FTP 配置 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TdGy6.png" alt="图片"></li><li>[2] 在配置 FTP 服务器时，可以使用 AAA 为每个用户分别配置登录账号和访问权限。</li><li>[3] aaa 命令用来进入 AAA 视图。</li><li>[4] local-user user-name 命令用来创建本地用户，并配置本地用户的各项参数。</li><li>[5] user-name 指定用户名。</li><li>[6] local-user huawei service-type ftp 命令用来配置本地用户的接入类型为 ftp。</li><li>[7] ftp-directory 指定 FTP 用户可访问的目录，如果不配置 FTP 用户可访问的目录，则 FTP 用户无法登录设备。</li><li>[8] access-limit 指定用户可以建立的最大连接数目。</li><li>[9] idle-timeout 指定用户的闲置超时时间。</li><li>[10] privilege level 指定用户的优先级。</li></ul><p class="red">6，FTP 配置 (3)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TwkAe.png" alt="图片"></li><li>[2] ftp 用户用来与远程 FTP 服务器建立控制连接，并进入 FTP 客户端视图。</li><li>[3] binary 命令用来在设备作为 FTP 客户端时设置文件传输方式为 Binary 模式，又称为二进制模式。</li><li>[4] 缺省情况下，文件传输模式为 ASCII 模式。</li><li>[5] get 命令用来从远程 FTP 服务器下载文件并保存在本地。</li></ul><p class="red">7，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] FTP 服务默认使用服务器哪些端口？</li><li>FTP 服务器需要开启 TCP 的 21 号端口来建立控制连接，20 号端口来建立数据连接。</li><li>[2] 用户反馈没有权限去访问 FTP 服务器上的目录，应该如何解决？</li><li>如果用户无法访问任何工作目录，则需要定义一个默认的 FTP 目录，执行 set default ftp-direcory 命令建立默认目录。</li></ul><h1 id="第二十章telnet原理与配置"><a class="anchor" href="#第二十章telnet原理与配置">#</a> 第二十章【Telnet 原理与配置】</h1><p>1.4 1-11 机器人 1-12</p><details class="primary"><summary>前言</summary><div><ul><li>如果企业网络中有一台或多台网络设备需要远程进行配置和管理，管理员可以使用 Telnet 远程连接到每一台设备上，对这些网络设备进行集中的管理和维护。</li></ul></div></details><p class="red">1，Telnet 应用场景：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TgE4K.png" alt="图片"></li><li><ins class="wavy">注：Telnet 可以通过终端对本地和远程的网络设备进行集中管理。</ins></li><li>[2] Telnet 提供了一个交互式操作页面，允许终端远程登录到任何可以充当 Telnet 服务器的设备，Telnet 用户可以像通过 Console 口本地登录一样对设备进行操作。</li><li>[3] 远端 Telnet 服务器和终端之间无需直连，只需保证两者之间可以相互通信即可，通过使用 Telnet，用户可以方便地实现对设备进行远程管理和维护。</li></ul><p class="red">2，Telnet 连接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6T2hQg.png" alt="图片"></li><li><ins ,wavy>注：Telnet 客户端和服务器基于 TCP 连接来传输命令。</ins></li><li>[2] Telnet 以客户端 / 服务器模式运行，Telnet 基于 TCP 协议，服务器端口默认是 23，服务器通过该端口与客户端建立 Telnet 连接。</li></ul><p class="red">3，认证模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TRpwR.png" alt="图片"></li><li>[2] 在配置 Telnet 登录用户界面时，必须配置认证方式，否则用户无法成功登录设备。</li><li>[3] Telnet 认证有两种模式：AAA 认证，密码认证。</li><li>当配置用户界面的认证方式为 AAA 时，用户登录设备时需要首先输入登录用户名和密码才能登录。</li><li>当配置用户界面的认证方式为 password 时，用户登录设备时需要先输入登陆密码才能登录。</li></ul><p class="red">4，Telnet 配置 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TRgB9.png" alt="图片"></li><li>[2] 网络设备作为 Telnet 服务器，通常使用密码认证机制来认证连接到 VTY 接口的用户。</li><li>[3] VTY (Virtual Type Terminal) 是网络设备用来管理和监控通过 Telnet 方式登录的用户的界面，网络设备为每个 Telnet 用户分配一个 VTY 界面。缺省情况下，ARG3 系列路由器支持的 Telnet 用户最大数目为 5 个，VTY 0 4 的含义是 VTY0 VTY1 VTY2 VTY3 VTY4。如果需要增加 Telnet 用户的登录数量，可以使用 user-interface maximum-vty 命令来调整 VTY 界面的数量。</li><li>[4] 执行 authentication-mode password 命令，可以配置 VTY 通过密码对用户进性认证。</li><li>[5] 注：不同的 VRP 版本执行 set authentication password cipher 命令有差异：有些平台需要回车后输入密码，另外一些平台可以直接在命令后输入密码，故，在操作具体产品时需要查阅相应的 VRP 产品文档。</li></ul><p class="red">5，Telnet 配置 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://z3.ax1x.com/2021/03/23/6TfaWV.png" alt="图片"></li><li>[2] 远程设备配置为 Telnet 服务器之后，可以在客户端上执行 telnet 命令来与服务器建立 Telnet 连接，客户端会收到需要认证相关的提示信息，用户输入的认证密码需要匹配 Telnet 服务器上保存的密码，认证通过之后，用户就可以通过 Telnet 远程连接到 Telnet 服务器上，在本地对远端的设备进行配置和管理。</li></ul><p class="red">6，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如果网络设备已经配置完成 Telnet 服务，但是用户仍然不能实现远程访问，原因可能是什么？</li><li>如果无法建立 Telnet 连接，首先验证设备是否可达，如果设备可达，再检查用户输入的密码是否正确，如果密码正确，再查看当前通过 Telnet 访问设备的用户量是否到达最大限制。如需增加用户数量，可以执行 user-	interface maximum-vty&lt;0-15&gt; 命令，0-15 表示支持的用户数。</li></ul><div class="tags"><a href="/tags/HUAWEI/" rel="tag"><i class="ic i-tag"></i> HUAWEI</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-03-24 00:28:35" itemprop="dateModified" datetime="2021-03-24T00:28:35+08:00">2021-03-24</time> </span><span id="2021/03/07/HCIA-Routing & Switching理论入门/" class="item leancloud_visitors" data-flag-title="HCIA-Routing & Switching理论入门" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Manshan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Manshan 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Manshan <i class="ic i-at"><em>@</em></i>I</li><li class="link"><strong>本文链接：</strong> <a href="https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/" title="HCIA-Routing &amp; Switching理论入门">https://manshan.top/2021/03/07/HCIA-Routing & Switching理论入门/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;07&#x2F;6K0lGT.jpg" title="数据通信与计算机网络"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 技术</span><h3>数据通信与计算机网络</h3></a></div><div class="item right"><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;08&#x2F;6loYh6.jpg" title="IPv6网络基础、安全、过渡与部署"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 技术</span><h3>IPv6网络基础、安全、过渡与部署</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BC%A0%E8%BE%93%E4%BB%8B%E8%B4%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">第一章【传输介质简介】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">第二章【以太网帧结构】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0ip%E7%BC%96%E5%9D%80"><span class="toc-number">3.</span> <span class="toc-text">第三章【IP 编址】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0icmp%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">第四章【ICMP 协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0arp%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.</span> <span class="toc-text">第五章【ARP 协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.</span> <span class="toc-text">第六章【传输层协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">第七章【数据转发过程】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0vrp%E5%9F%BA%E7%A1%80"><span class="toc-number">8.</span> <span class="toc-text">第八章【VRP 基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9F%BA%E7%A1%80"><span class="toc-number">9.</span> <span class="toc-text">第九章【命令行基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80"><span class="toc-number">10.</span> <span class="toc-text">第十章【文件系统基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0vrp%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86"><span class="toc-number">11.</span> <span class="toc-text">第十一章【VRP 系统管理】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%E4%BA%A4%E6%8D%A2%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80"><span class="toc-number">12.</span> <span class="toc-text">第十二章【交换网络基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0stp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">13.</span> <span class="toc-text">第十三章【STP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0rstp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">第十四章【RSTP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0ip%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80"><span class="toc-number">15.</span> <span class="toc-text">第十五章【IP 路由基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80"><span class="toc-number">16.</span> <span class="toc-text">第十六章【静态路由基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AEospf"><span class="toc-number">17.</span> <span class="toc-text">第十七章【链路状态路由协议 ——OSPF】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AB%E7%AB%A0dhcp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">18.</span> <span class="toc-text">第十八章【DHCP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0ftp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">19.</span> <span class="toc-text">第十九章【FTP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0telnet%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">20.</span> <span class="toc-text">第二十章【Telnet 原理与配置】</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/01/13/%E8%B7%AF%E7%94%B1%E6%9D%BF%E5%9D%97/" rel="bookmark" title="路由板块">路由板块</a></li><li><a href="/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/" rel="bookmark" title="深信服SCSA">深信服SCSA</a></li><li><a href="/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Python高级编程">Python高级编程</a></li><li><a href="/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/" rel="bookmark" title="Python爬虫入门到高级">Python爬虫入门到高级</a></li><li><a href="/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/" rel="bookmark" title="新华三H3C刷题">新华三H3C刷题</a></li><li><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="bookmark" title="数据通信与计算机网络">数据通信与计算机网络</a></li><li class="active"><a href="/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/" rel="bookmark" title="HCIA-Routing & Switching理论入门">HCIA-Routing & Switching理论入门</a></li><li><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" rel="bookmark" title="IPv6网络基础、安全、过渡与部署">IPv6网络基础、安全、过渡与部署</a></li><li><a href="/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/" rel="bookmark" title="HCIA-Routing & Switching实验入门">HCIA-Routing & Switching实验入门</a></li><li><a href="/2021/03/31/AD/" rel="bookmark" title="深信服——AD">深信服——AD</a></li><li><a href="/2021/04/02/NISP/" rel="bookmark" title="NISP">NISP</a></li><li><a href="/2021/04/05/Kali%E6%B8%97%E9%80%8F%E6%95%99%E7%A8%8B&%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="bookmark" title="Kali渗透教程/网络安全">Kali渗透教程/网络安全</a></li><li><a href="/2021/04/11/SCSA%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86/" rel="bookmark" title="深信服SCSA实验部分">深信服SCSA实验部分</a></li><li><a href="/2021/05/23/%E5%8D%8E%E4%B8%BAHCIA%E6%95%B0%E9%80%9A/" rel="bookmark" title="华为HCIA数通">华为HCIA数通</a></li><li><a href="/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8A)/" rel="bookmark" title="数据通信与计算机网络">数据通信与计算机网络</a></li><li><a href="/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8B)/" rel="bookmark" title="数据通信与计算机网络">数据通信与计算机网络</a></li><li><a href="/2021/06/18/TCP_IP%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF%EF%BC%88%E4%B8%80%EF%BC%89/" rel="bookmark" title="数据通信与计算机网络">数据通信与计算机网络</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Manshan" data-src="/images/1.jpg"><p class="name" itemprop="name">Manshan</p><div class="description" itemprop="description"></div></div><div id="binft"></div><script>var binft=function(t){function r(){return f[Math.floor(Math.random()*f.length)]}function e(){return String.fromCharCode(94*Math.random()+33)}function n(t){for(var n=document.createDocumentFragment(),i=0;t>i;i++){var l=document.createElement("span");l.textContent=e(),l.style.color=r(),n.appendChild(l)}return n}function i(){var r=a[c.skillI];c.step?c.step--:(c.step=o,c.prefixP<l.length?(c.prefixP>=0&&(c.text+=l[c.prefixP]),c.prefixP++):"forward"===c.direction?c.skillP<r.length?(c.text+=r[c.skillP],c.skillP++):c.delay?c.delay--:(c.direction="backward",c.delay=g):c.skillP>0?(c.text=c.text.slice(0,-1),c.skillP--):(c.skillI=(c.skillI+1)%a.length,c.direction="forward")),t.textContent=c.text,t.appendChild(n(c.prefixP<l.length?Math.min(b,b+c.prefixP):Math.min(b,r.length-c.skillP))),setTimeout(i,d)}var l="",a=["天道酬勤，宁静致远。","一言既出，驷马难追。","用心做事，诚信为人。","如鱼饮水，冷暖自知。","博观细取，厚积薄发。","知人者智，自知者明。","一日无书，百事荒废。","一分辛劳，一分收获。","人之幼稚，不学则愚。","塞翁失马，焉知非福。","耳闻是虚，眼见为实。"].map(function(t){return t+""}),g=2,o=1,b=5,d=75,f=["rgb(110,64,170)","rgb(150,61,179)","rgb(191,60,175)","rgb(228,65,157)","rgb(254,75,131)","rgb(255,94,99)","rgb(255,120,71)","rgb(251,150,51)","rgb(226,183,47)","rgb(198,214,60)","rgb(175,240,91)","rgb(127,246,88)","rgb(82,246,103)","rgb(48,239,130)","rgb(29,223,163)","rgb(26,199,194)","rgb(35,171,216)","rgb(54,140,225)","rgb(76,110,219)","rgb(96,84,200)"],c={text:"",prefixP:-b,skillI:0,skillP:0,direction:"forward",delay:g,step:o};i()};binft(document.getElementById("binft"))</script><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pvY2VseW5mbG9yZXNYWFg=" title="https:&#x2F;&#x2F;github.com&#x2F;jocelynfloresXXX"><i class="ic i-github"></i></span> <span class="exturl item weixin" data-url="aHR0cHM6Ly9zMy5heDF4LmNvbS8yMDIxLzAzLzA3LzZLQmJjRC5qcGc=" title="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;07&#x2F;6KBbcD.jpg"><i class="ic i-weixin"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE0Nzg0ODY0ODU=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1478486485"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vNzMwMzMxNDY1OC9wcm9maWxlP3RvcG5hdj0xJnd2cj02" title="https:&#x2F;&#x2F;weibo.com&#x2F;7303314658&#x2F;profile?topnav&#x3D;1&amp;wvr&#x3D;6"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly93d3cuMTZwZXJzb25hbGl0aWVzLmNvbS9wcm9maWxlcy85ZDY2Njg3MjAwZDhm" title="https:&#x2F;&#x2F;www.16personalities.com&#x2F;profiles&#x2F;9d66687200d8f"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E6%9D%82/" title="分类于 杂">杂</a></div><span><a href="/2021/05/23/%E6%9D%82/" title="杂">杂</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8A)/" title="数据通信与计算机网络">数据通信与计算机网络</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/" title="深信服SCSA">深信服SCSA</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" title="IPv6网络基础、安全、过渡与部署">IPv6网络基础、安全、过渡与部署</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/" title="HCIA-Routing &amp; Switching实验入门">HCIA-Routing & Switching实验入门</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/05/23/%E5%8D%8E%E4%B8%BAHCIA%E6%95%B0%E9%80%9A/" title="华为HCIA数通">华为HCIA数通</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%9E%E4%B9%A0/" title="分类于 实习">实习</a></div><span><a href="/2021/07/06/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="实习日记">实习日记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/04/11/SCSA%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86/" title="深信服SCSA实验部分">深信服SCSA实验部分</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2021/07/07/SANGFOR%E4%BA%A7%E5%93%81%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%97%A5%E8%AE%B0/" title="分类于 日记">日记</a></div><span><a href="/2021/07/08/%E6%97%A5%E5%BF%97/" title="日志">日志</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Manshan @ Manshan</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">209k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">3:10</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("01/10/2021 1:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/07/HCIA-Routing & Switching理论入门/",favicon:{show:"（●´3｀●）你好！",hide:"(´Д｀)再见！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->