<!-- build time:Fri Mar 19 2021 18:07:14 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#008000"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="I" href="https://2memos.xyz/rss.xml"><link rel="alternate" type="application/atom+xml" title="I" href="https://2memos.xyz/atom.xml"><link rel="alternate" type="application/json" title="I" href="https://2memos.xyz/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="HUAWEI"><link rel="canonical" href="https://2memos.xyz/2021/03/07/HCIA-Routing%20&%20Switching/"><title>HCIA-Routing & Switching - 技术 | Manshan = I</title><meta name="generator" content="Hexo 5.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs right"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">HCIA-Routing & Switching</h1><div class="meta"><span class="item" title="创建时间：2021-03-07 13:52:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-07T13:52:40+08:00">2021-03-07</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>42k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>38 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Manshan</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://s3.ax1x.com/2021/03/07/6KsYp6.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="item" rel="index" title="分类于 技术"><span itemprop="name">技术</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://2memos.xyz/2021/03/07/HCIA-Routing%20&%20Switching/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/1.jpg"><meta itemprop="name" content="Manshan"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="I"></span><div class="body md" itemprop="articleBody"><h1 id="第一章传输介质简介"><a class="anchor" href="#第一章传输介质简介">#</a> 第一章【传输介质简介】</h1><details class="primary"><summary>前言</summary><div><ul><li>通信网络除了包含通信设备本身之外，还包含连接这些设备的传输介质，如，同轴电缆，双绞线和光纤等。不同的传输介质具有不同的特性，这些特性直接影响到通信的诸多方面，如，线路编码方式，传输速度和传输距离等。</li></ul></div></details><p class="red">1，简单网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MGv3d.png" alt="图片"></li><li>上图，两个终端，用一条能够承载数据传输的物理介质 (也称传输介质) 连接起来，就组成了一个简单网络。</li><li>[2] 终端相互传递信息和资源共享的需求是网络产生的主要原因。</li><li>[3] 终端可以产生，发送和接收数据，网络是终端建立通信的媒介，终端通过网络建立连接，用来传输数据的载体称为介质，网络可以使用各种介质进行数据传送，包括物理线缆，无线电波等。</li><li>[4] 网络就是通过介质把终端互联而成的一个规模大，功能强的系统，从而使得众多的终端可以方便地互相传递信息，共享信息资源。</li></ul><p class="red">2，介质 —— 同轴电缆：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 简介如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MYMQA.png" alt="图片"></li><li>[2] 同轴电缆是一种早期使用的传输介质，同轴电缆的标准分为两种，10BASE2 和 10BASE5. 这两种标准都支持 10Mbps 的传输数据，最长传输距离分别为 184m 和 500m 一般情况下，10BASE2 同轴电缆使用 BNC 接头，10BASE5 使用 N 型接头。</li><li>[3] 10BASE5 和 10BASE2 是早期的两种以太网标准，它们均采用同轴电缆作为传输介质。10BASE5 和 10BASE2 所使用的同轴电缆的直径分别为 9.5mm 和 5mm，所以前者又称为粗电缆，后者又称为细电缆。</li><li>[4] 现在 10Mbps 的传输速率早已不满足目前企业网络的需求，因此同轴电缆在目前企业网络中很少应用。</li></ul><p class="red">3，介质 —— 交叉线：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MsexK.png" alt="图片"></li><li>[2] 与同轴电缆相比双绞线 (Twisted Pair) 具有更低的制造和部署成本，因此在企业网络中被广泛应用。</li><li>[3] 双绞线可分为屏蔽双绞线 (Shielded Twisted Pair STP) 和非屏蔽双绞线 (Unshielded Twisted Pair UTP)。</li><li>[4] 屏蔽双绞线在双绞线与外层绝缘封套之间有一个金属屏蔽层，可以屏蔽电磁干扰。</li><li>[5] 双绞线有很多种类型，不同类型的双绞线所支持的传输速率一般也不相同，例如，3 类双绞线支持 10Mbps 传输速率，5 类双绞线支持 100Mbps 传输速率，超 5 类双绞线及更高级别的双绞线支持千兆以太网传输。</li><li>[6] 双绞线使用 RJ-45 接头连接网络设备，为了保证终端能够正常收发数据，RJ-45 的针脚必须按照一定的线序排列。</li><li>[7] 排序：</li><li>568A 排线顺序：绿白，绿，橙白，蓝，蓝白，橙，棕白，棕。</li><li>568B 排线顺序：橙白，橙，绿白，蓝，蓝白，绿，棕白，棕。</li></ul><p class="red">4，介质 —— 光纤：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M6hCR.png" alt="图片"></li><li>[2] 双绞线和同轴电缆传输数据时使用的是电信号，而光纤传输数据时使用的是光信号。</li><li>[3] 光纤支持的传输速率包括：10Mbps，100Mbps，1Gbps，10Gbps 甚至更高。</li><li>[4] 根据光纤传输光信号模式的不同，光纤又可以分为单模光纤和多模光纤。</li><li>[5] 单模光纤只能传输一种模式的光，不存在膜间色散，因此适用于长距离高速传输。</li><li>[6] 多模光纤允许不同模式的光在一根光纤上传输，由于膜间色散较大而导致信号脉冲展宽严重，因此多模光纤主要用于局域网中短距离传输。</li><li>[7] 光纤连接器种类很多，常用的连接器包括 ST，FC，SC，LC 连接器。</li></ul><p class="red">5，介质 —— 串口电缆：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M2cb8.png" alt="图片"></li><li>[2] 网络通信中常常会用到各种各样的串口电缆，常用的串口电缆标准为 RS-232，同时也是推荐的标准。但是 RS-232 的传输速率有限，传输距离仅为 6m。</li><li>[3] 其他的串口电缆标准可以支持更长的传输距离，例如：RS-422 和 RS-485 的传输距离可达到 1200m，RS-422 和 RS-485 串口电缆通常使用 V.35 接头，这种接头在上世纪 80 年代已被淘汰，但是，现在仍在帧中继，ATM 等传统网络上使用。</li><li>[4] V.24 是 RS-232 标准的欧洲版，RS-232 本身没有定义接头标准，常用的接头类型为 DB-9 和 DB-25.</li><li>[5] 现在，RS-232 已逐渐被 FireWire，USB 等新标准取代，新产品和新设备已普遍使用 USB 标准。</li></ul><p class="red">6，冲突域：</p><div class="note info"><p>如下如下</p></div><ul><li><p>[1] 如图：</p></li><li><p><img data-src="https://s3.ax1x.com/2021/03/07/6MWFO0.png" alt="图片"></p></li><li><p>注：共享式网络中可能会出现信号冲突现象。</p></li><li><p>[2] 上图是一个 10BASE5 以太网，每个主机都使用同一根同轴电缆来与其他主机进行通信，因此，这里的同轴电缆又被称为共享介质，相应的网络被称为共享介质网络，或称为共享式网络，在共享式网络中，不同的主机同时发送数据时，就会产生信号冲突的问题，解决这一问题的方法一般是采用<ins class="wavy"> CSMA/CD (载波侦听多路访问 / 冲突检测技术)。</ins></p></li><li><p>[3]<ins class="wavy success"> CSMA/CD 的基本工作过程如下：</ins></p></li><li><p><ins class="wavy success">终端设备不停地检测共享线路的状态，如果线路空闲，则可以发送数据，如果线路不空闲，则等待一段时间后继续检测 (延时时间由退避算法决定)。</ins></p></li><li><p><ins class="wavy success">如果有另一台设备同时发送数据，两个设备发送的数据会产生冲突。</ins></p></li><li><p><ins class="wavy success">终端设备检测到冲突之后，会马上停止发送自己的数据，并发送特殊阻塞信息，以强化冲突信号，使线路上其他站点能够尽早检测到冲突。</ins></p></li><li><p><ins class="wavy success">终端设备检测到冲突后，等一段时间之后再进行数据发送 (延时时间有退避算法决定)。</ins></p></li><li><p><ins class="wavy success">CSMA/CD 的工作原理可简单总结为：先听后发，边发边听，冲突停发，随机延迟后重发。</ins></p></li></ul><p class="red">7，双工模式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M4Q6s.png" alt="图片"></li><li>注：两种双工模式都支持双向数据传输。</li><li>[2] 半双工：</li><li>在半双工 (Half-duplex mode) 下，通信双方都能发送和接收数据，但不能同时进行。当一台设备发送时，另一台只能接收，反之亦然。对讲机就是半双工的典型例子。</li><li>[3] 全双工：</li><li>在全双工 (Full-duplex mode) 下，通信双方都能同时接收和发送数据，电话网络是典型的全双工例子。</li><li>[4] 以太网上的通信模式包括全双工和半双工两种。</li><li>[5] 半双工模式下，共享物理介质的通信双方必须采用 CSMA/CD 机制来避免冲突，例如，10BASE5 以太网的通信模式就必须是半双工模式。</li><li>[6] 全双工模式下，通信双方可以同时实现双向通信，这种模式不会产生冲突，因此，不需要使用 CSMA/CD 机制，例如，10BASE-T 以太网的通信模式就可以是全双工模式。</li><li>[7] 同一物理链路上相连的两台设备的双工模式必须保持一致。</li></ul><p class="red">8，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>千兆以太网传输必须使用超 5 类标准及以上的双绞线，或者使用千兆级更高等级的光纤。</li><li>冲突域是一个通过共享物理介质进行双向传输的所有节点的集合，当同一个冲突与域中的主机同时发送数据时，数据到达目的地之前可能会发生冲突。</li><li>CSMA/CD 是一种在共享式网络上检测并避免冲突的机制。</li></ul><h1 id="第二章以太网帧结构"><a class="anchor" href="#第二章以太网帧结构">#</a> 第二章【以太网帧结构】</h1><details class="primary"><summary>前言</summary><div><ul><li>网络中传输数据时需要定义并遵循一些标准，以太网是根据 IEEE 802.3 标准来管理和控制数据帧的。了解 IEEE 802.3 标准是充分了解以太网中链路层通信的基础。</li></ul></div></details><p class="red">1，网络通信协议：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MTD2D.png" alt="图片"></li><li>注：不同的协议栈用于定义和管理不同网络的数据转发规则。</li><li>[2] 网络通信中，“协议” 和 “标准” 这两个词汇常常可以混用，同时，协议或标准本身又常常具有层次的特点。</li><li>[3] 一般地，关注于逻辑数据关系的协议通常被称为上层协议，而关注于物理数据流的协议通常被称为底层协议。</li><li>[4] IEEE 802 就是一套用来管理物理数据流在局域网中传输的标准，包括在局域网中传输物理数据的 802.3 以太网标准。除此之外，还有一些用来管理物理数据流在广域网中传输的标准，如，PPP (Point-To-Point Protocol)，高级数据链路控制 HDLC (High-Level Data Link Control)。</li></ul><p class="red">2，分层模型 ——OSI：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6M7oY6.png" alt="图片"></li><li>[2] OSI 参考模型具有以下优点：</li><li>简化了相关的网络操作。</li><li>提供了不同厂商之间的兼容性。</li><li>促进了标准化工作。</li><li>结构上进行了分层。</li><li>易于学习和操作。</li><li>[3] OSI 各个层次的基本功能如下：</li><li><ins class="dot">物理层：</ins></li><li>在设备之间传输比特流，规定了电平，速度和电缆针脚。</li><li><ins class="dot">数据链路层：</ins></li><li>将比特组合成字节，再将字节组合成帧，使用链路层地址 (以太网使用 MAC 地址) 来访问介质，并进行差错检测。</li><li><ins class="dot">网络层：</ins></li><li>提供逻辑地址，供路由器确认路径。</li><li><ins class="dot">传输层</ins></li><li>提供面向连接或非面向连接的数据传递以及进行重传前的差错检测。</li><li><ins class="dot">会话层</ins></li><li>负责建立，管理，终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和相应组成。</li><li><ins class="dot">表示层</ins></li><li>提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。</li><li><ins class="dot">应用层</ins></li><li>OSI 参考模型中最靠近用户的一层，为应用程序提供网络服务。</li></ul><p class="red">3，分层模型 ——TCP/IP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/07/6MqezT.png" alt="图片"></li><li>[2] TCP/IP 模型同样采用了分层结构，层与层相对独立但是相应之间也具备非常密切的协作关系。</li><li>[3] TCP/IP 模型将网络分为四层，TCP/IP 模型不关注底层物理介质，主要关注于终端之间的逻辑数据流转发，</li><li>[4] TCP/IP 模型的核心是网络层和传输层，网络层解决网络之间的逻辑转发问题，传输层保证源端到目的端之间的可靠传输。最上层的应用层通过各种协议向终端用户提供业务应用。</li></ul><p class="red">4，数据封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QC5WQ.png" alt="图片"></li><li>[2] 应用数据需要经过 TCP/IP 每一层处理之后才能通过网络传输到目的端，每一层上都是用该层的数据单元 PDU (Protocol Data Unit) 彼此交换信息。不同层的 PDU 中包含有不同的信息，因此 PDU 在不同层被赋予了不同的名称。</li><li>[3] 如上层数据在传输层添加 TCP 报头后得到的 PDU 被称为数据段 (Segmet), 数据段被传递给网络层，网络层添加 IP 报头得到的 PDU 被称为数据包 (Packet), 数据包被传递到数据链路层，封装数据链路层报头得到的 PDU 被称为数据帧 (Frame), 最后，帧被转换为比特，通过网络介质传输，这种协议栈逐层向下传递数据，并添加报头和报尾的过程称为封装。</li></ul><p class="red">5，终端之间的通信：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QPkTK.png" alt="图片"></li><li>注：数据链路层控制数据帧在物理线路上传输。</li><li>[2] 数据包在以太网物理介质传播之前必须封装头部和尾部信息，封装后的数据包被称为数据帧，数据帧中封装的信息决定了数据如何传输，以太网中传输的数据帧有两种格式。选择哪种格式，由 TCP/IP 协议族中的网络层决定。</li></ul><p class="red">6，帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QPQmt.png" alt="图片"></li><li>[2] 以太网上使用两种标准帧格式，第一种是上世纪八十年代提出的 DIX v2 格式，即 Ethernet II 帧格式，Ethernet II 后来被 IEEE 802 标准接纳，并写进了 IEEE 802.3	X-1997 的 3.2.6 节。</li><li>[3] 第二种是 1983 年提出的 IEEE 802.3 格式，这两种格式的主要区别在与 Ethernet II 格式中包含一个 Type 字段，标识以太帧处理完成之后将被发送到哪个上层协议进行处理，IEEE 802.3 格式中，同样的位置是长度字段。</li><li>[4] 不同的 Type 字段值可以用来区别这两种帧的类型，当 Type 字段值小于等于 1500 (或者 16 进制的 0x05DC) 时，帧使用的是 IEEE 802.3 格式。当 Type 值大于等于 1536 (或者 16 进制 0x0600) 时，帧使用的是 Ethernet II 格式。<ins class="wavy">以太网中大多数的数据帧使用的是 Ethernet II 格式。</ins></li><li>[5]<ins class="wavy"> 以太帧中还包括源和目的 MAC 地址，分别代表发送者的 MAC 和接收者的 MAC，此外还有帧校验序列字段，用于校验传输过程中帧的完整性。</ins></li></ul><p class="red">7，Ethernet II 帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6QzZoF.png" alt="图片"></li><li><ins class="wavy">注：Ethernet II 帧类型值大于等于 1536 (0x0600)，以太网数据帧的长度在 64-1518 字节之间。</ins></li><li>[2] Ethernet II 的帧中各种字段说明如下：</li><li><ins class="wavy">DMAC(Destination MAC)：</ins></li><li>是目的 MAC 地址，DMAC 字段长度为 6 个字节，标识帧的接收者。</li><li><ins class="wavy">SMAC(Source MAC)：</ins></li><li>是源 MAC 地址，SMAC 字段长度为 6 个字节，标识帧的发送者。</li><li><ins class="wavy">Type (类型字段)：</ins></li><li>用于标识数据字段中包含的高层协议，该字段长度为 2 个字节，<ins class="wavy">类型字段取值为 0x0800 的帧代表 IP 协议帧。类型字段取值为 0x0806 的帧代表 ARP 协议帧。</ins></li><li><ins class="wavy">Data (数据字段)：</ins></li><li>是网络层数据，最小长度必须为 46 字节以保证帧长至少为 64 字节，数据字段的最大长度为 1500 字节。</li><li><ins class="wavy">FCS (循环冗余检验字段)：</ins></li><li>提供了一种错误检测机制，该字段长度为 4 个字节。</li></ul><p class="red">8，IEEE 802.3 帧格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lFCAP.png" alt="图片"></li><li><ins class="wavy">注：IEEE 802.3 帧长度字段值小于等于 1500 (0x05DC)。</ins></li><li>[2] IEEE 802.3 帧格式类似于 Ethernet II 帧，只是 Ethernet II 帧的 type 域被 802.3 帧的 Length 域取代，并且占用了 Data 字段的 8 个字节作为 LLC 和 SNAP 字段。</li><li><ins class="wavy">Leagth 字段：</ins></li><li>定义了 Data 字段包含的字节数。</li><li><ins class="wavy">逻辑链路控制 LLC (Logical Link Control)：</ins></li><li>由目的服务访问点 DSAP (Destination Service Access Point)，源服务访问点 SSAP (Source Service Access Point) 和 Control 字段组成。</li><li><ins class="wavy">SNAP(Sub-network Access Point)：</ins></li><li>由机构代码 (Org Code) 和类型 (Type) 字段组成，Org Code 三个字节都为零，Type 字段的含义与 Ethernet II 帧中的 Type 字段相同。</li><li><ins class="wavy">IEEE 802.3 帧根据 DSAP，SSAP 字段的取值又可以分为以下几类：</ins></li><li>1) 当 DSAP 和 SSAP 都取特定值 0xff 时，802.3 帧就变成了 Netware-ETHERNET 帧，用来承载 NetWare 类型的数据。</li><li>2) 当 DSAP 和 SSAP 都取特定值 0xaa 时，802.3 帧就变成了 ETHERNET-SNAP 帧，ETHERNER_SNAP 帧可以用于传输多种协议。</li><li>3)<ins class="wavy"> DSAP 和 SSAP 其他的取值均为纯 IEEE 802.3 帧。</ins></li></ul><p class="red">9，数据帧传输：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lVFVs.png" alt="图片"></li><li><ins class="wavy">注：数据链路层基于 MAC 地址进行帧的传输。</ins></li><li>[2] 以太网在二层链路上通过 MAC 地址来唯一标识网络设备，并且实现局域网上网络设备之间的通信。</li><li>[3] MAC 地址也叫物理地址，大多数网卡厂商把 MAC 地址烧入了网卡的 ROM 中，发送端使用接收端的 MAC 地址作为目的地址，以太帧封装完成之后会通过物理层转换成比特流在物理介质上传输。</li></ul><p class="red">10，以太网的 MAC 地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lek90.png" alt="图片"></li><li>++ 注：MAC 地址由两部分组成，分别是供应商代码和序列号。其中前 24 位代表该供应商代码，由 IEEE 管理和分配，剩下的 24 位序列号由厂商自己分配。</li><li>[2] 网络设备的 MAC 地址是全球唯一的，MAC 地址长度为 48 比特，通常用 16 进制标识。</li><li>[3] MAC 地址包含两个部分：前 24 比特是组织唯一标识符 (OUI) 由 IEEE 统一分配给设备制造商，例如，华为网络产品的 MAC 地址前 24 比特是 0x00e0fc。后 24 位序列号是厂商厂商分配给每个产品的唯一数值，由各个厂商自行分配。</li></ul><p class="red">11，单播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6ln06f.png" alt="图片"></li><li>[2] 局域网中的帧可以通过三种方式发送，第一种是单播，指从单一的源端单一的目的端，每个主机接口由一个 MAC 地址唯一标识，<ins class="wavy">MAC 地址的 OUI 中，第一个字节第八个比特标识比特类型。</ins></li><li>[3] 对于主机 MAC 地址，这个比特固定为零，表示目的 MAC 地址为此 MAC 地址的帧都是发送到某个唯一的目的端。</li><li>[4] 在冲突与中，所有主机都能接收到源主机发送的单播帧，都是其他主机发现目的地址与本地 MAC 地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧。</li></ul><p class="red">12，广播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lKLy6.png" alt="图片"></li><li>[2] 第二种方式是广播，表示帧从单一的源发送到共享以太网上的所有主机。广播帧的目的 MAC 地址为十六进制的 FF:FF:FF:FF:FF:FF，所有收到该广播帧的主机都要接收并处理这个帧。</li><li>[3]<ins class="wavy"> 广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能。</ins></li><li>[4]<ins class="wavy"> 当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式。</ins></li></ul><p class="red">13，组播：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6lQQ4H.png" alt="图片"></li><li>[2] 第三种发送方式为组播，组播比广播更加高效，组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的 MAC 地址为该组播 MAC 地址的帧。</li><li>[3] 组播 MAC 地址和单播 MAC 地址是通过<ins class="wavy">第一个字节中的第八个比特区分的。组播 MAC 地址的第八个比特为 1，而单播 MAC 地址的第八个比特为 0。</ins></li><li>[4] 当需要网络上的一组主机 (而不是全部主机) 接收相同的信息，并且其他主机不受影响的情况下通常会使用组播方式。</li></ul><p class="red">14，数据帧的发送和接收：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/6l3GvR.png" alt="图片"></li><li><ins class="wavy">注：当主机接收到数据帧所包含的目的 MAC 地址是自己时，会把以太网封装剥掉后送往上层协议。</ins></li><li>[2] 帧从主机的物理口发送出来后，通过传输介质传输到目的端，共享网络中，这个帧可能到达多个主机，主机检测帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢弃收到的帧。</li><li>[3] 如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检测帧检验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保存了完整性。如果帧的 FCS 值与本机计算的值不同，主机会认为帧已被破坏，并会丢弃该帧。如果该帧通过了 FCS 校验，则主机会根据帧头部的 Type 字段来确定将帧发送给上层哪一个协议处理，本列中，Type 字段的值为 0x0800，表明该帧需要发送到 IP 协议上处理，在发送给 IP 协议之前，帧的头部和尾部会被剥掉。</li></ul><p class="red">15，本章总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 网络设备如何确定以太网数据帧的上层协议？</li><li>以太网帧中包含一个 Type 字段，表示帧中的数据应该发送到上层哪个协议处理，比如，IP 协议对应的 Type 值为 0x0800，ARP 协议对应的 Type 值为 0x0806。</li><li>[2] 终端设备接收到数据帧时，会如何处理？</li><li>主机检查帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢掉收到的帧，如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检查帧校验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保持了完整性。如果检查通过，就会剥离帧头和帧尾，然后根据帧头中的 Type 字段来决定把数据发送到哪个上层协议进行后续处理。</li></ul><h1 id="第三章ip编址"><a class="anchor" href="#第三章ip编址">#</a> 第三章【IP 编址】</h1><details class="primary"><summary>前言</summary><div><ul><li>网络层位于数据链路层与传输层之间，网络层包含了许多协议其中最为重要的就是 IP 协议，网络层提供了 IP 路由功能，理解 IP 路由除了要熟悉 IP 协议的工作机制外，还必须理解 IP 编址以及如何合理地使用 IP 地址来设计网络。</li></ul></div></details><p class="red">1，上层协议类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61SXYF.png" alt="图片"></li><li>++ 注：以太网帧中的 Type 字段值为 0x0800，表示该帧的网络层协议为 IP 协议。</li><li>[2] 在剥掉帧的头部和尾部之前网络设备需要根据帧头中 Type 字段来确定下一步将帧发送到哪个上层协议进行处理。本列中的帧头部 Type 字段表示该帧需要上送到 IP 协议进行处理，以下将介绍帧的头部和尾部剥离之后，IP 协议将如何处理帧中的数据。</li></ul><p class="red">2，IP 报文头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/619nCF.png" alt="图片"></li><li>[2] IP 报文头部信息用于指导网络设备对报文进行路由和分片。同一个网段内的数据转发通过数据链路层即可实现，而跨网段的数据转发需要使用网络设备的路由功能。分片是指数据包超过一定长度时，需要被划分成不同的片段使其能够在网络中传输。</li><li>[3] IP 报文头部长度为 20——60 字节，报文头部中的信息可以用来指导网络设备如何将报文从原设备发送到目的设备，其中，版本字段表示当前支持的 IP 协议版本，当前的版本号为 4。DS 字段早期用来表示业务类型，现在用于支持 QoS 中的差分服务模型，实现网络流量优化。</li><li>[4] 源和目的 IP 地址是分配给自己的逻辑地址，用于在网络层标识报文的发送方和接收方，根据源和目的 IP 地址可以判断目的端是否与发送端位于同一网段，如果二者不在同一网段，则需要采用<ins class="wavy">路由机制</ins>进行跨网段转发。</li></ul><p class="red">3，IP 编址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61Pd0I.png" alt="图片"></li><li><ins class="wavy">注：IP 地址分为网络部分和主机部分</ins></li><li><ins class="wavy">注：IP 地址由 32 个二进制位组成，通常用点分十进制来表示</ins></li></ul><p class="red">4，二进制，十进制，十六进制 ———— 略</p><p class="red">5，IP 地址分类：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61iGEq.png" alt="图片"></li><li>[2] IP 地址被划分为 A,B,C,D,E 五类，每类地址的网络号包含不同的字节数。A，B，C 类地址可以分配 IP 地址。每类地址支持的网络数和主机数不同，例如：A 类地址可支持 126 个网络每个网络支持 2*24 (16777216) 个主机地址，另外每个网段中的网络地址和广播地址不能分配给主机，C 类地址支持 200 多万个网络，每个网络支持 256 个主机地址，其中 254 个地址可以分配给主机使用。</li><li>[3] D 类地址为组播地址，主机收到以 D 类地址为目的地址的报文后，且该主机是该组播组的成员，就会接收并处理该报文。</li></ul><p class="red">6，IP 地址类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/08/61FzlD.png" alt="图片"></li><li>[2] 默认情况下，网络中的主机无法使用使用私网地址与公网通信，当需要与公网通信时，私网地址必须转换成公网地址。</li><li>[3] 127.0.0.1 网段中的地址为环回地址。用于诊断网络是否正常。</li><li>[4] IPv4 中的第一个地址 0.0.0.0 表示任何网络。IPv4 最后一个地址 255.255.255.255 是 0.0.0.0 网络中的广播地址。</li></ul><p class="red">7，网络通信：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68rxnP.png" alt="图片"></li><li>[2] 源主机必须知道目的主机的 IP 地址后才能将数据发送到目的地，源主机向其他目的主机发送报文之前，需要检查目的 IP 地址和源 IP 地址是否属于同一网段，如果是则报文将被下发到底层协议进行以太网封装处理。如果目的地址和源地址属于不同网段，则主机需要获取下一跳路由器的 IP 地址，然后将报文下发到底层协议处理。</li></ul><p class="red">8，子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68yZ2d.png" alt="图片"></li><li>[2] 子网掩码用于区分网络部分和主机部分。</li><li>[3] 子网掩码与 IP 地址的表示方式相同，每个 IP 地址和子网掩码一起可以用来唯一的标识一个网段中的某台网络设备。</li><li>[4] 子网掩码中的 1 表示网络位，0 表示主机位。</li></ul><p class="red">10，默认子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68yjdf.png" alt="图片"></li><li>[2] 每类 IP 地址有一个缺省子网掩码，A 类地址的为 8 位，即第一个字节表示网络位，其他三个字节表示主机位，B 类 16 位，因此 B 类支持更多的网络，但是主机数也相应减少。C 类 24 位，支持的网络最多，但是也限制了单个网络中主机的数量。</li></ul><p class="red">11，地址规划：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68c8js.png" alt="图片"></li><li>[2] 通过子网掩码可以判断主机所属的网段，网段上的广播地址以及网段上支持的主机数。</li></ul><p class="red">12，地址规划举例：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68gJRe.png" alt="图片"></li></ul><p class="red">13，有类 IP 编址的缺陷：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68WYzF.png" alt="图片"></li><li><ins class="wavy">注：在设计网络时使用有类 IP 地址会造成地址的浪费。</ins></li><li>[2] 使用缺省子网掩码就会存在一定的局限性，网络中划分多个网段后，每个网段中的实际主机数量可能很有限，导致很多地址未被使用，地址使用率低。</li></ul><p class="red">14，变长子网掩码：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src alt="图片"></li><li>[2] 采用可变长子网掩码可解决上述问题	，缺省子网掩码可以进一步划分，称为变长子网掩码 (VLSM)。</li><li>[3] 通过改变子网掩码，可以将网络划分为多个子网，上图借用了一个主机位作为网络位，借用的主机位变成了子网位。所以有 2*7-2 个主机地址，即 126 个。</li></ul><p class="red">15，无类域间路由 (CIDR)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/6850XD.png" alt="图片"></li><li><ins class="wavy">注：CIDR 增强了网络的可拓展性。</ins></li><li>[2] 无类域间路由 CIDR 由 RFC1817 定义，CIDR 突破了传统 IP 地址的分类边界，将路由表中的若干条路由汇总为一条路由，减少了路由表的规模，提高了路由器的可拓展性。</li></ul><p class="red">16，网关：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/09/68IJKS.png" alt="图片"></li><li><ins class="wavy">注：网关用来转发来自不同网段之间的数据包。</ins></li><li>[2] 报文转发过程中，首先需要确定转发路径以及通往目的网段的接口，然后将报文封装在以太帧中通过指定的物理接口转发出去。如果目的主机与源主机不在同一网段，报文需要先转发到网关，然后通过网关将报文转发到目的网段。</li><li>[3] 网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备，为实现此功能，网关必须知道目的网段的 IP 地址，网关设备上连接本地网段的接口地址即为该网段的网关地址。</li></ul><p class="red">17，IP 包分片：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/68qjiQ.png" alt="图片"></li><li>[2]<ins class="wavy"> 网络中转发的 IP 报文长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输，将报文分割成多个片段的过程叫做分片。</ins></li><li>[3] 接收端根据分片报文中的<ins class="wavy">标识符 (Identification)，标志 (Flags)，及片偏移 (Fragment Offset) 字段</ins>对分片报文进行重组。</li><li>[4]<ins class="wavy"> 标识符 (Identification): 用于识别属于同一个数据包的分片，以区别于同一主机或其他	主机发送的其他数据包分片，保证分片被正确的重新组合。</ins></li><li>[5]<ins class="wavy"> 标志字段 (Flags): 用于判断是否已经收到最后一个分片，最后一个分片的标志字段设置为 0，其他分片的标志字段设置为 1. 目的端在收到标志字段为 0 的分片后，开始重组报文。</ins></li><li>[6]<ins class="wavy"> 片偏移字段 (Fragment Offset): 表示每个分片在原始报文中的位置。第一个分片的片偏移为 0，第二个分片的片偏移表示紧跟第一个分片后的第一个比特的位置，比如，如果首片报文包含 1259 比特，那么第二分片报文的片偏移字段值就应该为 1260。</ins></li></ul><p class="red">18，生存时间：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/68OO3j.png" alt="图片"></li><li>[2] 报文在网段间转发时，如果网络设备上的路由规划不合理，就可能会重新环路，导致报文在网络中无限循环，无法到达目的端。环路发生后，所有发往这个目的地的报文的都会被循环转发，随着这种报文逐渐增多，网络将会发送拥塞。</li><li>[3] 为了避免环路导致的网络拥塞，IP 报文头中包含一个生存时间 TTL (Time To Live) 字段，报文每经过一台<ins class="wavy">三层设备，</ins>TTL 值减 1。初始 TTL 值由源端设备设置。当报文中的 TTL 降为 0 时，报文会被丢弃。同时，丢弃报文的设备会根据报文头中的源 IP 地址向源端发送 ICMP 错误消息。</li></ul><p class="red">19，协议号：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6Gjy8g.png" alt="图片"></li><li>[2] 目的端的网络层在接受并处理报文之后，需要决定下一步对报文该做如何的处理。IP 报文头部中的协议字段标识了将会继续处理报文的协议。与以太帧头部中的 Type 字段类似，协议字段也是一个十六进制数，该协议可以标识网络层协议，如，ICMP (因特网控制报文协议)，也可以标识上层协议，如，TCP (传输控制协议，对应值 0x06)，UDP (用户数据包协议，对应值 0x11)</li></ul><p class="red">20，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 子网掩码的专用是什么？</li><li>32 位的 IP 子网掩码用于区分 IP 地址中的网络号和主机号，网络号表示网络或子网，主机号表示网络或子网中的主机。</li><li>[2] IP 报文头部中 TTL 字段的作用是什么？</li><li>如果网络中存在环路，则 IP 报文可能会在网络中循环而无法达到目的端，TTL 字段限定了 IP 报文的生存时间，保证无法到达目的端口的报文最终被丢弃。</li><li>[3] 网关的作用是什么？</li><li>网关是指接收并处理本地网段主机发送出来的报文并转发到目的网段的设备。</li></ul><h1 id="第四章icmp协议"><a class="anchor" href="#第四章icmp协议">#</a> 第四章【ICMP 协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>Internet 控制消息协议 ICMP (Internet Control Message Protocol) 是网络层的一个重要协议。</li><li>ICMP 协议用来在网络设备间传递各种差错和控制信息，并，<ins class="wavy">对于收集各种网络信息，诊断和排除各种网络故障等方面起着至关重要的作用。</ins></li><li>使用基于 ICMP 的应用时，需要对 ICMP 的工作原理非常熟悉。</li></ul></div></details><p class="red">1，ICMP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JCwQO.png" alt="图片"></li><li><ins class="wavy">注：ICMP 用来传递差错，控制，查询等信息。</ins></li><li>[2]<ins class="wavy"> ICMP 是 TCP/IP 协议族的核心协议之一，它用于在 IP 网络设备之间发送控制报文，传递差错，控制，查询等消息。</ins></li></ul><p class="red">2，ICMP 重定向：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JPQht.png" alt="图片"></li><li>[2] ICMP Redirect 重定向消息用于支持路由功能。</li><li>[3]<ins class="wavy"> 上图，主机 A 希望发送报文到服务器 A，于是根据配置的默认网关地址向网关 RTB 发送报文，网关 RTB 收到报文后，检查报文信息，发现报文应该转发到与源主机在同一网段的另一个网关设备 RTA，因为此转发路径是更优的路径，所以 RTB 会向主机发送一个 Redirect 消息，通知主机直接向另一个网关 RTA 发送该报文，主机收到 Redirect 消息后，会向 RTA 发送报文，然后 RTA 会该报文再转发给服务器 A。</ins></li></ul><p class="red">3，ICMP 差错检测：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JENYd.png" alt="图片"></li><li><ins class="wavy">注：ICMP Echo Requests 和 ICMP Echo Reply 分别用来查询和响应某些消息，进行差错检测。</ins></li><li>[2]<ins class="wavy"> ICMP Echo 消息常用于诊断源和目的地之间的网络连通性，同时，还可以提供其他信息，如报文往返时间等。</ins></li></ul><p class="red">4，ICMP 错误报告：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JVrg1.png" alt="图片"></li><li><ins class="wavy">注：当网络设备无法访问目标网络时，会自动发送 ICMP 目的不可达报文到发送端设备。</ins></li><li>[2]<ins class="wavy"> ICMP 定义了各种错误消息，用于诊断网络连通性问题，根据这些错误消息，源设备可以判断出数据传输失败的原因。</ins></li><li>[3]<ins class="wavy"> 比如，如果网络中发生了环路，导致报文在网络中循环，且最终 TTL 超时，这种情况下网络设备会发送 TTL 超时消息个发送端设备。</ins></li><li>[4]<ins class="wavy"> 又比如，如果目的地址不可达，则中间的网络设备会发送目的不可达的消息给发送端设备。</ins></li><li>[5]<ins class="wavy"> 目的不可达的情况有多种，如果是网络设备无法找到目的网络。则发送目的网络不可达消息，如果是网络设备无法找到目的网络中的目的主机，则发送目的主机不可达消息。</ins></li></ul><p class="red">5，ICMP 数据包格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JKmBq.png" alt="图片"></li><li><ins class="wavy">注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同消息。</ins></li><li>[2] ICMP 消息封装在 IP 报文中。<ins class="wavy">ICMP 消息的格式取决于 Type 和 Code 字段。其中 Type 字段为消息类型，Code 字段包含该消息类型的具体参数。</ins></li><li>[3]<ins class="wavy"> 后面的校验和字段用于检测消息是否完整，消息中包含 32 比特的可变参数，这个字段一般不使用，通常设置为 0。在 ICMP Redirect 消息中，这个字段用来指定网关 IP 地址，主机根据这个地址将报文重定向到指定网关。</ins></li><li>[4]<ins class="wavy"> 在 Echo 请求消息中，这个字段包含标识符和序号，源端根据这两个参数将收到的回复消息与本端发送的 Echo 请求消息进行关联，尤其是当源端向目的端发送多个 Echo 请求消息时，需要根据标识符和序号将 Echo 请求和回复消息进行一一对应。</ins></li></ul><p class="red">6，ICMP 消息类型和编码类型：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6JNBjK.png" alt="图片"></li><li>[2] ICMP 定义了多种消息类型，并用于不同的场景，这些消息不需要 Code 字段来描述具体的类型参数，仅用 Type 字段表示消息类型，比如，ICMP Echo 回复消息的 Type 字段设置为 0。</li><li>[3]<ins class="wavy"> 有些 ICMP 消息使用 Type 字段定义消息大类，用 Code 字段表示消息的具体类型。比如，类型为三的消息表示目的不可达，不同的 Code 值表示不可达的原因，包括目的网络不可达 (Code=0)，目的主机不可达 (code=1), 协议不可达 (Code=2)，目的 TCP/UDP 端口不可达 (Code=3) 等。</ins></li></ul><p class="wavy">7，ICMP 应用 - Ping (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6YVbwT.png" alt="图片"></li><li>[2] ICMP 的一个典型应用时 Ping，Ping 是检测网络连通性的常用工具，同时也能收集其他相关信息。</li><li>[3] 用户可以在 Ping 命令中指定不同的参数，如 ICMP 报文长度，发送的 ICMP 报文个数，等待回复相应的超时时间等，设备根据配置的参数来构造并发送 ICMP 报文，进行 Ping 测试。</li><li>[4] Ping 常用的配置参数说明如下：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①：-a source-ip-address指定发送ICMP ECHO—REQUEST报文的源IP地址。如果不指定源IP地址，将采用出接口的IP地址作为ICMP ECHO—REQUEST报文发送的源地址。</pre></td></tr><tr><td data-num="2"></td><td><pre>②：-c count 指定发送ICMP ECHO—REQUEST报文次数，缺省情况下发送5个ICMP ECHO-REQUEST报文。</pre></td></tr><tr><td data-num="3"></td><td><pre>③：-h ttl-value指定TTL的值，缺省值是255。</pre></td></tr><tr><td data-num="4"></td><td><pre>④：-t <span class="token function">time</span> out指定发送完ICMP ECHO-REQUEST后，等待ICMP ECHO-<span class="token environment constant">REPLY</span>的超时时间。</pre></td></tr></table></figure><p class="red">8，ICMP 应用 - Ping (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/10/6Ym0W4.png" alt="图片"></li><li>[2]<ins class="wavy"> Ping 命令的输出信息中包括目的地址，ICMP 报文长度，序号，TTL 值以及往返时间。</ins></li><li>[3]<ins class="wavy"> 序号是包含在 Echo 回复消息 (Type=0) 中的可变参数字段，TTL 和往返时间包含在消息的 IP 头中。</ins></li></ul><p class="red">9，ICMP 应用 - Tracert (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6YDV6s.png" alt="图片"></li><li>[2] ICMP 的另一个典型的应用是 Tracrt，<ins class="wavy">Traceret 基于报头中的 TTL 值来逐跳跟踪报文的转发路径。</ins></li><li>[3] 为了跟踪到达某特定目的地址的路径，源端首先将报文的 TTL 值设置为 1，该报文到达第一个节点后，TTL 超时，于是该字节向源端发送 TTL 超时消息，消息中携带时间戳。然后源端将报文的 TTL 值设置为 2，报文到达第二个节点超时后，该节点同样返回 TTL 超时消息，以此类推，直到报文到达目的地。这样，源端根据返回的报文中的消息可以跟踪到报文经过的每一个节点，并根据时间戳信息计算往返时间，Tracert 是检测网络丢包及时延的有效手段，同时可以帮助管理员发现网络中的路由环路。</li><li>[4] Tracertc 常用的配置参数说明如下：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①：-a source-ip-address指定Tracert报文的源地址。</pre></td></tr><tr><td data-num="2"></td><td><pre>②：-f first-ttl指定初始TTL，缺省值是1。</pre></td></tr><tr><td data-num="3"></td><td><pre>③：-m max-ttl指定最大TTL，缺省值是30。</pre></td></tr><tr><td data-num="4"></td><td><pre>④：-name使能显示每一跳的主机名。</pre></td></tr><tr><td data-num="5"></td><td><pre>⑤：-p port指定目的主机的UDP端口。</pre></td></tr></table></figure><p class="red">10，ICMP 应用 ——Tracert (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6YyqHI.png" alt="图片"></li><li>[2]<ins class="wavy"> 注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同信息。</ins></li><li>[3] 上图，源端 (RTA) 向目的端 (主机 B) 发送一个 UDP 报文，TTL 值为 1，目的 UDP 端口号是大于 30000 的一个数，因此在大多数情况下，大于 30000 的 UDP 端口号是任何一个应用程序都不可能使用的端口号。</li><li>[4] 第一跳 (RTB) 接收到源端发送的 UDP 报文后，判断出报文的目的 IP 地址不是本机 IP 地址，将 TTL 减一后，判断出 TTL 值等于 0，将丢弃报文并向源端发送一个 ICMP 超时 (Time Exceeded) 报文。(该报文中含有第一跳的 IP 地址 10.0.0.2)，这样源端就得到了 RTB 的地址。</li><li>[5] 源端收到 RTB 的 ICMP 超时报文后，再次向目的端发送一个 UDP 报文，TTL 值为 2。</li><li>[6] 第二跳 (RTC) 收到源端发送出的 UDP 报文后，回应一个 ICMP 超时报文，这样源端就得到了 RTC 的地址 (20.0.0.2)</li><li>[7] 以上过程不断进行，直到目的端收到收到源端发送的 UDP 报文，判断出目的 IP 地址是本机 IP 地址，则处理此报文，根据报文中目的 UDP 端口号寻找占用此端口号的上层协议。因目的端没有应用程序使用该 UDP 端口号，则向源端返回一个 ICMP 不可达 (Destination Unreachable) 报文。</li><li>[8] 源端收到 ICMP 端口不可达报文后，判断出 UDP 报文已经到达目的端。则停止 Tracert 程序，从而得到数据报文从源端到目的端所经历的路径 (10.0.0.2,20.0.0.2,30.0.0.2)。</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] Ping 使用的是哪两类 ICMP 消息？</li><li>Ping 利用 ICMP Echo 请求消息 (Type 值为 0) 来发起检测目的可达性，目的端收到 ICMP Echo 请求消息后，根据 IP 报头中的源地址向源端发送 ICMP Echo 回复消息 (Type 值为 0)。</li><li>[2] 当网络设备收到 TTL 值为 0 的报文时，会如何操作？</li><li>如果 IP 数据包在到达目的地之前 TTL 值已经将为 0，则收到 IP 数据包的网络设备会丢弃该数据包，并向源端发送 ICMP 消息通知源端 TTL 超时。</li></ul><h1 id="第五章arp协议"><a class="anchor" href="#第五章arp协议">#</a> 第五章【ARP 协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>当网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址 (即 IP 地址)。</li><li>IP 地址由网络层来提供，但是仅有 IP 地址是不够的，IP 数据报文必须封装成帧才能通过数据链路层进行发送。</li><li>数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址，通过目的 IP 地址来获取目的 MAC 地址的过程是由 ARP (Address Resolution Protocol) 协议来实现的。</li></ul></div></details><p class="red">1，ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NKKYV.png" alt="图片"></li><li><ins class="wavy">注：数据链路层在进行数据封装时，需要目的 MAC 地址。</ins></li><li>[2] 一个网络设备要发送数据给另一个网络设备时，必须要知道对方的 IP 地址，但是仅有 IP 地址是不够的，因为 IP 数据报文必须封装成帧才能通过数据链路层进行发送，而数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址。</li><li>[3] 每一个网络设备在数据封装前都需要获取下一跳的 MAC 地址。</li><li>[4] IP 地址由网络层提供，MAC 地址通过 ARP 协议来获取。</li><li>[5] ARp 协议是 TCP/IP 协议族中的重要组成部分，它能够通过目的 IP 地址获取目标设备的 MAC 地址，从而实现数据链路层的可达性。</li></ul><p class="red">2，ARP 数据包格式：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NQV5q.png" alt="图片"></li><li><ins class="wavy">注：ARP 报文不能穿越路由器，不能被转发到其他广播域。</ins></li><li>[2] 网络设备通过 ARP 报文来发现目的 MAC 地址，ARP 报文中包含以下字段：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Hard Type表示硬件地址类型，一般为以太网。</pre></td></tr><tr><td data-num="2"></td><td><pre>Protocol Type表示三层协议地址类型，一般为IP。</pre></td></tr><tr><td data-num="3"></td><td><pre>Hard Length和Protocol Length为MAC地址和IP地址的长度，单位是字节。</pre></td></tr><tr><td data-num="4"></td><td><pre>Operation Code指定了ARP报文的类型，包括ARP Requested和ARP Reply。</pre></td></tr><tr><td data-num="5"></td><td><pre>Source Hardware Address指的是发送ARP报文的设备MAC地址。</pre></td></tr><tr><td data-num="6"></td><td><pre>Source Protocol Address指的是发送ARP报文的设备IP地址。</pre></td></tr><tr><td data-num="7"></td><td><pre>Destination Hardware Address指的是接收者MAC地址，在ARP Request报文中，该字段为0。</pre></td></tr><tr><td data-num="8"></td><td><pre>Destination Protocol Address指的是接收者的IP地址。</pre></td></tr></table></figure><p class="red">3，ARP 工作过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N1s8P.png" alt="图片"></li><li><ins class="wavy">注：主机 A 发送一个数据包给主机 C 之前，首先要获取主机 C 的 MAC 地址。</ins></li><li>[2] 通过 ARP 协议，网络设备可以建立目标 IP 地址和 MAC 地址之间的映射，网络设备通过网络层获取到目的 IP 地址之后，还要判断目的 MAC 地址是否已知。</li></ul><p class="red">4，ARP 缓存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N3nRP.png" alt="图片"></li><li>[2] 网络设备一般都有一个 ARP 缓存 (ARP Cache)，<ins class="wavy">ARP 缓存用来存放 IP 地址和 MAC 地址的关联信息。</ins></li><li>[3] 在发送数据之前，设备会先检查 ARP 缓存表，如果缓存表中存在对方设备的 MAC 地址，则直接采用该 MAC 地址来封装帧，然后将帧发送出去，如果缓存表中不存在相应信息，则通过发送<ins class="wavy"> ARP Request</ins> 报文来获取它。</li><li>[4] 学习到的 IP 地址和 MAC 地址的映射关系会被放入 ARP 缓存表中存放一段时间，在有效时间内，设备可以直接从这个表中查找目的 MAC 地址来进行数据封装，而无需进行 ARP 查询，过了这段有效期，ARP 表项会被自动删除。</li><li>[5] 如果目标设备位于其他网络，则源设备会在 ARP 缓存表中查找网关的 MAC 地址，然后将数据发送给网关，网关再把数据转发给目的设备。</li></ul><p class="red">5，ARP 请求：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NGpnO.png" alt="图片"></li><li>[2] 上图，主机 A 的 ARP 缓存表中不存在主机 C 的 MAC 地址，所以主机 A 会发送 ARP Request 来获取目的 MAC 地址。</li><li>[3] ARP Request 报文封装在以太帧里，帧头中的源 MAC 地址为发送端主机 A 的 MAC 地址，此时，由于主机 A 不知道主机 C 的 MAC 地址，所以目的 MAC 地址为广播地址 FF-FF-FF-FF-FF-FF。</li><li>[4] ARP Request 报文中包含源 IP 地址，目的 IP 地址，源 MAC 地址，目的 MAC 地址，其中目的 MAC 的值为 0，ARP Request 报文会在整个网络上传播，该网络上的所有主机包括网关都会接收到此 ARP Request 报文。</li><li>[5]<ins class="wavy"> 网关将会阻止该报文发送到其他网络上。</ins></li></ul><p class="red">6，ARP 响应 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NYIjP.png" alt="图片"></li><li>[2] 所有的主机接收到该 ARP Request 报文之后，都会检查它的目的协议地址字段与本身的 IP 地址是否匹配。如果不匹配，则该主机将不会响应该 ARP Request 报文，如果匹配，则该主机会将 ARP 报文中的源 MAC 地址和源 IP 地址信息记录到自己的 ARP 缓存表中，然后通过 ARP Reply 报文进行相应。</li></ul><p class="red">7，ARP 响应 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6Ntk4J.png" alt="图片"></li><li>[2] 主机 C 会向主机 A 回应 ARP Reply 报文，ARP Reply 报文中的源协议地址是主机 C 自己的 IP 地址，目标协议地址是主机 A 的 IP 地址，目的 MAC 地址是主机 A 的 MAC 地址，源 MAC 地址是自己的 MAC 地址，同时 Operation Code 被设置为 Reply。</li><li>[3] ARP Reply 报文通过单播传输。</li></ul><p class="red">8，ARP 缓存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NNuzn.png" alt="图片"></li><li>[2] 主机 A 收到 ARP Reply 以后，会检查 ARP 报文中目的 MAC 地址是否与自己的 MAC 匹配，如果匹配，ARP 报文中的源 IP 地址和源 MAC 地址会被记录到主机 A 的 ARP 缓存表中。</li></ul><p class="red">9，ARP 代理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图:</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NUPfJ.png" alt="图片"></li><li><ins class="wavy">注：同一网段，不同物理网络上的计算机之间，可以通过 ARP 代理实现相互通信。</ins></li><li>[2] 上图组网中，主机 A 需要与主机 B 通信，目的 IP 地址与本机的 IP 地址在同一个网段，所以 A 将会以广播形式发送 ARP Request 报文请求主机 B 的 MAC 地址，但是，广播报文无法被路由器转发，所以主机 B 无法收到主机 A 的 ARP 请求报文，当然也就无法应答。</li><li>[3] 在路由器上启用代理 ARP 功能，就可以解决这个问题，启用代理 ARP 后，路由器收到这样的请求，会查找路由表，如果存在主机 B 的路由表项，路由器将会使用自己的 G0/0/0 接口的 MAC 地址来回应 ARP Request，主机 A 收到 ARP Reply 后，将以路由器的 G0/0/0 接口的 MAC 地址作为目的 MAC 地址进行数据转发。</li></ul><p class="red">10，免费 ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src alt="图片"></li><li><ins class="wavy">注：免费 ARP 可以用来探测 IP 地址是否冲突。</ins></li><li>[2] 主机被分配了 IP 地址或者 IP 地址发生变更后，必须立刻检测其所分配的 IP 地址在网络上是否是唯一的，以避免地址冲突，<ins class="wavy">主机通过发送 ARP Request 报文来进行地址冲突检测。</ins></li><li>[3] 主机 A 将 ARP Request 广播报文中的目的 IP 地址字段设置为自己的 IP 地址，且该网络中所有主机包括网关都会接收到此报文。当目的 IP 地址已经被某一个主机或网关使用时，该主机或者网关就会回应 ARP Reply 报文，通过这种方式，主机 A 就能探测到 IP 地址冲突了。</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 网络设备在什么情况下会发送 ARP Request？</li><li>源设备在发送数据给目的设备前，会首先查看自身的 ARP 缓存，查找 ARP 缓存中是否存在目的设备的 IP 地址和 MAC 地址的映射，如果存在则直接使用，如果不存在则会发送 ARP Request。</li><li>[2] 网络设备什么时候会产生免费 ARP？</li><li>当网络上的一个设备被分配了 IP 地址或者 IP 地址发生变更后，可以通过免费 ARP 来检测 IP 地址是否冲突。</li></ul><h1 id="第六章传输层协议"><a class="anchor" href="#第六章传输层协议">#</a> 第六章【传输层协议】</h1><details class="primary"><summary>前言</summary><div><ul><li>传输层定义了主机应用程序之间端到端的连通性，传输层最为常见的两个协议分别是传输控制协议 TCP (Transmission Control Protocol) 和用户数据包协议 UDP (User datagram Protocol)。</li></ul></div></details><p class="red">1，TCP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6N06xJ.png" alt="图片"></li><li><ins class="wavy">注：TCP 是一种面向连接的传输层协议，可提供可靠的传输服务。</ins></li><li>[2] TCP 位于 TCP/IP 模型的传输层，它是一种面向连接的端到端协议。</li><li>[3] TCP 作为传输控制协议，可以为主机提供可靠的数据传输，上图，在通信之前，需要 TCP 在他们之间建立可靠的传输通道。</li></ul><p class="red">2，TCP 端口号：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NBmJU.png" alt="图片"></li><li><ins class="wavy">注：端口号用来区分不同的网络服务。</ins></li><li>[2] TCP 允许一个主机同时运行多个应用进程，m 每台主机可以拥有多个应用端口，每对端口号，源和目标 IP 地址的组合唯一的标识了一个会话。</li><li>[3] 端口分为知名端口和动态端口，<ins class="wavy">有些网络服务会使用固定的端口，这类端口称为知名端口，端口范围为 0-1023。如，FTP，HTTP，Telnet，SNMP 服务均使用知名端口。</ins></li><li>[4]<ins class="wavy"> 动态端口范围从 1024-65535，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。</ins></li></ul><p class="wavy">3，TCP 头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/11/6NrECT.png" alt="图片"></li><li>[2] TCP 通常使用 IP 作为网络层协议，这时 TCP 数据段被封装在 IP 数据包内。</li><li>[3] TCP 数据段由 TCP Header (头部)，和 TCP Data (数据) 组成，TCP 最多可以有 60 个字节的头部，如果没有 Options 字段，正常的长度是 20 字节。</li><li>[4] TCP Header 是由上图标识的一些字段组成这里列出几个常用字段：</li></ul><figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>①16位源端口号：源主机的应用程序使用的端口号。</pre></td></tr><tr><td data-num="2"></td><td><pre>②16位目的端口号：目的主机的应用程序使用的端口号。每个TCP头部都包含源和目的端的端口号，这两个值加上IP头部中的源IP地址和目的IP地址可以唯一确定一个TCP连接。</pre></td></tr><tr><td data-num="3"></td><td><pre>③32位序列号：用于标识从发送端发出的不同的TCP数据段的序号，数据段在网络中传输时，他们的顺序可能会发生变化，接收端依据此序列号，便可按照正确的顺序重组数据。</pre></td></tr><tr><td data-num="4"></td><td><pre>④32位确认序列号：用于标识接收端确认收到的数据段，确认序列号为成功收到的数据数列号加1.</pre></td></tr><tr><td data-num="5"></td><td><pre>⑤4位头部长度：表示头部占用32bit字的数目，它能表达的TCP头部最大长度为60字节。</pre></td></tr><tr><td data-num="6"></td><td><pre>⑥16位窗口大小：表示接收端期望通过单次确认而收到的数据的大小，由于该字段为16位，所以窗口大小的最大值为65535字节，该字节通常用来进行流量控制。</pre></td></tr><tr><td data-num="7"></td><td><pre>⑦16位校验和：校验整个TCP报文段，包括TCP头部和TCP数据，该值由发送端计算和记录并由接收端进行验证。</pre></td></tr></table></figure><p class="red">4，TCP 建立连接的过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6NsgfK.png" alt="图片"></li><li><ins class="wavy">注：TCP 通过三次握手建立可靠连接。</ins></li><li>[2] TCP 是一种可靠的，面向连接的全双工传输层协议。</li><li>[3] TCP 连接的建立是一个三次握手的过程，如图所示：</li><li>[4] 主机 A (通常也称为客户端) 发送一个标识了 SYN 的数据段，表示期望与服务器 A 建立连接，此数据段的序列号 (seq) 为 a。</li><li>[5] 服务器 A 回复了标识了 SYN+ACK 的数据阶段，此数据段的序列号 (seq) 为 b，确认序列号为主机 A 的序列号加 1 (a+1)，以此作为对主机 A 的 SYN 报文确认。</li><li>[6] 主机 A 发送一个标识了 ACK 的数据段，此数据段的序列号 (seq) 为 a+1，确认序列号为服务器 A 的序列号加 1 (b+1)，以此作为对服务器 A 的 SYN 报文的确认。</li></ul><p class="red">5，TCP 的传输过程：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6aPmi4.png" alt="图片"></li><li>[2] TCP 的可靠传输还体现在 TCP 使用了确认技术来确保目的设备收到了从源设备而发来的数据。并且是正确无误的。</li><li>[3] 确认技术的工作原理如下：</li><li>目的设备接收到源设备发送的数据段时，会向源端发送确认报文，源设备收到确认报文后，继续发送数据段，如此重复。</li><li>[4] 上图，主机 A 向服务器 A 发送 TCP 数据段，假定每个数据段的长度都是 500 个字节。当服务器 A 成功收到序列号是 M+1499 字节以及之前的所有字节时，会以序列号 M+1499+1=M+1500 进行确认。另外，由于数据段 N+3 传输失败，所以服务器 A 未能收到序列号为 M+1500 的字节，因此服务器 A 还会再次以序列号 M+1500 进行确认。</li></ul><p class="red">6，TCP 流量控制：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6ai1pj.png" alt="图片"></li><li>[2]<ins class="wavy"> TCP 滑动窗口技术通过动态改变窗口大小来实现对端到端设备之间的数据进行流量控制。</ins></li><li>[3] 上图，主机 A 和服务器 A 之间通过滑动窗口来实现流量控制，为方便理解，上图只考虑主机 A 发送数据给服务器 A 时，服务器 A 通过滑动窗口进行流量控制。</li><li>[4] 主机 A 向服务器发送 4 个长度为 1024 字节的数据段，其中主机的窗口大小为 4096 个字节。服务器 A 收到第三个数据段后，缓存区满。第四个数据段被丢弃，服务器以 ACK 3073 响应，窗口大小调整为 3072，表明服务器的缓冲区只能处理 3072 个字节的数据段，于是主机 A 改变其发送的速率，发送窗口大小为 3072 的数据段。</li></ul><p class="red">7，TCP 关闭连接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/12/6aFUKI.png" alt="图片"></li><li><ins class="wavy">注：主机在关闭连接之前，要确认收到来自对方的 ACK。</ins></li><li>[2] TCP 支持全双工模式传输数据，这意味着同一时刻两个方向都可以进行数据的效数据的传输，在传输数据之前，TCP 通过三次握手建立的实际上是两个方向的连接，因此，在传输完毕之后，两个方向的连接必须都关闭。</li><li>[3]<ins class="wavy"> TCP 的建立是一个三次握手的过程，而 TCP 连接的终止则要经过四次握手。</ins></li><li>[4] 如上图：</li><li><ins class="wavy">主机 A 想要终止连接，于是发送了一个标识了 FIN，ACK 的数据段，序列号为 a，确认序列号为 b。</ins></li><li><ins class="wavy">服务器 A 回应了一个标识了 ACK 的数据段，序列号为 b，确认序号为 a+1，作为对主机 A 的 FIN 报文的确认。</ins></li><li><ins class="wavy">服务器 A 想要终止连接，于是向主机 A 发送了一个标识了 FIN，ACK 的数据段，序列号为 b，确认序列号为 a+1。</ins></li><li><ins class="wavy">主机 A 回应了一个 ACK 的数据段，序列号为 a+1，确认序列号为 b+1，作为对服务器 A 的 FIN 报文的确定。</ins></li><li>[5] 以上四次交互便完成了两个方向连接的关闭。</li></ul><p class="red">8，UDP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a4rK1.png" alt="图片"></li><li><ins wavy>注：UDP 是一种面向无连接的传输层协议，传输可靠性没有保障。</ins></li><li>[2] 当应用程序对传输的可靠性要求不高时，但是对传输速度和延迟要求较高时，可以用 UDP 协议来代替 TCP 协议在传输层控制数据的转发。</li><li>[3] UDP 将数据从源端发送到目的端时，无需事先建立连接。</li><li>[4] UDP 采用了简单，易操作的机制在应用程序之间传输数据，没有使用 TCP 中的确认技术或滑动窗口机制，因此，UDP 不能保证数据传输的可靠性，也无法避免接收到重复数据的情况。</li></ul><p class="red">9，UDP 头部：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a4TqP.png" alt="图片"></li><li><ins class="wavy">注：UDP 头部仅占 8 字节，传输数据时没有确认机制。</ins></li><li>[2] UDP 报文分为 UDP 报文头和 UDP 数据两部分。报头由源端口，目的端口，报文长度以及校验和组成，UDP 适合于实时数据的传输，如语音和视频通信。</li><li>[3] 相比于 TCP，UDP 的传输效率更高，开销更小，但是无法保证数据传输的可靠性。</li><li>[4] UDP 头部的标识如下：</li><li>16 位源端口号：源主机的应用程序使用的端口号。</li><li>16 位目的端口号：目的主机的应用程序使用的端口号。</li><li>16 位 UDP 长度：是指 UDP 头部和 UDP 数据的字节长度，因为 UDP 头部长度为 8 字节，所以该字节的最小值为 8。</li><li>16 位 UDP 校验和：该字节提供了与 TCP 校验字段同样的功能，该字段是可选的。</li></ul><p class="red">10，UDP 的传输过程 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a5CZV.png" alt="图片"></li><li><ins class="wavy">注：使用 UDP 传输数据时，由应用程序根据需要提供报文到达确认，排序，流量控制等功能。</ins></li><li>[2] 主机 A 发送数据包时，这些数据包是以有序的方式发送到网络中的，每个数据包独立地在网络中被发送，所以不同的数据包可能会通过不同的网络路径到达主机 B。</li><li>[3] 这样的情况下，先发的数据包不一定先到达主机 B，因为 UDP 数据包没有序号，主机 B 将无法通过 UDP 协议将数据包按照原来的顺序重新组合，所以此时需要应用程序提供报文的到达确认，排序和流量控制等功能。</li><li>[4] 通常情况下，UDP 采用实时传输机制和时间戳来传输语音和视频数据。</li></ul><p class="red">11，UDP 的传输过程 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6a58RH.png" alt="图片"></li><li><ins class="wavy">注：UDP 不提供重传机制，占用资源小，处理效率高。</ins></li><li><ins class="wavy">注：一些时延敏感的流量，如语音，视频等，通常使用 UDP 作为传输协议。</ins></li><li>[2] UDP 适合传输对时延敏感的流量，如，语音和视频。</li><li>[3] 在使用 TCP 协议传输数据时，如果一个数据段丢失或者接收端对某个数据段没有确认，发送端会重新发送该数据段。</li><li>[4] TCP 重新发送数据会带来延迟和重复数据，降低了用户体验。对于时延敏感的应用，少量的数据丢失一般可以被忽略，这时使用 UDP 传输将能够提升用户的体验。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] TCP 头部中的确认标识位由什么作用？</li><li>TCP 报文头中的 ACK 标志位用于目的端对已收到数据的确认，目的端成功收到序列号为 X 的字节及之前的所有字节后，会以序列号 X+1 进行确认。</li><li>[2] TCP 头部中有哪些标识位参与 TCP 三次握手？</li><li>在 TCP 的三次握手过程中，要使用 SYN 和 ACK 标识位来请求建立连接和确认建立连接。</li></ul><h1 id="第七章数据转发过程"><a class="anchor" href="#第七章数据转发过程">#</a> 第七章【数据转发过程】</h1><details class="primary"><summary>前言</summary><div><ul><li>TCP/IP 协议族和底层协议配合，保证了数据能够实现端到端地连接。数据传输过程是一个非常复杂的过程，例如，数据在转发地过程中会进行一系列的封装和解封装。对于网络工程师来说，只有深刻地了解数据在各种不同设备上的转发过程，才能对网络进行正确的分析和检测。</li></ul></div></details><p class="red">1，数据转发过程的概述：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6duWB4.png" alt="图片"></li><li><ins class="wavy">注：数据包在相同网段内或不同网段之间转发所依据的原理基本一致。</ins></li><li>[2]<ins class="wavy"> 数据可以在同一网络内或者在不同网络间传输，数据转发过程也分为本地转发和远程转发，但两者的数据转发原理是基本一致的，都是遵循 TCP/IP 协议族。</ins></li><li>上图，主机 A 需要访问服务器 A 的 WEB 服务，并假设两者之间已经建立了 TCP 连接，接下来会以上图来讲解数据在不同网络间的传输过程。</li></ul><p class="red">2，TCP 封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dKyad.png" alt="图片"></li><li><ins class="wavy">注当主机建立了到达目的地的 TCP 连接后，便开始对应用层数据进行封装。</ins></li><li>[2]<ins class="wavy"> 主机 A 会对待发送的应用数据首先执行加密和压缩等相关操作，之后进行传输层封装。</ins></li><li>[3] Web 应用是基于传输层的 TCP 协议传输数据的，主机 A 使用 TCP 进行报文封装时，必须填充源端口和目的端口字段，初始序列号和确认序列号字段，标识位，窗口字段以及校验和字段。</li><li>[4] 此列中，数据段的源端口号为主机 A 随机的 1027 号端口，目的端口号为服务器 A 的 TCP 知名端口 80。</li></ul><p class="wavy">3，IP 封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dMDS0.png" alt="图片"></li><li>[2] 主机 A 完成传输层封装后，一般会进行网络层数据封装，在使用 IP 进行封装时，需要明确 IP 报文的源和目的地址，如果报文的大小大于网络的最大传输单元 (MTU)，则该报文有可能在传输过程中被分片。</li><li>[3] 生存时间 (TTL) 字段用来减少网络环路造成的影响。ARG3 系列路由器产生的数据包，默认 TTL 值为 255，路由器转发一个数据包时，该值会被减一，如果路由器发现该值被减为 0，就会丢弃该数据包。这样，即使网络中存在环路，数据包也不会在网络上一直被转发。</li><li>[4] 协议字段标识了传输层所使用的协议，本列中，传输层使用的是 TCP 协议，所以该字段的填充值为 0x06。</li></ul><p class="red">4，查找路由：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dQ1AJ.png" alt="图片"></li><li><ins class="wavy">注：主机 A 必须要拥有到达目的地的路由。</ins></li><li>[2]<ins class="wavy"> 每个主机都会独自维护各自的路由表项，主机 A 在发送数据前需要先检测是否能够到达目的端，这个过程是通过查找路由来完成的。</ins></li><li>[3] 上图，主机 A 拥有一条到达 “任何网络” 的路由。它发往其他网络的数据都会通过 IP 地址为 10.1.1.1 的接口转发到下一跳，即网关 10.1.1.254。</li></ul><p class="red">5，ARP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dlK2t.png" alt="图片"></li><li><ins class="wavy">注：通过 ARP 缓存表找到下一跳的 MAC 地址。</ins></li><li><ins class="wavy">注：如果表项里没有下一跳的 MAC 地址，主机 A 会发送 ARP 请求。</ins></li><li>[2] 接下来，由于数据包要被封装成数据帧，所以主机 A 需要获取下一跳的 MAC 地址，也就是网关的 MAC 地址，主机首先会查询 ARP 缓存表。上图，主机 A 的 ARP 缓存表中存在网关 MAC 地址的表项。</li><li>[3]<ins class="wavy"> 如果没有查找到网关的 MAC 地址表项，主机 A 会通过发送 ARP 请求来获取网关的 MAC 地址。</ins></li></ul><p class="red">6，以太网封装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6d1WkQ.png" alt="图片"></li><li>[2] 主机 A 在链路层封装数据帧时，会遵循 IEEE 802.3 或 Ethernet II 标准，Ethernet II 帧头中的类型字段填充为 0x0800，以表示网络层使用的是 IP 协议，源 MAC 地址为主机 A 的 MAC 地址，目的 MAC 地址为网关路由器的 E0/0 接口的 MAC 地址。</li></ul><p class="red">7，数据帧转发过程：</p><div class="note infojie'fu"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6d80Mt.png" alt="图片"></li><li><ins class="wavy">注：主机工作在半双工模式下，所以会使用 CSMA/CD 来检测链路是否空闲。</ins></li><li><ins class="wavy">注：前导码用于使接收者进入同步状态，定界符用于指示帧的开始。</ins></li><li>[2] 主机 A 工作在半双工模式下，所以会使用 CSMA/CD 里检测链路是否空闲，如果链路空闲，++ 主机 A 会将一个前导码 (Preamble) 和一个帧首定界符 (SFD) 附加到帧头然后进行传输。</li><li>[3]<ins class="wavy"> 前导码的作用是使接收设备进行同步并做好接收数据帧的准备。前导码是包括了 7 个字节的二进制 &quot;1&quot;,&quot;0&quot; 交替的代码，即 1010...10 共 56 位。</ins></li><li>[4]<ins class="wavy"> 帧首定界符是长度为 1 个字节的 10110101 二进制序列，它的作用是使接收端对帧的第一位进行定位。</ins></li></ul><p class="red">8，数据帧转发过程 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6dRyPH.png" alt="图片"></li><li><ins class="wavy">注：每个冲突域里的设备都会收到主机 A 发送的数据帧。</ins></li><li><ins class="wavy">注：只有网关 (RTA) 会处理该数据帧，并继续转发。</ins></li><li>[2] 上图，主机 A 发送数据帧到共享以太网，此网络中的所有设备都会收到数据帧。设备收到帧之后，首先会进行 FCS 校验，如果 FCS 未能通过，则帧被立即丢弃。</li><li>[3] 对于通过了 FCS 校验的帧，设备会检察帧中的目的 MAC 地址，如果帧中的目的 MAC 地址与自己的 MAC 地址不同，设备将丢弃帧，如果相同，则会继续处理。</li><li>[4] 在处理过程中，帧头帧尾会被剥去 (也就是解封装)，剩下的数据报文会被根据帧头中的类型字段的值来送到网络层中的对应协议模块去处理。</li></ul><p class="red">9，数据帧转发过程 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6doKfS.png" alt="图片"></li><li><ins class="wavy">注：网关检查是否具有到达目的网络的路由条目。</ins></li><li><ins class="wavy">注：如果存在转发路径，则为数据包添加一个新的二层帧头和帧尾，并继续转发。</ins></li><li>[2] RTA 收到此数据报文后，网络层会对该报文进行处理。RTA 首先根据 IP 头部信息中的校验和字段，检查 IP 数据报文头部的完整性，然后根据目的 IP 地址查看路由表，确定是否能够将数据包转发到目的端。RTA 还必须对 TTL 的值进行处理，另外，报文大小不能超过 MTU 值。如果报文大小超过 MTU 值，则报文将被分片。</li><li>[3] 网络层处理完成之后，报文将被收到数据链路层重新进行封装，成为一个新的数据帧，该帧的头部会封装新的源 MAC 地址和目的 MAC 地址，如果当前设备不知道下一跳的 MAC 地址，将会使用 ARP 来获得。</li></ul><p class="red">10，数据包解封装 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wtRIK.png" alt="图片"></li><li><ins class="wavy">注：服务器 A 检查数据包的目的 IP 地址，发现目的 IP 与自己的 IP 地址相同。</ins></li><li><ins class="wavy">注：服务器 A 剥掉数据包的 IP 报头后，会往上层协议 TCP 继续进行处理。</ins></li><li>[2] 服务器 A 通过 IP 协议来处理该报文，首先会通过校验和字段来验证报文头的完整性，然后检查 IP 报文头中的目的 IP 地址是否与自己当前的 IP 地址匹配。</li><li>[3] 如果在源和目的之间的数据传输期间数据发生了报文分片，则报文会被目的端重新组合。标识字段用于标识属于同一数据源的分片报文，偏移量标识该分片在源分组中的相对位置。</li><li>[4] 标志字段目前只有两位有意义，标志字段最低位为 1，表示后面还有分片，为 0 表示这已经是最后一个数据片，中间一位为 1 表示不能分片，为 0 表示可以分片。所有的分片报文必须被目的端全部接收到后才能进行重新组合。</li><li>[5] 协议字段表示此数据包携带的上层数据是上层数据的哪种协议的数据，需要注意的是，下一个报头并非总在传输层报头，例如，ICMP 报文也是使用 IP 协议封装，协议字段值为 0x01。</li></ul><p class="red">11，数据段解封装 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wUA0I.png" alt="图片"></li><li><ins class="wavy">注：服务器 A 检查 TCP 头部的目的端口，然后将数据段发送给应用层的 HTTP 协议进行处理。</ins></li><li>[2] 当 IP 报文头被处理完并剥离后，数据段会被发送到传输层进行处理。</li><li>[3] 上图，传输层协议使用的是 TCP，且发送端和接收端已经通过三次握手建立了连接。</li><li>[4] 传输层收到该数据段后，TCP 协议会查看并处理该数据段头部信息，其中目的端口号为 80，用于表示处理该数据的应用层协议为 HTTP 协议。</li><li>[5] TCP 处理完头部信息后会将此数据段头部进行剥离，然后将剩下的应用数据发送到 HTTP 协议进行处理。</li></ul><p class="red">12，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 数据在进行二层和三层封装之前，主机需要了解哪些信息？</li><li>主机在封装数据包之前，必须要知道目的端 IP 地址，在封装数据帧之前，必须要知道去往目的网络的路由以及下一跳的 MAC 地址。</li><li>[2] 当数据帧发送到非目的主机时，非目的主机将会如何处理？</li><li>如果主机接收到一个不是发往自己的数据帧，在检验帧头中的目的 MAC 地址之后会丢弃该帧。</li><li>[3] 传输层如何能够准确的将数据交给特定应用？</li><li>传输层会检查 TCP 或 UDP 报文头中的目的端口号，以此来识别特定应用。</li><li>[4] 当两台主机同时访问服务器的 HTTP 服务，该服务器如何区分数据属于哪个会话？</li><li>服务器可以只通过源 IP 地址识别两台主机的 HTTP 流量，另外 TCP 报文头中包含的源端口也可以被用来区分同一台主机通过不同的浏览器发起的不同的会话。例如，两个来自源 IP 为 10.1.1.1 的 HTTP 流量使用的目的端口号都是 80，但源端口号为 1028 和 1035。</li></ul><h1 id="第八章vrp基础"><a class="anchor" href="#第八章vrp基础">#</a> 第八章【VRP 基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>交换机可以隔离冲突与，路由器可以隔离广播域。这两种设备在企业网络中应用越来越广泛，随着越来越多的终端接入到网络中，网络设备的负担也越来越重，这时网络设备可以通过华为专有的 VRP 系统来提升运行效率。</li><li>通用路由平台 VRP (Versatile Routing Platform) 是华为公司数据通信产品的通用操作系统，它以 IP 业务为核心，采用组件化的体系结构，在实现丰富功能特性的同时，还提供了基于应用的可裁剪和可拓展的功能，使得路由器和交换机的运行效率大大增加，能对 VRP 熟练地进行配置和操作是对网络工程师的一种基本要求。</li></ul></div></details><p class="red">1，交换机的应用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wwYNt.png" alt="图片"></li><li><ins class="wavy">注：如果使用 Hub，则主机 A 发送数据时，其他主机都不能发送数据，否则会发送冲突。使用交换机时，则不会出现这种现象。</ins></li><li>[2] 由集线器 [HUB] 和中继器组建的以太网，实质上是一种共享式以太网，共享式以太网的主要缺陷有：<ins class="wavy">冲突严重，广播泛滥，安全性差。</ins></li><li>[3] 交换机是工作在数据链路层的设备，交换机可以将一个共享式以太网分割为多个冲突域，链路层流量被隔离在不同的冲突域中进行转发，如此便极大地提升了以太网的性能。</li><li>[4] 更进一步说，通常主机和交换机之间以及交换机与交换机之间都使用全双工技术进行通信，这时冲突现象会被彻底消除。</li><li>[5] 上图，由 HUB 搭建的网络中，所有的主机都处于同一个冲突域，主机 A 在发送数据给主机 B 时，其他主机都将收到此数据，但同时这些主机都不能发送数据。</li><li>[6] 用交换机替代 HUB 后，因为交换机分割了冲突域，所以在主机 A 发送数据给主机 B 时，主机 C 和主机 D 之间也可以同时互相发送数据。</li></ul><p class="red">2，路由器的应用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wDyEd.png" alt="图片"></li><li><ins class="wavy">注：路由器可以分割广播域。</ins></li><li>[2] 交换机虽然可以隔离冲突域，但是当一台设备发送广播帧时，其他设备仍然都会收到该广播帧，随着网络规模的增大，广播会越来越多，这样就会影响网络的效率，路由器可以用来分割广播域，减少广播对网络效率的影响。</li><li>[3]<ins class="wavy"> 一般情况下，广播帧的转发被限制在广播域内，广播域的边缘是路由器，因为，通常路由器不会转发广播帧。</ins></li><li>[4] 路由器负责在网络间转发报文，它能够在自身的路由表里查找到达目的地的下一跳地址，将报文转发给下一跳路由器，如此重复，并最终将报文送达目的地。</li></ul><p class="red">3，VRP 介绍：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w6Ax0.png" alt="图片"></li><li>[2] VRP 是华为公司具有完全自主知识产权的网络操作系统，可以运行在多种硬件平台上，VRP 拥有一致的网络界面，用户界面和管理界面，为用户提供了灵活丰富的应用解决方案。</li><li>[3] VRP 平台以 TCP/IP 协议族为核心，实现了数据链路层，网络层和应用层的多种协议，在操作系统中集成了路由交换技术，Qos 技术，安全技术和 IP 语音技术等数据通信功能。并以<ins class="wavy"> IP 转发引擎技术为基础。</ins>为网络设备提供了出色的数据转发能力。</li></ul><p class="red">4，VRP 的发展：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w6oQ0.png" alt="图片"></li><li>[2] 随着网络技术和应用的飞速发展，VRP 平台在处理机制，业务能力，产品支持等方面也在持续演进。到目前为止，VRP 以及开发出了五个版本，分别是 VRP1，VRP2，VRP3，VRP5，VRP8。</li><li>[3] VRP5 是一款分布式网络操作系统，具有高可靠性，高性能，可拓展的架构设计。目前，绝大多数华为设备使用的都是 VRP5 版本。</li><li>[4] VRP8 是新一代网络操作系统，具有分布式，多线程，组件化架构，支持分布式应用和虚拟化技术，能够适应未来的硬件发展趋势和企业急剧膨胀的业务需求。</li></ul><p class="red">5，设备管理接口：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6wgDDf.png" alt="图片"></li><li>[2] AR 系列企业路由器由多个型号，包括 AR150，AR200，AR1200，AR2200，AR3200。它们是华为第三代路由器产品，提供路由，交换，无线，语音和安全等功能，AR 路由器被部署在企业网络和公网之间，作为两个网络间传输数据的入口和接口。在 AR 路由器上部署多种业务能降低企业的网络建设成本和运维成本，根据一个企业的用户数和业务的复杂程度可以选择不同型号的 AR 路由器，来部署到网络中。</li><li>[3] 华为 X7 系列以太网交换机提供数据交换的功能，满足企业网络上多业务的可靠接入和高质量传输的要求，这个系列的交换机位于企业网络的接入层，汇聚层和核心层，提供大容量交换，高密度接口，实现高效的报文转发。X7 系列以太网交换机包括了 S1700，S2700，S3700，S5700，S7700，S9700 等。</li><li>[4] ARG3 系列路由器和 X7 系列交换机都提供了 Console 口作为管理口，AR2200 额外提供了 Mini USB 口作为管理口。</li></ul><p class="red">6，Console 口登录：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w2CIe.png" alt="图片"></li><li>[2] 使用 Console 线缆来链接交换机或路由器的 Console 口与计算机的 COM 口，这样就可以通过计算机实现本地调试和维护，S5720 和 AR2200E 的 Console 口是一种符合 RS232 串口标准的 RJ-45 接口。目前大多数台式电脑提供的 COM 口都可以与 Console 口连接。笔记本电脑一般不提供 COM 口，需要使用 USB 到 RS232 的转换接口。</li></ul><p class="red">7，参数配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/13/6w2kRA.png" alt="图片"></li><li>[2] 很多终端模拟程序都能发起 Console 连接，例如，可以使用超级终端程序连接到 VRP 操作系统。</li><li>[3] 上图，使用超级终端连接 VRP 时，必须设置端口参数，上图是端口参数设置的实列，如果对参数值做了修改，需要恢复默认参数值。</li><li>[4] 完成设置以后，点击 &quot;确认&quot; 按钮即可与 VRP 建立连接。</li><li>[5] 在缺少超级终端程序的计算机上，可以使用	putty 或 Secure CRT 程序发起 Console 连接，并连接到 VRP，配置参数与上图一致。</li></ul><p class="red">8，Mini USB 口登录：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6w2DzR.png" alt="图片"></li><li>[2] 华为 AR2200 系列路由器还支持 Mini USB 口与主机 USB 口建立连接，实现对设备的调试和维护。</li><li>[3]<ins class="wavy"> 在管理设备时，Console 口和 Mini USB 口互斥，即同一时刻只能使用其中一个接口连接 VRP。</ins></li></ul><p class="red">9，Mini USB 驱动安装：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6w2bef.png" alt="图片"></li><li>[2] 在使用 Mini USB 口建立连接前，需要在主机上安装驱动程序，可以从华为企业官方支持的网站下载到所需的驱动程序。</li><li>[3]++ 目前，Mini USB 的驱动程序只能安装在 Win XP，Win Vista 和 Win7 操作系统上。</li><li>[4] 华为企业官方网站网址：<span class="exturl" data-url="aHR0cDovL3d3dy5zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS8lRTMlODAlODI=">http://www.support.huawei.com/enterprise/。</span></li></ul><p class="red">10，参数配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wRVfJ.png" alt="图片"></li><li>[2] 安装驱动程序后，主机上会增加一个新的虚拟 COM 接口，终端模拟软件可以通过该虚拟 COM 接口连接到 VRP，</li></ul><p class="red">11，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如果路由器收到了网络中主机发送的广播报文，会如何操作？</li><li>当路由器收到该广播报文时，路由器会根据数据包内容尽享处理，可能会对必要广播报文 (如请求路由器 MAC 地址的 ARP 广播) 进行回应，但不会将该数据包转发到其他广播域。</li><li>[2] 华为数通设备目前使用的 VRP 版本是多少？</li><li>目前，大多数华为数通产品，使用的是 VRP5 版本，少数产品如 NE 系列路由器使用的是 VRP8 版本。</li></ul><h1 id="第九章命令行基础"><a class="anchor" href="#第九章命令行基础">#</a> 第九章【命令行基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>熟悉 VRP 命令行并且熟练掌握 VRP 配置是高效管理华为网络设备的必备基础。</li></ul></div></details><p class="red">1，设备初始化启动：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wWBK1.png" alt="图片"></li><li>[2] 管理员和工程师如果要访问在通用路由平台 VRP 上运行的华为产品，首先要进入启动程序。</li><li>[3] 开机界面信息提供了系统启动的运行程序和正在运行的 VRP 版本及其加载路径。</li><li>[4] 启动完成以后，系统提示目前正在运行的是自动配置模式，用户可以选择继续使用自动配置模式或是进入手动配置模式。</li><li>[5]<ins class="wavy"> 如果选择手动配置模式，在提示符处输入 Y，在没有特别要求的情况下，我们选择手动配置模式。</ins></li></ul><p class="red">2，命令行视图：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6wf6Lq.png" alt="图片"></li><li>[2] VRP 分层的命令结构定义了很多命令行视图，每条命令只能在特定的视图中执行。</li><li>[3] 上图，介绍了常见的命令行视图，每个命令都注册在一个或多个命令视图下，用户只有先进入这个命令所在的视图，才能运行相应的命令。</li><li>[4]<ins class="wavy"> 进入到 VRP 系统的配置界面后，VRP 上最先出现的视图是用户视图，在该视图下，用户可以查看设备的运行状态和统计信息。</ins></li><li>[5] 若要修改系统参数，用户必须进入系统视图，用户还可以通过系统视图进入其他的功能配置视图，如接口视图和协议视图。</li><li>[6]<ins class="wavy"> 通过提示符可以判断当前所处的视图，例如，&quot;&lt;&gt;&quot; 表示用户视图，&quot;[]&quot; 表示除用户视图以外的其他视图。</ins></li></ul><p class="wavy">3，命令行功能：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/6whn6s.png" alt="图片"></li><li>[2] 其他快捷键功能如下：</li><li>CTRL + B 将光标向左移动一个字符。</li><li>CTRL + D 删除当前光标所在位置的字符。</li><li>CTRL + E 将光标移动到当前行的末尾。</li><li>CTRL + F 将光标向右移动一个字符。</li><li>CTRL + H 删除光标左侧的一个字符。</li><li>CTRL + N 显示历史命令缓冲区中的后一条命令。</li><li>CTRL + P 显示历史命令缓冲区中的前一条命令。</li><li>CTRL + W 删除光标左侧的一个字符串。</li><li>CTRL + X 删除光标左侧所有的字符。</li><li>CTRL + Y 删除光标所在位置及其右侧所有的字符。</li><li>ESC + B 将光标向左移动一个字符串。</li><li>ESC + D 删除光标右侧的一个字符串。</li></ul><p class="red">4，命令行功能：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60NT2D.png" alt="图片"></li></ul><p class="red">5，命令行在线帮助：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60U9xg.png" alt="图片"></li><li>[2] VRP 提供两种帮助功能，分别是部分帮助和完全帮助。</li><li>[3] 部分帮助是，当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符。可以使用命令行的部分帮助获取以该字符串开头的所有关键字，如上图所示。</li><li>[4] 完全帮助是，在任一命令视图下，用户可以键入 “ ？” 获取该命令视图下所有的命令及其简单描述，如果建入一条命令关键字，后接以空格分割的 “ ？”，如果该位置为关键字，则列出全部关键字及其描述。</li></ul><p class="red">6，基本配置步骤：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60U6FP.png" alt="图片"></li><li>[2] 网络上一般都会部署不止一台设备，管理员需要 i 对这些设备进行统一管理，在进行设备调试的时候，首要任务是设置设备名。</li><li>[3] 设备名用来唯一的标识一台设备。</li><li>[4] AR2200E 路由器默认的设备名是 Huawei，而 S5720 交换机默认的设备名是 HUAWEI。</li><li>[5] 设备名称一旦设置，立刻生效。</li></ul><p class="red">7，配置系统时钟：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60adhV.png" alt="图片"></li><li>[2] 系统时钟是设备上的系统时间戳，由于地域的不同，用户可以根据当地的规定时钟系统时钟，用户必须正确设置系统时钟以确保其与其他设备保持同步。</li></ul><p class="red">8，配置标题消息：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60dQER.png" alt="图片"></li><li>[2] header 命令用来设置用户登录设备时终端上显示的标题信息。</li><li>[3] Login 参数指定当用户在登录设备认证过程中，激活终端连接 s 时显示的标题信息。</li><li>[4] shell 参数指定当用户成功登录到设备上，已经建立会话时显示的标题信息。</li><li>[5] header 的内容可以是字符串或文件名。当 header 的内容为字符串时，标题信息以第一个英文字符作为起使符号，最后一个相同的英文字符作为结束符，通常情况下，建议使用英文特殊符号，并需要确保在信息正文中没有此符号。</li><li>[6] 上图，header 的内容时字符串，字符串可以包含 1-2000 字符，包含空格。使用 header {login|shell} information text 命令能设置字符串形式的 header。</li><li>[7] 若要设置文件形式的 header，使用 header {login|shell} file file-name 命令。file name 参数 z 指定了标题信息所使用的文件名，登录前后，该文件的内容将以文本的形式显示。</li></ul><p class="red">9，命令等级：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60wYiq.png" alt="图片"></li><li>[2] 缺省情况下命令级别分为 0<sub>3 级，用户级别分为 0</sub>15 级。</li><li>[3]<ins class="wavy"> 用户 0 级为访问级别，对应网络诊断工具命令 (Ping，Tracert)，从设备出发访问外部的命令 (Telnet 客户端)，部分 display 命令等。</ins></li><li>[4]<ins class="wavy"> 用户 1 级为监控级别，对应命令级 0，1 级，包括用于系统维护的命令以及 display 等命令。</ins></li><li>[5]<ins class="wavy"> 用户 2 级是配置级，包括向用户提供直接网络服务，包括路由，各个网络层次的命令。</ins></li><li>[6]<ins class="wavy"> 用户 3-15 级是管理级别，对应命令 3 级，该级别主要用于系统运行的命令，对业务提供支撑作用，包括文件系统，FTP，TFTP 下载，文件交换配置，电源供应配置，备份板控制，用户管理，命令级别设置，系统内部参数配置以及用于业务故障诊断的 debugging 命令。</ins></li><li>[7] 上图，展示了如何修改命令级别，在用户视图下执行 save 命令，需要 3 级权限。</li><li>[8]<ins class="wavy"> 在具体使用中，如果我们有多个管理员账号，但只允许某一个管理员保存系统配置，则可以将 save 命令的级别提高到 4 级，并定义只有该管理员有 4 级权限，这样在不影响其他用户的情况下，可以实现对命令的使用控制。</ins></li></ul><p class="red">10，用户界面：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60DisU.png" alt="图片"></li><li><ins class="wavy">注：VTY 接口最大可配置范围为 0-14。</ins></li><li>[2] 每类用户界面都有对应的用户界面视图，用户界面 (User-interface) 视图是系统提供的一种命令行视图，用来配置和管理所有工作在异步交互方式下的物理接口和逻辑接口。从而达到统一管理各种用户界面的目的。</li><li>[3] 在连接设备前，用户要设置用户界面参数，系统支持的用户界面包括 Console 用户界面和 VTY 用户界面。</li><li>[4] 控制口 (Console Port) 是一种通信串行端口，由设备的主控板提供。</li><li>[5] 虚拟类型终端 (Virtual Type Terminal) 是一种虚拟线路端口，用户通过终端与设备建立 Telnet 或 SSH 连接后，也就建立了一条 VTY。即用户可以通过 VTY 方式登录设备。</li><li>[6] 设备一般最多支持 15 个用户同时通过 VTY 方式访问。</li><li>[7] 执行 user-interface maximum-vty number 命令可以配置同时登录到设备的 VTY 类型用户界面的最大个数，如果将最大登录用户数设为 0，则任何用户都不能通过 Telnet 或 SSH 登录到路由器。display user-interface 命令来查看用户界面信息。</li><li>[8]<ins class="wavy"> 不同的设备，或使用不同版本的 VRP 软件系统，具体可以被使用的 VTY 接口的最大数量可能不同。</ins></li></ul><p class="red">11，配置用户界面命令：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/60sNKf.png" alt="图片"></li><li>[2] 用户可以设置 Console 界面和 VTY 界面属性，以提高系统安全性。如果一个连接上设备的用户一直处于空闲状态而不断开，可能会给系统带来很大的风险，所以在等待一个超时时间后，系统会自动中断连接，这个闲置切断时间又称为超时时间，默认为 10 分钟。</li><li>[3] 当 display 命令输出的信息超过一页时，系统会对输出内容进行分页，使用空格切换下一页。</li><li>[4] 如果一页输出的内容过少或过多，用户可以执行 screen-length 命令修改信息输出时一页的行数，默认行数为 24，最大支持 512 行，不建议将行数设置为 0，因为这样不会显示任何内容。</li><li>[5] 每条命令执行后，执行的记录都保存在历史命令缓存区。历史命令缓存区	默认能存储 10 条命令，可以通过运行 history-command max-size 改变可存储的命令数，最多可存储 256 条。</li></ul><p class="red">12，配置登录权限：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/14/606zvt.png" alt="图片"></li><li>[2] 如果没有权限限制，未授权的用户就可以，使用设备获取信息并更改配置，从设备安全角度考虑，限制用户的访问和操作权限是很有必要的，<ins class="wavy">用户权限和用户认证</ins>是提升终端安全的两种方式。用户权限要求规定用户的级别，一定级别的用户只能 z 执行特定级别的命令。</li><li>[3] 配置用户界面的用户认证方式后。用户登录设备时，需要输入密码 j 进行认证，这样就 x 限制了用户访问设备的权限，在通过 VTY 进行 Telnet 连接时，所有接入设备的 y 用户都必须要经过认证。</li><li>[4] 设备提供三种认证模式，AAA 模式，密码认证模式和不认证模式。AAA 认证模式具有很高的安全性，因为登陆时必须输入用户名和密码。密码认证只需要输入登录密码就行，所以所有的用户使用的都是同一个密码，使用不认证模式就是不需要对用户认证直接登录到设备，需要注意的是，Console 界面默认使用不认证模式。</li><li>[5] 对于 Telnet 登录用户，授权是非常必要的，最好设置用户名，密码和指定和账号相关联的权限。</li><li>[6] 注：不同 VRP 版本执行 set authentication password cipher 命令有差异，有些平台需要回车后 s 输入密码，另外一些平台可以直接在命令行后输入密码，故，在操作具体产品时，需要查阅相应的 VRP 版本。</li></ul><p class="red">13，配置接口地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BQdoD.png" alt="图片"></li><li>[2] 要在接口运行 IP 服务，必须为接口配置一个 IP 地址，一个接口一般只需要一个 IP 地址，在特殊情况下，也有可能为接口配置一个次要的 IP 地址。</li><li>[3] 例如，当路由器 AR2200E 的接口连接到一个物理网络时，该物理网络中的主机属于两个网段，为让两个网段的主机都可以通过路由器 AR2200E 访问其他网络，可以配置一个主 IP 地址和一个次要 IP 地址，一个接口只能有一个主 IP 地址，如果接口配置了新的主 IP 地址，那么新的主 IP 地址就代替了原来的主 IP 地址。</li><li>[4] Lookback 接口是一个逻辑接口，可用来虚拟一个网络或者一个 IP 主机，在运行多种协议的时候，由于 Lookback 接口稳定可靠，所以也可以用来做管理接口。</li><li>[5] 如果接口处于 Down 状态，应使用 undo shuttdown 打开该接口。</li></ul><p class="red">14，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 华为网络设备支持多少个用户同时使用 console 口登录？</li><li>华为网络设备同时只能有一个用户登录 Console 界面，因此 Console 用户的编号固定为 0</li><li>[2] 在使用命令 interface lookback interface 0 之后，lookback 0 接口的状态是什么？</li><li>Lookback 口是一种逻辑接口，在未创建之前，Lookback 接口并不存在，从创建开始，Lookback 口就一直存在，并一直保持 Up 状态，除非被手动关闭。</li></ul><h1 id="第十章文件系统基础"><a class="anchor" href="#第十章文件系统基础">#</a> 第十章【文件系统基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>华为网络设备的配置文件和 VRP 系统文件都保存在物理储存介质中，所以文件系统是 VRP 正常运行的基础。只有掌握了对文件系统的基本操作，网络工程师才能对设备的配置文件和 VRP 系统文件进行高效的管理。</li></ul></div></details><p class="red">1，基本查询命令：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BlvHf.png" alt="图片"></li><li>[2] 上图，在用户始于中使用 dir 命令，可以查看 flash 中的文件信息。</li></ul><p class="red">2，目录操作：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BGLi8.png" alt="图片"></li></ul><p class="red">3，文件操作 (1)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BGjzQ.png" alt="图片"></li><li>[2] 文件操作包括：复制，移动，重命名，压缩，删除，恢复等。</li></ul><p class="red">4，文件操作 (2)：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/15/6BJFiT.png" alt="图片"></li></ul><p class="red">5，配置文件管理：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTCS1.png" alt="图片"></li><li>++ 注：设备启动时，会加载保存的配置文件到 RAM，并作为当前配置文件。</li><li>[2] 设备中的配置文件分为两种类型：<ins class="wavy">当前配置文件和保存的配置文件。</ins>。</li><li>[3] 当前配置文件保存在设备的 RAM 中，用户可以通过命令行对设备进行配置，配置完成后使用 save 命令保存当前配置到储存设备中，形成保存的配置文件。</li><li>[4]++ 保存的配置文件都是以 “.cfg” 或 “.zip” 作为扩展名，存放在储存设备的根目录下。</li><li>[5] 在设备启动时，会从默认的储存路径下加载保存的配置文件到 RAM 中，如果默认储存路经中没有保存的配置文件，则设备会使用缺省参数进行初始化配置。</li></ul><p class="red">6，配置文件查询：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTapn.png" alt="图片"></li></ul><p class="red">7，配置文件保存：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yTHtH.png" alt="图片"></li><li>[2] SAVE 命令可以用来保存当前配置信息到系统默认的储存路径中。</li></ul><p class="red">8，系统启动文件查询：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6y79Ag.png" alt="图片"></li><li>[2] display startup 命令用来查看设备本次及下次启动相关的系统软件，备份系统软件，配置文件，License 文件，补丁文件以及语音文件。</li><li>[3] Startup system software 表示的是本次系统启动所使用的 VRP 文件。</li><li>[4] Next startup system software 表示的是下次系统启动所使用的 VRP 文件。</li><li>[5] Startup save-configuration file 表示得是本次系统启动所使用的配置文件。</li><li>[6] Next startup save-configuration file 表示得是下次系统启动所使用的配置文件。</li></ul><p class="red">9，系统启动配置文件修改：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yHVGd.png" alt="图片"></li><li>[2] 设备启动时，会从储存设备中加载配置文件并进行初始化，如果储存设备中，没有配置文件，设备将会使用默认参数进行初始化。</li><li>[3] configuration-file 参数为系统启动配置文件的名称。</li></ul><p class="red">10，比较当前配置和保存的配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/16/6yHldS.png" alt="图片"></li><li>[2] compare configuration (configuration-file)(current-line-number save-line-number) 命令用来比较当前的配置与下次启动的配置文件内容的区别，configuration-file 指定需要与当前配置进行比较的配置文件名，current-line-number 表示从当前配置的该行号开始比较，save-line-number 表示从指定配置的该行号开始比较。</li><li>[3] 当执行该命令后，系统默认会将保存的配置与当前得到配置从第一行开始逐行比较。</li><li>[4] 系统比较出不同之处后，将从两者有差别的地方开始显示字符，默认显示 120 个字符。如果从该不同之处到文件末尾不足 120 个字符，将显示到文件尾为止。</li></ul><p class="red">11，配置文件重置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybVTU.png" alt="图片"></li><li>[2] reset saved-configuration 命令用来清除储存设备中启动配置文件的内容。</li><li>[3] 执行该命令后，如果不使用该命令 startup save-configuration 重新指定设备下次启动时使用的配置文件，也不使用 save 命令保存配置文件，则设备下次启动时会采用缺省的配置参数进行初始化。</li></ul><p class="red">12，存储设备：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybd1A.png" alt="图片"></li><li>[2] 存储设备包括 SDRAM，Flash，NVRAM，SD 卡，U 盘等。例如，AR2200E 的路由器有内置的闪存，该路由器提供了两个预留的 USB 插槽 (USB0 和 USB1) 和一个 SD 卡插槽 (SD0)。</li><li>[3] S5720 交换机包含了一个内置闪存，该闪存根据型号不同，存储容量也不同，S5720-EI 支持 340M 内存，S5720-HI 支持 400M 闪存。</li><li>[4]++ 执行 display version 命令可以查看华为存储设备的详细信息。</li></ul><p class="red">13，存储设备修复：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6ybbh4.png" alt="图片"></li><li><ins class="wavy">注：当存储设备的文件系统出现异常时，可以通过 fixdisk 命令进行修复。</ins></li><li>[2] fixdisk 命令用来对文件系统出现异常的存储设备进行修复，当存储设备上的文件系统出现异常时，终端会给出提示信息，此时建议使用此命令进行修复，但不确保修复成功。</li><li>[3]<ins class="wavy"> 执行此命令后，如果仍然收到系统建议修复的信息，则表示物理介质可能已经损坏。</ins></li><li>此命令是问题修复类命令，在系统未出现问题时，建议用户不要执行此命令。</li><li><ins class="wavy">有些 VRP 版本不支持 fixdisk 命令，在操作具体产品时请查阅相应的 VRP 文档。</ins></li></ul><p class="red">14，存储设备格式化：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yqF9H.png" alt="图片"></li><li><ins class="wavy">注：格式化会导致数据丢失。</ins></li><li>[2] 当文件系统出现异常无法修复时，并且确认不在需要存储器上的所有数据时，可格式化存储设备。格式化存储设备会导致设备上的数据丢失，且这些文件不能恢复。</li><li>[3] format (devicename) 命令用来格式化存储器，在执行 format 命令时，需要指定 devicename 参数，表示格式化特定的存储器，在执行此命令后，会清空指定存储器中的所有文件和目录，并且不可恢复，所以谨慎使用 format 命令！</li><li>[4] 有些 VRP 版本不支持 format 命令。</li></ul><p class="red">15，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 设备中的文件属性有 drw，其中 d 代表什么含义？</li><li>d 表明是个目录，r，w，是可读出，可写入的意思。</li><li>[2] 如果设备中有多个配置文件，如何指定下次启动时使用的配置文件？</li><li>配置文件可以不使用默认的文件名 vrp.cfg, 而用其他指定的名称保存到路由器或交换机中，如果需要指定某一个配置文件为下次启动时使用的配置文件，可以执行 startup saved-configuration (configuration-file-name) 命令，这里的配置文件名包括文件名称和拓展名。</li></ul><h1 id="第十一章vrp系统管理"><a class="anchor" href="#第十一章vrp系统管理">#</a> 第十一章【VRP 系统管理】</h1><details class="primary"><summary>前言</summary><div><ul><li>为了满足企业业务对网络的需求，网络设备中的系统文件需要不断进行升级，另外，网络设备中的配置文件也需要时常进行备份，以防设备故障或其他灾害个业务带来损害。</li><li>在升级和备份系统文件或配置文件时，经常会使用 FTP 和 TFTP 来传输文件。</li><li>++ 注：使用 FTP，TFTP，SFTPv1 协议存在安全风险，建议使用 SFTPv2 方式进行文件操作。</li></ul></div></details><p class="red">1，升级 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yLnMR.png" alt="图片"></li><li><ins class="wavy">注：随着 VRP 版本的更新，VRP 支持的特性也越来越多，可根据需求更新 VRP 版本。</ins></li></ul><p class="red">2，文件传输：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6yOCSH.png" alt="图片"></li><li><ins class="wavy">注：网络设备可以从服务器获取 VRP 系统文件，也可以将日志文件，配置文件保存到服务器作为备份。</ins></li><li>[2] 文件传输是指发送文件到远程服务器，或者从远程服务器获取文件的过程。</li><li>[3] 在实际场景中，为满足企业业务的需求。设备的 VRP 文件需要更新，如上图所示，设备在与服务器建立连接之后，可以从服务器获取新的 VRP，完成更新工作。</li><li>[3] 为避免数据丢失对业务造成影响，设备的配置文件和日志文件也通常会进行备份，如上图所示，设备在与服务器建立连接之后，可以将配置文件，日记文件传输到服务器上，完成备份工作，当设备上的文件丢失后，可以恢复之前服务器上备份的配置文件和日志文件。</li></ul><p class="red">3，文件传输协议：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cTK61.png" alt="图片"></li><li><ins class="red">注：常用的文件传输协议有 FTP 和 TFTP 两种。</ins></li><li>[2] FTP (File Transfer Protocol) 是 TCP/IP 协议族中一种<ins class="wavy">应用层协议</ins>，称为文件传输协议。</li><li>[3] FTP 的主要功能是向用户提供本地和远程主机之间的文件传输。++ 在进行版本升级，日记下载和配置保存等业务操作时，会广泛地使用到 FTP，</li><li>[4] FTP 采用两个 TCP 连接：<ins class="wavy">控制连接和数据连接</ins>。其中控制连接用于连接控制端口，传输控制命令。数据连接用于连接数据端口。传输数据。在控制连接建立后，数据连接通过控制端口的命令建立起连接，进行数据的传输。</li><li>[5] FTP 数据连接的建立有两种：<ins class="wavy">主动模式和被动模式。</ins>两者之间的区别在于数据连接是由服务器发起还是客户端发起。</li><li>[6] ARG3 系列路由器既可以作为 FTP Client 又可以作为 FTP Server。缺省情况下，AR2200 采用主动模式建立数据连接。</li><li>[7] TFTP (Trivial File Transfer Protocol) 是一种简化的文件传输协议，TFTP 协议使用 UDP 协议进行文件的传输，由客户端发起 TFTP 传输请求，实现文件的上传和下载。ARG3 系列路由器只可以作为 TFTP 客户端。</li></ul><p class="red">4，VRP 系统文件更新配置 —— 与 FTP 服务器连接：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cHERJ.png" alt="图片"></li><li><ins class="wavy">注：在通过 FTP 传输任何数据之前，首先必须保证 FTP 客户端和 FTP 服务器之间可以通信。</ins></li></ul><p class="red">5，VRP 系统文件更新配置 —— 查看剩余存储空间：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cHgLq.png" alt="图片"></li><li><ins class="wavy">注：当剩余存储空间不足时，可以删除无关的 VRP 文件或其他文件以释放空间。</ins></li><li>[2] 在获取 VRP 文件之前，还要确认设备有足够的存储空间来存储新获取的 VRP 文件，可以用 dir 命令来检查当前目录中的文件和可用空间，如果存储空间不足，需要删除无关文件来释放足够的空间，上图，通过 delete 命令删除以存在的无关 VRP 文件来获取了足够的空间。</li></ul><p class="red">6，VRP 系统文件更新配置 - 从 FTP 服务器获取 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cXcVI.png" alt="图片"></li><li>[2] 如需从 FTP 服务器获取文件，客户端需要使用 ftp [ip address] 命令来发起 FTP 连接请求，其中 ip address 指的是 FTP 服务器的 IP 地址，客户端和 FTP 服务器建立连接之后，客户端需要使用 FTP 服务器中配置的用户名和密码进行认证。认证通过后，客户端可以访问 FTP 服务器，并且能够查看和下载存储在服务器中的文件。</li><li>[3] 上图，客户端使用 ftp 10.1.1.2 和 FTP 服务器建立了连接，使用 get AR2220E-V200R007C00SPC600.cc 命令可以获取位于 FTP 服务器上的 VRP 文件。</li></ul><p class="red">7，VRP 系统文件更新配置 —— 从 TFTP 服务器获取 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6cxMPP.png" alt="图片"></li><li><ins class="wavy">注：ARG3 路由器只需使用上述命令即可从 TFTP 服务器获取 VRP 文件。</ins></li><li>[2] 如果客户端需要从 TFTP 服务器获取 VRP 文件，则不需要首先和 TFTP 服务器建立连接。</li><li>[3]<ins class="wavy"> ARG3 系列路由器和 X7 系列交换机只能作为 TFTP 客户端。</ins></li><li>[4] 上图，客户端通过配置 TFTP 10.1.1.2 get AR2220E-V200R003SPC600.cc 就可以从 TFTP 服务器获取 VRP 文件。</li></ul><p class="red">8，VRP 系统文件更新配置 - 指定下次启动时加载的 VRP：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6czTpV.png" alt="图片"></li><li>[2] 从服务器成功获取 VRP 文件后，还需要配置此文件为设备下次启动时的系统文件，否则，设备仍会使用旧版本的 VRP 系统文件。</li><li>[3] 在设备上通过使用 startup system-software 命令可以指定下次启动的系统文件。</li><li>[4] VRP 系统文件必须存储在根目录。否则。系统不能正常运行。</li><li>[5] 上图，可以使用 display startup 命令去验证系统启动文件是否已经变更，显示信息中 Startup system software 显示当前系统启动使用的 VRP 文件，Next startup system software 显示下次系统启动使用的 VRP 文件。</li></ul><p class="red">9，VRP 系统文件更新配置 —— 重启设备：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gPyqO.png" alt="图片"></li><li><ins class="wavy">注：设备重启后，将会加载新的 VRP 系统。</ins></li><li>[2] 确认系统下次启动软件正确后，需要重启设备，使用 reboot 命令可以重启设备，输入此命令后，系统会提示是否保存配置文件，实际中，可根据需要进行选择，上图选择了不保存配置。</li></ul><p class="red">10，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 设备作为 FTP 客户端时，如何从服务器下载 VRP?</li><li>首先必须保证客户端和服务器之间可以通信，然后客户端需要使用 ftp [IP address] 命令与服务器建立 FTP 连接，建立连接之后需要输入正确的用户名和密码进行验证，验证通过后使用 get 命令即可下载 VRP。</li><li>[2] 在完成 VRP 升级并重启之后，管理员如何确认升级成功？</li><li>管理员可以使用 display startup 命令验证系统启动的 VRP 软件。以此来判断	VRP 升级是否成功。</li></ul><h1 id="第十二章交换网络基础"><a class="anchor" href="#第十二章交换网络基础">#</a> 第十二章【交换网络基础】</h1><details class="primary"><summary>前言</summary><div><ul><li>常见的以太网设备包括 Hub，交换机等。交换机工作在数据链路层，它有效地隔离了以太网中的冲突域，极大地提升了以太网的性能。</li></ul></div></details><p class="red">1，小型交换网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gi5tJ.png" alt="图片"></li><li><ins class="wavy">注：交换机工作在数据链路层，转发数据帧。</ins></li><li>[2] 随着企业网络的发展，越来越多的用户需要接入到网络，交换机提供了大量的接入接口能够很好地满足了这种需求，同时，交换机也彻底解决了困扰早期以太网冲突问题，极大地提升了以太网的性能，同时也提供了以太网的安全性。</li><li>[3] 交换机工作在数据链路层，对数据帧进行操作，在收到数据帧后，交换机会根据数据帧的头部信息对数据帧进行转发。</li></ul><p class="red">2，交换机的转发行为：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gFWvt.png" alt="图片"></li><li>[2] 交换机中有一个 MAC 地址库，里面存放了 MAC 地址与交换机端口的映射关系，MAC 地址表也称为 CAM (Content Addressable Memory) 表。</li><li>[3] 上图，++ 交换机对帧的转发操作行为一共有三种：泛洪 (Flooding)，转发 (Forwarding)，丢弃 (Discarding)。</li><li>[4] 泛洪 (Flooding)：交换机把从某一个端口进来的帧通过所有其他的端口转发出去 (注意，&quot;所有其他的端口&quot; 是指除了这个帧进入交换机的那个端口以外的所有端口)。</li><li>[5] 转发 (Forwarding)：交换机把从某一端口进来的帧通过另一个端口转发出去 (注意，&quot;另一个端口&quot; 是指不是这帧进入交换机得到那个端口).。</li><li>[6] 丢弃 (Discarding)：交换机把从某一端口进来的帧直接丢弃。</li><li>[7] 交换机的基本工作原理可以概括地描述如下：</li><li>①如果进入交换机的是一个单播帧，则交换机会去 MAC 地址表中查找这个帧的目的 MAC 地址。</li><li>如果查不到这个 MAC 地址，则交换机执行泛洪操作。</li><li>如果查到了这个 MAC 地址，则比较这个 MAC 地址在 MAC 地址表中对应的端口是不是这个帧进入交换机的那个端口，如果不是，则交换机执行转发操作，如果是，则交换机执行丢弃操作。</li><li>[8] 如果进入交换机的是一个广播帧，则交换机不会去查 MAC 地址表，而是执行泛洪操作。</li><li>[9] 如果进入交换机的是一个组播组，则交换机的处理行为比较复杂，另外，交换机还具有学习功能，当一个帧进入交换机后，交换机会检查这个帧的源 MAC 地址，并将该源 MAC 地址与这个帧进入交换机的那个端口进行映射，然后将这个映射关系存放进 MAC 地址表。</li></ul><p class="red">3，交换机初始状态：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gACef.png" alt="图片"></li><li><ins class="wavy">注：初始状态下，交换机 MAC 地址表为空。</ins></li><li>[1] 初始状态下，交换机并不知道所连接主机的 MAC 地址，所以 MAC 地址表为空，上图，SWA 为初始状态，在收到主机 A 发送的数据帧之前，MAC 地址表中没有任何表项。</li></ul><p class="red">4，学习 MAC 地址：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gAQTU.png" alt="图片"></li><li><ins class="wavy">注：交换机将收到的数据帧的源 MAC 地址和对应接口记录到 MAC 地址表中。</ins></li><li>[2] 主机 A 发送数据给主机 C 时，一般会首先发送 ARP 请求来获取主机 C 的 MAC 地址，此 ARp 请求帧中的目的 MAC 地址是广播地址，源 MAC 地址是自己的 MAC 地址。</li><li>[3] SWA 收到该帧后，会将源 MAC 地址和接收端口的映射关系添加到 MAC 地址表中，缺省情况下，X7 系列交换机学习到的 MAC 地址表项的老化时间为 300 秒。</li><li>[4] 如果在老化时间内再次收到主机 A 发送的数据帧，SWA 中保存的主机 A 的 MAC 地址和 G0/0/1 的映射的老化时间会被刷新。</li><li>[5] 此后，如果交换机收到目标 MAC 地址为 00-01-02-03-04-AA 的数据帧时，都将通过 G0/0/1 端口转发。</li></ul><p class="red">5，转发数据帧：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/17/6gAxNF.png" alt="图片"></li><li>++ 注：当数据帧的目的 MAC 地址不在 MAC 表中，或者目的 MAC 地址为广播地址时，交换机会泛洪该帧。</li><li>[2] 上图，主机 A 发送的数据帧的目的 MAC 地址为广播地址，所以交换机会将此数据帧通过 G0/0/2 和 G0/0/3 端口广播到主机 B 和主机 C。</li></ul><p class="red">6，目标主机回复：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gEe4e.png" alt="图片"></li><li><ins class="wavy">注：交换机根据 MAC 地址表将目的主机的回复信息单播转发给源主机。</ins></li><li>[2] 主机 B 和主机 C 收到此数据帧后，都会查看该 ARP 数据帧，但是主机 B 不会回复该帧，主机 C 会处理该帧并发送 ARP 回应。此回复数据帧的目的 MAC 地址为主机 A 的 MAC 地址，源 MAC 地址为主机 C 的 MAC 地址。</li><li>[3] SWA 收到回复数据帧时，会将该帧的源 MAC 地址和接口的映射关系添加到 MAC 地址表中。</li><li>[3] 如果此映射关系在 MAC 地址表已经存在，则会被刷新，然后 SWA 查询 MAC 地址表，根据帧的目的 MAC 地址找到对应的转发端口后，从 G0/0/1 转发此数据帧。</li></ul><p class="red">7，基本配置：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gVpa8.png" alt="图片"></li><li>[2] 早期的以太网的工作模式都是 10M 半双工的，随着技术的发展，出现了全双工模式，接着又出现了百兆和千兆以太网，采用不同工作模式的设备无法直接相互通信，自协商技术的出现解决了不同以太网工作模式之间的兼容性问题。</li><li>[3]<ins class="wavy"> 自协商的内容主要包括双工模式和运行速率，一旦协商通过，链路两端的设备就具有相同的工作参数。</ins></li><li>[4] negotiation auto 命令用来设置以太网端口的自协商功能，端口是否应该使能自协商模式，要考虑对接双方设备的端口是否都支持自动协商，如果对端设备的以太网端口不支持自协商模式，则需要在本端端口上先使用 undo negotiation	auto 命令配置为非自协商模式，之后，修改本端端口的速率和双工模式保持与对端一致，确保通信正常。</li><li>[5] duplex 命令用来设置以太网端口的双工模式，GE 电口工作速率为 1000Mbit/s 时，只支持全双工模式，不需要与链路对端的端口共同协商双工模式。</li><li>[6] speed 命令用来设置端口的工作速率，配置端口的速率和双工模式之前需要先配置端口为非自协商模式。</li><li>[7] 因产品型号的不同，华为交换机可能不支持更改端口双工模式。</li></ul><p class="red">8，配置验证：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gZLnI.png" alt="图片"></li><li>[2] display interface () interface-type (interface-number (.sumnumber))) 命令用来查看端口当前运行状态和统计信息。</li><li>[3] current state 表示端口的物理状态，如果为 UP，表示端口处于打开状态。</li><li>[4] Line protocol current state 表示端口的链路协议状态，如果为 UP，表示端口的链路协议处于正常的启动状态。</li><li>[5] Speed 表示端口的工作速率，SWA 的 G0/0/1 端口工作速率为 100Mbits/s。</li><li>[6] duplex 表示端口的双工模式，SWA 的 G0/0/1 端口双工模式为全双工。</li></ul><p class="red">9，总结：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 当一台主机从交换机的一个端口移动到另一个端口时，交换机的 MAC 地址表会发生什么变化？</li><li>当一台主机从交换机的一个端口移除时，交换机检测到物理链路 Down 因此会从 MAC 地址表中清除对应主机的 MAC 表项，一旦主机连接到交换机的另一个端口，交换机会检测到新端口对应的物理链路 UP。主机发送报文后，交换机就会学习到主机的 MAC 地址和新端口映射关系，并且添加到 MAC 地址表中。</li></ul><h1 id="第十三章stp原理与配置"><a class="anchor" href="#第十三章stp原理与配置">#</a> 第十三章【STP 原理与配置】</h1><details class="primary"><summary>前言</summary><div><ul><li>为了提高网络的可靠性，交换网络中通常会使用冗余链路。然而，冗余链路会给交换网络带来环路风险，并导致广播风暴以及 MAC 地址表不稳定等问题，进而会影响到用户的通信质量，生成树协议 STP (Spanning Tree Protocol) 可以在提高可靠性的同时又能避免环路带来的各种问题。</li></ul></div></details><p class="red">1，二层交换网络：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g1NjS.png" alt="图片"></li><li><ins class="wavy">注：交换机之间通过多条链路互联时，虽然能够提升网络可靠性，但同时也会带来环路问题。</ins></li><li>[2] 随着局域网规模的不断扩大，越来越多的交换机被用来实现主机之间的互联，如果交换机之间仅使用一条链路互联，则可能会出现单点故障，导致业务中断。为了解决此类问题，交换机在互联时一般都会使用冗余链路来实现备份。</li><li>[3] 冗余链路虽然增强了网络的可靠性，但是也会产生环路，而环路会带来一系列的问题，继而导致通信质量下降和通信业务中断等问题。</li></ul><p class="red">2，广播风暴：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g3FKS.png" alt="图片"></li><li><ins class="wavy">注：环路会产生广播风暴。</ins></li><li><ins class="wavy">注：网络中的主机会收到重复数据帧。</ins></li><li>[2] 根据交换机的转发原则，如果交换机从一个端口上接收到的是一个广播帧，或者是一个目的 MAC 地址未知的单播帧，则会将这个帧向除源端口之外的使用其他端口转发。如果交换网络中有环路，则这个帧会被无限转发，此时便会形成广播风暴，网络中也会充斥着重复的数据帧。</li><li>[3] 上图，主机 A 向外发送了一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在。SWB 接收到此帧后，将其转发到 SWA 和 SWC，SWA 和 SWC 也会将此帧转发到除了接收此帧的其他所有的接口，结果此帧又会被再次转发给 SWB，这种循环会一直持续，于是便产生了广播风暴，交换机性能会因此急剧下降，并会导致业务中断。</li></ul><p class="red">3，MAC 地址表震荡：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g3U8x.png" alt="图片"></li><li><ins class="wavy">注：环路会引起 MAC 地址表震荡。</ins></li><li>[2] 交换机是根据所收到的数据帧的源地址和接收端口生成 MAC 地址表项的。</li><li>[3] 主机 A 向外发送一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在，SWB 收到此数据帧后，在 MAC 地址表中生成一个 MAC 地址表项，00-01-02-03-04-AA，对应端口为 G0/0/3，并将其从 G0/0/1 和 G0/0/2 端口转发，上图仅以 G0/0/1 转发此帧。</li><li>[4] SWA 收到此帧后，由于 MAC 地址表中没有对应此帧目的 MAC 地址的表项，所以 SWA 会将此帧从 G0/0/2 端口发送出去。</li><li>[5] SWC 接收到此帧后，由于 MAC 地址表中也没有对应此帧的目的 MAC 地址的表项，所以 SWC 会将此帧从 G0/0/2 端口发送回 SWB，也会发给主机 B。</li><li>[6] SWB 从 G0/0/2 接口接收到此数据帧之后，会在 MAC 地址表中删除原有的相关表项，生成一个新的表项，00-01-02-03-04-AA，对应端口为 G0/0/2。此过程会不断重复，从而导致 MAC 地址表震荡。</li></ul><p class="red">4，STP 的作用：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6g8Okd.png" alt="图片"></li><li><ins class="wavy">注：STP 通过阻塞端口来消除回路，并能够实现链路备份的目的。</ins></li><li>[2] 在以太网中，二层网络的环路会带来广播风暴，MAC 地址表震荡，重复数据帧等问题，为了解决交换网络中的环路问题，提出了 STP。</li><li>[3] STP 的主要作用：</li><li>消除环路：通过阻断冗余链路来消除网络中可能存在的环路。</li><li>链路备份：当活动路径发送故障时，激活备份链路，及时恢复网络连通性。</li></ul><p class="red">5，STP 操作：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gG5Nj.png" alt="图片"></li><li>[2] STP 通过改造一棵树来消除交换网络中的环路。</li><li>[3] 每个 STP 网络中，都会存在一个根桥，其他交换机为非根桥，根桥或者根交换机位于整个逻辑树的根部，是 STP 网络的逻辑中心，非根桥是根桥的下游设备，当现有根桥产生故障时，非根桥之间会交互信息并重新选举根桥，交互的这种信息被称为 BPDU，BPDU 中包含交换机在参加	生成树计算时的各种参数信息。</li><li>[4] STP 中定义了三种端口角色：指定端口，根端口和预备端口。</li><li>[5] 指定端口是交换机向所连网段转发配置 BPDU 的端口，每个网段有且只能有一个指定端口。一般情况下，根桥的每一个端口总是指定端口。</li><li>[6] 根端口是非根交换机去往根桥路径最优的端口，在一个运行 STP 的交换机上最多只有一个根端口，但根桥上没有根端口。</li><li>[7] 如果一个端口既不是指定端口也不是根端口，则此端口为预备端口，预备端口将被阻塞。</li></ul><p class="red">6，根桥选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gYxpR.png" alt="图片"></li><li><ins class="wavy">注：每一台交换机启动 STP 后，都认为自己是根桥。</ins></li><li>[2]<ins class="wavy"> STP 中根桥的选举依据是桥 ID，</ins>STP 中的每个交换机都会有一个桥 ID (Bridge ID)。桥 ID 由 16 位桥优先级 (Bridge priority) 和 48 位的 MAC 地址构成，在 STP 网络中，桥优先级是可以配置的，取值范围 0~65535，默认值 32768，优先级最高的设备 (数值越小越优先) 会被选举为根桥，如果优先级相同，则会比较 MAC 地址，MAC 地址越小则越优先。</li><li>[3] 交换机启动后就自动进行生成树收敛计算，默认情况下，所有交换机启动时都认为自己是根桥，自己的所有端口都为指定端口，这样 BPDU 报文就可以通过所有端口转发，对在端交换机收到 BPDU 报文后，会比较 BPDU 中的根桥 ID 和自己的桥 ID。如果收到的 BPDU 报文中的桥 ID 优先级最高，则交换机会修改自己的 BPDU 报文的根桥 ID 字段，宣告新的根桥。</li></ul><p class="red">7，根端口选举：</p><div class="note info"><p>如下如下</p></div><ul><li>[1] 如图：</li><li><img data-src="https://s3.ax1x.com/2021/03/18/6gN1r6.png" alt="图片"></li><li><ins class="wavy">注：非根交换机在选举根端口时分别依据该端口的路径开销，对端 BID，对端 PID 和本端 PIN。</ins></li><li>[2] 非根交换机在选举根端口时分别依据该端口的根路径开销，对端 BID (Bridge ID)，对端 PID (Port ID) 和本端 PID。</li><li>[3] 交换机的每个端口都有一个端口开销 (Port Cost) 参数，此参数表示该端口在 STP 中的开销值。默认情况下端口的开销和端口的带宽有关，带宽越高，开销越低。从一个	非根桥到达根桥的路径可能有多条，每一条路径都有一个总的开销值，此开销值是该路径上所有接收 BPDU 端口的端口开销总和 (即 BPDU 的入方向端口)，称为路径开销。非根桥通过对比多条路径的 lu 路径开销，选出到达根桥的最短路径，这条最短路径的路径开销被称为 RPC (Root Path Cost，根路径开销)，并生成无环树状网络，根桥的根路径开销是 0。</li><li>[4] 一年情况下，企业网络中会存在多厂商的交换设备，华为 X7 系列交换机支持多种 STP 的路径开销计算标准，提供最大程度的兼容性，缺省情况下，华为 X7 系列交换机使用 IEEE 802.1t 标准来计算路径开销。</li><li>[5] 运行 STP 交换机的每个端口都有一个端口 ID，端口 ID</li></ul><h1 id="第十四章rstp原理与配置"><a class="anchor" href="#第十四章rstp原理与配置">#</a> 第十四章【RSTP 原理与配置】</h1><h1 id="第十五章ip路由基础"><a class="anchor" href="#第十五章ip路由基础">#</a> 第十五章【IP 路由基础】</h1><h1 id="第十六章静态路由基础"><a class="anchor" href="#第十六章静态路由基础">#</a> 第十六章【静态路由基础】</h1><h1 id="第十七章链路状态路由协议ospf"><a class="anchor" href="#第十七章链路状态路由协议ospf">#</a> 第十七章【链路状态路由协议 ——OSPF】</h1><h1 id="第十八章dhcp原理与配置"><a class="anchor" href="#第十八章dhcp原理与配置">#</a> 第十八章【DHCP 原理与配置】</h1><h1 id="第十九章ftp原理与配置"><a class="anchor" href="#第十九章ftp原理与配置">#</a> 第十九章【FTP 原理与配置】</h1><h1 id="第二十章telnet原理与配置"><a class="anchor" href="#第二十章telnet原理与配置">#</a> 第二十章【Telnet 原理与配置】</h1><div class="tags"><a href="/tags/HUAWEI/" rel="tag"><i class="ic i-tag"></i> HUAWEI</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-03-18 10:45:21" itemprop="dateModified" datetime="2021-03-18T10:45:21+08:00">2021-03-18</time> </span><span id="2021/03/07/HCIA-Routing & Switching/" class="item leancloud_visitors" data-flag-title="HCIA-Routing & Switching" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Manshan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Manshan 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Manshan <i class="ic i-at"><em>@</em></i>I</li><li class="link"><strong>本文链接：</strong> <a href="https://2memos.xyz/2021/03/07/HCIA-Routing%20&%20Switching/" title="HCIA-Routing &amp; Switching">https://2memos.xyz/2021/03/07/HCIA-Routing & Switching/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;07&#x2F;6K0lGT.jpg" title="数据通信与计算机网络"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 技术</span><h3>数据通信与计算机网络</h3></a></div><div class="item right"><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;08&#x2F;6loYh6.jpg" title="IPv6网络基础、安全、过渡与部署"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 技术</span><h3>IPv6网络基础、安全、过渡与部署</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BC%A0%E8%BE%93%E4%BB%8B%E8%B4%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">第一章【传输介质简介】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">第二章【以太网帧结构】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0ip%E7%BC%96%E5%9D%80"><span class="toc-number">3.</span> <span class="toc-text">第三章【IP 编址】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0icmp%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">第四章【ICMP 协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0arp%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.</span> <span class="toc-text">第五章【ARP 协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.</span> <span class="toc-text">第六章【传输层协议】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">第七章【数据转发过程】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0vrp%E5%9F%BA%E7%A1%80"><span class="toc-number">8.</span> <span class="toc-text">第八章【VRP 基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9F%BA%E7%A1%80"><span class="toc-number">9.</span> <span class="toc-text">第九章【命令行基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80"><span class="toc-number">10.</span> <span class="toc-text">第十章【文件系统基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0vrp%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86"><span class="toc-number">11.</span> <span class="toc-text">第十一章【VRP 系统管理】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%E4%BA%A4%E6%8D%A2%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80"><span class="toc-number">12.</span> <span class="toc-text">第十二章【交换网络基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0stp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">13.</span> <span class="toc-text">第十三章【STP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0rstp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">第十四章【RSTP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0ip%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80"><span class="toc-number">15.</span> <span class="toc-text">第十五章【IP 路由基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80"><span class="toc-number">16.</span> <span class="toc-text">第十六章【静态路由基础】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AEospf"><span class="toc-number">17.</span> <span class="toc-text">第十七章【链路状态路由协议 ——OSPF】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AB%E7%AB%A0dhcp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">18.</span> <span class="toc-text">第十八章【DHCP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0ftp%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">19.</span> <span class="toc-text">第十九章【FTP 原理与配置】</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0telnet%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">20.</span> <span class="toc-text">第二十章【Telnet 原理与配置】</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/01/13/%E8%B7%AF%E7%94%B1%E6%9D%BF%E5%9D%97/" rel="bookmark" title="路由板块">路由板块</a></li><li><a href="/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/" rel="bookmark" title="深信服SCSA">深信服SCSA</a></li><li><a href="/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Python高级编程">Python高级编程</a></li><li><a href="/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/" rel="bookmark" title="Python爬虫入门到高级">Python爬虫入门到高级</a></li><li><a href="/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/" rel="bookmark" title="新华三H3C刷题">新华三H3C刷题</a></li><li><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="bookmark" title="数据通信与计算机网络">数据通信与计算机网络</a></li><li class="active"><a href="/2021/03/07/HCIA-Routing%20&%20Switching/" rel="bookmark" title="HCIA-Routing & Switching">HCIA-Routing & Switching</a></li><li><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" rel="bookmark" title="IPv6网络基础、安全、过渡与部署">IPv6网络基础、安全、过渡与部署</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Manshan" data-src="/images/1.jpg"><p class="name" itemprop="name">Manshan</p><div class="description" itemprop="description"></div></div><div id="binft"></div><script>var binft=function(t){function r(){return f[Math.floor(Math.random()*f.length)]}function e(){return String.fromCharCode(94*Math.random()+33)}function n(t){for(var n=document.createDocumentFragment(),i=0;t>i;i++){var l=document.createElement("span");l.textContent=e(),l.style.color=r(),n.appendChild(l)}return n}function i(){var r=a[c.skillI];c.step?c.step--:(c.step=o,c.prefixP<l.length?(c.prefixP>=0&&(c.text+=l[c.prefixP]),c.prefixP++):"forward"===c.direction?c.skillP<r.length?(c.text+=r[c.skillP],c.skillP++):c.delay?c.delay--:(c.direction="backward",c.delay=g):c.skillP>0?(c.text=c.text.slice(0,-1),c.skillP--):(c.skillI=(c.skillI+1)%a.length,c.direction="forward")),t.textContent=c.text,t.appendChild(n(c.prefixP<l.length?Math.min(b,b+c.prefixP):Math.min(b,r.length-c.skillP))),setTimeout(i,d)}var l="",a=["天道酬勤，宁静致远。","一言既出，驷马难追。","用心做事，诚信为人。","如鱼饮水，冷暖自知。","博观细取，厚积薄发。","知人者智，自知者明。","一日无书，百事荒废。","一分辛劳，一分收获。","人之幼稚，不学则愚。","塞翁失马，焉知非福。","耳闻是虚，眼见为实。"].map(function(t){return t+""}),g=2,o=1,b=5,d=75,f=["rgb(110,64,170)","rgb(150,61,179)","rgb(191,60,175)","rgb(228,65,157)","rgb(254,75,131)","rgb(255,94,99)","rgb(255,120,71)","rgb(251,150,51)","rgb(226,183,47)","rgb(198,214,60)","rgb(175,240,91)","rgb(127,246,88)","rgb(82,246,103)","rgb(48,239,130)","rgb(29,223,163)","rgb(26,199,194)","rgb(35,171,216)","rgb(54,140,225)","rgb(76,110,219)","rgb(96,84,200)"],c={text:"",prefixP:-b,skillI:0,skillP:0,direction:"forward",delay:g,step:o};i()};binft(document.getElementById("binft"))</script><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">9</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">1</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pvY2VseW5mbG9yZXNYWFg=" title="https:&#x2F;&#x2F;github.com&#x2F;jocelynfloresXXX"><i class="ic i-github"></i></span> <span class="exturl item weixin" data-url="aHR0cHM6Ly9zMy5heDF4LmNvbS8yMDIxLzAzLzA3LzZLQmJjRC5qcGc=" title="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;03&#x2F;07&#x2F;6KBbcD.jpg"><i class="ic i-weixin"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE0Nzg0ODY0ODU=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1478486485"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vNzMwMzMxNDY1OC9wcm9maWxlP3RvcG5hdj0xJnd2cj02" title="https:&#x2F;&#x2F;weibo.com&#x2F;7303314658&#x2F;profile?topnav&#x3D;1&amp;wvr&#x3D;6"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly93d3cuMTZwZXJzb25hbGl0aWVzLmNvbS9wcm9maWxlcy85ZDY2Njg3MjAwZDhm" title="https:&#x2F;&#x2F;www.16personalities.com&#x2F;profiles&#x2F;9d66687200d8f"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="数据通信与计算机网络">数据通信与计算机网络</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/" title="Python高级编程">Python高级编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/" title="新华三H3C刷题">新华三H3C刷题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/" title="Python爬虫入门到高级">Python爬虫入门到高级</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/13/%E8%B7%AF%E7%94%B1%E6%9D%BF%E5%9D%97/" title="路由板块">路由板块</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/" title="IPv6网络基础、安全、过渡与部署">IPv6网络基础、安全、过渡与部署</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2021/01/10/hello-world/" title="Welcome">Welcome</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/" title="深信服SCSA">深信服SCSA</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="分类于 技术">技术</a></div><span><a href="/2021/03/07/HCIA-Routing%20&%20Switching/" title="HCIA-Routing &amp; Switching">HCIA-Routing & Switching</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Manshan @ Manshan</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">77k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:10</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>function createtime(){var n=new Date("01/10/2021 1:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}var now=new Date;setInterval("createtime()",250)</script></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/07/HCIA-Routing & Switching/",favicon:{show:"（●´3｀●）你好！",hide:"(´Д｀)再见！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(i){return i.includes("#")},function(i){return new RegExp(LOCAL.path+"$").test(i)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by hrmmi -->