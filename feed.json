{
    "version": "https://jsonfeed.org/version/1",
    "title": "I",
    "subtitle": "",
    "icon": "https://manshan.top/images/favicon.ico",
    "description": "",
    "home_page_url": "https://Manshan.top",
    "items": [
        {
            "id": "https://manshan.top/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/",
            "url": "https://manshan.top/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/",
            "title": "HCIA-Routing & Switching实验入门",
            "date_published": "2021-03-23T16:16:52.748Z",
            "content_html": "<h1 id=\"写在前面\"><a class=\"anchor\" href=\"#写在前面\">#</a> 写在前面</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li class=\"red\">[1] 常用图标：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6HBzjA.png\" alt=\"图片\"></li>\n<li class=\"red\">[2] 设备名称，型号与版本对应关系如下：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6HD9Bt.png\" alt=\"图片\"></li>\n</ul>\n<h1 id=\"第一章实验ensp搭建基础网络\"><a class=\"anchor\" href=\"#第一章实验ensp搭建基础网络\">#</a> 第一章【实验 eNSP 搭建基础网络】</h1>\n<p class=\"red\">1，启动终端设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qDxG8.png\" alt=\"图片\"></li>\n<li>[2] 选中设备，右击，在弹出的菜单中，选择 “启动” 选项，启动该设备。</li>\n<li>[3] 或，选中准备，点击右上角启动按钮。</li>\n</ul>\n<p class=\"red\">2，捕获接口报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qrTYV.png\" alt=\"图片\"></li>\n<li>[2] 选中设备右击，在菜单中点击 “数据抓包” 选项后，从列表中选择需要监控的接口。</li>\n<li>[3] 接口选择完成后，Wireshark 会自动激活，捕获选中接口所收发的所有报文。</li>\n</ul>\n<p class=\"red\">3，生成接口流量：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qsQ1S.png\" alt=\"图片\"></li>\n<li>[2] 生成的流量会在该界面的回显信息中显示，包含发送的报文和接受的报文。</li>\n<li>[3] 生成流量后，通过 Wireshark 捕获报文并生成抓包结果。</li>\n</ul>\n<p class=\"red\">4，观察捕获的报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qrtzD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Wireshark 的使用方法会在另一篇中介绍。</ins></li>\n<li>[2] Wireshark 界面包含三个面板，分别显示的是数据包列表，每个数据包的内容明细以及数据报对应的十六进制的数据格式。</li>\n<li>[3] 报文内容明细对于理解协议报文格式十分重要，同时也显示了基于 OSI 参考模型的各层协议的详细信息。</li>\n</ul>\n<h1 id=\"第二章设备基础配置\"><a class=\"anchor\" href=\"#第二章设备基础配置\">#</a> 第二章【设备基础配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>您是公司的网络管理员，现在公司购买了两台华为 AR G3 系列路由器，路由器在使用之前，需要先配置路由器的设备名称，系统时间及登陆密码等管理信息。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qyCEn.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，查看系统信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用 display version 命令，查看路由器的软件版本与硬件信息。</li>\n<li>[2]&lt;Huawei&gt;display version</li>\n<li>Huawei Versatile Routing Platform Software</li>\n<li>VRP (R) software, Version 5.130 (AR200 V200R003C00)</li>\n<li>Copyright (C) 2011-2012 HUAWEI TECH CO., LTD</li>\n<li>Huawei AR201 Router uptime is 0 week, 0 day, 0 hour, 0 minute</li>\n<li>MPU 0(Master) : uptime is 0 week, 0 day, 0 hour, 0 minute</li>\n<li>MPU version information :</li>\n<li>1, PCB      Version  : AR01SRU0A VER.A</li>\n<li>2, MAB      Version  : 0</li>\n<li>3, Board    Type     : AR201</li>\n<li>4, BootROM  Version  : 0</li>\n<li>[3] 命令回显消息中包含了 VRP 版本 (Version 5.130)，设备型号 (AR201) 和启动时间 (uptime is 0 week, 0 day, 0 hour, 0 minute) 等信息。</li>\n</ul>\n<p class=\"red\">3，修改系统时间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] VRP 系统会自动保存时间，但如果时间不正确，可以在用户视图下执行<span class=\"green\"> clock timezone</span> 命令和<span class=\"green\"> clock datatime</span> 命令修改系统时间。</li>\n<li>&lt;Huawei&gt;clock timezone Local add 09:00:00</li>\n<li>&lt;Huawei&gt;clock datetime 12:00:00 2000-07-07</li>\n<li>[2] 你也可以修改 local 字段为当前地区的时区名称，如果当前时区位于 UTC+0 时区的西部，需要把 add 字段修改为 minus。</li>\n<li>[3] 执行 display clock 命令查看生效的新系统时间。</li>\n<li>&lt;Huawei&gt;display clock</li>\n<li>2000-07-07 12:04:49</li>\n<li>Friday</li>\n<li>Time Zone(Local) : UTC+09:00</li>\n</ul>\n<p class=\"red\">4，帮助功能和命令自动补全功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在系统输入命令时，？是通配符，Tab 键是自动补全命令的快捷键。</li>\n<li>&lt;Huawei&gt;display ?</li>\n<li>aaa                       AAA</li>\n<li>access-user               User access</li>\n<li>accounting-scheme         Accounting scheme</li>\n<li>acl                       &lt;Group&gt; acl command group</li>\n<li>actual                    Current actual</li>\n<li>adp-ipv4                  Ipv4 information</li>\n<li>adp-mpls                  Adp-mpls module</li>\n<li>alarm                     Alarm</li>\n<li>[2] 在输入信息后输入 “ ？” 可查看以输入字母开头的命令，如，输入 “dis？ ”，设备将输出以 dis 开头的命令。</li>\n<li>[3] 在输入的信息后增加空格，再输入 “ ？”，这时设备将尝试识别输入的信息所对应的命令，然后输出该命令的其他参数。例如输入 “dis ？”，如果只有 display 命令是以 dis 开头的，那么设备将输出 display 命令的参数，如果以 dis 开头的命令还有其他的，设备将报错。</li>\n<li>[4] 另外可以使用键盘上 Tab 键补全命令，比如键入 “dis” 后，按键盘 “Tab” 键可以将命令补全为 “display”。如果有多个以 “dis” 开头的命令存在，则在多个命令之间循环切换。</li>\n<li>[5] 命令在不发生歧义的情况下可以使用简写，如 “display” 可以简写为 “dis” 或 “disp” 等，“interface” 可以简写为 “int” 或 “inter” 等。</li>\n</ul>\n<p class=\"red\">5，进入系统视图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用 system-view 命令可以进入系统视图，这样才可以配置接口，协议等内容。</li>\n<li>&lt;Huawei&gt;system-view</li>\n<li>Enter system view, return user view with Ctrl+Z.</li>\n</ul>\n<p class=\"red\">6，修改设备名称：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置设备时，为了便于区分。往往给设备定义不同的名称。</li>\n<li>[2] 修改 R1 路由器的设备名称为 R1。</li>\n<li>[Huawei]sysname R1</li>\n<li>[R1]</li>\n<li>[3] 修改 R2 路由器的设备名称为 R2。</li>\n<li>[Huawei]sysname R2</li>\n<li>[R2]</li>\n</ul>\n<p class=\"red\">7，配置登录信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置登录标语信息来进行提示或进行登录警告，执行<span class=\"green\"> header shell information</span> 命令配置登录信息。</li>\n<li>[R1]header shell information &quot;Hello !!!&quot;</li>\n<li>[2] 退出路由器命令行界面，再重新登录命令行界面，查看登录信息是否已经修改。</li>\n<li>&lt;R1&gt;quit</li>\n<li>Configuration console exit, please press any key to log on</li>\n<li>Hello !!!</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">8，配置 Console 口参数：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 默认情况下，通过 Console 口登录无密码，任何人都可以直接连接到设备，进行配置。</li>\n<li>[2] 为了避免由此带来的风险，可以将 Console 接口登录方式配置为密码认证方式，密码为密文形式的 “Huawei@123”。</li>\n<li>[3] 空闲时间指的是经过没有任何操作的一定时间后，会自动退出该配置界面，再次登录会根据系统要求，提示输入密码进行验证。</li>\n<li>[4] 空闲时间超时时间为 20 分钟，默认为 10 分钟。</li>\n<li>[R1-ui-console0]user-interface console 0</li>\n<li>[R1-ui-console0]authentication-mode password</li>\n<li>Please configure the login password (maximum length 16):16</li>\n<li>[R1-ui-console0]set authentication password cipher * * * * * *</li>\n<li>[R1-ui-console0]idle-timeout 20 0</li>\n<li>[5] 执行 display this 命令查看配置结果。</li>\n<li>[R1-ui-console0]display this</li>\n<li>[V200R003C00]</li>\n<li>user-interface con 0</li>\n<li>authentication-mode password</li>\n<li>set authentication password cipher %$%7{[8W~(~m1B}=[F=7>&9,'>.bbJS4b>77C8N\\2D:uw%9'>1,%%$</li>\n<li>idle-timeout 20 0</li>\n<li>user-interface vty 0 4</li>\n<li>user-interface vty 16 20</li>\n<li>return</li>\n<li>[6] 退出系统，并使用新配置的密码登陆系统，需要注意的是，在路由器第一次初始化启动时，也需要配置密码。</li>\n<li>&lt;R1&gt;quit</li>\n<li>Configuration console exit, please press any key to log on</li>\n<li>Login authentication</li>\n<li>Password:Huawei@123</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">9，配置接口 IP 地址和描述信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 配置 R1 G0/0/0 接口的 IP 地址，使用点分十进制格式 (如：255.255.255.0) 或根据子网掩码前缀长度配置子网掩码。</p>\n</li>\n<li>\n<p>[R1]int g0/0/0</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]ip address 172.16.1.1 24</p>\n</li>\n<li>\n<p>Mar 24 2021 23:08:22-08:00 R1 %%01IFNET/4/LINK_STATE(l)[0]:The line protocol IP on the interface GigabitEthernet0/0/0 has entered the UP state.</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]description This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>[2] 在当前接口视图下，执行<span class=\"green\"> display this</span> 命令查看配置结果。</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]display this</p>\n</li>\n<li>\n<p>[V200R003C00]</p>\n</li>\n<li>\n<p>interface GigabitEthernet0/0/0</p>\n</li>\n<li>\n<p>description This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>ip address 172.16.1.1 255.255.255.0</p>\n</li>\n<li>\n<p>return</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]</p>\n</li>\n<li>\n<p>[3] 执行<span class=\"gree\"> display interface</span> 命令查看接口信息。</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]display interface G0/0/0</p>\n</li>\n<li>\n<p>GigabitEthernet0/0/0 current state : UP</p>\n</li>\n<li>\n<p>Line protocol current state : UP</p>\n</li>\n<li>\n<p>Last line protocol up time : 2021-03-24 23:08:22 UTC-08:00</p>\n</li>\n<li>\n<p>Description:This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>Route Port,The Maximum Transmit Unit is 1500</p>\n</li>\n<li>\n<p>Internet Address is 172.16.1.1/24</p>\n</li>\n<li>\n<p>IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc8e-05ac</p>\n</li>\n<li>\n<p>Last physical up time   : 2021-03-24 23:06:29 UTC-08:00</p>\n</li>\n<li>\n<p>Last physical down time : 2021-03-24 23:06:16 UTC-08:00</p>\n</li>\n<li>\n<p>Current system time: 2021-03-24 23:15:30-08:00</p>\n</li>\n<li>\n<p>Port Mode: COMMON COPPER</p>\n</li>\n<li>\n<p>Speed : 1000,  Loopback: NONE</p>\n</li>\n<li>\n<p>Duplex: FULL,  Negotiation: ENABLE</p>\n</li>\n<li>\n<p>Mdi   : AUTO</p>\n</li>\n<li>\n<p>[3] 从命令回显消息中可以看到，接口的物理状态与协议状态均为 Up，表示对应的物理层与数据链路层均可用。</p>\n</li>\n<li>\n<p>[4] 配置 R2 上 G0/0/0 接口的 IP 地址与描述信息。</p>\n</li>\n<li>\n<p>[R2]int g0/0/0</p>\n</li>\n<li>\n<p>[R2-GigabitEthernet0/0/0]ip address 172.16.1.2 24</p>\n</li>\n<li>\n<p>Mar 24 2021 23:20:19-08:00 R2 %%01IFNET/4/LINK_STATE(l)[0]:The line protocol IP on the interface GigabitEthernet0/0/0 has entered the UP state.</p>\n</li>\n<li>\n<p>[R2-GigabitEthernet0/0/0]description This interface connects to R1-G0/0/0</p>\n</li>\n<li>\n<p>[4] 配置完成后，通过执行 ping 命令测试 R1 和 R2 间的连通性。</p>\n</li>\n<li>\n<p>&lt;R1&gt;ping 172.16.1.2</p>\n</li>\n<li>\n<p>PING 172.16.1.2: 56  data bytes, press CTRL_C to break</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=1 ttl=255 time=120 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=2 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=3 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=4 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=5 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>--- 172.16.1.2 ping statistics ---</p>\n</li>\n<li>\n<p>5 packet(s) transmitted</p>\n</li>\n<li>\n<p>5 packet(s) received</p>\n</li>\n<li>\n<p>0.00% packet loss</p>\n</li>\n<li>\n<p>round-trip min/avg/max = 20/40/120 ms</p>\n</li>\n</ul>\n<p class=\"red\">10，查看当前设备上存储的文件列表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行<span class=\"green\"> display saved-configuration</span> 命令查看保存的配置文件。</li>\n<li>&lt;R1&gt;display saved-configuration</li>\n<li>There is no correct configuration file in FLASH</li>\n<li>&lt;R1&gt;</li>\n<li>[2] 系统中没有已保存的配置文件，执行<span class=\"green\"> save</span> 命令保存当前的配置文件。</li>\n<li>&lt;R1&gt;save</li>\n<li>The current configuration will be written to the device.</li>\n<li>Are you sure to continue? (y/n)[n]:y</li>\n<li>It will take several minutes to save configuration file, please wait........</li>\n<li>Configuration file had been saved successfully</li>\n<li>Note: The configuration file will take effect after being activated</li>\n<li>&lt;R1&gt;</li>\n<li>[3] 重新执行<span class=\"green\"> display saved-configuration</span> 命令查看已保存的配置信息。</li>\n<li>&lt;R1&gt;display saved-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n<li>[4] 执行<span class=\"green\"> display current-configuration</span> 命令查看当前配置信息。</li>\n<li>&lt;R1&gt;display current-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n<li>[5] 一台路由器可以配置多个配置文件。执行<span class=\"green\"> display startup</span> 命令查看下次启动时使用的配置文件。</li>\n<li>&lt;R1&gt;display startup</li>\n<li>MainBoard:</li>\n<li>Startup system software:                   null</li>\n<li>Next startup system software:              null</li>\n<li>Backup system software for next startup:   null</li>\n<li>Startup saved-configuration file:          flash:/vrpcfg.zip</li>\n<li>Next startup saved-configuration file:     flash:/vrpcfg.zip</li>\n<li>Startup license file:                      null</li>\n<li>Next startup license file:                 null</li>\n<li>Startup patch package:                     null</li>\n<li>Next startup patch package:                null</li>\n<li>Startup voice-files:                       null</li>\n<li>Next startup voice-files:                  null</li>\n<li>&lt;R1&gt;</li>\n<li>[6] 删除闪存中的配置文件。</li>\n<li>&lt;R1&gt;reset saved-configuration</li>\n<li>This will delete the configuration in the flash memory.</li>\n<li>The device configuratio</li>\n<li>ns will be erased to reconfigure.</li>\n<li>Are you sure? (y/n)[n]:y</li>\n<li>Clear the configuration in the device successfully.</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">11，重启设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行 reboot 命令重启路由器。</li>\n<li>&lt;R1&gt;reboot</li>\n<li>Info: The system is comparing the configuration, please wait.</li>\n<li>Warning: All the configuration will be saved to the next startup configuration.</li>\n<li>Continue ? [y/n]:y</li>\n<li>[2] 系统提示是否保存当前配置，可根据实验要求决定是否保存当前配置，如果无法确认是否保存，则不保存当前配置。</li>\n<li>[3] 配置文件。</li>\n<li>[R1]display current-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n</ul>\n<h1 id=\"第三章stp和rstp\"><a class=\"anchor\" href=\"#第三章stp和rstp\">#</a> 第三章【STP 和 RSTP】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，为了避免网络中的环路问题，需要在网络中的交换机上配置 STP。本实验中，你还需要通过修改桥优先级来控制 STP 的根桥选举，并通过配置 STP 的一些特性来加快 STP 的收敛速度。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/25/6qO6hV.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，配置 STP 并验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 为了保证实验结果的准确性，必须先关闭无关的端口。确保设备以空配置启动，如果 STP 被禁用，则执行 stp enable 命令启用 STP。</li>\n<li>[2] 本实验中，S1 和 S2 之间有两条链路，在 S1 和 S2 上启用 STP，并把 S1 配置为根桥。</li>\n<li>[S1]stp mode stp</li>\n<li>Info: This operation may take a few seconds. Please wait for a moment...done.</li>\n<li>[S1]stp root primary</li>\n<li>[S2]stp mode stp</li>\n<li>Info: This operation may take a few seconds. Please wait for a moment...done.</li>\n<li>[S2]stp root secondary</li>\n<li>[3] 执行<span class=\"green\"> display stp brief</span> 命令查看 STP 信息。</li>\n<li>[S1]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               DESI  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               DESI  FORWARDING      NONE</li>\n<li>[S1]</li>\n<li>[S2]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ROOT  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               ALTE  DISCARDING      NONE</li>\n<li>[S2]</li>\n<li>[4] 执行<span class=\"green\"> display stp interface</span> 命令查看端口的 STP 状态。</li>\n<li>[S1]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :0    .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 0(root)</li>\n<li>CIST RegRoot/IRPC   :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>[S2]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 200000</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n</ul>\n<p class=\"red\">3，控制根桥的选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行 display stp 命令查看根桥信息，根桥设备的 CIST Bridge 与 CIST Root/ERPC 字段取值相同。</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :0    .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RegRoot/IRPC   :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>CIST Root Type      :Primary root</li>\n<li>[S2]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 200000</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>CIST Root Type      :Secondary root</li>\n<li>[2] 通过配置优先级，使 S2 为根桥，S1 为备份桥，桥优先级取值越小，则优先级越高，把 S1 和 S2 的优先级分别设置为 8192 和 4096。</li>\n<li>[S1]undo stp root</li>\n<li>[S1]stp priority 8192</li>\n<li>[S2]undo stp root</li>\n<li>[S2]stp priority 4096</li>\n<li>[3] 执行 display stp 命令查看新的根桥信息。</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[S2]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 0(root)</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[4] 由上述回显消息中可以看出，S2 已经变成新的根桥。关闭 S2 的 E0/0/1 和 E0/0/2 端口，从而隔离 S1 与 S2，模拟 S2\t发生故障。</li>\n<li>[S2]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]shutdown</li>\n<li>[S2-Ethernet0/0/1]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]shutdown</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :128.2</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[5] 在上述回显消息中，表明当 S2 故障时，S1 变成了根桥，然后开启 S2 之前关闭的接口。</li>\n</ul>\n<h1 id=\"第四章路由配置\"><a class=\"anchor\" href=\"#第四章路由配置\">#</a> 第四章【路由配置】</h1>\n<h1 id=\"第五章ftp和dhcp\"><a class=\"anchor\" href=\"#第五章ftp和dhcp\">#</a> 第五章【FTP 和 DHCP】</h1>\n",
            "tags": [
                "技术",
                "HUAWEI"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/",
            "url": "https://manshan.top/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/",
            "title": "IPv6网络基础、安全、过渡与部署",
            "date_published": "2021-03-07T11:49:27.621Z",
            "content_html": "<h1 id=\"第一章ipv6基础知识\"><a class=\"anchor\" href=\"#第一章ipv6基础知识\">#</a> 第一章【IPv6 基础知识】</h1>\n<h1 id=\"第二章ipv6协议首部结构\"><a class=\"anchor\" href=\"#第二章ipv6协议首部结构\">#</a> 第二章【IPv6 协议首部结构】</h1>\n<h1 id=\"第三章ipv6地址结构\"><a class=\"anchor\" href=\"#第三章ipv6地址结构\">#</a> 第三章【IPv6 地址结构】</h1>\n<h1 id=\"第四章icmpv6协议和邻居发现协议\"><a class=\"anchor\" href=\"#第四章icmpv6协议和邻居发现协议\">#</a> 第四章【ICMPv6 协议和邻居发现协议】</h1>\n<h1 id=\"第五章ipv6路由协议\"><a class=\"anchor\" href=\"#第五章ipv6路由协议\">#</a> 第五章【IPv6 路由协议】</h1>\n<h1 id=\"第六章ipv6安全机制\"><a class=\"anchor\" href=\"#第六章ipv6安全机制\">#</a> 第六章【IPv6 安全机制】</h1>\n<h1 id=\"第七章移动ipv6技术\"><a class=\"anchor\" href=\"#第七章移动ipv6技术\">#</a> 第七章【移动 IPv6 技术】</h1>\n<h1 id=\"第八章ipv6过渡技术\"><a class=\"anchor\" href=\"#第八章ipv6过渡技术\">#</a> 第八章【IPv6 过渡技术】</h1>\n<h1 id=\"第九章ipv6网络协议栈应用\"><a class=\"anchor\" href=\"#第九章ipv6网络协议栈应用\">#</a> 第九章【IPv6 网络协议栈应用】</h1>\n<h1 id=\"第十章ipv6技术配置实验\"><a class=\"anchor\" href=\"#第十章ipv6技术配置实验\">#</a> 第十章【IPv6 技术配置实验】</h1>\n<h1 id=\"第十一章ipv6部署\"><a class=\"anchor\" href=\"#第十一章ipv6部署\">#</a> 第十一章【IPv6 部署】</h1>\n",
            "tags": [
                "技术",
                "IPV6"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/",
            "url": "https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/",
            "title": "HCIA-Routing & Switching理论入门",
            "date_published": "2021-03-07T05:52:40.240Z",
            "content_html": "<h1 id=\"第一章传输介质简介\"><a class=\"anchor\" href=\"#第一章传输介质简介\">#</a> 第一章【传输介质简介】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>通信网络除了包含通信设备本身之外，还包含连接这些设备的传输介质，如，同轴电缆，双绞线和光纤等。不同的传输介质具有不同的特性，这些特性直接影响到通信的诸多方面，如，线路编码方式，传输速度和传输距离等。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，简单网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MGv3d.png\" alt=\"图片\"></li>\n<li>上图，两个终端，用一条能够承载数据传输的物理介质 (也称传输介质) 连接起来，就组成了一个简单网络。</li>\n<li>[2] 终端相互传递信息和资源共享的需求是网络产生的主要原因。</li>\n<li>[3] 终端可以产生，发送和接收数据，网络是终端建立通信的媒介，终端通过网络建立连接，用来传输数据的载体称为介质，网络可以使用各种介质进行数据传送，包括物理线缆，无线电波等。</li>\n<li>[4] 网络就是通过介质把终端互联而成的一个规模大，功能强的系统，从而使得众多的终端可以方便地互相传递信息，共享信息资源。</li>\n</ul>\n<p class=\"red\">2，介质 —— 同轴电缆：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 简介如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MYMQA.png\" alt=\"图片\"></li>\n<li>[2] 同轴电缆是一种早期使用的传输介质，同轴电缆的标准分为两种，10BASE2 和 10BASE5. 这两种标准都支持 10Mbps 的传输数据，最长传输距离分别为 184m 和 500m 一般情况下，10BASE2 同轴电缆使用 BNC 接头，10BASE5 使用 N 型接头。</li>\n<li>[3] 10BASE5 和 10BASE2 是早期的两种以太网标准，它们均采用同轴电缆作为传输介质。10BASE5 和 10BASE2 所使用的同轴电缆的直径分别为 9.5mm 和 5mm，所以前者又称为粗电缆，后者又称为细电缆。</li>\n<li>[4] 现在 10Mbps 的传输速率早已不满足目前企业网络的需求，因此同轴电缆在目前企业网络中很少应用。</li>\n</ul>\n<p class=\"red\">3，介质 —— 交叉线：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MsexK.png\" alt=\"图片\"></li>\n<li>[2] 与同轴电缆相比双绞线 (Twisted Pair) 具有更低的制造和部署成本，因此在企业网络中被广泛应用。</li>\n<li>[3] 双绞线可分为屏蔽双绞线 (Shielded Twisted Pair STP) 和非屏蔽双绞线 (Unshielded Twisted Pair UTP)。</li>\n<li>[4] 屏蔽双绞线在双绞线与外层绝缘封套之间有一个金属屏蔽层，可以屏蔽电磁干扰。</li>\n<li>[5] 双绞线有很多种类型，不同类型的双绞线所支持的传输速率一般也不相同，例如，3 类双绞线支持 10Mbps 传输速率，5 类双绞线支持 100Mbps 传输速率，超 5 类双绞线及更高级别的双绞线支持千兆以太网传输。</li>\n<li>[6] 双绞线使用 RJ-45 接头连接网络设备，为了保证终端能够正常收发数据，RJ-45 的针脚必须按照一定的线序排列。</li>\n<li>[7] 排序：</li>\n<li>568A 排线顺序：绿白，绿，橙白，蓝，蓝白，橙，棕白，棕。</li>\n<li>568B 排线顺序：橙白，橙，绿白，蓝，蓝白，绿，棕白，棕。</li>\n</ul>\n<p class=\"red\">4，介质 —— 光纤：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M6hCR.png\" alt=\"图片\"></li>\n<li>[2] 双绞线和同轴电缆传输数据时使用的是电信号，而光纤传输数据时使用的是光信号。</li>\n<li>[3] 光纤支持的传输速率包括：10Mbps，100Mbps，1Gbps，10Gbps 甚至更高。</li>\n<li>[4] 根据光纤传输光信号模式的不同，光纤又可以分为单模光纤和多模光纤。</li>\n<li>[5] 单模光纤只能传输一种模式的光，不存在膜间色散，因此适用于长距离高速传输。</li>\n<li>[6] 多模光纤允许不同模式的光在一根光纤上传输，由于膜间色散较大而导致信号脉冲展宽严重，因此多模光纤主要用于局域网中短距离传输。</li>\n<li>[7] 光纤连接器种类很多，常用的连接器包括 ST，FC，SC，LC 连接器。</li>\n</ul>\n<p class=\"red\">5，介质 —— 串口电缆：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M2cb8.png\" alt=\"图片\"></li>\n<li>[2] 网络通信中常常会用到各种各样的串口电缆，常用的串口电缆标准为 RS-232，同时也是推荐的标准。但是 RS-232 的传输速率有限，传输距离仅为 6m。</li>\n<li>[3] 其他的串口电缆标准可以支持更长的传输距离，例如：RS-422 和 RS-485 的传输距离可达到 1200m，RS-422 和 RS-485 串口电缆通常使用 V.35 接头，这种接头在上世纪 80 年代已被淘汰，但是，现在仍在帧中继，ATM 等传统网络上使用。</li>\n<li>[4] V.24 是 RS-232 标准的欧洲版，RS-232 本身没有定义接头标准，常用的接头类型为 DB-9 和 DB-25.</li>\n<li>[5] 现在，RS-232 已逐渐被 FireWire，USB 等新标准取代，新产品和新设备已普遍使用 USB 标准。</li>\n</ul>\n<p class=\"red\">6，冲突域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/07/6MWFO0.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>注：共享式网络中可能会出现信号冲突现象。</p>\n</li>\n<li>\n<p>[2] 上图是一个 10BASE5 以太网，每个主机都使用同一根同轴电缆来与其他主机进行通信，因此，这里的同轴电缆又被称为共享介质，相应的网络被称为共享介质网络，或称为共享式网络，在共享式网络中，不同的主机同时发送数据时，就会产生信号冲突的问题，解决这一问题的方法一般是采用<ins class=\"wavy\"> CSMA/CD (载波侦听多路访问 / 冲突检测技术)。</ins></p>\n</li>\n<li>\n<p>[3]<ins class=\"wavy success\"> CSMA/CD 的基本工作过程如下：</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备不停地检测共享线路的状态，如果线路空闲，则可以发送数据，如果线路不空闲，则等待一段时间后继续检测 (延时时间由退避算法决定)。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">如果有另一台设备同时发送数据，两个设备发送的数据会产生冲突。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备检测到冲突之后，会马上停止发送自己的数据，并发送特殊阻塞信息，以强化冲突信号，使线路上其他站点能够尽早检测到冲突。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备检测到冲突后，等一段时间之后再进行数据发送 (延时时间有退避算法决定)。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">CSMA/CD 的工作原理可简单总结为：先听后发，边发边听，冲突停发，随机延迟后重发。</ins></p>\n</li>\n</ul>\n<p class=\"red\">7，双工模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M4Q6s.png\" alt=\"图片\"></li>\n<li>注：两种双工模式都支持双向数据传输。</li>\n<li>[2] 半双工：</li>\n<li>在半双工 (Half-duplex mode) 下，通信双方都能发送和接收数据，但不能同时进行。当一台设备发送时，另一台只能接收，反之亦然。对讲机就是半双工的典型例子。</li>\n<li>[3] 全双工：</li>\n<li>在全双工 (Full-duplex mode) 下，通信双方都能同时接收和发送数据，电话网络是典型的全双工例子。</li>\n<li>[4] 以太网上的通信模式包括全双工和半双工两种。</li>\n<li>[5] 半双工模式下，共享物理介质的通信双方必须采用 CSMA/CD 机制来避免冲突，例如，10BASE5 以太网的通信模式就必须是半双工模式。</li>\n<li>[6] 全双工模式下，通信双方可以同时实现双向通信，这种模式不会产生冲突，因此，不需要使用 CSMA/CD 机制，例如，10BASE-T 以太网的通信模式就可以是全双工模式。</li>\n<li>[7] 同一物理链路上相连的两台设备的双工模式必须保持一致。</li>\n</ul>\n<p class=\"red\">8，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>千兆以太网传输必须使用超 5 类标准及以上的双绞线，或者使用千兆级更高等级的光纤。</li>\n<li>冲突域是一个通过共享物理介质进行双向传输的所有节点的集合，当同一个冲突与域中的主机同时发送数据时，数据到达目的地之前可能会发生冲突。</li>\n<li>CSMA/CD 是一种在共享式网络上检测并避免冲突的机制。</li>\n</ul>\n<h1 id=\"第二章以太网帧结构\"><a class=\"anchor\" href=\"#第二章以太网帧结构\">#</a> 第二章【以太网帧结构】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>网络中传输数据时需要定义并遵循一些标准，以太网是根据 IEEE 802.3 标准来管理和控制数据帧的。了解 IEEE 802.3 标准是充分了解以太网中链路层通信的基础。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，网络通信协议：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MTD2D.png\" alt=\"图片\"></li>\n<li>注：不同的协议栈用于定义和管理不同网络的数据转发规则。</li>\n<li>[2] 网络通信中，“协议” 和 “标准” 这两个词汇常常可以混用，同时，协议或标准本身又常常具有层次的特点。</li>\n<li>[3] 一般地，关注于逻辑数据关系的协议通常被称为上层协议，而关注于物理数据流的协议通常被称为底层协议。</li>\n<li>[4] IEEE 802 就是一套用来管理物理数据流在局域网中传输的标准，包括在局域网中传输物理数据的 802.3 以太网标准。除此之外，还有一些用来管理物理数据流在广域网中传输的标准，如，PPP (Point-To-Point Protocol)，高级数据链路控制 HDLC (High-Level Data Link Control)。</li>\n</ul>\n<p class=\"red\">2，分层模型 ——OSI：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M7oY6.png\" alt=\"图片\"></li>\n<li>[2] OSI 参考模型具有以下优点：</li>\n<li>简化了相关的网络操作。</li>\n<li>提供了不同厂商之间的兼容性。</li>\n<li>促进了标准化工作。</li>\n<li>结构上进行了分层。</li>\n<li>易于学习和操作。</li>\n<li>[3] OSI 各个层次的基本功能如下：</li>\n<li><ins class=\"dot\">物理层：</ins></li>\n<li>在设备之间传输比特流，规定了电平，速度和电缆针脚。</li>\n<li><ins class=\"dot\">数据链路层：</ins></li>\n<li>将比特组合成字节，再将字节组合成帧，使用链路层地址 (以太网使用 MAC 地址) 来访问介质，并进行差错检测。</li>\n<li><ins class=\"dot\">网络层：</ins></li>\n<li>提供逻辑地址，供路由器确认路径。</li>\n<li><ins class=\"dot\">传输层</ins></li>\n<li>提供面向连接或非面向连接的数据传递以及进行重传前的差错检测。</li>\n<li><ins class=\"dot\">会话层</ins></li>\n<li>负责建立，管理，终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和相应组成。</li>\n<li><ins class=\"dot\">表示层</ins></li>\n<li>提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。</li>\n<li><ins class=\"dot\">应用层</ins></li>\n<li>OSI 参考模型中最靠近用户的一层，为应用程序提供网络服务。</li>\n</ul>\n<p class=\"red\">3，分层模型 ——TCP/IP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MqezT.png\" alt=\"图片\"></li>\n<li>[2] TCP/IP 模型同样采用了分层结构，层与层相对独立但是相应之间也具备非常密切的协作关系。</li>\n<li>[3] TCP/IP 模型将网络分为四层，TCP/IP 模型不关注底层物理介质，主要关注于终端之间的逻辑数据流转发，</li>\n<li>[4] TCP/IP 模型的核心是网络层和传输层，网络层解决网络之间的逻辑转发问题，传输层保证源端到目的端之间的可靠传输。最上层的应用层通过各种协议向终端用户提供业务应用。</li>\n</ul>\n<p class=\"red\">4，数据封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QC5WQ.png\" alt=\"图片\"></li>\n<li>[2] 应用数据需要经过 TCP/IP 每一层处理之后才能通过网络传输到目的端，每一层上都是用该层的数据单元 PDU (Protocol Data Unit) 彼此交换信息。不同层的 PDU 中包含有不同的信息，因此 PDU 在不同层被赋予了不同的名称。</li>\n<li>[3] 如上层数据在传输层添加 TCP 报头后得到的 PDU 被称为数据段 (Segmet), 数据段被传递给网络层，网络层添加 IP 报头得到的 PDU 被称为数据包 (Packet), 数据包被传递到数据链路层，封装数据链路层报头得到的 PDU 被称为数据帧 (Frame), 最后，帧被转换为比特，通过网络介质传输，这种协议栈逐层向下传递数据，并添加报头和报尾的过程称为封装。</li>\n</ul>\n<p class=\"red\">5，终端之间的通信：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QPkTK.png\" alt=\"图片\"></li>\n<li>注：数据链路层控制数据帧在物理线路上传输。</li>\n<li>[2] 数据包在以太网物理介质传播之前必须封装头部和尾部信息，封装后的数据包被称为数据帧，数据帧中封装的信息决定了数据如何传输，以太网中传输的数据帧有两种格式。选择哪种格式，由 TCP/IP 协议族中的网络层决定。</li>\n</ul>\n<p class=\"red\">6，帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QPQmt.png\" alt=\"图片\"></li>\n<li>[2] 以太网上使用两种标准帧格式，第一种是上世纪八十年代提出的 DIX v2 格式，即 Ethernet II 帧格式，Ethernet II 后来被 IEEE 802 标准接纳，并写进了 IEEE 802.3\tX-1997 的 3.2.6 节。</li>\n<li>[3] 第二种是 1983 年提出的 IEEE 802.3 格式，这两种格式的主要区别在与 Ethernet II 格式中包含一个 Type 字段，标识以太帧处理完成之后将被发送到哪个上层协议进行处理，IEEE 802.3 格式中，同样的位置是长度字段。</li>\n<li>[4] 不同的 Type 字段值可以用来区别这两种帧的类型，当 Type 字段值小于等于 1500 (或者 16 进制的 0x05DC) 时，帧使用的是 IEEE 802.3 格式。当 Type 值大于等于 1536 (或者 16 进制 0x0600) 时，帧使用的是 Ethernet II 格式。<ins class=\"wavy\">以太网中大多数的数据帧使用的是 Ethernet II 格式。</ins></li>\n<li>[5]<ins class=\"wavy\"> 以太帧中还包括源和目的 MAC 地址，分别代表发送者的 MAC 和接收者的 MAC，此外还有帧校验序列字段，用于校验传输过程中帧的完整性。</ins></li>\n</ul>\n<p class=\"red\">7，Ethernet II 帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QzZoF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Ethernet II 帧类型值大于等于 1536 (0x0600)，以太网数据帧的长度在 64-1518 字节之间。</ins></li>\n<li>[2] Ethernet II 的帧中各种字段说明如下：</li>\n<li><ins class=\"wavy\">DMAC(Destination MAC)：</ins></li>\n<li>是目的 MAC 地址，DMAC 字段长度为 6 个字节，标识帧的接收者。</li>\n<li><ins class=\"wavy\">SMAC(Source MAC)：</ins></li>\n<li>是源 MAC 地址，SMAC 字段长度为 6 个字节，标识帧的发送者。</li>\n<li><ins class=\"wavy\">Type (类型字段)：</ins></li>\n<li>用于标识数据字段中包含的高层协议，该字段长度为 2 个字节，<ins class=\"wavy\">类型字段取值为 0x0800 的帧代表 IP 协议帧。类型字段取值为 0x0806 的帧代表 ARP 协议帧。</ins></li>\n<li><ins class=\"wavy\">Data (数据字段)：</ins></li>\n<li>是网络层数据，最小长度必须为 46 字节以保证帧长至少为 64 字节，数据字段的最大长度为 1500 字节。</li>\n<li><ins class=\"wavy\">FCS (循环冗余检验字段)：</ins></li>\n<li>提供了一种错误检测机制，该字段长度为 4 个字节。</li>\n</ul>\n<p class=\"red\">8，IEEE 802.3 帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lFCAP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IEEE 802.3 帧长度字段值小于等于 1500 (0x05DC)。</ins></li>\n<li>[2] IEEE 802.3 帧格式类似于 Ethernet II 帧，只是 Ethernet II 帧的 type 域被 802.3 帧的 Length 域取代，并且占用了 Data 字段的 8 个字节作为 LLC 和 SNAP 字段。</li>\n<li><ins class=\"wavy\">Leagth 字段：</ins></li>\n<li>定义了 Data 字段包含的字节数。</li>\n<li><ins class=\"wavy\">逻辑链路控制 LLC (Logical Link Control)：</ins></li>\n<li>由目的服务访问点 DSAP (Destination Service Access Point)，源服务访问点 SSAP (Source Service Access Point) 和 Control 字段组成。</li>\n<li><ins class=\"wavy\">SNAP(Sub-network Access Point)：</ins></li>\n<li>由机构代码 (Org Code) 和类型 (Type) 字段组成，Org Code 三个字节都为零，Type 字段的含义与 Ethernet II 帧中的 Type 字段相同。</li>\n<li><ins class=\"wavy\">IEEE 802.3 帧根据 DSAP，SSAP 字段的取值又可以分为以下几类：</ins></li>\n<li>1) 当 DSAP 和 SSAP 都取特定值 0xff 时，802.3 帧就变成了 Netware-ETHERNET 帧，用来承载 NetWare 类型的数据。</li>\n<li>2) 当 DSAP 和 SSAP 都取特定值 0xaa 时，802.3 帧就变成了 ETHERNET-SNAP 帧，ETHERNER_SNAP 帧可以用于传输多种协议。</li>\n<li>3)<ins class=\"wavy\"> DSAP 和 SSAP 其他的取值均为纯 IEEE 802.3 帧。</ins></li>\n</ul>\n<p class=\"red\">9，数据帧传输：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lVFVs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据链路层基于 MAC 地址进行帧的传输。</ins></li>\n<li>[2] 以太网在二层链路上通过 MAC 地址来唯一标识网络设备，并且实现局域网上网络设备之间的通信。</li>\n<li>[3] MAC 地址也叫物理地址，大多数网卡厂商把 MAC 地址烧入了网卡的 ROM 中，发送端使用接收端的 MAC 地址作为目的地址，以太帧封装完成之后会通过物理层转换成比特流在物理介质上传输。</li>\n</ul>\n<p class=\"red\">10，以太网的 MAC 地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lek90.png\" alt=\"图片\"></li>\n<li>++ 注：MAC 地址由两部分组成，分别是供应商代码和序列号。其中前 24 位代表该供应商代码，由 IEEE 管理和分配，剩下的 24 位序列号由厂商自己分配。</li>\n<li>[2] 网络设备的 MAC 地址是全球唯一的，MAC 地址长度为 48 比特，通常用 16 进制标识。</li>\n<li>[3] MAC 地址包含两个部分：前 24 比特是组织唯一标识符 (OUI) 由 IEEE 统一分配给设备制造商，例如，华为网络产品的 MAC 地址前 24 比特是 0x00e0fc。后 24 位序列号是厂商厂商分配给每个产品的唯一数值，由各个厂商自行分配。</li>\n</ul>\n<p class=\"red\">11，单播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6ln06f.png\" alt=\"图片\"></li>\n<li>[2] 局域网中的帧可以通过三种方式发送，第一种是单播，指从单一的源端单一的目的端，每个主机接口由一个 MAC 地址唯一标识，<ins class=\"wavy\">MAC 地址的 OUI 中，第一个字节第八个比特标识比特类型。</ins></li>\n<li>[3] 对于主机 MAC 地址，这个比特固定为零，表示目的 MAC 地址为此 MAC 地址的帧都是发送到某个唯一的目的端。</li>\n<li>[4] 在冲突与中，所有主机都能接收到源主机发送的单播帧，都是其他主机发现目的地址与本地 MAC 地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧。</li>\n</ul>\n<p class=\"red\">12，广播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lKLy6.png\" alt=\"图片\"></li>\n<li>[2] 第二种方式是广播，表示帧从单一的源发送到共享以太网上的所有主机。广播帧的目的 MAC 地址为十六进制的 FF:FF:FF:FF:FF:FF，所有收到该广播帧的主机都要接收并处理这个帧。</li>\n<li>[3]<ins class=\"wavy\"> 广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能。</ins></li>\n<li>[4]<ins class=\"wavy\"> 当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式。</ins></li>\n</ul>\n<p class=\"red\">13，组播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lQQ4H.png\" alt=\"图片\"></li>\n<li>[2] 第三种发送方式为组播，组播比广播更加高效，组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的 MAC 地址为该组播 MAC 地址的帧。</li>\n<li>[3] 组播 MAC 地址和单播 MAC 地址是通过<ins class=\"wavy\">第一个字节中的第八个比特区分的。组播 MAC 地址的第八个比特为 1，而单播 MAC 地址的第八个比特为 0。</ins></li>\n<li>[4] 当需要网络上的一组主机 (而不是全部主机) 接收相同的信息，并且其他主机不受影响的情况下通常会使用组播方式。</li>\n</ul>\n<p class=\"red\">14，数据帧的发送和接收：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6l3GvR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当主机接收到数据帧所包含的目的 MAC 地址是自己时，会把以太网封装剥掉后送往上层协议。</ins></li>\n<li>[2] 帧从主机的物理口发送出来后，通过传输介质传输到目的端，共享网络中，这个帧可能到达多个主机，主机检测帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢弃收到的帧。</li>\n<li>[3] 如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检测帧检验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保存了完整性。如果帧的 FCS 值与本机计算的值不同，主机会认为帧已被破坏，并会丢弃该帧。如果该帧通过了 FCS 校验，则主机会根据帧头部的 Type 字段来确定将帧发送给上层哪一个协议处理，本列中，Type 字段的值为 0x0800，表明该帧需要发送到 IP 协议上处理，在发送给 IP 协议之前，帧的头部和尾部会被剥掉。</li>\n</ul>\n<p class=\"red\">15，本章总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 网络设备如何确定以太网数据帧的上层协议？</li>\n<li>以太网帧中包含一个 Type 字段，表示帧中的数据应该发送到上层哪个协议处理，比如，IP 协议对应的 Type 值为 0x0800，ARP 协议对应的 Type 值为 0x0806。</li>\n<li>[2] 终端设备接收到数据帧时，会如何处理？</li>\n<li>主机检查帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢掉收到的帧，如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检查帧校验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保持了完整性。如果检查通过，就会剥离帧头和帧尾，然后根据帧头中的 Type 字段来决定把数据发送到哪个上层协议进行后续处理。</li>\n</ul>\n<h1 id=\"第三章ip编址\"><a class=\"anchor\" href=\"#第三章ip编址\">#</a> 第三章【IP 编址】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>网络层位于数据链路层与传输层之间，网络层包含了许多协议其中最为重要的就是 IP 协议，网络层提供了 IP 路由功能，理解 IP 路由除了要熟悉 IP 协议的工作机制外，还必须理解 IP 编址以及如何合理地使用 IP 地址来设计网络。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，上层协议类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61SXYF.png\" alt=\"图片\"></li>\n<li>++ 注：以太网帧中的 Type 字段值为 0x0800，表示该帧的网络层协议为 IP 协议。</li>\n<li>[2] 在剥掉帧的头部和尾部之前网络设备需要根据帧头中 Type 字段来确定下一步将帧发送到哪个上层协议进行处理。本列中的帧头部 Type 字段表示该帧需要上送到 IP 协议进行处理，以下将介绍帧的头部和尾部剥离之后，IP 协议将如何处理帧中的数据。</li>\n</ul>\n<p class=\"red\">2，IP 报文头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/619nCF.png\" alt=\"图片\"></li>\n<li>[2] IP 报文头部信息用于指导网络设备对报文进行路由和分片。同一个网段内的数据转发通过数据链路层即可实现，而跨网段的数据转发需要使用网络设备的路由功能。分片是指数据包超过一定长度时，需要被划分成不同的片段使其能够在网络中传输。</li>\n<li>[3] IP 报文头部长度为 20——60 字节，报文头部中的信息可以用来指导网络设备如何将报文从原设备发送到目的设备，其中，版本字段表示当前支持的 IP 协议版本，当前的版本号为 4。DS 字段早期用来表示业务类型，现在用于支持 QoS 中的差分服务模型，实现网络流量优化。</li>\n<li>[4] 源和目的 IP 地址是分配给自己的逻辑地址，用于在网络层标识报文的发送方和接收方，根据源和目的 IP 地址可以判断目的端是否与发送端位于同一网段，如果二者不在同一网段，则需要采用<ins class=\"wavy\">路由机制</ins>进行跨网段转发。</li>\n</ul>\n<p class=\"red\">3，IP 编址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61Pd0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IP 地址分为网络部分和主机部分</ins></li>\n<li><ins class=\"wavy\">注：IP 地址由 32 个二进制位组成，通常用点分十进制来表示</ins></li>\n</ul>\n<p class=\"red\">4，二进制，十进制，十六进制 ———— 略</p>\n<p class=\"red\">5，IP 地址分类：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61iGEq.png\" alt=\"图片\"></li>\n<li>[2] IP 地址被划分为 A,B,C,D,E 五类，每类地址的网络号包含不同的字节数。A，B，C 类地址可以分配 IP 地址。每类地址支持的网络数和主机数不同，例如：A 类地址可支持 126 个网络每个网络支持 2*24 (16777216) 个主机地址，另外每个网段中的网络地址和广播地址不能分配给主机，C 类地址支持 200 多万个网络，每个网络支持 256 个主机地址，其中 254 个地址可以分配给主机使用。</li>\n<li>[3] D 类地址为组播地址，主机收到以 D 类地址为目的地址的报文后，且该主机是该组播组的成员，就会接收并处理该报文。</li>\n</ul>\n<p class=\"red\">6，IP 地址类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61FzlD.png\" alt=\"图片\"></li>\n<li>[2] 默认情况下，网络中的主机无法使用使用私网地址与公网通信，当需要与公网通信时，私网地址必须转换成公网地址。</li>\n<li>[3] 127.0.0.1 网段中的地址为环回地址。用于诊断网络是否正常。</li>\n<li>[4] IPv4 中的第一个地址 0.0.0.0 表示任何网络。IPv4 最后一个地址 255.255.255.255 是 0.0.0.0 网络中的广播地址。</li>\n</ul>\n<p class=\"red\">7，网络通信：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68rxnP.png\" alt=\"图片\"></li>\n<li>[2] 源主机必须知道目的主机的 IP 地址后才能将数据发送到目的地，源主机向其他目的主机发送报文之前，需要检查目的 IP 地址和源 IP 地址是否属于同一网段，如果是则报文将被下发到底层协议进行以太网封装处理。如果目的地址和源地址属于不同网段，则主机需要获取下一跳路由器的 IP 地址，然后将报文下发到底层协议处理。</li>\n</ul>\n<p class=\"red\">8，子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68yZ2d.png\" alt=\"图片\"></li>\n<li>[2] 子网掩码用于区分网络部分和主机部分。</li>\n<li>[3] 子网掩码与 IP 地址的表示方式相同，每个 IP 地址和子网掩码一起可以用来唯一的标识一个网段中的某台网络设备。</li>\n<li>[4] 子网掩码中的 1 表示网络位，0 表示主机位。</li>\n</ul>\n<p class=\"red\">10，默认子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68yjdf.png\" alt=\"图片\"></li>\n<li>[2] 每类 IP 地址有一个缺省子网掩码，A 类地址的为 8 位，即第一个字节表示网络位，其他三个字节表示主机位，B 类 16 位，因此 B 类支持更多的网络，但是主机数也相应减少。C 类 24 位，支持的网络最多，但是也限制了单个网络中主机的数量。</li>\n</ul>\n<p class=\"red\">11，地址规划：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68c8js.png\" alt=\"图片\"></li>\n<li>[2] 通过子网掩码可以判断主机所属的网段，网段上的广播地址以及网段上支持的主机数。</li>\n</ul>\n<p class=\"red\">12，地址规划举例：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68gJRe.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">13，有类 IP 编址的缺陷：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68WYzF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在设计网络时使用有类 IP 地址会造成地址的浪费。</ins></li>\n<li>[2] 使用缺省子网掩码就会存在一定的局限性，网络中划分多个网段后，每个网段中的实际主机数量可能很有限，导致很多地址未被使用，地址使用率低。</li>\n</ul>\n<p class=\"red\">14，变长子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src alt=\"图片\"></li>\n<li>[2] 采用可变长子网掩码可解决上述问题\t，缺省子网掩码可以进一步划分，称为变长子网掩码 (VLSM)。</li>\n<li>[3] 通过改变子网掩码，可以将网络划分为多个子网，上图借用了一个主机位作为网络位，借用的主机位变成了子网位。所以有 2*7-2 个主机地址，即 126 个。</li>\n</ul>\n<p class=\"red\">15，无类域间路由 (CIDR)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/6850XD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：CIDR 增强了网络的可拓展性。</ins></li>\n<li>[2] 无类域间路由 CIDR 由 RFC1817 定义，CIDR 突破了传统 IP 地址的分类边界，将路由表中的若干条路由汇总为一条路由，减少了路由表的规模，提高了路由器的可拓展性。</li>\n</ul>\n<p class=\"red\">16，网关：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68IJKS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网关用来转发来自不同网段之间的数据包。</ins></li>\n<li>[2] 报文转发过程中，首先需要确定转发路径以及通往目的网段的接口，然后将报文封装在以太帧中通过指定的物理接口转发出去。如果目的主机与源主机不在同一网段，报文需要先转发到网关，然后通过网关将报文转发到目的网段。</li>\n<li>[3] 网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备，为实现此功能，网关必须知道目的网段的 IP 地址，网关设备上连接本地网段的接口地址即为该网段的网关地址。</li>\n</ul>\n<p class=\"red\">17，IP 包分片：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/68qjiQ.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> 网络中转发的 IP 报文长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输，将报文分割成多个片段的过程叫做分片。</ins></li>\n<li>[3] 接收端根据分片报文中的<ins class=\"wavy\">标识符 (Identification)，标志 (Flags)，及片偏移 (Fragment Offset) 字段</ins>对分片报文进行重组。</li>\n<li>[4]<ins class=\"wavy\"> 标识符 (Identification): 用于识别属于同一个数据包的分片，以区别于同一主机或其他\t主机发送的其他数据包分片，保证分片被正确的重新组合。</ins></li>\n<li>[5]<ins class=\"wavy\"> 标志字段 (Flags): 用于判断是否已经收到最后一个分片，最后一个分片的标志字段设置为 0，其他分片的标志字段设置为 1. 目的端在收到标志字段为 0 的分片后，开始重组报文。</ins></li>\n<li>[6]<ins class=\"wavy\"> 片偏移字段 (Fragment Offset): 表示每个分片在原始报文中的位置。第一个分片的片偏移为 0，第二个分片的片偏移表示紧跟第一个分片后的第一个比特的位置，比如，如果首片报文包含 1259 比特，那么第二分片报文的片偏移字段值就应该为 1260。</ins></li>\n</ul>\n<p class=\"red\">18，生存时间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/68OO3j.png\" alt=\"图片\"></li>\n<li>[2] 报文在网段间转发时，如果网络设备上的路由规划不合理，就可能会重新环路，导致报文在网络中无限循环，无法到达目的端。环路发生后，所有发往这个目的地的报文的都会被循环转发，随着这种报文逐渐增多，网络将会发送拥塞。</li>\n<li>[3] 为了避免环路导致的网络拥塞，IP 报文头中包含一个生存时间 TTL (Time To Live) 字段，报文每经过一台<ins class=\"wavy\">三层设备，</ins>TTL 值减 1。初始 TTL 值由源端设备设置。当报文中的 TTL 降为 0 时，报文会被丢弃。同时，丢弃报文的设备会根据报文头中的源 IP 地址向源端发送 ICMP 错误消息。</li>\n</ul>\n<p class=\"red\">19，协议号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6Gjy8g.png\" alt=\"图片\"></li>\n<li>[2] 目的端的网络层在接受并处理报文之后，需要决定下一步对报文该做如何的处理。IP 报文头部中的协议字段标识了将会继续处理报文的协议。与以太帧头部中的 Type 字段类似，协议字段也是一个十六进制数，该协议可以标识网络层协议，如，ICMP (因特网控制报文协议)，也可以标识上层协议，如，TCP (传输控制协议，对应值 0x06)，UDP (用户数据包协议，对应值 0x11)</li>\n</ul>\n<p class=\"red\">20，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 子网掩码的专用是什么？</li>\n<li>32 位的 IP 子网掩码用于区分 IP 地址中的网络号和主机号，网络号表示网络或子网，主机号表示网络或子网中的主机。</li>\n<li>[2] IP 报文头部中 TTL 字段的作用是什么？</li>\n<li>如果网络中存在环路，则 IP 报文可能会在网络中循环而无法达到目的端，TTL 字段限定了 IP 报文的生存时间，保证无法到达目的端口的报文最终被丢弃。</li>\n<li>[3] 网关的作用是什么？</li>\n<li>网关是指接收并处理本地网段主机发送出来的报文并转发到目的网段的设备。</li>\n</ul>\n<h1 id=\"第四章icmp协议\"><a class=\"anchor\" href=\"#第四章icmp协议\">#</a> 第四章【ICMP 协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>Internet 控制消息协议 ICMP (Internet Control Message Protocol) 是网络层的一个重要协议。</li>\n<li>ICMP 协议用来在网络设备间传递各种差错和控制信息，并，<ins class=\"wavy\">对于收集各种网络信息，诊断和排除各种网络故障等方面起着至关重要的作用。</ins></li>\n<li>使用基于 ICMP 的应用时，需要对 ICMP 的工作原理非常熟悉。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，ICMP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JCwQO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ICMP 用来传递差错，控制，查询等信息。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP 是 TCP/IP 协议族的核心协议之一，它用于在 IP 网络设备之间发送控制报文，传递差错，控制，查询等消息。</ins></li>\n</ul>\n<p class=\"red\">2，ICMP 重定向：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JPQht.png\" alt=\"图片\"></li>\n<li>[2] ICMP Redirect 重定向消息用于支持路由功能。</li>\n<li>[3]<ins class=\"wavy\"> 上图，主机 A 希望发送报文到服务器 A，于是根据配置的默认网关地址向网关 RTB 发送报文，网关 RTB 收到报文后，检查报文信息，发现报文应该转发到与源主机在同一网段的另一个网关设备 RTA，因为此转发路径是更优的路径，所以 RTB 会向主机发送一个 Redirect 消息，通知主机直接向另一个网关 RTA 发送该报文，主机收到 Redirect 消息后，会向 RTA 发送报文，然后 RTA 会该报文再转发给服务器 A。</ins></li>\n</ul>\n<p class=\"red\">3，ICMP 差错检测：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JENYd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ICMP Echo Requests 和 ICMP Echo Reply 分别用来查询和响应某些消息，进行差错检测。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP Echo 消息常用于诊断源和目的地之间的网络连通性，同时，还可以提供其他信息，如报文往返时间等。</ins></li>\n</ul>\n<p class=\"red\">4，ICMP 错误报告：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JVrg1.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当网络设备无法访问目标网络时，会自动发送 ICMP 目的不可达报文到发送端设备。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP 定义了各种错误消息，用于诊断网络连通性问题，根据这些错误消息，源设备可以判断出数据传输失败的原因。</ins></li>\n<li>[3]<ins class=\"wavy\"> 比如，如果网络中发生了环路，导致报文在网络中循环，且最终 TTL 超时，这种情况下网络设备会发送 TTL 超时消息个发送端设备。</ins></li>\n<li>[4]<ins class=\"wavy\"> 又比如，如果目的地址不可达，则中间的网络设备会发送目的不可达的消息给发送端设备。</ins></li>\n<li>[5]<ins class=\"wavy\"> 目的不可达的情况有多种，如果是网络设备无法找到目的网络。则发送目的网络不可达消息，如果是网络设备无法找到目的网络中的目的主机，则发送目的主机不可达消息。</ins></li>\n</ul>\n<p class=\"red\">5，ICMP 数据包格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JKmBq.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同消息。</ins></li>\n<li>[2] ICMP 消息封装在 IP 报文中。<ins class=\"wavy\">ICMP 消息的格式取决于 Type 和 Code 字段。其中 Type 字段为消息类型，Code 字段包含该消息类型的具体参数。</ins></li>\n<li>[3]<ins class=\"wavy\"> 后面的校验和字段用于检测消息是否完整，消息中包含 32 比特的可变参数，这个字段一般不使用，通常设置为 0。在 ICMP Redirect 消息中，这个字段用来指定网关 IP 地址，主机根据这个地址将报文重定向到指定网关。</ins></li>\n<li>[4]<ins class=\"wavy\"> 在 Echo 请求消息中，这个字段包含标识符和序号，源端根据这两个参数将收到的回复消息与本端发送的 Echo 请求消息进行关联，尤其是当源端向目的端发送多个 Echo 请求消息时，需要根据标识符和序号将 Echo 请求和回复消息进行一一对应。</ins></li>\n</ul>\n<p class=\"red\">6，ICMP 消息类型和编码类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JNBjK.png\" alt=\"图片\"></li>\n<li>[2] ICMP 定义了多种消息类型，并用于不同的场景，这些消息不需要 Code 字段来描述具体的类型参数，仅用 Type 字段表示消息类型，比如，ICMP Echo 回复消息的 Type 字段设置为 0。</li>\n<li>[3]<ins class=\"wavy\"> 有些 ICMP 消息使用 Type 字段定义消息大类，用 Code 字段表示消息的具体类型。比如，类型为三的消息表示目的不可达，不同的 Code 值表示不可达的原因，包括目的网络不可达 (Code=0)，目的主机不可达 (code=1), 协议不可达 (Code=2)，目的 TCP/UDP 端口不可达 (Code=3) 等。</ins></li>\n</ul>\n<p class=\"wavy\">7，ICMP 应用 - Ping (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6YVbwT.png\" alt=\"图片\"></li>\n<li>[2] ICMP 的一个典型应用时 Ping，Ping 是检测网络连通性的常用工具，同时也能收集其他相关信息。</li>\n<li>[3] 用户可以在 Ping 命令中指定不同的参数，如 ICMP 报文长度，发送的 ICMP 报文个数，等待回复相应的超时时间等，设备根据配置的参数来构造并发送 ICMP 报文，进行 Ping 测试。</li>\n<li>[4] Ping 常用的配置参数说明如下：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①：-a source-ip-address指定发送ICMP ECHO—REQUEST报文的源IP地址。如果不指定源IP地址，将采用出接口的IP地址作为ICMP ECHO—REQUEST报文发送的源地址。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②：-c count 指定发送ICMP ECHO—REQUEST报文次数，缺省情况下发送5个ICMP ECHO-REQUEST报文。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③：-h ttl-value指定TTL的值，缺省值是255。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④：-t <span class=\"token function\">time</span> out指定发送完ICMP ECHO-REQUEST后，等待ICMP ECHO-<span class=\"token environment constant\">REPLY</span>的超时时间。</pre></td></tr></table></figure><p class=\"red\">8，ICMP 应用 - Ping (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6Ym0W4.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> Ping 命令的输出信息中包括目的地址，ICMP 报文长度，序号，TTL 值以及往返时间。</ins></li>\n<li>[3]<ins class=\"wavy\"> 序号是包含在 Echo 回复消息 (Type=0) 中的可变参数字段，TTL 和往返时间包含在消息的 IP 头中。</ins></li>\n</ul>\n<p class=\"red\">9，ICMP 应用 - Tracert (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6YDV6s.png\" alt=\"图片\"></li>\n<li>[2] ICMP 的另一个典型的应用是 Tracrt，<ins class=\"wavy\">Traceret 基于报头中的 TTL 值来逐跳跟踪报文的转发路径。</ins></li>\n<li>[3] 为了跟踪到达某特定目的地址的路径，源端首先将报文的 TTL 值设置为 1，该报文到达第一个节点后，TTL 超时，于是该字节向源端发送 TTL 超时消息，消息中携带时间戳。然后源端将报文的 TTL 值设置为 2，报文到达第二个节点超时后，该节点同样返回 TTL 超时消息，以此类推，直到报文到达目的地。这样，源端根据返回的报文中的消息可以跟踪到报文经过的每一个节点，并根据时间戳信息计算往返时间，Tracert 是检测网络丢包及时延的有效手段，同时可以帮助管理员发现网络中的路由环路。</li>\n<li>[4] Tracertc 常用的配置参数说明如下：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①：-a source-ip-address指定Tracert报文的源地址。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②：-f first-ttl指定初始TTL，缺省值是1。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③：-m max-ttl指定最大TTL，缺省值是30。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④：-name使能显示每一跳的主机名。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>⑤：-p port指定目的主机的UDP端口。</pre></td></tr></table></figure><p class=\"red\">10，ICMP 应用 ——Tracert (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6YyqHI.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> 注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同信息。</ins></li>\n<li>[3] 上图，源端 (RTA) 向目的端 (主机 B) 发送一个 UDP 报文，TTL 值为 1，目的 UDP 端口号是大于 30000 的一个数，因此在大多数情况下，大于 30000 的 UDP 端口号是任何一个应用程序都不可能使用的端口号。</li>\n<li>[4] 第一跳 (RTB) 接收到源端发送的 UDP 报文后，判断出报文的目的 IP 地址不是本机 IP 地址，将 TTL 减一后，判断出 TTL 值等于 0，将丢弃报文并向源端发送一个 ICMP 超时 (Time Exceeded) 报文。(该报文中含有第一跳的 IP 地址 10.0.0.2)，这样源端就得到了 RTB 的地址。</li>\n<li>[5] 源端收到 RTB 的 ICMP 超时报文后，再次向目的端发送一个 UDP 报文，TTL 值为 2。</li>\n<li>[6] 第二跳 (RTC) 收到源端发送出的 UDP 报文后，回应一个 ICMP 超时报文，这样源端就得到了 RTC 的地址 (20.0.0.2)</li>\n<li>[7] 以上过程不断进行，直到目的端收到收到源端发送的 UDP 报文，判断出目的 IP 地址是本机 IP 地址，则处理此报文，根据报文中目的 UDP 端口号寻找占用此端口号的上层协议。因目的端没有应用程序使用该 UDP 端口号，则向源端返回一个 ICMP 不可达 (Destination Unreachable) 报文。</li>\n<li>[8] 源端收到 ICMP 端口不可达报文后，判断出 UDP 报文已经到达目的端。则停止 Tracert 程序，从而得到数据报文从源端到目的端所经历的路径 (10.0.0.2,20.0.0.2,30.0.0.2)。</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] Ping 使用的是哪两类 ICMP 消息？</li>\n<li>Ping 利用 ICMP Echo 请求消息 (Type 值为 0) 来发起检测目的可达性，目的端收到 ICMP Echo 请求消息后，根据 IP 报头中的源地址向源端发送 ICMP Echo 回复消息 (Type 值为 0)。</li>\n<li>[2] 当网络设备收到 TTL 值为 0 的报文时，会如何操作？</li>\n<li>如果 IP 数据包在到达目的地之前 TTL 值已经将为 0，则收到 IP 数据包的网络设备会丢弃该数据包，并向源端发送 ICMP 消息通知源端 TTL 超时。</li>\n</ul>\n<h1 id=\"第五章arp协议\"><a class=\"anchor\" href=\"#第五章arp协议\">#</a> 第五章【ARP 协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>当网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址 (即 IP 地址)。</li>\n<li>IP 地址由网络层来提供，但是仅有 IP 地址是不够的，IP 数据报文必须封装成帧才能通过数据链路层进行发送。</li>\n<li>数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址，通过目的 IP 地址来获取目的 MAC 地址的过程是由 ARP (Address Resolution Protocol) 协议来实现的。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NKKYV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据链路层在进行数据封装时，需要目的 MAC 地址。</ins></li>\n<li>[2] 一个网络设备要发送数据给另一个网络设备时，必须要知道对方的 IP 地址，但是仅有 IP 地址是不够的，因为 IP 数据报文必须封装成帧才能通过数据链路层进行发送，而数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址。</li>\n<li>[3] 每一个网络设备在数据封装前都需要获取下一跳的 MAC 地址。</li>\n<li>[4] IP 地址由网络层提供，MAC 地址通过 ARP 协议来获取。</li>\n<li>[5] ARp 协议是 TCP/IP 协议族中的重要组成部分，它能够通过目的 IP 地址获取目标设备的 MAC 地址，从而实现数据链路层的可达性。</li>\n</ul>\n<p class=\"red\">2，ARP 数据包格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NQV5q.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARP 报文不能穿越路由器，不能被转发到其他广播域。</ins></li>\n<li>[2] 网络设备通过 ARP 报文来发现目的 MAC 地址，ARP 报文中包含以下字段：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Hard Type表示硬件地址类型，一般为以太网。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Protocol Type表示三层协议地址类型，一般为IP。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Hard Length和Protocol Length为MAC地址和IP地址的长度，单位是字节。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Operation Code指定了ARP报文的类型，包括ARP Requested和ARP Reply。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Source Hardware Address指的是发送ARP报文的设备MAC地址。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Source Protocol Address指的是发送ARP报文的设备IP地址。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Destination Hardware Address指的是接收者MAC地址，在ARP Request报文中，该字段为0。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Destination Protocol Address指的是接收者的IP地址。</pre></td></tr></table></figure><p class=\"red\">3，ARP 工作过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N1s8P.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机 A 发送一个数据包给主机 C 之前，首先要获取主机 C 的 MAC 地址。</ins></li>\n<li>[2] 通过 ARP 协议，网络设备可以建立目标 IP 地址和 MAC 地址之间的映射，网络设备通过网络层获取到目的 IP 地址之后，还要判断目的 MAC 地址是否已知。</li>\n</ul>\n<p class=\"red\">4，ARP 缓存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N3nRP.png\" alt=\"图片\"></li>\n<li>[2] 网络设备一般都有一个 ARP 缓存 (ARP Cache)，<ins class=\"wavy\">ARP 缓存用来存放 IP 地址和 MAC 地址的关联信息。</ins></li>\n<li>[3] 在发送数据之前，设备会先检查 ARP 缓存表，如果缓存表中存在对方设备的 MAC 地址，则直接采用该 MAC 地址来封装帧，然后将帧发送出去，如果缓存表中不存在相应信息，则通过发送<ins class=\"wavy\"> ARP Request</ins> 报文来获取它。</li>\n<li>[4] 学习到的 IP 地址和 MAC 地址的映射关系会被放入 ARP 缓存表中存放一段时间，在有效时间内，设备可以直接从这个表中查找目的 MAC 地址来进行数据封装，而无需进行 ARP 查询，过了这段有效期，ARP 表项会被自动删除。</li>\n<li>[5] 如果目标设备位于其他网络，则源设备会在 ARP 缓存表中查找网关的 MAC 地址，然后将数据发送给网关，网关再把数据转发给目的设备。</li>\n</ul>\n<p class=\"red\">5，ARP 请求：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NGpnO.png\" alt=\"图片\"></li>\n<li>[2] 上图，主机 A 的 ARP 缓存表中不存在主机 C 的 MAC 地址，所以主机 A 会发送 ARP Request 来获取目的 MAC 地址。</li>\n<li>[3] ARP Request 报文封装在以太帧里，帧头中的源 MAC 地址为发送端主机 A 的 MAC 地址，此时，由于主机 A 不知道主机 C 的 MAC 地址，所以目的 MAC 地址为广播地址 FF-FF-FF-FF-FF-FF。</li>\n<li>[4] ARP Request 报文中包含源 IP 地址，目的 IP 地址，源 MAC 地址，目的 MAC 地址，其中目的 MAC 的值为 0，ARP Request 报文会在整个网络上传播，该网络上的所有主机包括网关都会接收到此 ARP Request 报文。</li>\n<li>[5]<ins class=\"wavy\"> 网关将会阻止该报文发送到其他网络上。</ins></li>\n</ul>\n<p class=\"red\">6，ARP 响应 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NYIjP.png\" alt=\"图片\"></li>\n<li>[2] 所有的主机接收到该 ARP Request 报文之后，都会检查它的目的协议地址字段与本身的 IP 地址是否匹配。如果不匹配，则该主机将不会响应该 ARP Request 报文，如果匹配，则该主机会将 ARP 报文中的源 MAC 地址和源 IP 地址信息记录到自己的 ARP 缓存表中，然后通过 ARP Reply 报文进行相应。</li>\n</ul>\n<p class=\"red\">7，ARP 响应 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6Ntk4J.png\" alt=\"图片\"></li>\n<li>[2] 主机 C 会向主机 A 回应 ARP Reply 报文，ARP Reply 报文中的源协议地址是主机 C 自己的 IP 地址，目标协议地址是主机 A 的 IP 地址，目的 MAC 地址是主机 A 的 MAC 地址，源 MAC 地址是自己的 MAC 地址，同时 Operation Code 被设置为 Reply。</li>\n<li>[3] ARP Reply 报文通过单播传输。</li>\n</ul>\n<p class=\"red\">8，ARP 缓存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NNuzn.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 收到 ARP Reply 以后，会检查 ARP 报文中目的 MAC 地址是否与自己的 MAC 匹配，如果匹配，ARP 报文中的源 IP 地址和源 MAC 地址会被记录到主机 A 的 ARP 缓存表中。</li>\n</ul>\n<p class=\"red\">9，ARP 代理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图:</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NUPfJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：同一网段，不同物理网络上的计算机之间，可以通过 ARP 代理实现相互通信。</ins></li>\n<li>[2] 上图组网中，主机 A 需要与主机 B 通信，目的 IP 地址与本机的 IP 地址在同一个网段，所以 A 将会以广播形式发送 ARP Request 报文请求主机 B 的 MAC 地址，但是，广播报文无法被路由器转发，所以主机 B 无法收到主机 A 的 ARP 请求报文，当然也就无法应答。</li>\n<li>[3] 在路由器上启用代理 ARP 功能，就可以解决这个问题，启用代理 ARP 后，路由器收到这样的请求，会查找路由表，如果存在主机 B 的路由表项，路由器将会使用自己的 G0/0/0 接口的 MAC 地址来回应 ARP Request，主机 A 收到 ARP Reply 后，将以路由器的 G0/0/0 接口的 MAC 地址作为目的 MAC 地址进行数据转发。</li>\n</ul>\n<p class=\"red\">10，免费 ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：免费 ARP 可以用来探测 IP 地址是否冲突。</ins></li>\n<li>[2] 主机被分配了 IP 地址或者 IP 地址发生变更后，必须立刻检测其所分配的 IP 地址在网络上是否是唯一的，以避免地址冲突，<ins class=\"wavy\">主机通过发送 ARP Request 报文来进行地址冲突检测。</ins></li>\n<li>[3] 主机 A 将 ARP Request 广播报文中的目的 IP 地址字段设置为自己的 IP 地址，且该网络中所有主机包括网关都会接收到此报文。当目的 IP 地址已经被某一个主机或网关使用时，该主机或者网关就会回应 ARP Reply 报文，通过这种方式，主机 A 就能探测到 IP 地址冲突了。</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 网络设备在什么情况下会发送 ARP Request？</li>\n<li>源设备在发送数据给目的设备前，会首先查看自身的 ARP 缓存，查找 ARP 缓存中是否存在目的设备的 IP 地址和 MAC 地址的映射，如果存在则直接使用，如果不存在则会发送 ARP Request。</li>\n<li>[2] 网络设备什么时候会产生免费 ARP？</li>\n<li>当网络上的一个设备被分配了 IP 地址或者 IP 地址发生变更后，可以通过免费 ARP 来检测 IP 地址是否冲突。</li>\n</ul>\n<h1 id=\"第六章传输层协议\"><a class=\"anchor\" href=\"#第六章传输层协议\">#</a> 第六章【传输层协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>传输层定义了主机应用程序之间端到端的连通性，传输层最为常见的两个协议分别是传输控制协议 TCP (Transmission Control Protocol) 和用户数据包协议 UDP (User datagram Protocol)。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，TCP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N06xJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：TCP 是一种面向连接的传输层协议，可提供可靠的传输服务。</ins></li>\n<li>[2] TCP 位于 TCP/IP 模型的传输层，它是一种面向连接的端到端协议。</li>\n<li>[3] TCP 作为传输控制协议，可以为主机提供可靠的数据传输，上图，在通信之前，需要 TCP 在他们之间建立可靠的传输通道。</li>\n</ul>\n<p class=\"red\">2，TCP 端口号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NBmJU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：端口号用来区分不同的网络服务。</ins></li>\n<li>[2] TCP 允许一个主机同时运行多个应用进程，m 每台主机可以拥有多个应用端口，每对端口号，源和目标 IP 地址的组合唯一的标识了一个会话。</li>\n<li>[3] 端口分为知名端口和动态端口，<ins class=\"wavy\">有些网络服务会使用固定的端口，这类端口称为知名端口，端口范围为 0-1023。如，FTP，HTTP，Telnet，SNMP 服务均使用知名端口。</ins></li>\n<li>[4]<ins class=\"wavy\"> 动态端口范围从 1024-65535，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。</ins></li>\n</ul>\n<p class=\"wavy\">3，TCP 头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NrECT.png\" alt=\"图片\"></li>\n<li>[2] TCP 通常使用 IP 作为网络层协议，这时 TCP 数据段被封装在 IP 数据包内。</li>\n<li>[3] TCP 数据段由 TCP Header (头部)，和 TCP Data (数据) 组成，TCP 最多可以有 60 个字节的头部，如果没有 Options 字段，正常的长度是 20 字节。</li>\n<li>[4] TCP Header 是由上图标识的一些字段组成这里列出几个常用字段：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①16位源端口号：源主机的应用程序使用的端口号。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②16位目的端口号：目的主机的应用程序使用的端口号。每个TCP头部都包含源和目的端的端口号，这两个值加上IP头部中的源IP地址和目的IP地址可以唯一确定一个TCP连接。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③32位序列号：用于标识从发送端发出的不同的TCP数据段的序号，数据段在网络中传输时，他们的顺序可能会发生变化，接收端依据此序列号，便可按照正确的顺序重组数据。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④32位确认序列号：用于标识接收端确认收到的数据段，确认序列号为成功收到的数据数列号加1.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>⑤4位头部长度：表示头部占用32bit字的数目，它能表达的TCP头部最大长度为60字节。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>⑥16位窗口大小：表示接收端期望通过单次确认而收到的数据的大小，由于该字段为16位，所以窗口大小的最大值为65535字节，该字节通常用来进行流量控制。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>⑦16位校验和：校验整个TCP报文段，包括TCP头部和TCP数据，该值由发送端计算和记录并由接收端进行验证。</pre></td></tr></table></figure><p class=\"red\">4，TCP 建立连接的过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6NsgfK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：TCP 通过三次握手建立可靠连接。</ins></li>\n<li>[2] TCP 是一种可靠的，面向连接的全双工传输层协议。</li>\n<li>[3] TCP 连接的建立是一个三次握手的过程，如图所示：</li>\n<li>[4] 主机 A (通常也称为客户端) 发送一个标识了 SYN 的数据段，表示期望与服务器 A 建立连接，此数据段的序列号 (seq) 为 a。</li>\n<li>[5] 服务器 A 回复了标识了 SYN+ACK 的数据阶段，此数据段的序列号 (seq) 为 b，确认序列号为主机 A 的序列号加 1 (a+1)，以此作为对主机 A 的 SYN 报文确认。</li>\n<li>[6] 主机 A 发送一个标识了 ACK 的数据段，此数据段的序列号 (seq) 为 a+1，确认序列号为服务器 A 的序列号加 1 (b+1)，以此作为对服务器 A 的 SYN 报文的确认。</li>\n</ul>\n<p class=\"red\">5，TCP 的传输过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6aPmi4.png\" alt=\"图片\"></li>\n<li>[2] TCP 的可靠传输还体现在 TCP 使用了确认技术来确保目的设备收到了从源设备而发来的数据。并且是正确无误的。</li>\n<li>[3] 确认技术的工作原理如下：</li>\n<li>目的设备接收到源设备发送的数据段时，会向源端发送确认报文，源设备收到确认报文后，继续发送数据段，如此重复。</li>\n<li>[4] 上图，主机 A 向服务器 A 发送 TCP 数据段，假定每个数据段的长度都是 500 个字节。当服务器 A 成功收到序列号是 M+1499 字节以及之前的所有字节时，会以序列号 M+1499+1=M+1500 进行确认。另外，由于数据段 N+3 传输失败，所以服务器 A 未能收到序列号为 M+1500 的字节，因此服务器 A 还会再次以序列号 M+1500 进行确认。</li>\n</ul>\n<p class=\"red\">6，TCP 流量控制：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6ai1pj.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> TCP 滑动窗口技术通过动态改变窗口大小来实现对端到端设备之间的数据进行流量控制。</ins></li>\n<li>[3] 上图，主机 A 和服务器 A 之间通过滑动窗口来实现流量控制，为方便理解，上图只考虑主机 A 发送数据给服务器 A 时，服务器 A 通过滑动窗口进行流量控制。</li>\n<li>[4] 主机 A 向服务器发送 4 个长度为 1024 字节的数据段，其中主机的窗口大小为 4096 个字节。服务器 A 收到第三个数据段后，缓存区满。第四个数据段被丢弃，服务器以 ACK 3073 响应，窗口大小调整为 3072，表明服务器的缓冲区只能处理 3072 个字节的数据段，于是主机 A 改变其发送的速率，发送窗口大小为 3072 的数据段。</li>\n</ul>\n<p class=\"red\">7，TCP 关闭连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6aFUKI.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机在关闭连接之前，要确认收到来自对方的 ACK。</ins></li>\n<li>[2] TCP 支持全双工模式传输数据，这意味着同一时刻两个方向都可以进行数据的效数据的传输，在传输数据之前，TCP 通过三次握手建立的实际上是两个方向的连接，因此，在传输完毕之后，两个方向的连接必须都关闭。</li>\n<li>[3]<ins class=\"wavy\"> TCP 的建立是一个三次握手的过程，而 TCP 连接的终止则要经过四次握手。</ins></li>\n<li>[4] 如上图：</li>\n<li><ins class=\"wavy\">主机 A 想要终止连接，于是发送了一个标识了 FIN，ACK 的数据段，序列号为 a，确认序列号为 b。</ins></li>\n<li><ins class=\"wavy\">服务器 A 回应了一个标识了 ACK 的数据段，序列号为 b，确认序号为 a+1，作为对主机 A 的 FIN 报文的确认。</ins></li>\n<li><ins class=\"wavy\">服务器 A 想要终止连接，于是向主机 A 发送了一个标识了 FIN，ACK 的数据段，序列号为 b，确认序列号为 a+1。</ins></li>\n<li><ins class=\"wavy\">主机 A 回应了一个 ACK 的数据段，序列号为 a+1，确认序列号为 b+1，作为对服务器 A 的 FIN 报文的确定。</ins></li>\n<li>[5] 以上四次交互便完成了两个方向连接的关闭。</li>\n</ul>\n<p class=\"red\">8，UDP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a4rK1.png\" alt=\"图片\"></li>\n<li><ins wavy>注：UDP 是一种面向无连接的传输层协议，传输可靠性没有保障。</ins></li>\n<li>[2] 当应用程序对传输的可靠性要求不高时，但是对传输速度和延迟要求较高时，可以用 UDP 协议来代替 TCP 协议在传输层控制数据的转发。</li>\n<li>[3] UDP 将数据从源端发送到目的端时，无需事先建立连接。</li>\n<li>[4] UDP 采用了简单，易操作的机制在应用程序之间传输数据，没有使用 TCP 中的确认技术或滑动窗口机制，因此，UDP 不能保证数据传输的可靠性，也无法避免接收到重复数据的情况。</li>\n</ul>\n<p class=\"red\">9，UDP 头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a4TqP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：UDP 头部仅占 8 字节，传输数据时没有确认机制。</ins></li>\n<li>[2] UDP 报文分为 UDP 报文头和 UDP 数据两部分。报头由源端口，目的端口，报文长度以及校验和组成，UDP 适合于实时数据的传输，如语音和视频通信。</li>\n<li>[3] 相比于 TCP，UDP 的传输效率更高，开销更小，但是无法保证数据传输的可靠性。</li>\n<li>[4] UDP 头部的标识如下：</li>\n<li>16 位源端口号：源主机的应用程序使用的端口号。</li>\n<li>16 位目的端口号：目的主机的应用程序使用的端口号。</li>\n<li>16 位 UDP 长度：是指 UDP 头部和 UDP 数据的字节长度，因为 UDP 头部长度为 8 字节，所以该字节的最小值为 8。</li>\n<li>16 位 UDP 校验和：该字节提供了与 TCP 校验字段同样的功能，该字段是可选的。</li>\n</ul>\n<p class=\"red\">10，UDP 的传输过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a5CZV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：使用 UDP 传输数据时，由应用程序根据需要提供报文到达确认，排序，流量控制等功能。</ins></li>\n<li>[2] 主机 A 发送数据包时，这些数据包是以有序的方式发送到网络中的，每个数据包独立地在网络中被发送，所以不同的数据包可能会通过不同的网络路径到达主机 B。</li>\n<li>[3] 这样的情况下，先发的数据包不一定先到达主机 B，因为 UDP 数据包没有序号，主机 B 将无法通过 UDP 协议将数据包按照原来的顺序重新组合，所以此时需要应用程序提供报文的到达确认，排序和流量控制等功能。</li>\n<li>[4] 通常情况下，UDP 采用实时传输机制和时间戳来传输语音和视频数据。</li>\n</ul>\n<p class=\"red\">11，UDP 的传输过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a58RH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：UDP 不提供重传机制，占用资源小，处理效率高。</ins></li>\n<li><ins class=\"wavy\">注：一些时延敏感的流量，如语音，视频等，通常使用 UDP 作为传输协议。</ins></li>\n<li>[2] UDP 适合传输对时延敏感的流量，如，语音和视频。</li>\n<li>[3] 在使用 TCP 协议传输数据时，如果一个数据段丢失或者接收端对某个数据段没有确认，发送端会重新发送该数据段。</li>\n<li>[4] TCP 重新发送数据会带来延迟和重复数据，降低了用户体验。对于时延敏感的应用，少量的数据丢失一般可以被忽略，这时使用 UDP 传输将能够提升用户的体验。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] TCP 头部中的确认标识位由什么作用？</li>\n<li>TCP 报文头中的 ACK 标志位用于目的端对已收到数据的确认，目的端成功收到序列号为 X 的字节及之前的所有字节后，会以序列号 X+1 进行确认。</li>\n<li>[2] TCP 头部中有哪些标识位参与 TCP 三次握手？</li>\n<li>在 TCP 的三次握手过程中，要使用 SYN 和 ACK 标识位来请求建立连接和确认建立连接。</li>\n</ul>\n<h1 id=\"第七章数据转发过程\"><a class=\"anchor\" href=\"#第七章数据转发过程\">#</a> 第七章【数据转发过程】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>TCP/IP 协议族和底层协议配合，保证了数据能够实现端到端地连接。数据传输过程是一个非常复杂的过程，例如，数据在转发地过程中会进行一系列的封装和解封装。对于网络工程师来说，只有深刻地了解数据在各种不同设备上的转发过程，才能对网络进行正确的分析和检测。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，数据转发过程的概述：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6duWB4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据包在相同网段内或不同网段之间转发所依据的原理基本一致。</ins></li>\n<li>[2]<ins class=\"wavy\"> 数据可以在同一网络内或者在不同网络间传输，数据转发过程也分为本地转发和远程转发，但两者的数据转发原理是基本一致的，都是遵循 TCP/IP 协议族。</ins></li>\n<li>上图，主机 A 需要访问服务器 A 的 WEB 服务，并假设两者之间已经建立了 TCP 连接，接下来会以上图来讲解数据在不同网络间的传输过程。</li>\n</ul>\n<p class=\"red\">2，TCP 封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dKyad.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注当主机建立了到达目的地的 TCP 连接后，便开始对应用层数据进行封装。</ins></li>\n<li>[2]<ins class=\"wavy\"> 主机 A 会对待发送的应用数据首先执行加密和压缩等相关操作，之后进行传输层封装。</ins></li>\n<li>[3] Web 应用是基于传输层的 TCP 协议传输数据的，主机 A 使用 TCP 进行报文封装时，必须填充源端口和目的端口字段，初始序列号和确认序列号字段，标识位，窗口字段以及校验和字段。</li>\n<li>[4] 此列中，数据段的源端口号为主机 A 随机的 1027 号端口，目的端口号为服务器 A 的 TCP 知名端口 80。</li>\n</ul>\n<p class=\"wavy\">3，IP 封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dMDS0.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 完成传输层封装后，一般会进行网络层数据封装，在使用 IP 进行封装时，需要明确 IP 报文的源和目的地址，如果报文的大小大于网络的最大传输单元 (MTU)，则该报文有可能在传输过程中被分片。</li>\n<li>[3] 生存时间 (TTL) 字段用来减少网络环路造成的影响。ARG3 系列路由器产生的数据包，默认 TTL 值为 255，路由器转发一个数据包时，该值会被减一，如果路由器发现该值被减为 0，就会丢弃该数据包。这样，即使网络中存在环路，数据包也不会在网络上一直被转发。</li>\n<li>[4] 协议字段标识了传输层所使用的协议，本列中，传输层使用的是 TCP 协议，所以该字段的填充值为 0x06。</li>\n</ul>\n<p class=\"red\">4，查找路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dQ1AJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机 A 必须要拥有到达目的地的路由。</ins></li>\n<li>[2]<ins class=\"wavy\"> 每个主机都会独自维护各自的路由表项，主机 A 在发送数据前需要先检测是否能够到达目的端，这个过程是通过查找路由来完成的。</ins></li>\n<li>[3] 上图，主机 A 拥有一条到达 “任何网络” 的路由。它发往其他网络的数据都会通过 IP 地址为 10.1.1.1 的接口转发到下一跳，即网关 10.1.1.254。</li>\n</ul>\n<p class=\"red\">5，ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dlK2t.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：通过 ARP 缓存表找到下一跳的 MAC 地址。</ins></li>\n<li><ins class=\"wavy\">注：如果表项里没有下一跳的 MAC 地址，主机 A 会发送 ARP 请求。</ins></li>\n<li>[2] 接下来，由于数据包要被封装成数据帧，所以主机 A 需要获取下一跳的 MAC 地址，也就是网关的 MAC 地址，主机首先会查询 ARP 缓存表。上图，主机 A 的 ARP 缓存表中存在网关 MAC 地址的表项。</li>\n<li>[3]<ins class=\"wavy\"> 如果没有查找到网关的 MAC 地址表项，主机 A 会通过发送 ARP 请求来获取网关的 MAC 地址。</ins></li>\n</ul>\n<p class=\"red\">6，以太网封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6d1WkQ.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 在链路层封装数据帧时，会遵循 IEEE 802.3 或 Ethernet II 标准，Ethernet II 帧头中的类型字段填充为 0x0800，以表示网络层使用的是 IP 协议，源 MAC 地址为主机 A 的 MAC 地址，目的 MAC 地址为网关路由器的 E0/0 接口的 MAC 地址。</li>\n</ul>\n<p class=\"red\">7，数据帧转发过程：</p>\n<div class=\"note infojie'fu\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6d80Mt.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机工作在半双工模式下，所以会使用 CSMA/CD 来检测链路是否空闲。</ins></li>\n<li><ins class=\"wavy\">注：前导码用于使接收者进入同步状态，定界符用于指示帧的开始。</ins></li>\n<li>[2] 主机 A 工作在半双工模式下，所以会使用 CSMA/CD 里检测链路是否空闲，如果链路空闲，++ 主机 A 会将一个前导码 (Preamble) 和一个帧首定界符 (SFD) 附加到帧头然后进行传输。</li>\n<li>[3]<ins class=\"wavy\"> 前导码的作用是使接收设备进行同步并做好接收数据帧的准备。前导码是包括了 7 个字节的二进制 &quot;1&quot;,&quot;0&quot; 交替的代码，即 1010...10 共 56 位。</ins></li>\n<li>[4]<ins class=\"wavy\"> 帧首定界符是长度为 1 个字节的 10110101 二进制序列，它的作用是使接收端对帧的第一位进行定位。</ins></li>\n</ul>\n<p class=\"red\">8，数据帧转发过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dRyPH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每个冲突域里的设备都会收到主机 A 发送的数据帧。</ins></li>\n<li><ins class=\"wavy\">注：只有网关 (RTA) 会处理该数据帧，并继续转发。</ins></li>\n<li>[2] 上图，主机 A 发送数据帧到共享以太网，此网络中的所有设备都会收到数据帧。设备收到帧之后，首先会进行 FCS 校验，如果 FCS 未能通过，则帧被立即丢弃。</li>\n<li>[3] 对于通过了 FCS 校验的帧，设备会检察帧中的目的 MAC 地址，如果帧中的目的 MAC 地址与自己的 MAC 地址不同，设备将丢弃帧，如果相同，则会继续处理。</li>\n<li>[4] 在处理过程中，帧头帧尾会被剥去 (也就是解封装)，剩下的数据报文会被根据帧头中的类型字段的值来送到网络层中的对应协议模块去处理。</li>\n</ul>\n<p class=\"red\">9，数据帧转发过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6doKfS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网关检查是否具有到达目的网络的路由条目。</ins></li>\n<li><ins class=\"wavy\">注：如果存在转发路径，则为数据包添加一个新的二层帧头和帧尾，并继续转发。</ins></li>\n<li>[2] RTA 收到此数据报文后，网络层会对该报文进行处理。RTA 首先根据 IP 头部信息中的校验和字段，检查 IP 数据报文头部的完整性，然后根据目的 IP 地址查看路由表，确定是否能够将数据包转发到目的端。RTA 还必须对 TTL 的值进行处理，另外，报文大小不能超过 MTU 值。如果报文大小超过 MTU 值，则报文将被分片。</li>\n<li>[3] 网络层处理完成之后，报文将被收到数据链路层重新进行封装，成为一个新的数据帧，该帧的头部会封装新的源 MAC 地址和目的 MAC 地址，如果当前设备不知道下一跳的 MAC 地址，将会使用 ARP 来获得。</li>\n</ul>\n<p class=\"red\">10，数据包解封装 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wtRIK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：服务器 A 检查数据包的目的 IP 地址，发现目的 IP 与自己的 IP 地址相同。</ins></li>\n<li><ins class=\"wavy\">注：服务器 A 剥掉数据包的 IP 报头后，会往上层协议 TCP 继续进行处理。</ins></li>\n<li>[2] 服务器 A 通过 IP 协议来处理该报文，首先会通过校验和字段来验证报文头的完整性，然后检查 IP 报文头中的目的 IP 地址是否与自己当前的 IP 地址匹配。</li>\n<li>[3] 如果在源和目的之间的数据传输期间数据发生了报文分片，则报文会被目的端重新组合。标识字段用于标识属于同一数据源的分片报文，偏移量标识该分片在源分组中的相对位置。</li>\n<li>[4] 标志字段目前只有两位有意义，标志字段最低位为 1，表示后面还有分片，为 0 表示这已经是最后一个数据片，中间一位为 1 表示不能分片，为 0 表示可以分片。所有的分片报文必须被目的端全部接收到后才能进行重新组合。</li>\n<li>[5] 协议字段表示此数据包携带的上层数据是上层数据的哪种协议的数据，需要注意的是，下一个报头并非总在传输层报头，例如，ICMP 报文也是使用 IP 协议封装，协议字段值为 0x01。</li>\n</ul>\n<p class=\"red\">11，数据段解封装 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wUA0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：服务器 A 检查 TCP 头部的目的端口，然后将数据段发送给应用层的 HTTP 协议进行处理。</ins></li>\n<li>[2] 当 IP 报文头被处理完并剥离后，数据段会被发送到传输层进行处理。</li>\n<li>[3] 上图，传输层协议使用的是 TCP，且发送端和接收端已经通过三次握手建立了连接。</li>\n<li>[4] 传输层收到该数据段后，TCP 协议会查看并处理该数据段头部信息，其中目的端口号为 80，用于表示处理该数据的应用层协议为 HTTP 协议。</li>\n<li>[5] TCP 处理完头部信息后会将此数据段头部进行剥离，然后将剩下的应用数据发送到 HTTP 协议进行处理。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 数据在进行二层和三层封装之前，主机需要了解哪些信息？</li>\n<li>主机在封装数据包之前，必须要知道目的端 IP 地址，在封装数据帧之前，必须要知道去往目的网络的路由以及下一跳的 MAC 地址。</li>\n<li>[2] 当数据帧发送到非目的主机时，非目的主机将会如何处理？</li>\n<li>如果主机接收到一个不是发往自己的数据帧，在检验帧头中的目的 MAC 地址之后会丢弃该帧。</li>\n<li>[3] 传输层如何能够准确的将数据交给特定应用？</li>\n<li>传输层会检查 TCP 或 UDP 报文头中的目的端口号，以此来识别特定应用。</li>\n<li>[4] 当两台主机同时访问服务器的 HTTP 服务，该服务器如何区分数据属于哪个会话？</li>\n<li>服务器可以只通过源 IP 地址识别两台主机的 HTTP 流量，另外 TCP 报文头中包含的源端口也可以被用来区分同一台主机通过不同的浏览器发起的不同的会话。例如，两个来自源 IP 为 10.1.1.1 的 HTTP 流量使用的目的端口号都是 80，但源端口号为 1028 和 1035。</li>\n</ul>\n<h1 id=\"第八章vrp基础\"><a class=\"anchor\" href=\"#第八章vrp基础\">#</a> 第八章【VRP 基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>交换机可以隔离冲突与，路由器可以隔离广播域。这两种设备在企业网络中应用越来越广泛，随着越来越多的终端接入到网络中，网络设备的负担也越来越重，这时网络设备可以通过华为专有的 VRP 系统来提升运行效率。</li>\n<li>通用路由平台 VRP (Versatile Routing Platform) 是华为公司数据通信产品的通用操作系统，它以 IP 业务为核心，采用组件化的体系结构，在实现丰富功能特性的同时，还提供了基于应用的可裁剪和可拓展的功能，使得路由器和交换机的运行效率大大增加，能对 VRP 熟练地进行配置和操作是对网络工程师的一种基本要求。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，交换机的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wwYNt.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：如果使用 Hub，则主机 A 发送数据时，其他主机都不能发送数据，否则会发送冲突。使用交换机时，则不会出现这种现象。</ins></li>\n<li>[2] 由集线器 [HUB] 和中继器组建的以太网，实质上是一种共享式以太网，共享式以太网的主要缺陷有：<ins class=\"wavy\">冲突严重，广播泛滥，安全性差。</ins></li>\n<li>[3] 交换机是工作在数据链路层的设备，交换机可以将一个共享式以太网分割为多个冲突域，链路层流量被隔离在不同的冲突域中进行转发，如此便极大地提升了以太网的性能。</li>\n<li>[4] 更进一步说，通常主机和交换机之间以及交换机与交换机之间都使用全双工技术进行通信，这时冲突现象会被彻底消除。</li>\n<li>[5] 上图，由 HUB 搭建的网络中，所有的主机都处于同一个冲突域，主机 A 在发送数据给主机 B 时，其他主机都将收到此数据，但同时这些主机都不能发送数据。</li>\n<li>[6] 用交换机替代 HUB 后，因为交换机分割了冲突域，所以在主机 A 发送数据给主机 B 时，主机 C 和主机 D 之间也可以同时互相发送数据。</li>\n</ul>\n<p class=\"red\">2，路由器的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wDyEd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器可以分割广播域。</ins></li>\n<li>[2] 交换机虽然可以隔离冲突域，但是当一台设备发送广播帧时，其他设备仍然都会收到该广播帧，随着网络规模的增大，广播会越来越多，这样就会影响网络的效率，路由器可以用来分割广播域，减少广播对网络效率的影响。</li>\n<li>[3]<ins class=\"wavy\"> 一般情况下，广播帧的转发被限制在广播域内，广播域的边缘是路由器，因为，通常路由器不会转发广播帧。</ins></li>\n<li>[4] 路由器负责在网络间转发报文，它能够在自身的路由表里查找到达目的地的下一跳地址，将报文转发给下一跳路由器，如此重复，并最终将报文送达目的地。</li>\n</ul>\n<p class=\"red\">3，VRP 介绍：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w6Ax0.png\" alt=\"图片\"></li>\n<li>[2] VRP 是华为公司具有完全自主知识产权的网络操作系统，可以运行在多种硬件平台上，VRP 拥有一致的网络界面，用户界面和管理界面，为用户提供了灵活丰富的应用解决方案。</li>\n<li>[3] VRP 平台以 TCP/IP 协议族为核心，实现了数据链路层，网络层和应用层的多种协议，在操作系统中集成了路由交换技术，Qos 技术，安全技术和 IP 语音技术等数据通信功能。并以<ins class=\"wavy\"> IP 转发引擎技术为基础。</ins>为网络设备提供了出色的数据转发能力。</li>\n</ul>\n<p class=\"red\">4，VRP 的发展：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w6oQ0.png\" alt=\"图片\"></li>\n<li>[2] 随着网络技术和应用的飞速发展，VRP 平台在处理机制，业务能力，产品支持等方面也在持续演进。到目前为止，VRP 以及开发出了五个版本，分别是 VRP1，VRP2，VRP3，VRP5，VRP8。</li>\n<li>[3] VRP5 是一款分布式网络操作系统，具有高可靠性，高性能，可拓展的架构设计。目前，绝大多数华为设备使用的都是 VRP5 版本。</li>\n<li>[4] VRP8 是新一代网络操作系统，具有分布式，多线程，组件化架构，支持分布式应用和虚拟化技术，能够适应未来的硬件发展趋势和企业急剧膨胀的业务需求。</li>\n</ul>\n<p class=\"red\">5，设备管理接口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wgDDf.png\" alt=\"图片\"></li>\n<li>[2] AR 系列企业路由器由多个型号，包括 AR150，AR200，AR1200，AR2200，AR3200。它们是华为第三代路由器产品，提供路由，交换，无线，语音和安全等功能，AR 路由器被部署在企业网络和公网之间，作为两个网络间传输数据的入口和接口。在 AR 路由器上部署多种业务能降低企业的网络建设成本和运维成本，根据一个企业的用户数和业务的复杂程度可以选择不同型号的 AR 路由器，来部署到网络中。</li>\n<li>[3] 华为 X7 系列以太网交换机提供数据交换的功能，满足企业网络上多业务的可靠接入和高质量传输的要求，这个系列的交换机位于企业网络的接入层，汇聚层和核心层，提供大容量交换，高密度接口，实现高效的报文转发。X7 系列以太网交换机包括了 S1700，S2700，S3700，S5700，S7700，S9700 等。</li>\n<li>[4] ARG3 系列路由器和 X7 系列交换机都提供了 Console 口作为管理口，AR2200 额外提供了 Mini USB 口作为管理口。</li>\n</ul>\n<p class=\"red\">6，Console 口登录：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w2CIe.png\" alt=\"图片\"></li>\n<li>[2] 使用 Console 线缆来链接交换机或路由器的 Console 口与计算机的 COM 口，这样就可以通过计算机实现本地调试和维护，S5720 和 AR2200E 的 Console 口是一种符合 RS232 串口标准的 RJ-45 接口。目前大多数台式电脑提供的 COM 口都可以与 Console 口连接。笔记本电脑一般不提供 COM 口，需要使用 USB 到 RS232 的转换接口。</li>\n</ul>\n<p class=\"red\">7，参数配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w2kRA.png\" alt=\"图片\"></li>\n<li>[2] 很多终端模拟程序都能发起 Console 连接，例如，可以使用超级终端程序连接到 VRP 操作系统。</li>\n<li>[3] 上图，使用超级终端连接 VRP 时，必须设置端口参数，上图是端口参数设置的实列，如果对参数值做了修改，需要恢复默认参数值。</li>\n<li>[4] 完成设置以后，点击 &quot;确认&quot; 按钮即可与 VRP 建立连接。</li>\n<li>[5] 在缺少超级终端程序的计算机上，可以使用\tputty 或 Secure CRT 程序发起 Console 连接，并连接到 VRP，配置参数与上图一致。</li>\n</ul>\n<p class=\"red\">8，Mini USB 口登录：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6w2DzR.png\" alt=\"图片\"></li>\n<li>[2] 华为 AR2200 系列路由器还支持 Mini USB 口与主机 USB 口建立连接，实现对设备的调试和维护。</li>\n<li>[3]<ins class=\"wavy\"> 在管理设备时，Console 口和 Mini USB 口互斥，即同一时刻只能使用其中一个接口连接 VRP。</ins></li>\n</ul>\n<p class=\"red\">9，Mini USB 驱动安装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6w2bef.png\" alt=\"图片\"></li>\n<li>[2] 在使用 Mini USB 口建立连接前，需要在主机上安装驱动程序，可以从华为企业官方支持的网站下载到所需的驱动程序。</li>\n<li>[3]++ 目前，Mini USB 的驱动程序只能安装在 Win XP，Win Vista 和 Win7 操作系统上。</li>\n<li>[4] 华为企业官方网站网址：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS8lRTMlODAlODI=\">http://www.support.huawei.com/enterprise/。</span></li>\n</ul>\n<p class=\"red\">10，参数配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wRVfJ.png\" alt=\"图片\"></li>\n<li>[2] 安装驱动程序后，主机上会增加一个新的虚拟 COM 接口，终端模拟软件可以通过该虚拟 COM 接口连接到 VRP，</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如果路由器收到了网络中主机发送的广播报文，会如何操作？</li>\n<li>当路由器收到该广播报文时，路由器会根据数据包内容尽享处理，可能会对必要广播报文 (如请求路由器 MAC 地址的 ARP 广播) 进行回应，但不会将该数据包转发到其他广播域。</li>\n<li>[2] 华为数通设备目前使用的 VRP 版本是多少？</li>\n<li>目前，大多数华为数通产品，使用的是 VRP5 版本，少数产品如 NE 系列路由器使用的是 VRP8 版本。</li>\n</ul>\n<h1 id=\"第九章命令行基础\"><a class=\"anchor\" href=\"#第九章命令行基础\">#</a> 第九章【命令行基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>熟悉 VRP 命令行并且熟练掌握 VRP 配置是高效管理华为网络设备的必备基础。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，设备初始化启动：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wWBK1.png\" alt=\"图片\"></li>\n<li>[2] 管理员和工程师如果要访问在通用路由平台 VRP 上运行的华为产品，首先要进入启动程序。</li>\n<li>[3] 开机界面信息提供了系统启动的运行程序和正在运行的 VRP 版本及其加载路径。</li>\n<li>[4] 启动完成以后，系统提示目前正在运行的是自动配置模式，用户可以选择继续使用自动配置模式或是进入手动配置模式。</li>\n<li>[5]<ins class=\"wavy\"> 如果选择手动配置模式，在提示符处输入 Y，在没有特别要求的情况下，我们选择手动配置模式。</ins></li>\n</ul>\n<p class=\"red\">2，命令行视图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wf6Lq.png\" alt=\"图片\"></li>\n<li>[2] VRP 分层的命令结构定义了很多命令行视图，每条命令只能在特定的视图中执行。</li>\n<li>[3] 上图，介绍了常见的命令行视图，每个命令都注册在一个或多个命令视图下，用户只有先进入这个命令所在的视图，才能运行相应的命令。</li>\n<li>[4]<ins class=\"wavy\"> 进入到 VRP 系统的配置界面后，VRP 上最先出现的视图是用户视图，在该视图下，用户可以查看设备的运行状态和统计信息。</ins></li>\n<li>[5] 若要修改系统参数，用户必须进入系统视图，用户还可以通过系统视图进入其他的功能配置视图，如接口视图和协议视图。</li>\n<li>[6]<ins class=\"wavy\"> 通过提示符可以判断当前所处的视图，例如，&quot;&lt;&gt;&quot; 表示用户视图，&quot;[]&quot; 表示除用户视图以外的其他视图。</ins></li>\n</ul>\n<p class=\"wavy\">3，命令行功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6whn6s.png\" alt=\"图片\"></li>\n<li>[2] 其他快捷键功能如下：</li>\n<li>CTRL + B 将光标向左移动一个字符。</li>\n<li>CTRL + D 删除当前光标所在位置的字符。</li>\n<li>CTRL + E 将光标移动到当前行的末尾。</li>\n<li>CTRL + F 将光标向右移动一个字符。</li>\n<li>CTRL + H 删除光标左侧的一个字符。</li>\n<li>CTRL + N 显示历史命令缓冲区中的后一条命令。</li>\n<li>CTRL + P 显示历史命令缓冲区中的前一条命令。</li>\n<li>CTRL + W 删除光标左侧的一个字符串。</li>\n<li>CTRL + X 删除光标左侧所有的字符。</li>\n<li>CTRL + Y 删除光标所在位置及其右侧所有的字符。</li>\n<li>ESC + B 将光标向左移动一个字符串。</li>\n<li>ESC + D 删除光标右侧的一个字符串。</li>\n</ul>\n<p class=\"red\">4，命令行功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60NT2D.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，命令行在线帮助：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60U9xg.png\" alt=\"图片\"></li>\n<li>[2] VRP 提供两种帮助功能，分别是部分帮助和完全帮助。</li>\n<li>[3] 部分帮助是，当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符。可以使用命令行的部分帮助获取以该字符串开头的所有关键字，如上图所示。</li>\n<li>[4] 完全帮助是，在任一命令视图下，用户可以键入 “ ？” 获取该命令视图下所有的命令及其简单描述，如果建入一条命令关键字，后接以空格分割的 “ ？”，如果该位置为关键字，则列出全部关键字及其描述。</li>\n</ul>\n<p class=\"red\">6，基本配置步骤：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60U6FP.png\" alt=\"图片\"></li>\n<li>[2] 网络上一般都会部署不止一台设备，管理员需要 i 对这些设备进行统一管理，在进行设备调试的时候，首要任务是设置设备名。</li>\n<li>[3] 设备名用来唯一的标识一台设备。</li>\n<li>[4] AR2200E 路由器默认的设备名是 Huawei，而 S5720 交换机默认的设备名是 HUAWEI。</li>\n<li>[5] 设备名称一旦设置，立刻生效。</li>\n</ul>\n<p class=\"red\">7，配置系统时钟：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60adhV.png\" alt=\"图片\"></li>\n<li>[2] 系统时钟是设备上的系统时间戳，由于地域的不同，用户可以根据当地的规定时钟系统时钟，用户必须正确设置系统时钟以确保其与其他设备保持同步。</li>\n</ul>\n<p class=\"red\">8，配置标题消息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60dQER.png\" alt=\"图片\"></li>\n<li>[2] header 命令用来设置用户登录设备时终端上显示的标题信息。</li>\n<li>[3] Login 参数指定当用户在登录设备认证过程中，激活终端连接 s 时显示的标题信息。</li>\n<li>[4] shell 参数指定当用户成功登录到设备上，已经建立会话时显示的标题信息。</li>\n<li>[5] header 的内容可以是字符串或文件名。当 header 的内容为字符串时，标题信息以第一个英文字符作为起使符号，最后一个相同的英文字符作为结束符，通常情况下，建议使用英文特殊符号，并需要确保在信息正文中没有此符号。</li>\n<li>[6] 上图，header 的内容时字符串，字符串可以包含 1-2000 字符，包含空格。使用 header {login|shell} information text 命令能设置字符串形式的 header。</li>\n<li>[7] 若要设置文件形式的 header，使用 header {login|shell} file file-name 命令。file name 参数 z 指定了标题信息所使用的文件名，登录前后，该文件的内容将以文本的形式显示。</li>\n</ul>\n<p class=\"red\">9，命令等级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60wYiq.png\" alt=\"图片\"></li>\n<li>[2] 缺省情况下命令级别分为 0<sub>3 级，用户级别分为 0</sub>15 级。</li>\n<li>[3]<ins class=\"wavy\"> 用户 0 级为访问级别，对应网络诊断工具命令 (Ping，Tracert)，从设备出发访问外部的命令 (Telnet 客户端)，部分 display 命令等。</ins></li>\n<li>[4]<ins class=\"wavy\"> 用户 1 级为监控级别，对应命令级 0，1 级，包括用于系统维护的命令以及 display 等命令。</ins></li>\n<li>[5]<ins class=\"wavy\"> 用户 2 级是配置级，包括向用户提供直接网络服务，包括路由，各个网络层次的命令。</ins></li>\n<li>[6]<ins class=\"wavy\"> 用户 3-15 级是管理级别，对应命令 3 级，该级别主要用于系统运行的命令，对业务提供支撑作用，包括文件系统，FTP，TFTP 下载，文件交换配置，电源供应配置，备份板控制，用户管理，命令级别设置，系统内部参数配置以及用于业务故障诊断的 debugging 命令。</ins></li>\n<li>[7] 上图，展示了如何修改命令级别，在用户视图下执行 save 命令，需要 3 级权限。</li>\n<li>[8]<ins class=\"wavy\"> 在具体使用中，如果我们有多个管理员账号，但只允许某一个管理员保存系统配置，则可以将 save 命令的级别提高到 4 级，并定义只有该管理员有 4 级权限，这样在不影响其他用户的情况下，可以实现对命令的使用控制。</ins></li>\n</ul>\n<p class=\"red\">10，用户界面：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60DisU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：VTY 接口最大可配置范围为 0-14。</ins></li>\n<li>[2] 每类用户界面都有对应的用户界面视图，用户界面 (User-interface) 视图是系统提供的一种命令行视图，用来配置和管理所有工作在异步交互方式下的物理接口和逻辑接口。从而达到统一管理各种用户界面的目的。</li>\n<li>[3] 在连接设备前，用户要设置用户界面参数，系统支持的用户界面包括 Console 用户界面和 VTY 用户界面。</li>\n<li>[4] 控制口 (Console Port) 是一种通信串行端口，由设备的主控板提供。</li>\n<li>[5] 虚拟类型终端 (Virtual Type Terminal) 是一种虚拟线路端口，用户通过终端与设备建立 Telnet 或 SSH 连接后，也就建立了一条 VTY。即用户可以通过 VTY 方式登录设备。</li>\n<li>[6] 设备一般最多支持 15 个用户同时通过 VTY 方式访问。</li>\n<li>[7] 执行 user-interface maximum-vty number 命令可以配置同时登录到设备的 VTY 类型用户界面的最大个数，如果将最大登录用户数设为 0，则任何用户都不能通过 Telnet 或 SSH 登录到路由器。display user-interface 命令来查看用户界面信息。</li>\n<li>[8]<ins class=\"wavy\"> 不同的设备，或使用不同版本的 VRP 软件系统，具体可以被使用的 VTY 接口的最大数量可能不同。</ins></li>\n</ul>\n<p class=\"red\">11，配置用户界面命令：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60sNKf.png\" alt=\"图片\"></li>\n<li>[2] 用户可以设置 Console 界面和 VTY 界面属性，以提高系统安全性。如果一个连接上设备的用户一直处于空闲状态而不断开，可能会给系统带来很大的风险，所以在等待一个超时时间后，系统会自动中断连接，这个闲置切断时间又称为超时时间，默认为 10 分钟。</li>\n<li>[3] 当 display 命令输出的信息超过一页时，系统会对输出内容进行分页，使用空格切换下一页。</li>\n<li>[4] 如果一页输出的内容过少或过多，用户可以执行 screen-length 命令修改信息输出时一页的行数，默认行数为 24，最大支持 512 行，不建议将行数设置为 0，因为这样不会显示任何内容。</li>\n<li>[5] 每条命令执行后，执行的记录都保存在历史命令缓存区。历史命令缓存区\t默认能存储 10 条命令，可以通过运行 history-command max-size 改变可存储的命令数，最多可存储 256 条。</li>\n</ul>\n<p class=\"red\">12，配置登录权限：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/606zvt.png\" alt=\"图片\"></li>\n<li>[2] 如果没有权限限制，未授权的用户就可以，使用设备获取信息并更改配置，从设备安全角度考虑，限制用户的访问和操作权限是很有必要的，<ins class=\"wavy\">用户权限和用户认证</ins>是提升终端安全的两种方式。用户权限要求规定用户的级别，一定级别的用户只能 z 执行特定级别的命令。</li>\n<li>[3] 配置用户界面的用户认证方式后。用户登录设备时，需要输入密码 j 进行认证，这样就 x 限制了用户访问设备的权限，在通过 VTY 进行 Telnet 连接时，所有接入设备的 y 用户都必须要经过认证。</li>\n<li>[4] 设备提供三种认证模式，AAA 模式，密码认证模式和不认证模式。AAA 认证模式具有很高的安全性，因为登陆时必须输入用户名和密码。密码认证只需要输入登录密码就行，所以所有的用户使用的都是同一个密码，使用不认证模式就是不需要对用户认证直接登录到设备，需要注意的是，Console 界面默认使用不认证模式。</li>\n<li>[5] 对于 Telnet 登录用户，授权是非常必要的，最好设置用户名，密码和指定和账号相关联的权限。</li>\n<li>[6] 注：不同 VRP 版本执行 set authentication password cipher 命令有差异，有些平台需要回车后 s 输入密码，另外一些平台可以直接在命令行后输入密码，故，在操作具体产品时，需要查阅相应的 VRP 版本。</li>\n</ul>\n<p class=\"red\">13，配置接口地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BQdoD.png\" alt=\"图片\"></li>\n<li>[2] 要在接口运行 IP 服务，必须为接口配置一个 IP 地址，一个接口一般只需要一个 IP 地址，在特殊情况下，也有可能为接口配置一个次要的 IP 地址。</li>\n<li>[3] 例如，当路由器 AR2200E 的接口连接到一个物理网络时，该物理网络中的主机属于两个网段，为让两个网段的主机都可以通过路由器 AR2200E 访问其他网络，可以配置一个主 IP 地址和一个次要 IP 地址，一个接口只能有一个主 IP 地址，如果接口配置了新的主 IP 地址，那么新的主 IP 地址就代替了原来的主 IP 地址。</li>\n<li>[4] Lookback 接口是一个逻辑接口，可用来虚拟一个网络或者一个 IP 主机，在运行多种协议的时候，由于 Lookback 接口稳定可靠，所以也可以用来做管理接口。</li>\n<li>[5] 如果接口处于 Down 状态，应使用 undo shuttdown 打开该接口。</li>\n</ul>\n<p class=\"red\">14，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 华为网络设备支持多少个用户同时使用 console 口登录？</li>\n<li>华为网络设备同时只能有一个用户登录 Console 界面，因此 Console 用户的编号固定为 0</li>\n<li>[2] 在使用命令 interface lookback interface 0 之后，lookback 0 接口的状态是什么？</li>\n<li>Lookback 口是一种逻辑接口，在未创建之前，Lookback 接口并不存在，从创建开始，Lookback 口就一直存在，并一直保持 Up 状态，除非被手动关闭。</li>\n</ul>\n<h1 id=\"第十章文件系统基础\"><a class=\"anchor\" href=\"#第十章文件系统基础\">#</a> 第十章【文件系统基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>华为网络设备的配置文件和 VRP 系统文件都保存在物理储存介质中，所以文件系统是 VRP 正常运行的基础。只有掌握了对文件系统的基本操作，网络工程师才能对设备的配置文件和 VRP 系统文件进行高效的管理。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，基本查询命令：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BlvHf.png\" alt=\"图片\"></li>\n<li>[2] 上图，在用户始于中使用 dir 命令，可以查看 flash 中的文件信息。</li>\n</ul>\n<p class=\"red\">2，目录操作：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BGLi8.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，文件操作 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BGjzQ.png\" alt=\"图片\"></li>\n<li>[2] 文件操作包括：复制，移动，重命名，压缩，删除，恢复等。</li>\n</ul>\n<p class=\"red\">4，文件操作 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BJFiT.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，配置文件管理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTCS1.png\" alt=\"图片\"></li>\n<li>++ 注：设备启动时，会加载保存的配置文件到 RAM，并作为当前配置文件。</li>\n<li>[2] 设备中的配置文件分为两种类型：<ins class=\"wavy\">当前配置文件和保存的配置文件。</ins>。</li>\n<li>[3] 当前配置文件保存在设备的 RAM 中，用户可以通过命令行对设备进行配置，配置完成后使用 save 命令保存当前配置到储存设备中，形成保存的配置文件。</li>\n<li>[4]++ 保存的配置文件都是以 “.cfg” 或 “.zip” 作为扩展名，存放在储存设备的根目录下。</li>\n<li>[5] 在设备启动时，会从默认的储存路径下加载保存的配置文件到 RAM 中，如果默认储存路经中没有保存的配置文件，则设备会使用缺省参数进行初始化配置。</li>\n</ul>\n<p class=\"red\">6，配置文件查询：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTapn.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">7，配置文件保存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTHtH.png\" alt=\"图片\"></li>\n<li>[2] SAVE 命令可以用来保存当前配置信息到系统默认的储存路径中。</li>\n</ul>\n<p class=\"red\">8，系统启动文件查询：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6y79Ag.png\" alt=\"图片\"></li>\n<li>[2] display startup 命令用来查看设备本次及下次启动相关的系统软件，备份系统软件，配置文件，License 文件，补丁文件以及语音文件。</li>\n<li>[3] Startup system software 表示的是本次系统启动所使用的 VRP 文件。</li>\n<li>[4] Next startup system software 表示的是下次系统启动所使用的 VRP 文件。</li>\n<li>[5] Startup save-configuration file 表示得是本次系统启动所使用的配置文件。</li>\n<li>[6] Next startup save-configuration file 表示得是下次系统启动所使用的配置文件。</li>\n</ul>\n<p class=\"red\">9，系统启动配置文件修改：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yHVGd.png\" alt=\"图片\"></li>\n<li>[2] 设备启动时，会从储存设备中加载配置文件并进行初始化，如果储存设备中，没有配置文件，设备将会使用默认参数进行初始化。</li>\n<li>[3] configuration-file 参数为系统启动配置文件的名称。</li>\n</ul>\n<p class=\"red\">10，比较当前配置和保存的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yHldS.png\" alt=\"图片\"></li>\n<li>[2] compare configuration (configuration-file)(current-line-number save-line-number) 命令用来比较当前的配置与下次启动的配置文件内容的区别，configuration-file 指定需要与当前配置进行比较的配置文件名，current-line-number 表示从当前配置的该行号开始比较，save-line-number 表示从指定配置的该行号开始比较。</li>\n<li>[3] 当执行该命令后，系统默认会将保存的配置与当前得到配置从第一行开始逐行比较。</li>\n<li>[4] 系统比较出不同之处后，将从两者有差别的地方开始显示字符，默认显示 120 个字符。如果从该不同之处到文件末尾不足 120 个字符，将显示到文件尾为止。</li>\n</ul>\n<p class=\"red\">11，配置文件重置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybVTU.png\" alt=\"图片\"></li>\n<li>[2] reset saved-configuration 命令用来清除储存设备中启动配置文件的内容。</li>\n<li>[3] 执行该命令后，如果不使用该命令 startup save-configuration 重新指定设备下次启动时使用的配置文件，也不使用 save 命令保存配置文件，则设备下次启动时会采用缺省的配置参数进行初始化。</li>\n</ul>\n<p class=\"red\">12，存储设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybd1A.png\" alt=\"图片\"></li>\n<li>[2] 存储设备包括 SDRAM，Flash，NVRAM，SD 卡，U 盘等。例如，AR2200E 的路由器有内置的闪存，该路由器提供了两个预留的 USB 插槽 (USB0 和 USB1) 和一个 SD 卡插槽 (SD0)。</li>\n<li>[3] S5720 交换机包含了一个内置闪存，该闪存根据型号不同，存储容量也不同，S5720-EI 支持 340M 内存，S5720-HI 支持 400M 闪存。</li>\n<li>[4]++ 执行 display version 命令可以查看华为存储设备的详细信息。</li>\n</ul>\n<p class=\"red\">13，存储设备修复：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybbh4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当存储设备的文件系统出现异常时，可以通过 fixdisk 命令进行修复。</ins></li>\n<li>[2] fixdisk 命令用来对文件系统出现异常的存储设备进行修复，当存储设备上的文件系统出现异常时，终端会给出提示信息，此时建议使用此命令进行修复，但不确保修复成功。</li>\n<li>[3]<ins class=\"wavy\"> 执行此命令后，如果仍然收到系统建议修复的信息，则表示物理介质可能已经损坏。</ins></li>\n<li>此命令是问题修复类命令，在系统未出现问题时，建议用户不要执行此命令。</li>\n<li><ins class=\"wavy\">有些 VRP 版本不支持 fixdisk 命令，在操作具体产品时请查阅相应的 VRP 文档。</ins></li>\n</ul>\n<p class=\"red\">14，存储设备格式化：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yqF9H.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：格式化会导致数据丢失。</ins></li>\n<li>[2] 当文件系统出现异常无法修复时，并且确认不在需要存储器上的所有数据时，可格式化存储设备。格式化存储设备会导致设备上的数据丢失，且这些文件不能恢复。</li>\n<li>[3] format (devicename) 命令用来格式化存储器，在执行 format 命令时，需要指定 devicename 参数，表示格式化特定的存储器，在执行此命令后，会清空指定存储器中的所有文件和目录，并且不可恢复，所以谨慎使用 format 命令！</li>\n<li>[4] 有些 VRP 版本不支持 format 命令。</li>\n</ul>\n<p class=\"red\">15，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 设备中的文件属性有 drw，其中 d 代表什么含义？</li>\n<li>d 表明是个目录，r，w，是可读出，可写入的意思。</li>\n<li>[2] 如果设备中有多个配置文件，如何指定下次启动时使用的配置文件？</li>\n<li>配置文件可以不使用默认的文件名 vrp.cfg, 而用其他指定的名称保存到路由器或交换机中，如果需要指定某一个配置文件为下次启动时使用的配置文件，可以执行 startup saved-configuration (configuration-file-name) 命令，这里的配置文件名包括文件名称和拓展名。</li>\n</ul>\n<h1 id=\"第十一章vrp系统管理\"><a class=\"anchor\" href=\"#第十一章vrp系统管理\">#</a> 第十一章【VRP 系统管理】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>为了满足企业业务对网络的需求，网络设备中的系统文件需要不断进行升级，另外，网络设备中的配置文件也需要时常进行备份，以防设备故障或其他灾害个业务带来损害。</li>\n<li>在升级和备份系统文件或配置文件时，经常会使用 FTP 和 TFTP 来传输文件。</li>\n<li>++ 注：使用 FTP，TFTP，SFTPv1 协议存在安全风险，建议使用 SFTPv2 方式进行文件操作。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，升级 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yLnMR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：随着 VRP 版本的更新，VRP 支持的特性也越来越多，可根据需求更新 VRP 版本。</ins></li>\n</ul>\n<p class=\"red\">2，文件传输：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yOCSH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网络设备可以从服务器获取 VRP 系统文件，也可以将日志文件，配置文件保存到服务器作为备份。</ins></li>\n<li>[2] 文件传输是指发送文件到远程服务器，或者从远程服务器获取文件的过程。</li>\n<li>[3] 在实际场景中，为满足企业业务的需求。设备的 VRP 文件需要更新，如上图所示，设备在与服务器建立连接之后，可以从服务器获取新的 VRP，完成更新工作。</li>\n<li>[3] 为避免数据丢失对业务造成影响，设备的配置文件和日志文件也通常会进行备份，如上图所示，设备在与服务器建立连接之后，可以将配置文件，日记文件传输到服务器上，完成备份工作，当设备上的文件丢失后，可以恢复之前服务器上备份的配置文件和日志文件。</li>\n</ul>\n<p class=\"red\">3，文件传输协议：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cTK61.png\" alt=\"图片\"></li>\n<li><ins class=\"red\">注：常用的文件传输协议有 FTP 和 TFTP 两种。</ins></li>\n<li>[2] FTP (File Transfer Protocol) 是 TCP/IP 协议族中一种<ins class=\"wavy\">应用层协议</ins>，称为文件传输协议。</li>\n<li>[3] FTP 的主要功能是向用户提供本地和远程主机之间的文件传输。++ 在进行版本升级，日记下载和配置保存等业务操作时，会广泛地使用到 FTP，</li>\n<li>[4] FTP 采用两个 TCP 连接：<ins class=\"wavy\">控制连接和数据连接</ins>。其中控制连接用于连接控制端口，传输控制命令。数据连接用于连接数据端口。传输数据。在控制连接建立后，数据连接通过控制端口的命令建立起连接，进行数据的传输。</li>\n<li>[5] FTP 数据连接的建立有两种：<ins class=\"wavy\">主动模式和被动模式。</ins>两者之间的区别在于数据连接是由服务器发起还是客户端发起。</li>\n<li>[6] ARG3 系列路由器既可以作为 FTP Client 又可以作为 FTP Server。缺省情况下，AR2200 采用主动模式建立数据连接。</li>\n<li>[7] TFTP (Trivial File Transfer Protocol) 是一种简化的文件传输协议，TFTP 协议使用 UDP 协议进行文件的传输，由客户端发起 TFTP 传输请求，实现文件的上传和下载。ARG3 系列路由器只可以作为 TFTP 客户端。</li>\n</ul>\n<p class=\"red\">4，VRP 系统文件更新配置 —— 与 FTP 服务器连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cHERJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在通过 FTP 传输任何数据之前，首先必须保证 FTP 客户端和 FTP 服务器之间可以通信。</ins></li>\n</ul>\n<p class=\"red\">5，VRP 系统文件更新配置 —— 查看剩余存储空间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cHgLq.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当剩余存储空间不足时，可以删除无关的 VRP 文件或其他文件以释放空间。</ins></li>\n<li>[2] 在获取 VRP 文件之前，还要确认设备有足够的存储空间来存储新获取的 VRP 文件，可以用 dir 命令来检查当前目录中的文件和可用空间，如果存储空间不足，需要删除无关文件来释放足够的空间，上图，通过 delete 命令删除以存在的无关 VRP 文件来获取了足够的空间。</li>\n</ul>\n<p class=\"red\">6，VRP 系统文件更新配置 - 从 FTP 服务器获取 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cXcVI.png\" alt=\"图片\"></li>\n<li>[2] 如需从 FTP 服务器获取文件，客户端需要使用 ftp [ip address] 命令来发起 FTP 连接请求，其中 ip address 指的是 FTP 服务器的 IP 地址，客户端和 FTP 服务器建立连接之后，客户端需要使用 FTP 服务器中配置的用户名和密码进行认证。认证通过后，客户端可以访问 FTP 服务器，并且能够查看和下载存储在服务器中的文件。</li>\n<li>[3] 上图，客户端使用 ftp 10.1.1.2 和 FTP 服务器建立了连接，使用 get AR2220E-V200R007C00SPC600.cc 命令可以获取位于 FTP 服务器上的 VRP 文件。</li>\n</ul>\n<p class=\"red\">7，VRP 系统文件更新配置 —— 从 TFTP 服务器获取 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cxMPP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARG3 路由器只需使用上述命令即可从 TFTP 服务器获取 VRP 文件。</ins></li>\n<li>[2] 如果客户端需要从 TFTP 服务器获取 VRP 文件，则不需要首先和 TFTP 服务器建立连接。</li>\n<li>[3]<ins class=\"wavy\"> ARG3 系列路由器和 X7 系列交换机只能作为 TFTP 客户端。</ins></li>\n<li>[4] 上图，客户端通过配置 TFTP 10.1.1.2 get AR2220E-V200R003SPC600.cc 就可以从 TFTP 服务器获取 VRP 文件。</li>\n</ul>\n<p class=\"red\">8，VRP 系统文件更新配置 - 指定下次启动时加载的 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6czTpV.png\" alt=\"图片\"></li>\n<li>[2] 从服务器成功获取 VRP 文件后，还需要配置此文件为设备下次启动时的系统文件，否则，设备仍会使用旧版本的 VRP 系统文件。</li>\n<li>[3] 在设备上通过使用 startup system-software 命令可以指定下次启动的系统文件。</li>\n<li>[4] VRP 系统文件必须存储在根目录。否则。系统不能正常运行。</li>\n<li>[5] 上图，可以使用 display startup 命令去验证系统启动文件是否已经变更，显示信息中 Startup system software 显示当前系统启动使用的 VRP 文件，Next startup system software 显示下次系统启动使用的 VRP 文件。</li>\n</ul>\n<p class=\"red\">9，VRP 系统文件更新配置 —— 重启设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gPyqO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：设备重启后，将会加载新的 VRP 系统。</ins></li>\n<li>[2] 确认系统下次启动软件正确后，需要重启设备，使用 reboot 命令可以重启设备，输入此命令后，系统会提示是否保存配置文件，实际中，可根据需要进行选择，上图选择了不保存配置。</li>\n</ul>\n<p class=\"red\">10，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 设备作为 FTP 客户端时，如何从服务器下载 VRP?</li>\n<li>首先必须保证客户端和服务器之间可以通信，然后客户端需要使用 ftp [IP address] 命令与服务器建立 FTP 连接，建立连接之后需要输入正确的用户名和密码进行验证，验证通过后使用 get 命令即可下载 VRP。</li>\n<li>[2] 在完成 VRP 升级并重启之后，管理员如何确认升级成功？</li>\n<li>管理员可以使用 display startup 命令验证系统启动的 VRP 软件。以此来判断\tVRP 升级是否成功。</li>\n</ul>\n<h1 id=\"第十二章交换网络基础\"><a class=\"anchor\" href=\"#第十二章交换网络基础\">#</a> 第十二章【交换网络基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>常见的以太网设备包括 Hub，交换机等。交换机工作在数据链路层，它有效地隔离了以太网中的冲突域，极大地提升了以太网的性能。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，小型交换网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gi5tJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机工作在数据链路层，转发数据帧。</ins></li>\n<li>[2] 随着企业网络的发展，越来越多的用户需要接入到网络，交换机提供了大量的接入接口能够很好地满足了这种需求，同时，交换机也彻底解决了困扰早期以太网冲突问题，极大地提升了以太网的性能，同时也提供了以太网的安全性。</li>\n<li>[3] 交换机工作在数据链路层，对数据帧进行操作，在收到数据帧后，交换机会根据数据帧的头部信息对数据帧进行转发。</li>\n</ul>\n<p class=\"red\">2，交换机的转发行为：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gFWvt.png\" alt=\"图片\"></li>\n<li>[2] 交换机中有一个 MAC 地址库，里面存放了 MAC 地址与交换机端口的映射关系，MAC 地址表也称为 CAM (Content Addressable Memory) 表。</li>\n<li>[3] 上图，++ 交换机对帧的转发操作行为一共有三种：泛洪 (Flooding)，转发 (Forwarding)，丢弃 (Discarding)。</li>\n<li>[4] 泛洪 (Flooding)：交换机把从某一个端口进来的帧通过所有其他的端口转发出去 (注意，&quot;所有其他的端口&quot; 是指除了这个帧进入交换机的那个端口以外的所有端口)。</li>\n<li>[5] 转发 (Forwarding)：交换机把从某一端口进来的帧通过另一个端口转发出去 (注意，&quot;另一个端口&quot; 是指不是这帧进入交换机得到那个端口).。</li>\n<li>[6] 丢弃 (Discarding)：交换机把从某一端口进来的帧直接丢弃。</li>\n<li>[7] 交换机的基本工作原理可以概括地描述如下：</li>\n<li>①如果进入交换机的是一个单播帧，则交换机会去 MAC 地址表中查找这个帧的目的 MAC 地址。</li>\n<li>如果查不到这个 MAC 地址，则交换机执行泛洪操作。</li>\n<li>如果查到了这个 MAC 地址，则比较这个 MAC 地址在 MAC 地址表中对应的端口是不是这个帧进入交换机的那个端口，如果不是，则交换机执行转发操作，如果是，则交换机执行丢弃操作。</li>\n<li>[8] 如果进入交换机的是一个广播帧，则交换机不会去查 MAC 地址表，而是执行泛洪操作。</li>\n<li>[9] 如果进入交换机的是一个组播组，则交换机的处理行为比较复杂，另外，交换机还具有学习功能，当一个帧进入交换机后，交换机会检查这个帧的源 MAC 地址，并将该源 MAC 地址与这个帧进入交换机的那个端口进行映射，然后将这个映射关系存放进 MAC 地址表。</li>\n</ul>\n<p class=\"red\">3，交换机初始状态：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gACef.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：初始状态下，交换机 MAC 地址表为空。</ins></li>\n<li>[1] 初始状态下，交换机并不知道所连接主机的 MAC 地址，所以 MAC 地址表为空，上图，SWA 为初始状态，在收到主机 A 发送的数据帧之前，MAC 地址表中没有任何表项。</li>\n</ul>\n<p class=\"red\">4，学习 MAC 地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gAQTU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机将收到的数据帧的源 MAC 地址和对应接口记录到 MAC 地址表中。</ins></li>\n<li>[2] 主机 A 发送数据给主机 C 时，一般会首先发送 ARP 请求来获取主机 C 的 MAC 地址，此 ARp 请求帧中的目的 MAC 地址是广播地址，源 MAC 地址是自己的 MAC 地址。</li>\n<li>[3] SWA 收到该帧后，会将源 MAC 地址和接收端口的映射关系添加到 MAC 地址表中，缺省情况下，X7 系列交换机学习到的 MAC 地址表项的老化时间为 300 秒。</li>\n<li>[4] 如果在老化时间内再次收到主机 A 发送的数据帧，SWA 中保存的主机 A 的 MAC 地址和 G0/0/1 的映射的老化时间会被刷新。</li>\n<li>[5] 此后，如果交换机收到目标 MAC 地址为 00-01-02-03-04-AA 的数据帧时，都将通过 G0/0/1 端口转发。</li>\n</ul>\n<p class=\"red\">5，转发数据帧：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gAxNF.png\" alt=\"图片\"></li>\n<li>++ 注：当数据帧的目的 MAC 地址不在 MAC 表中，或者目的 MAC 地址为广播地址时，交换机会泛洪该帧。</li>\n<li>[2] 上图，主机 A 发送的数据帧的目的 MAC 地址为广播地址，所以交换机会将此数据帧通过 G0/0/2 和 G0/0/3 端口广播到主机 B 和主机 C。</li>\n</ul>\n<p class=\"red\">6，目标主机回复：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gEe4e.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机根据 MAC 地址表将目的主机的回复信息单播转发给源主机。</ins></li>\n<li>[2] 主机 B 和主机 C 收到此数据帧后，都会查看该 ARP 数据帧，但是主机 B 不会回复该帧，主机 C 会处理该帧并发送 ARP 回应。此回复数据帧的目的 MAC 地址为主机 A 的 MAC 地址，源 MAC 地址为主机 C 的 MAC 地址。</li>\n<li>[3] SWA 收到回复数据帧时，会将该帧的源 MAC 地址和接口的映射关系添加到 MAC 地址表中。</li>\n<li>[3] 如果此映射关系在 MAC 地址表已经存在，则会被刷新，然后 SWA 查询 MAC 地址表，根据帧的目的 MAC 地址找到对应的转发端口后，从 G0/0/1 转发此数据帧。</li>\n</ul>\n<p class=\"red\">7，基本配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gVpa8.png\" alt=\"图片\"></li>\n<li>[2] 早期的以太网的工作模式都是 10M 半双工的，随着技术的发展，出现了全双工模式，接着又出现了百兆和千兆以太网，采用不同工作模式的设备无法直接相互通信，自协商技术的出现解决了不同以太网工作模式之间的兼容性问题。</li>\n<li>[3]<ins class=\"wavy\"> 自协商的内容主要包括双工模式和运行速率，一旦协商通过，链路两端的设备就具有相同的工作参数。</ins></li>\n<li>[4] negotiation auto 命令用来设置以太网端口的自协商功能，端口是否应该使能自协商模式，要考虑对接双方设备的端口是否都支持自动协商，如果对端设备的以太网端口不支持自协商模式，则需要在本端端口上先使用 undo negotiation\tauto 命令配置为非自协商模式，之后，修改本端端口的速率和双工模式保持与对端一致，确保通信正常。</li>\n<li>[5] duplex 命令用来设置以太网端口的双工模式，GE 电口工作速率为 1000Mbit/s 时，只支持全双工模式，不需要与链路对端的端口共同协商双工模式。</li>\n<li>[6] speed 命令用来设置端口的工作速率，配置端口的速率和双工模式之前需要先配置端口为非自协商模式。</li>\n<li>[7] 因产品型号的不同，华为交换机可能不支持更改端口双工模式。</li>\n</ul>\n<p class=\"red\">8，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gZLnI.png\" alt=\"图片\"></li>\n<li>[2] display interface () interface-type (interface-number (.sumnumber))) 命令用来查看端口当前运行状态和统计信息。</li>\n<li>[3] current state 表示端口的物理状态，如果为 UP，表示端口处于打开状态。</li>\n<li>[4] Line protocol current state 表示端口的链路协议状态，如果为 UP，表示端口的链路协议处于正常的启动状态。</li>\n<li>[5] Speed 表示端口的工作速率，SWA 的 G0/0/1 端口工作速率为 100Mbits/s。</li>\n<li>[6] duplex 表示端口的双工模式，SWA 的 G0/0/1 端口双工模式为全双工。</li>\n</ul>\n<p class=\"red\">9，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 当一台主机从交换机的一个端口移动到另一个端口时，交换机的 MAC 地址表会发生什么变化？</li>\n<li>当一台主机从交换机的一个端口移除时，交换机检测到物理链路 Down 因此会从 MAC 地址表中清除对应主机的 MAC 表项，一旦主机连接到交换机的另一个端口，交换机会检测到新端口对应的物理链路 UP。主机发送报文后，交换机就会学习到主机的 MAC 地址和新端口映射关系，并且添加到 MAC 地址表中。</li>\n</ul>\n<h1 id=\"第十三章stp原理与配置\"><a class=\"anchor\" href=\"#第十三章stp原理与配置\">#</a> 第十三章【STP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>为了提高网络的可靠性，交换网络中通常会使用冗余链路。然而，冗余链路会给交换网络带来环路风险，并导致广播风暴以及 MAC 地址表不稳定等问题，进而会影响到用户的通信质量，生成树协议 STP (Spanning Tree Protocol) 可以在提高可靠性的同时又能避免环路带来的各种问题。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，二层交换网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g1NjS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机之间通过多条链路互联时，虽然能够提升网络可靠性，但同时也会带来环路问题。</ins></li>\n<li>[2] 随着局域网规模的不断扩大，越来越多的交换机被用来实现主机之间的互联，如果交换机之间仅使用一条链路互联，则可能会出现单点故障，导致业务中断。为了解决此类问题，交换机在互联时一般都会使用冗余链路来实现备份。</li>\n<li>[3] 冗余链路虽然增强了网络的可靠性，但是也会产生环路，而环路会带来一系列的问题，继而导致通信质量下降和通信业务中断等问题。</li>\n</ul>\n<p class=\"red\">2，广播风暴：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g3FKS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：环路会产生广播风暴。</ins></li>\n<li><ins class=\"wavy\">注：网络中的主机会收到重复数据帧。</ins></li>\n<li>[2] 根据交换机的转发原则，如果交换机从一个端口上接收到的是一个广播帧，或者是一个目的 MAC 地址未知的单播帧，则会将这个帧向除源端口之外的使用其他端口转发。如果交换网络中有环路，则这个帧会被无限转发，此时便会形成广播风暴，网络中也会充斥着重复的数据帧。</li>\n<li>[3] 上图，主机 A 向外发送了一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在。SWB 接收到此帧后，将其转发到 SWA 和 SWC，SWA 和 SWC 也会将此帧转发到除了接收此帧的其他所有的接口，结果此帧又会被再次转发给 SWB，这种循环会一直持续，于是便产生了广播风暴，交换机性能会因此急剧下降，并会导致业务中断。</li>\n</ul>\n<p class=\"red\">3，MAC 地址表震荡：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g3U8x.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：环路会引起 MAC 地址表震荡。</ins></li>\n<li>[2] 交换机是根据所收到的数据帧的源地址和接收端口生成 MAC 地址表项的。</li>\n<li>[3] 主机 A 向外发送一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在，SWB 收到此数据帧后，在 MAC 地址表中生成一个 MAC 地址表项，00-01-02-03-04-AA，对应端口为 G0/0/3，并将其从 G0/0/1 和 G0/0/2 端口转发，上图仅以 G0/0/1 转发此帧。</li>\n<li>[4] SWA 收到此帧后，由于 MAC 地址表中没有对应此帧目的 MAC 地址的表项，所以 SWA 会将此帧从 G0/0/2 端口发送出去。</li>\n<li>[5] SWC 接收到此帧后，由于 MAC 地址表中也没有对应此帧的目的 MAC 地址的表项，所以 SWC 会将此帧从 G0/0/2 端口发送回 SWB，也会发给主机 B。</li>\n<li>[6] SWB 从 G0/0/2 接口接收到此数据帧之后，会在 MAC 地址表中删除原有的相关表项，生成一个新的表项，00-01-02-03-04-AA，对应端口为 G0/0/2。此过程会不断重复，从而导致 MAC 地址表震荡。</li>\n</ul>\n<p class=\"red\">4，STP 的作用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g8Okd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：STP 通过阻塞端口来消除回路，并能够实现链路备份的目的。</ins></li>\n<li>[2] 在以太网中，二层网络的环路会带来广播风暴，MAC 地址表震荡，重复数据帧等问题，为了解决交换网络中的环路问题，提出了 STP。</li>\n<li>[3] STP 的主要作用：</li>\n<li>消除环路：通过阻断冗余链路来消除网络中可能存在的环路。</li>\n<li>链路备份：当活动路径发送故障时，激活备份链路，及时恢复网络连通性。</li>\n</ul>\n<p class=\"red\">5，STP 操作：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gG5Nj.png\" alt=\"图片\"></li>\n<li>[2] STP 通过改造一棵树来消除交换网络中的环路。</li>\n<li>[3] 每个 STP 网络中，都会存在一个根桥，其他交换机为非根桥，根桥或者根交换机位于整个逻辑树的根部，是 STP 网络的逻辑中心，非根桥是根桥的下游设备，当现有根桥产生故障时，非根桥之间会交互信息并重新选举根桥，交互的这种信息被称为 BPDU，BPDU 中包含交换机在参加\t生成树计算时的各种参数信息。</li>\n<li>[4] STP 中定义了三种端口角色：指定端口，根端口和预备端口。</li>\n<li>[5] 指定端口是交换机向所连网段转发配置 BPDU 的端口，每个网段有且只能有一个指定端口。一般情况下，根桥的每一个端口总是指定端口。</li>\n<li>[6] 根端口是非根交换机去往根桥路径最优的端口，在一个运行 STP 的交换机上最多只有一个根端口，但根桥上没有根端口。</li>\n<li>[7] 如果一个端口既不是指定端口也不是根端口，则此端口为预备端口，预备端口将被阻塞。</li>\n</ul>\n<p class=\"red\">6，根桥选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gYxpR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每一台交换机启动 STP 后，都认为自己是根桥。</ins></li>\n<li>[2]<ins class=\"wavy\"> STP 中根桥的选举依据是桥 ID，</ins>STP 中的每个交换机都会有一个桥 ID (Bridge ID)。桥 ID 由 16 位桥优先级 (Bridge priority) 和 48 位的 MAC 地址构成，在 STP 网络中，桥优先级是可以配置的，取值范围 0~65535，默认值 32768，优先级最高的设备 (数值越小越优先) 会被选举为根桥，如果优先级相同，则会比较 MAC 地址，MAC 地址越小则越优先。</li>\n<li>[3] 交换机启动后就自动进行生成树收敛计算，默认情况下，所有交换机启动时都认为自己是根桥，自己的所有端口都为指定端口，这样 BPDU 报文就可以通过所有端口转发，对在端交换机收到 BPDU 报文后，会比较 BPDU 中的根桥 ID 和自己的桥 ID。如果收到的 BPDU 报文中的桥 ID 优先级最高，则交换机会修改自己的 BPDU 报文的根桥 ID 字段，宣告新的根桥。</li>\n</ul>\n<p class=\"red\">7，根端口选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gN1r6.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根交换机在选举根端口时分别依据该端口的路径开销，对端 BID，对端 PID 和本端 PIN。</ins></li>\n<li>[2] 非根交换机在选举根端口时分别依据该端口的根路径开销，对端 BID (Bridge ID)，对端 PID (Port ID) 和本端 PID。</li>\n<li>[3] 交换机的每个端口都有一个端口开销 (Port Cost) 参数，此参数表示该端口在 STP 中的开销值。默认情况下端口的开销和端口的带宽有关，带宽越高，开销越低。从一个\t非根桥到达根桥的路径可能有多条，每一条路径都有一个总的开销值，此开销值是该路径上所有接收 BPDU 端口的端口开销总和 (即 BPDU 的入方向端口)，称为路径开销。非根桥通过对比多条路径的 lu 路径开销，选出到达根桥的最短路径，这条最短路径的路径开销被称为 RPC (Root Path Cost，根路径开销)，并生成无环树状网络，根桥的根路径开销是 0。</li>\n<li>[4] 一年情况下，企业网络中会存在多厂商的交换设备，华为 X7 系列交换机支持多种 STP 的路径开销计算标准，提供最大程度的兼容性，缺省情况下，华为 X7 系列交换机使用 IEEE 802.1t 标准来计算路径开销。</li>\n<li>[5] 运行 STP 交换机的每个端口都有一个端口 ID，端口 ID 由端口优先级和端口号构成，端口优先级取值范围是 0~240，步长为 16，即取值必须为 16 的整倍数。缺省情况下，端口优先级是 128，端口 ID (Port ID) 可以用来确定端口角色。</li>\n<li>[6] 每个非根桥都要选举一个根端口，根端口是距离根桥最近的端口，这个最近的衡量标准是靠路径开销来判定的，即路径开销最小的端口就是根端口，端口收到一个 BPDU 报文后，抽取该 BPDU 报文中根路径开销字段的值，加上该端口本身的端口开销即为本端口路径开销，如果有两个或两个以上的端口计算得到的累计路径开销相同，那么选择收到发送者 BID 最小的那个端口作为根端口。</li>\n<li>[7] 如果两个或两个以上的端口连接到同一台交换机上，则选择发送者 PID 最小的那个端口作为根端口。如果两个或两个以上的端口通过 HUB 连接到同一台交换机的同一个接口上，则选择本交换机的这些端口中的 PID 最小的作为根端口。</li>\n</ul>\n<p class=\"red\">8，指定端口选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fEegg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根交换机在选举指定端口时分别依据根路径的开销，BID，PID。</ins></li>\n<li><ins class=\"wavy\">注：未被选举为根端口或指定端口的端口为预备端口，将会被阻塞。</ins></li>\n<li>[2] 在网段上抑制其他端口 (无论是自己的还是其他设备的) 发送 BPDU 报文的端口，就是该网段的指定端口。每个网段都应该有一个指定端口，根桥的所有端口都是指定端口 (除非根桥在物理上存在环路)。</li>\n<li>[3] 指定端口的选举也是首先比较累计路径开销，累计路径开销最小的端口就是指定端口，如果累计路径开销相同，则比较端口所在交换机的桥 ID，所以桥 ID 最小的端口被选举为指定端口。如果通过累计路径开销和所在桥 ID 选举不出来，则比较端口 ID，端口 ID 最小的被选举为指定端口。</li>\n<li>[4] 网络收敛后，只有指定端口和根端口可以转发数据，其他端口为预备端口，被阻塞，不能转发数据，只能够从所连网段的指定交换机接收到 BPDU 报文，并以此来监视链路的状态。</li>\n</ul>\n<p class=\"red\">9，端口状态转换：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fV8eA.png\" alt=\"图片\"></li>\n<li>[2] 上图所示，为 STP 的端口状态迁移机制，运行 STP 协议的设备上端口状态有 5 种。</li>\n<li>[3] Forwarding：转发状态，端口既可以转发用户流量也可以转发 BPDU 报文，只有根端口或指定端口才能进入 Forwarding 状态。</li>\n<li>[4] Learning：学习状态。端口可个根据收到的用户流量构建 MAC 地址表，但不转发用户流量，增加 Learing 状态是为了防止临时环路。</li>\n<li>[5] Listening：倾听状态。端口可以转发 BPDU 报文，但不转发用户流量。</li>\n<li>[6] Blocking：阻塞状态。端口仅仅能接收并处理 BPDU，不能转发 BPDU，也不能转发用户流量，此状态是预备端口的最终状态。</li>\n<li>[7] Disabled：禁用状态。端口既不处理和转发 BPDU 报文，也不转发用户流量。</li>\n</ul>\n<p class=\"red\">10，BPDU：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fZdtx.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：BPDU 包含桥 ID，路径开销，端口 ID，计时器等参数。</ins></li>\n<li>[2] 为了计算生成树，交换机之间需要交换相关的信息和参数，这些信息和参数被封装在 BPDU (Bridge Proticol Data Unit) 中。</li>\n<li>[3] BPDU 有两种类型：配置 BPDU 和 TCN BPDU。</li>\n<li>[4] 配置 BPDU 包含了桥 ID，路径开销和端口 ID 等参数。STP 协议通过在交换机之间传递配置 BPDU 来选举根交换机，以及确定每个交换机端口的角色和状态。在初始化过程中，每个桥都主动发送配置 BPDU，在网络拓扑稳定后，只有根桥主动发送配置 BPDU，其他交换机在收到上游传来的配置 BPDU 后，才会发送自己的配置 BPDU。</li>\n<li>[5] TCN BPDU 是指下游交换机感知到拓扑发生变化时向上游发送的拓扑变化通知。</li>\n<li>[6] 配置 BPDU 中包含了足够的信息来保证设备完成生成树计算，其中包含的重要信息如下：</li>\n<li>根桥 ID：由根桥的优先级和 MAC 地址组成，每个 STP 网络中有且仅有一个根桥。</li>\n<li>根路径开销：到根桥的最短路径开销。</li>\n<li>指定桥 ID：由指定桥的优先级和 MAC 地址组成。</li>\n<li>指定端口 ID：由指定端口的优先级和端口号组成。</li>\n<li>Message Age：配置 BPDU 在网络中传播的生存期。</li>\n<li>MAX Age：配置 BPDU 在设备中能够保存的最大生存期。</li>\n<li>Hello Time：配置 BPDU 发送的周期。</li>\n<li>Foeward Delay：端口状态迁移的延时。</li>\n</ul>\n<p class=\"red\">11，计时器：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fmKzT.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：配置 BPDU 报文每经过一个交换机，Message Age 都加 1。</ins></li>\n<li><ins class=\"wavy\">注：如果 Message Age 大于 MAx age，非根桥会丢弃该配置 BPDU。</ins></li>\n<li>[2] STP 协议包含一些重要的时间参数，如下：</li>\n<li>Hello Time 是指运行 STP 协议的设备发送配置 BPDU 的时间间隔，用于检测链路是否在故障，交换机每隔 Hello Time 时间会向周围的交换机发送配置 BPDU 报文，以确认链路是否存在故障。当网络拓扑稳定后，该值只有在根桥上修改才有效。</li>\n<li>Message Age 是从根桥发送到当前交换机接收到 BPDU 的总时间，包括传输延时等，如果配置 BPDU 是根桥发出的，则 Message Age 为 0，实际现实中，配置 BPDU 报文每经过一个交换机，Message Age 增加 1。</li>\n<li>Max Age 是指 BPDU 报文的老化时间，可在根桥上通过命令人为改动这个值，Max Age 通过配置 BPDU 报文的传递，可以保证 Max Age 在整网中一致。非根桥设备收到配置 BPDU 报文后，会将报文中的 Message Age 和 Max Age 进行比较，如果 Message Age 小于等于 Max Age，则该非根桥设备会继续转发配置 BPDU 报文。如果 Message Age 大于 Max Age，则该配置 BPDU 报文将被老化掉，该非根桥设备将直接丢弃改配置 BPDU，并认为是网络直径过大，导致了根桥连接失败。</li>\n</ul>\n<p class=\"red\">12，根桥故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fu5Is.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根桥会在 BPDU 老化之后开始根桥的重新选举。</ins></li>\n<li>[2] 在稳定的 STP 拓扑中，非根桥会定期收到来自根桥的 BPDU 报文。</li>\n<li>[3] 如果根桥发生了故障，停止发送 BPDU 报文，下游交换机就无法收到来自根桥的 BPDU 报文。</li>\n<li>[4] 如果下游交换机一直接收不到 BPDU 报文，Max Age 定时器就会超时 (Max Age 的默认值为 20 秒)，从而导致已经收到的 BPDU 报文失效，此时，非根交换机会互相发送配置 BPDU 报文，重新选举新的根桥。</li>\n<li>[5] 根桥故障会导致 50 秒左右的恢复时间，恢复时间约等于 Max Age 加上两倍的 Forward Delay 收敛时间。</li>\n</ul>\n<p class=\"red\">13，直连链路故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fKznS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：SWB 检测到直连链路物理故障后，会将预备端口转换为根端口。</ins></li>\n<li><ins class=\"wavy\">注：SWB 新的根端口会在 30 秒后恢复到转发状态。</ins></li>\n<li>[2] 上图：SWA 和 SWB 使用了两条链路互联，其中一条是主线路，另外一条是备份链路，生成树正常收敛后，如果 SWB 检测到根端口的链路发生物理故障，则其 Alternate 端口会迁移到 Listening，Learning，Forwarding 状态，经过两倍的 Forwarding Delay 后恢复到转发状态。</li>\n</ul>\n<p class=\"red\">14，非直连链路故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fQPbD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非直连链路故障后，SWC 的预备端口恢复到转发状态大约需要 50 秒。</ins></li>\n<li>[2] 上图，SWB 和 SWA 之间的链路发生了某种故障 (非物理层故障)，SWB 因此一直收不到来自 SWA 的 BPDU 报文，等待 Max Age 定时器超时后，SWB 会认为根桥 SWA 不再有效，并认为自己是根桥，于是开始发送自己的 BPDU 报文给 SWC，通知 SWC 自己作为新的根桥。</li>\n<li>[3] 在此期间，由于 SWC 的 Alternate 端口再也不能收到包含原根桥 ID 的 BPDU 报文，其 Max Age 定时器超时后，SWC 会切换 Alternate 端口为指定端口并且转发来自其根端口的 BPDU 报文给 SWB，所以，Max Age 定时器超时后，SWB SWC 几乎同时会收到对方发来的 BPDU。</li>\n<li>[4] 经过 STP 重新计算后，SWB 放弃宣称自己是根桥并重新确定端口角色。</li>\n<li>[5] 非直连链路故障后，由于需要等待 Max Age 加上两倍的 Forwarding Delay 时间，端口大约 50 秒才能恢复到转发状态。</li>\n</ul>\n<p class=\"red\">15，拓扑改变导致 MAC 地址表错误 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6flvX6.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：MAC 地址表项的默认老化时间是 300 秒，在这段时间内，SWB 无法将数据从 G0/0/2 端口转发给主机 B。</ins></li>\n<li>[2] 在交换网络中，交换机依赖 MAC 地址表转发数据帧，缺省情况下，MAC 地址表的老化时间是 300 秒，如果生成树拓扑发生变化，交换机转发数据的路径也会随着发生变化，此时 MAC 地址表中未及时老化掉的表项会导致数据转发错误，因此在拓扑发生变化后需要及时更新 MAC 地址表项。</li>\n<li>[3] 上图，SWB 的 MAC 地址表项定义了通过端口 G0/0/3 可以到达主机 A，通过端口 G0/0/1 可以到达主机 B，由于 SWC 的根端口发生故障，导致生成树拓扑重新收敛，在生成树拓扑完成收敛之后，从主机 A 到主机 B 的帧仍然不能到达目的地，这是因为 MAC 地址表项老化时间是 300 秒主机 A 发往主机 B 的帧到达 SWB 后，SWB 会继续通过端口 G0/0/1 转发该数据帧。</li>\n</ul>\n<p class=\"red\">16，拓扑改变导致 MAC 地址表错误 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f1X5Q.png\" alt=\"图片\"></li>\n<li>[2] 拓扑变化过程中，根桥通过 TCN BPDU 报文获知生成树拓扑里发生了故障，根桥生成 TC 以来通知其他交换机加速老化现有的 MAC 地址表项。</li>\n<li>[3] 拓扑变更以及 MAC 地址表项更新的具体过程如下：</li>\n<li>SWC 感知到网络拓扑发生变化后，会不间段地向 SWB 发生 TCN BPDU 报文。</li>\n<li>SWB 收到 SWC 发来的 TCN BPDU 报文后，会把配置 BPDU\t报文中的 Flags 的 TCA 位设置 1，然后发送给 SWC，告知 SWC 停止发送 TCN BPDU 报文。</li>\n<li>SWB 向根桥转发 TCN BPDU 报文。</li>\n<li>SWA 把配置 BPDU 报文中的 Flags 的 TC 位置设置为 1 后发送，通知下游设备把 MAC 地址表项的老化时间由默认的 300 秒修改为 Forward Delay 的时间 (默认为 15 秒)。</li>\n<li>最多等待 15 秒后，SWB 中的错误 MAC 地址表项会被自动清除，此后，SWB 就能重新开始 MAC 表项的学习及转发操作。</li>\n</ul>\n<p class=\"red\">17，STP 模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fGbb6.png\" alt=\"图片\"></li>\n<li>[2] 华为 X7 系列交换机支持三种生成树协议模式。</li>\n<li>[3] stp mode {mstp|stp|rstp} 命令用来配置交换机的生成树协议模式，缺省情况下，华为 X7 系列交换机工作在 MSTP 模式，在使用 STP 前，STP 模式必须重新配置。</li>\n</ul>\n<p class=\"red\">18，配置交换机优先级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fJ2QA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：通过修改交换机的优先级，可以配置交换机为根交换机。</ins></li>\n<li>[2] 基于企业业务对网络的需求，一般建议手动指定网络中配置高，性能好的交换机为根桥。</li>\n<li>[3] 可以通过配置桥优先级来指定网络中的根桥，以确保企业网络里面的数据流量使用的是最优路径转发。</li>\n<li>[4] stp priority 命令用来配置设备优先级值，priority 值为整数，取值范围为 0 到 61440，步长为 4096. 缺省情况下，交换设备的优先级取值是 32768。另外，可以通过 Stp root primary 命令指定生成树里的根桥。</li>\n</ul>\n<p class=\"red\">19，配置路径开销：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fYG0P.png\" alt=\"图片\"></li>\n<li>[2] 华为 X7 系列交换机支持三种路径开销标准，以确保和友商设备保持兼容。缺省情况下，路基开销标准为 IEEE 802.1t。</li>\n<li>[3] stp pathcost-standard {dot1d-1998|dot1t|legacy} 命令用来配置指定交换机上路径开销值的标准。</li>\n<li>[4] 每个端口的路径开销也可以手动指定。此 STP 路径开销控制方法须谨慎使用，手动指定端口的路径开销可能会生成次优生成树拓扑。</li>\n<li>stp cost cost 命令取决于路径开销计算方法：</li>\n<li>使用华为的私有计算方法时，cost 取值范围是 1~200000。</li>\n<li>使用 IEEE 802.1d 标准方法时，cost 取值范围是 1~65535。</li>\n<li>使用 IEEE 802.1t 标准方法时，cost 取值范围是 1~200000000。</li>\n</ul>\n<p class=\"red\">20，配置验证 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6ftdUK.png\" alt=\"图片\"></li>\n<li>[2] display stp 命令用来检查当前交换机的 stp 配置，命令输出中信息介绍如下：</li>\n<li>CIST Bridge 参数标识指定交换机当前桥 ID，包含交换机的优先级和 MAC 地址。</li>\n<li>Bridge Time 参数标识 HEllo 计时器，Forward Delay 计时器，Max Age 计时器</li>\n<li>CIST Root/ERPC 参数标识根桥 ID 以及交换机到根桥的根路径开销。</li>\n</ul>\n<p class=\"red\">21，配置验证 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] display stp 命令显示交换机上所有端口信息。</li>\n<li>[2] display stp interface interface 命令显示交换机上指定端口信息。</li>\n<li>[3] 其他一些信息还包括端口角色，端口状态，以及使用的保护机制等。</li>\n</ul>\n<p class=\"red\">22，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 根桥产生故障后，其他交换机会被选举为根桥，那么原来的根桥恢复正常后，网络又会发生什么变化呢？</li>\n<li>如果生成树网络里面根桥发生了故障，则其他交换机中优先级最高的交换机会被选举为新的根桥。如果原来的根桥再次激活，则网络又会根据 BID 来重新选举新的根桥。</li>\n<li>[2] 端口开销和根路径开销的区别是什么？</li>\n<li>根路径开销是到根桥的路径的总开销，而端口开销指的是交换机某个端口的开销。</li>\n</ul>\n<h1 id=\"第十四章rstp原理与配置\"><a class=\"anchor\" href=\"#第十四章rstp原理与配置\">#</a> 第十四章【RSTP 原理与配置】</h1>\n<p>+++primarily 前言</p>\n<ul>\n<li class=\"red\">STP 协议虽然能够解决环路问题，但是收敛速度慢，影响用户通信质量，如果 STP 网络的拓扑结构频繁变化，网络也会频繁失去连通性，从而导致用户通信频繁中断，IEEE 于 2001 年发布的 802.1w 标准定义了快速生成树协议 RSTP (Rapid Spanning-Tree Protocol)，RSTP 在 STP 的基础上进行了改进，实现了网络拓扑快速收敛。<br>\n+++<br>\n1，STP 不足：</li>\n</ul>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fdvwR.png\" alt=\"图片\"></li>\n<li>[2] STP 能够提供无环网络，但是收敛速度较慢，如果 STP 网络的拓扑结构频繁变化，网络也会随之频繁失去连通性，从而导致用户通信频繁中断。</li>\n<li>[3] RSTP 使用了 Proposal/Agreement 机制保证链路及时协商，从而有效避免收敛计时器在生成树收敛前超时，如上图，在交换网络中，P/A 过程可以从根桥向下游级联传递。</li>\n</ul>\n<p class=\"red\">2，RSTP 端口角色：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fwMp8.png\" alt=\"图片\"></li>\n<li>[2] 运行 RSTP 的交换机使用了两个不同的端口角色来实现冗余备份，当到根桥的当前路径出现故障时，作为根端口的备份端口，Alternate 端口提供了从一个交换机到根桥的另一条可切换路径。</li>\n<li>[3] Backup 端口作为指定端口的备份，提供了另一条从根桥到相应 LAN 网段的备份路径，当一个交换机和一个共享媒介设备，例如 Hub 建立两个或者多个连接时，可以使用 Backup 端口，同样，当交换机上两个或者多个端口和同一个 LAN 网段链连接时，也可以使用 Backup 端口。</li>\n</ul>\n<p class=\"red\">3，RSTP 边缘端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fwoBd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：边缘端口不接收处理配置 BPDU，不参与 RSTP 运算。</ins></li>\n<li>[2] RSTP 里，位于网络边缘的指定端口被称为边缘端口，边缘端口一般与用户终端设备直接连接，不与任何交换设备连接。</li>\n<li>[3] 边缘端口不接收配置 BPDU 报文，不参与 RSTP 运算，可以由 Disabled 状态直接转到 Forwarding 状态，且不经历时延，就像在端口上将 STP 禁用了一样。</li>\n<li>[4] 但是，一旦边缘端口收到配置 BPDU 报文，就丧失了边缘端口的属性，成为普通 STP 端口，并重新进行生成树计算，从而引起网络震荡。</li>\n</ul>\n<p class=\"red\">4，端口状态：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f0mDJ.png\" alt=\"图片\"></li>\n<li>[2] RSTP 把原来的 STP 的五种端口状态简化成了三种。</li>\n<li>Discarding 状态：端口既不转发用户流量也不学习 MAC 地址。</li>\n<li>Learning 状态：端口不转发用户流量但是学习 MAC 地址。</li>\n<li>Forwarding 状态：端口即转发用户流量又学习 MAC 地址。</li>\n</ul>\n<p class=\"red\">5，RST BPDU(1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f0gbj.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：STP 的配置 BPDU 中 Flag 字段的中间 6 位在 RSTP 中得到了应用。</ins></li>\n<li>[2] 除了部分参数不同，RSTP 使用了类似 STP 的 BPDU\t报文，即 RST BPDU 报文。BPDU Type 原来区分 STP 的 BPDU 报文和 RST (Rapid Spanning Tree) BPDU 报文。</li>\n<li>[3] STP 的配 BPDU 报文的 BPDU Type 值为 0 (0X00)，TCN BPDU 报文的 BPDU Type 值为 128 (0X80)，RST BPDU 报文的 BPDU Type 值为 2 (\t0X02)。</li>\n<li>[4] STP 的 BPDU 报文的 Flags 字段只定义了拓扑变化 TC (Topology Change) 标志和拓扑变化确认 TCA (Topology Change Acknowledgment) 标志，其他字段保留。</li>\n<li>[5] 在 RST BPDU 报文里的 Flags 字段，还使用了其他字段，包括 P/A 进程字段和定义端口状态的字段。Forward，Learning，与 Port Role 表示发出的 BPDU 的端口的状态和角色。</li>\n</ul>\n<p class=\"red\">6，RST BPDU(2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fBYWV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根桥设备无论是否接收到根桥发送的配置 BPDU，都会按照 Hello Timer 规定的时间间隔发送配置 BPDU。</ins></li>\n<li>[2] STP 中，当网络拓扑稳定后，根桥依据 Hello Timer 规定的时间间隔发送配置 BPDU 报文，其他非根桥设备在收到上游设备发送过来的配置 BPDU 报文后，才会触发发出配置 BPDU 报文。</li>\n<li>[3] 此方式使得 STP 协议计算复杂且缓慢，RSTP 对此进行了改进，即在拓扑稳定后，无论非根桥设备是否接收到根桥传来的配置 BPDU 报文，非根桥设备都会仍然按照 Hello Timer 规定的时间间隔发送配置 BPDU，该行为完全由每台设备自主进行。</li>\n</ul>\n<p class=\"red\">7，RSTP 收敛过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/20/6fBql8.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每台交换机启动 RSTP 后，都认为自己是 “根桥”，并且发送 RST BPDU。所有端都为指定端口，处于 Discarding 状态。</ins></li>\n<li>[2] RSTP 收敛遵循 STP 的基本原理，网络初始化时，网络中所有的 RSTP 交换机都认为自己是 &quot;根桥&quot;，并设置每个端口为指定端口。此时，端口为 Discarding 状态。</li>\n</ul>\n<p class=\"red\">8，RSTP 收敛过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/20/6fD9f0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机互相发送 Proposal 置位的 RST BPDU。</ins></li>\n<li><ins class=\"wavy\">注：SWA 收到 SWB 的 RST BPDU，会忽略。</ins></li>\n<li>[2] 每个认为自己是 “根桥” 的交换机生成一个 RST BPDU 报文来协商指定网段的端口状态，此 RST BPDU 报文的 Flags 字段里面的 Proposal 位需要置位。</li>\n<li>[3] 当一个端口收到 RST BPDU 报文时，此端口会比较收到的 RST BPDU 报文和本地的 RST BPDU 报文，如果本地的 RST BPDU 报文优于接收到的 RST BPDU 报文，则端口会丢弃接收到的 RST BPDU 报文，并发送 Proposal 置位的本地 RST BPDU 报文来回复对端设备。</li>\n</ul>\n<p class=\"red\">9，RSTP 收敛过程 (3)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64QIJJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：SWB 收到了更优的 RST BPDU，于是停止发送 RST BPDU，并开始执行同步。</ins></li>\n<li>[2] 交换机使用同步机制来实现端口角色协商管理，当收到 Proposal 置位并且优先级最高的 BPDU 报文时，接收交换机必须设置所有下游指定端口为 Discarding 状态。</li>\n<li>[3] 如果下游端口是 Alternate 端口或者边缘端口，则端口状态保持不变。</li>\n<li>[4] 上图，说明了下游指定端口暂时迁移到 Discarding 状态的情形，因此，P/A 进程中任何帧转发都将被阻止。</li>\n</ul>\n<p class=\"red\">10，RSTP 收敛过程 (4)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lCQI.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：阻塞所有非边缘端口之后，SWB 将发送一个 Agreement 置位的 RST BPDU。</ins></li>\n<li>[2] 当确认下游指定端口迁移到 Discarding 状态后，设备发送 RST BPDU 报文回复上游交换机发送的 Proposal 消息。</li>\n<li>[3] 上图，端口已经确认为根端口，因此 RST BPDU 报文 Flags 字段里面设置了 Agreement 标记位和根端口角色。</li>\n</ul>\n<p class=\"red\">11，RSTP 收敛过程 (5)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lUp9.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：P/A 进程向下游继续传递，SWB 和 SWC 会继续进行收敛。</ins></li>\n<li>[2] 在 P/A 进程的最后阶段，上游交换机收到 Agreement 置位的 RST BPDU 报文后指定端口立即从 Discarding 状态迁移到 Forwarding 状态，然后，下游网段开始使用同样的 P/A 进程协商端口角色。</li>\n</ul>\n<p class=\"red\">12，链路故障 / 根桥失效：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lW6I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：链路故障或者根桥失效都会导致交换机收不到邻居发送的 RST BPDU。在 RSTP 中，3 倍的 Hello Timer 内收不到邻居的 BPDU 即认为邻居是失效。</ins></li>\n<li>[2] 在 STP 中，当出现链路故障或者根桥失效导致交换机收不到 BPDU 时，交换机需要等待 Max Age 时间后才能确认出现了故障。</li>\n<li>[3] 而在 RSTP 中，如果交换机的端口在连续 3 次 Hello Timer 规定的时间间隔内没有收到上游交换机发送的 RST BPDU，便会确认本端口和对端端口的通信失败，从而需要重新进行 RSTP 的计算来确定交换机及端口角色。</li>\n</ul>\n<p class=\"red\">13，RSTP 拓扑变化处理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6411gA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：其他交换机收到 TC 置位的 BPDU 后，清空所有其他端口学习到的 MAC 导致，收到 TC BPDU 的端口 b 不清空。</ins></li>\n<li>[2] RSTP 拓扑变化的处理类似 STP 拓扑变化的处理，但也有些细微的差别。</li>\n<li>[3] 上图，SWC 发生链路故障，SWA 和 SWC 立即检测出链路故障并清除连接此链路的端口上的 MAC 地址表项。</li>\n<li>[4] 接下来 SWC 选举出新的根端口并立即进入 Forwarding 状态，因此，触发 SWC 向外发送 TC 置位的 BPDU 报文 (简称 TC 报文)，通知上游交换机清除所有其他端口上的 MAC 地址表项，除了接收到 TC 报文的端口。</li>\n<li>[5] TC 报文周期性的转发给邻居，在此周期内，所有相关接口上 MAC 地址表项将会被清除，重新学习 MAC 地址表项。</li>\n<li>[6] 上图，图形里面红色 X 表示，由于拓扑变化导致端口上的 MAC 地址表项被清除。</li>\n</ul>\n<p class=\"red\">14，STP 兼容：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/643mMn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：运行 RSTP 的交换设备在谋端口上接收到运行 STP 的交换设备发出的配置 BPDU，会把该端口转换到 STP 工作模式。</ins></li>\n<li>[2] RSTP 是可以与 STP 实现后向兼容的，但在实际中，并不推荐这种做法，原因是 RSTP 会失去其快速收敛的优势，而 STP 慢速收敛的缺点会被暴露出来。</li>\n<li>[3] 当同一个网段里既有运行 STP 的交换机又有运行 RSTP 的交换机时，STP 交换机会忽略接收到的 RST BPDU，而 RSTP 交换机在某端口上接收到 STP BPDU 时。会等待两个 Hello Timer 时间之后，把自己的端口转换到 STP 工作模式，此后便发送 STP BPDU，这样就实现了兼容性操作。</li>\n</ul>\n<p class=\"red\">15，配置 STP 模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/643Oe0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：执行命令后，SWA 所有端口都工作在 RSTP 模式。</ins></li>\n<li>[2] 在 Sx7 交换机上，可以使用 stp mode rstp 命令来配置交换机工作在 RSTP 模式。</li>\n<li>[3] stp mode rstp 命令在系统视图下执行，此命令必须在所有参与快速生成树拓扑计算机的交换机上配置。</li>\n</ul>\n<p class=\"red\">16，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64GsKA.png\" alt=\"图片\"></li>\n<li>[2] display stp 命令可以显示 RSTP 配置信息的参数，根据显示信息可以确认交换机是否工作在 RSTP 模式。</li>\n</ul>\n<p class=\"red\">17，配置边缘端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64GoKs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：边缘端口可以由 Disable 直接转到 Forwarding 状态，不经历时延。</ins></li>\n<li><ins class=\"wavy\">注：Sx7 系列交换机默认所有端口都工作在非边缘端口。</ins></li>\n<li>[2] 边缘端口完全不参与 STP 或 RSTP 计算，边缘端口的状态要么是 Disabled，要么是 Forwarding，终端上电工作后，他就直接由 Disabled 状态转到 Forwarding 状态，终端下电后，他就直接由 Forwarding 状态转到 Disabled 状态。</li>\n<li>[3] 交换机所有端口默认为非边缘端口。</li>\n<li>[4] stp edged-port enable 命令用来配置交换机的端口为边缘端口，它是一个针对某一具体端口的命令。</li>\n<li>[5] stp edged-port default 命令用来配置交换机的所有端口为边缘端口。</li>\n<li>[6] stp edged-port disable 命令用来将边缘端口的属性去掉，使之成为非边缘端口，他也是一个针对某一具体端口的命令。</li>\n<li>[7] 需要注意的是，华为 Sx7 系列交换机运行 STP 时也可以使用边缘端口设置。</li>\n</ul>\n<p class=\"red\">18，根保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64YR1g.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：根保护功能确保了根桥的指定端口不会因为一些网络问题而改变端口角色。</ins></li>\n<li>[2] 由于错误配置根交换机或网络中的恶意攻击，根交换机有可能会收到优先级更高的 BPDU 报文，使得根交换机变长非根交换机，从而引起网络拓扑结构的变动。</li>\n<li>[3] 这种不合法的拓扑变化，可能会导致原来应该通过高速链路的流量被牵引到低速链路上，造成链路阻塞。</li>\n<li>[4] 交换机提供了根保护功能来解决此问题，根保护功能通过维持指定端口角色从而保护根交换机。</li>\n<li>[5] 一旦启用了根保护功能的指定端口收到了优先级更高的 BPDU 报文时，端口会停止转发报文并进入 Listening 状态，经过一段时间后，如果端口一直没有在收到优先级较高的 BPDU 报文，端口就会自动恢复到原来的状态。</li>\n<li>[6] 根保护功能仅在指定端口生效，不能配置在边缘端口或者使能了环路保护功能的端口上。</li>\n</ul>\n<p class=\"red\">19，BPDU 保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tZDA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：配置 BPDU 保护功能后，如果边缘端口收到 BPDU 报文，边缘端口将会被立即关闭，并通知网管系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</ins></li>\n<li>[2] 正常情况下，边缘端口是不会收到 BPDU 的，但是，如果有人发送 BPDU 来进行恶意攻击时，边缘端口就会收到这些 BPDU，并自动变为非边缘端口，且开始参与网络拓扑计算，从而会增加整个网络的计算工作量，并可能引起网络震荡。</li>\n<li>[3] 为了防止上述情况发生，可以使用 BPDU 保护功能。使能 BPDU 保护功能后的交换机的边缘端口在收到 BPDU 报文时，会立刻关闭该端口，并通知网络管理系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</li>\n<li>[4] 如果使能 BPDU 保护功能，可在系统试图下执行 stp bpdu-protection 命令。</li>\n</ul>\n<p class=\"red\">20，环路保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tUU0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：根端口如果长时间收不到来自上游的 BPDU，则进入 Discarding 状态，避免在网络中形成环路。</ins></li>\n<li>[2] 交换机通过从上游交换机持续收到 BPDU 报文来维护根端口和阻塞端口的状态，当由于链路拥塞或者单项链路故障时，交换机不能收到上游交换机发送的 BPDU 报文，交换机重新选择根端口，最初的根端口会变成指定端口，阻塞端口进入 Forwarding 状态，这就有可能造成网络环路。</li>\n<li>[3] 交换机提供了环路保护功能来避免这种环路的产生，环路保护功能使能后，如果根端口不能收到上游交换机发送的 BPDU 报文，则向网管发出通知信息，根端口会被阻塞，阻塞端口仍然将保持阻塞状态，这样就避免了可能发生的网络环路。</li>\n<li>[4] 如需使能环路保护功能，可以在接口视图下执行 stp loop-protection 命令。</li>\n</ul>\n<p class=\"red\">21，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tR56.png\" alt=\"图片\"></li>\n<li>[2] display stp interface (接口名) 命令可以显示端口的 RSTP 配置情况，包括端口状态，端口优先级，端口开销，端口角色，是否为边缘端口等待。</li>\n</ul>\n<p class=\"red\">22，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] P/A 机制中同步的作用是什么？</li>\n<li>P/A 机制是 RSTP 网络中的一种拓扑收敛机制，P/A 机制中同步的作用是避免临时环路的产生。</li>\n</ul>\n<h1 id=\"第十五章ip路由基础\"><a class=\"anchor\" href=\"#第十五章ip路由基础\">#</a> 第十五章【IP 路由基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>以太网交换机工作在数据链路层，用于在网络内进行数据的转发，而企业网络的拓扑结构一般会比较复杂，不同的部门，或者总部和分支可能处在不同的网络中，此时就需要使用路由器来连接不同的网络，实现网络之间的是数据转发。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，自治系统：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64NPZn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：自治系统 (AS)：由同一个管理机构管理，使用统一路由策略的路由器的集合。</ins></li>\n<li>[2] 一般情况下，我们可以把一个企业网络认为是一个自治系统 AS (Autonomous System)。根据 RFC1030 的定义，自治系统是由一个单一实体管辖的网络。这个实体可以是一个互联网服务提供商，或一个大型组织机构。</li>\n<li>[3] 自治系统内部遵循一个单一且明确的路由策略，最初，自治系统内部只考虑运行单个路由协议，然而，随着网络的发展，一个自治系统内现在也可以支持同时运行多种路由协议。</li>\n</ul>\n<p class=\"red\">2，LAN 和广播域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64N3i6.png\" alt=\"图片\"></li>\n<li>[2] 一个 AS 通常由多个不同的局域网组成，以企业网络为例，各个部门属于不同的局域网，或者各个分支机构和总部也可以属于不同的局域网。</li>\n<li>[3] 局域网内的主机可以通过交换机来实现通信，不同局域网之间的主机要想相互通信，可以通过路由器来实现。</li>\n<li>[4] 路由器工作在网络层，隔离了广播域，并可以作为每个局域网的网关，发现到达目的网络的最优路径，最终实现报文在不同网络间的转发。</li>\n<li>[5] 上图，RTA 和 RTB 把整个网络分成了三个不同的局域网，每个局域网为一个广播域。</li>\n<li>[6] LAN1 内部的主机直接可以通过交换机实现相互通信，LAN2 内部的主机也是如此，但是 LAN1 内部的主机与 LAN2 内部的主机之间则必须要通过路由器才能实现相互通信。</li>\n</ul>\n<p class=\"red\">3，路由选路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/645FG8.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器负责为数据包选择一条最优路径，并进行转发。</ins></li>\n<li>[2] 路由器收到数据包后，会根据数据包中的目的 IP 地址选择一条最优路径，并将数据包转发到下一个路由器，路径上最后的路由器负责将数据包送交目的主机。</li>\n<li>[3] 数据包在网络上的传输就好像是体育运动中的接力赛一样，每个路由器负责将数据包按照最优的路径向下一跳路由器进行转发，通过多个路由器一站一站的接力，最终将数据包通过最优路径转发到目的地，当然有时候由于实施了一些特别的路由策略，数据包通过的路径可能并不是最佳的。</li>\n<li>[4] 路由器能够决定数据报文的转发路径，如果由多条路径可以到达目的地，则路由器会通过进行计算来决定最佳下一跳，计算的原则会随实际使用的路由协议不同而不同。</li>\n</ul>\n<p class=\"red\">4，IP 路由表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64ISlF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由表中包含了路由器可以到达的目的网络，目的网络在路由表中不存在的数据包会被丢弃。</ins></li>\n<li>[2] 路由器转发数据包的关键是路由表，每个路由器都保存着一张路由表，表中每条路由表项都指明了数据包要到达某网络或者某主机应通过路由器的那个物理接口发送，以及可到达该路径的哪个下一跳路由器，或者不再别的路由器而直接可以到达目的地。</li>\n<li>[3] 路由表中包含了下列关键项：</li>\n<li>目的地址 (Destination)：用来标识 IP 数据包的目的地址或目的网络。</li>\n<li>网络掩码 (Mask)：IP 地址与网络掩码进行逻辑与运算便可以得到相应的网段信息，上图，目的地址为 8.0.0.0 255.0.0.0 相与后便可以得到一个 A 类的网段信息 (8.0.0.0/8)。网络掩码的另一个作用还表现在当路由表中由多条目的地址相同的路由信息时，路由器将选择其掩码最长的一项作为匹配项。</li>\n<li>[4] 输出端口 (Interface)：指明 IP 数据包将从该路由器的哪个接口转发出去。</li>\n<li>[5] 下一跳 IP 地址 (NextHop)：指明 IP 数据包所经由的下一跳路由器的接口地址。</li>\n<li>[6] 路由器中的优先级，度量值等其他的字段以后介绍。</li>\n</ul>\n<p class=\"red\">5，路由优先级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64oMgU.png\" alt=\"图片\"></li>\n<li>[2] 路由器可以根据多种不同协议学习到去往同一目的网络的路由，当这些路由都符合最长匹配原则时，必须决定哪个路由优先。</li>\n<li>[3] 每个路由协议都由一个协议优先级 (取值最小，优先级越高)。当有多个路由信息时，选择最高优先级的路由作为最佳路由。</li>\n<li>[4] 上图，路由器通过两种路由协议学习到了网段 10.1.1.0 的路由，虽然 RIP 协议提供了一条看起来更加近的路线，但是由于 OSPF 具有更高的优先级，因而成为优选路由，并被加入路由表中。</li>\n</ul>\n<p class=\"red\">6，路由度量：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65p3Af.png\" alt=\"图片\"></li>\n<li>[2] 如果路由器无法用优先级来判断最优路由，则使用度量值 (Metric) 来决定需要加入路由表的路由。</li>\n<li>[3] 一些常用的度量值有：跳数，带宽，时延，代价，负载，可靠性等。</li>\n<li>[4] 跳数是指到达目的地所通过的路由器数目。</li>\n<li>[5] 带宽是指链路的容量，高速链路开销 (度量值) 较小。</li>\n<li>[6] metric 值越小，路由越优先，因此上图中 metric=1+1=2 的路由是到达目的地的最优路由，其表项可以在路由表中找到。</li>\n</ul>\n<p class=\"red\">7，建立路由表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/659rqI.png\" alt=\"图片\"></li>\n<li>[2] 根据比较 “路由优先级” 和 “路由度量”，设备可以产生最优路径的 IP 路由表。</li>\n<li>[3] 根据来源的不同，路由表中的路由通常可分为以下三类：</li>\n<li>链路层协议发现的路由 (也称为接口路由或直连路由)。</li>\n<li>由网络管理员手工配置的静态路由。</li>\n<li>动态路由协议发现的路由。</li>\n</ul>\n<p class=\"red\">8，最长匹配原则：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/659HoV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由表中如果有多个匹配目的网络的路由条目，则路由器会选择掩码最长的条目。</ins></li>\n<li>[2] 路由器在转发数据时，需要选择路由表中的最优路由，当数据报文到达路由器时，路由器首先提取出报文的目的 IP 地址，然后查找路由表，将报文的目的 IP 地址与路由表中某表项的掩码字段做 “与” 操作，“与” 操作后的结构跟路由表该表项的目的 IP 地址比较，相同则匹配上，否则就没有匹配上，当与所有的路由表项都进行匹配后，路由器会选择一个掩码最长的匹配项。</li>\n<li>[3] 如上图，路由表中有两个表项到达目的网段 10.1.1.0，下一跳地址都是 20.1.1.2。如果要将报文转发至网段 10.1.1.1，则 10.1.1.0/30 符合最长匹配原则。</li>\n</ul>\n<p class=\"red\">9，路由器转发数据包：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Cq0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器需要找到下一跳和出接口才能将数据转发出去。</ins></li>\n<li>[2] 路由器收到一个数据包后，会检查其目的 IP 地址，然后查找路由表，查找到匹配的路由表项之后，路由器会根据该表项所指示的出接口信息和下一跳信息将数据包转发出去。</li>\n</ul>\n<p class=\"red\">10，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 路由器选择最优路由的顺序是什么？</li>\n<li>路由器在选择最优路由时，会首先根据路由的优先级选择哪些路由可以放入路由表，如果优先级相等，再比较 metric 数值，决定哪些路由放入路由表，最后在查路由表时根据最长掩码匹配原则选择路由表项指导数据报文转发。</li>\n<li>[2] Preference 字段在路由表中代表什么含义？</li>\n<li>Preference 字段在路由表中代表了路由优先级，设备厂商会在各自的产品中为不同的路由协议规定不同的优先级。</li>\n</ul>\n<h1 id=\"第十六章静态路由基础\"><a class=\"anchor\" href=\"#第十六章静态路由基础\">#</a> 第十六章【静态路由基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>静态路由是指由管理员手动配置和维护的路由</li>\n<li>静态路由配置简单，被广泛地应用于网络中，另外，静态路由还可以实现负载均衡和路由备份，因此，学习并掌握好静态路由的应用与配置是非常必要的。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，静态路由应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65F9wn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：静态路由是指由管理员手动配置和维护的路由。</ins></li>\n<li>[2] 静态路由是指由管理员手动配置和维护的路由，静态路由配置简单，并且无需像动态路由那样占用路由的 CPU 资源来计算和分析路由更新。</li>\n<li>[3] 静态路由的缺点在于，当网络拓扑发生变化时，静态路由不会自动适应拓扑改变，而是需要管理员手动进行调整。</li>\n<li>[4] 静态路由一般适用于结构简单的网络，在复杂网络环境中，一般会使用动态路由协议来生成动态路由。不过，即使在复杂的网络环境中，合理地配置一些静态路由也可以改进网络的性能。</li>\n</ul>\n<p class=\"red\">2，静态路由配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65k6C6.png\" alt=\"图片\"></li>\n<li>[2] ip route-static 命令用来配置静态路由，参数 ip-address 指定了一个网络或者主机的目的地址，参数 mask 指定了一个子网掩码或者前缀长度。</li>\n<li>[3] 如果使用了广播接口如以太网接口作为出接口，则必须要指定下一跳地址，如果使用了串口作为出接口，则可以通过参数 interface-type 和 interface-number (如，Serial1/0/0) 来配置出接口。此时不必指定下一跳地址。</li>\n</ul>\n<p class=\"red\">3，静态路由 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65AAr4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在串行接口上，可以通过指定下一跳地址或者出接口来配置静态路由。</ins></li>\n<li>[2] 静态路由可以应用在串行网络或者以太网中，但静态路由在这两种网络中的配置有所不同。</li>\n<li>[3] 在串行网络中配置静态路由时，可以只指定下一跳地址或只指定出接口。华为 ARG3 下列路由器中，串行接口默认封装 PPP 协议，对于这种类型的接口，静态路由的下一跳地址就是与接口相连的对端接口的地址，所以在串行网络中配置静态路由时可以只配置出接口。</li>\n<li>[4] 以太网是广播类型的网络。和串行网络情况不同，在以太网中配置静态路由，必须指定下一跳地址。</li>\n</ul>\n<p class=\"red\">4，静态路由 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65AxyD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在广播类型的接口 (如以太网接口) 上配置静态路由时，必须要指定下一跳地址。</ins></li>\n<li>[2] 在广播型的接口上配置静态路由时，必须明确指定下一跳地址，以太网中同一网络可能连接了多台路由器，如果在配置静态路由时只指定了出接口，则路由器无法将报文转发到正确的下一跳。</li>\n<li>[3] 上图，RTA 需要将数据转发到 192.168.2.0/24 网络，在配置静态路由时，需要明确指定下一跳地址为 10.0.123.2，否则，RTA 将无法将报文转发到 RTB 所连接的 192.168.2.0/24 网络，因为 RTA 不知道应该通过 RTB 还是 RTC 才能到达目的地。</li>\n</ul>\n<p class=\"red\">5，负载分担：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65VwDg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：静态路由支持到达同一目的地的等价负载分担。</ins></li>\n<li>[2] 当源网络和目的网络之间存在多条链路时，可以通过等价路由来实现流量负载分担。这些等价路由具有相同的目的网络和掩码，优先级和度量值。</li>\n<li>[3] 上图，RTA 和 RTB 之间有两条链路相连，通过使用等价的静态路由来实现流量负载分担。</li>\n<li>[4] 在 RTB 上配置了两条静态路由，他们具有相同的目的 IP 地址和子网掩码，优先级 (都为 60)，路由开销 (都为 0)，但下一跳不同。在 RTB 需要转发数据给 RTA 时，就会使用这两条等价静态路由将数据进行负载分担。</li>\n<li>[5] 在 RTA 上也应该配置对应的两条等价的静态路由。</li>\n</ul>\n<p class=\"red\">6，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Z4Qf.png\" alt=\"图片\"></li>\n<li>[2] 在配置完成静态路由后，可以使用 display ip routing-table 命令来验证配置结果。</li>\n<li>[3] 上图所示，红色高亮的部分代表路由表中的静态路由，这两条路由具有相同的目的地址和掩码，并且有相同的优先级和度量值，但是他们的下一跳地址和出接口不同，此时，RTB 就可以通过这两条等价路由实现负载分担。</li>\n</ul>\n<p class=\"red\">7，路由备份：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65eZ6K.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：浮动静态路由在网络中主路由失效的情况下，会加入到路由表并承担数据转发业务。</ins></li>\n<li>[2] 在配置多条静态路由时，可以修改静态路由的优先级。使一条静态路由的优先级高于其他静态路由，从而实现静态路由的备份，也叫浮动静态路由。</li>\n<li>[3] 如上图所示，RTB 上配置了两条静态路由，正常情况下，这两条静态路由是等价的，通过配置 preference 100，使第二条静态路由的优先级要低于第一条 (值越大优先级越低)。</li>\n<li>[4] 路由器只把优先级最高的静态路由加入到路由表中，当加入到路由表中的静态路由出现故障时，优先级低的静态路由才会加入到路由表并承担数据转发业务。</li>\n</ul>\n<p class=\"red\">8，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65e7jK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在主链路正常情况下，只有主路由会出现在路由表中。</ins></li>\n<li>[2] 从 display ip routing-table 命令的回显消息中可以看出，通过修改静态路由优先级实现了浮动静态路由，</li>\n<li>[3] 正常情况下，路由表中应该显示两条有相同目的地，但不同下一跳和出接口的等价路由。由于修改了优先级，回显中只有一条默认优先级为 60 的静态路由，另一个静态路由的优先级是 100，该路由优先级低，所以不会显示在路由表中。</li>\n</ul>\n<p class=\"red\">9，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65m3E4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在主链路出现故障时，浮动静态路由会被激活并加入到路由表中，承担数据转发业务。</ins></li>\n<li>[2] 当主要静态路由出现物理链路故障或者接口故障时，该静态路由不能再提供到达目的地的路径，所以再路由表中会被删除。</li>\n<li>[3] c 此时，浮动静态路由会被加入到路由表，以保证报文能够从备份链路成功转发到目的地。</li>\n<li>[4] 在主用静态路由的物理链路恢复正常后，主用静态路由会重新被加入到路由表，并且数据转发业务会从浮动静态路由切换到主用静态路由，而浮动静态路由会在路由表中再次被隐藏。</li>\n</ul>\n<p class=\"red\">10，缺省路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65nSIJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省路由是目的地址和掩码全为 0 的特殊路由。</ins></li>\n<li><ins class=\"wavy\">注：如果报文的目的地址无法匹配路由表中的任何一项，路由器将选择依照缺省路由来转发报文。</ins></li>\n<li>[2] 当路由表中没有与报文的目的地址匹配的表项时，设备可以选择缺省路由作为报文的转发路径。</li>\n<li>[3] 在路由表中，缺省路由的目的网络地址为 0.0.0.0 掩码也为 0.0.0.0。如上图所示，RTA 使用缺省路由转发到达未知目的地址的报文，缺省静态路由的默认优先级也是 60。在路由选择过程中，缺省路由会被最后匹配。</li>\n</ul>\n<p class=\"red\">11，验证配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65nx6P.png\" alt=\"图片\"></li>\n<li>[2] 配置缺省路由后，可以使用 display ip routing-table 命令来查看该路由的详细信息。</li>\n<li>[3] 如上图所示，目的地址在路由表中没能匹配的所有报文都将通过 G0/0/0 接口转发到下一跳地址 10.0.12.2。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如何配置能够将静态路由配置为浮动静态路由？</li>\n<li>在配置静态路由时，需要调整其中一条静态路由的优先级，就可将其修改为浮动静态路由。</li>\n<li>[2] 配置缺省路由时，目的网络的地址是什么？</li>\n<li>在配置缺省路由时，目的网络为 0.0.0.0 代表的是任意网络。</li>\n</ul>\n<h1 id=\"第十七章链路状态路由协议ospf\"><a class=\"anchor\" href=\"#第十七章链路状态路由协议ospf\">#</a> 第十七章【链路状态路由协议 ——OSPF】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>开放式最短路径优先 OSPF (Open Shortest Path First) 协议是 IETF 定义的一种基于链路状态的内部网关路由协议。</li>\n<li>RIP 是一种基于距离矢量算法的路由协议，存在着收敛慢，易产生路由环路，可拓展性差等问题，目前已逐渐被 OSPF 取代。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，开放式最短路径优先 (OSPF)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Tx2V.png\" alt=\"图片\"></li>\n<li>[2] OSPF 是一种基于链路状态的路由协议，它从设计上就保证了无路由环路，OSPF 支持区域的划分，区域内部的路由器使用 SPF 最短路径算法保证了区域内部的无环路。OSPF 还利用区域间的连接规则保证了区域之间无路由环路。</li>\n<li>[3] OSPF 支持触发更新，能够快速检测并通告自治系统内的拓扑变化。</li>\n<li>[4] OSPF 可以解决网络扩容带来的问题，当网络上的路由器越来越多，路由信息流量急剧增长的时候，OSPF 可以将每个自治系统划分为多个区域，并限制每个区域的范围。OSPF 这种分区域的特点，使得 OSPF 特别适合大中型网络，OSPF 可以提供认证功能，OSPF 路由器之间的报文可以配置成必须经过认证才能进行交换。</li>\n</ul>\n<p class=\"red\">2，OSPF 原理介绍：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65q9r8.png\" alt=\"图片\"></li>\n<li>[2] OSPF 要求每台运行 OSPF 的路由器都连接整个网络的链路状态信息，这样才能计算出到达目的地的最优路径。</li>\n<li>[3] OSPF 的收敛过程由链路状态公告 LSA (Link State Advertisement) 泛洪开始，LSA 中包含了路由器已知的接口 IP 地址，掩码，开销和网络类型等信息。</li>\n<li>[4] 收到 LSA 的路由器都可以根据 LSA 提供的信息建立自己的链路状态数据库 LSDB (Link State Database)，并在 LSDB 的基础上使用 SPF 算法进行运算，建立起到达每个网络的最短路径树。</li>\n<li>[5] 最后，通过最短路径树得到到达目的网络的最优路由，并将其加入到 IP 路由表中。</li>\n</ul>\n<p class=\"red\">3，OSPF 报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65L6k4.png\" alt=\"图片\"></li>\n<li>[2] OSPF 直接运行在 IP 协议之上，使用 IP 协议号 89。</li>\n<li>[3] OSPF 有五种报文类型，每种报文都使用相同的 OSPF 报文头。</li>\n<li>Hello 报文：最常用的一种报文，用于发现，维护邻居关系。并在广播和 NBMA (None-Broadcast Multi-Access) 类型的网络中选举指定路由器 DR (Designated Router) 和备份指定路由器 BDR (Backup Designated Router)。</li>\n<li>DD 报文：两台路由器进行 LSDB 数据库同步时，用 DD 报文来描述自己的 LSDB。DD 报文的内容包括 LSDB 中每一条 LSA 的头部 (LSA 的头部可以唯一标识一条 LSA)。LSA 头部只占一条 LSA 的整个数据量的一小部分，所以，这样就可以减少路由器之间的协议报文流量。</li>\n<li>LSR 报文：两台路由器相互交换过 DD 报文之后，知道对端的路由器有哪些 LSA 是本地 LSDB 所缺少的，这时需要发送 LSR 报文向对方请求缺少的 LSA，LSR 只包含了所需要的 LSA 的摘要信息。</li>\n<li>LSU 报文：用来向对端路由器发送所需要的 LSA。</li>\n<li>LSACK 报文：用来对接收到的 LSU 报文进行确认。</li>\n</ul>\n<p class=\"red\">4，邻居状态机：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65japd.png\" alt=\"图片\"></li>\n<li>[2] 邻居和邻接关系建立的过程如下：</li>\n<li>Down：这是邻居的初始状态，表示没有在邻居失效时间间隔内收到来自邻居路由器的 Hello 数据包。</li>\n<li>Attempt：此状态只在 NBMA 网络上存在，表示没有收到邻居的任何信息，但是已经周期性的向邻居发送报文，发送间隔为 HelloInterval。如果 RouterDeadInterval 间隔内未收到邻居的 Hello 报文，则转为 Down 状态。</li>\n<li>Init：在此状态下，路由器已经从邻居收到了 Hello 报文，但是自己不在所收到的 Hello 报文的邻居列表中，尚未与邻居建立双向的通信关系。</li>\n<li>2-Way：在此状态下，双向通信已经建立，但是没有与邻居建立邻接关系，这是建立邻接关系以前的最高级状态。</li>\n<li>ExStart：这是形成邻接关系的第一个步骤，邻居状态变成此状态以后，路由器开始向邻居发送 DD 报文，主从关系是在此状态下形成的，初始 DD 序列号也是在此状态下决定的，在此状态下发送的 DD 报文不包含链路状态描述，</li>\n<li>Exchange：此状态下路由器相互发送包含链路状态信息摘要的 DD 报文，描述本地 LSDB 的内容。</li>\n<li>Loading：相互发送 LSR 报文请求 LSA，发送 LSU 报文通告 LSA。</li>\n<li>Full：路由器的 LSDB 已经同步。</li>\n</ul>\n<p class=\"red\">5，Router ID，邻居和邻接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65xyWQ.png\" alt=\"图片\"></li>\n<li>[2] Router ID 是一个 32 位的值，它唯一标识了一个自治系统内的路由器，管理员可以为每台运行 OSPF 的路由器手动配置一个 Router ID。如果未手动指定，设备会按照以下规则自动选举 Router ID：</li>\n<li>[3] 如果设备存在多个逻辑接口地址，则路由器使用逻辑接口中最大的 IP 地址作为 Router ID。</li>\n<li>[4] 如果没有配置逻辑接口，则路由器使用物理接口的最大 IP 地址作为 Router ID。</li>\n<li>[5] 在为一台运行 OSPF 的路由器配置新的 Router ID 后，可以在路由器上通过重置 OSPF 进程来更新 Router ID。通常建议手动配置 Router ID，以防 Router ID 因为接口地址的变化而改变。</li>\n<li>[6] 运行 OSPF 的路由器之间需要交换链路状态信息和路由信息，在交换这些信息之前路由器之间首先需要建立邻接关系。</li>\n<li>[7] 邻居 (Neighbor)：</li>\n<li>OSPF 路由器启动后，便会通过 OSPF 接口向外发送 Hello 报文用于发现邻居，收到 Hello 报文的 OSPF 路由器会检查报文中所定义的以下参数，如果双方的参数一致，就会彼此形成邻居关系，状态到达 2-Way 即可称为建立了邻居关系。</li>\n<li>[8] 邻接 (Adjacency)：</li>\n<li>形成邻居的双方不一定都能形成邻接关系，这要根据网络类型而定。只有当双方成功交换 DD 报文，并同步 LSDB 后，才形成了真正意义上的邻接关系。</li>\n<li>上图所示，RTA 通过以太网连接了三个路由器，所以 RTA 有三个邻居，但不能说 RTA 有三个邻接关系。</li>\n</ul>\n<p class=\"red\">6，邻居发现：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65zjjs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Hello 报文用来发现和维持 OSPF 邻居关系。</ins></li>\n<li>[2] OSPF 的邻居发现过程是基于 Hello 报文来实现的，Hello 报文中的主要字段解释如下：</li>\n<li>Network Mask：发送 Hello 报文的接口的网络掩码。</li>\n<li>Hello interval：发送 Hello 报文的时间\t间隔，单位为秒。</li>\n<li>Options：标识发送此报文的 OSPF 路由器所支持的可选功能，具体的可选功能未来解释。</li>\n<li>Router Priority：发送 Hello 报文的接口的 Router Priority，用于选举 DR 和 BDR。</li>\n<li>Router Dead Interval：失效时间，如果在此时间内未收到邻居发来的 Hello 报文，则认为邻居失效，单位为秒，通常为 4 倍 Hello Interval。</li>\n<li>Designated Router：发送 Hello 报文的路由器所选举的 DR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 DR 路由器。</li>\n<li>Backup Designated Router：发送 Hello 报文的路由器所选举出的 BDR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 BDR。</li>\n<li>Neighbor：邻居得到 Router ID 列表，表示本路由器已经从这些邻居收到了合法的 Hello 报文。</li>\n<li>如果路由器发现所接收的合法 Hello 报文的邻居列表中有自己的 Router ID，则认为已经和邻居建立了双向邻接，表示邻居关系已经建立。</li>\n<li>[3] 验证一个接收到的 Hello 报文是否合法包括：</li>\n<li>如果接收端口的网络类型是广播型，点到多点或者 NBMA，所接收的 Hello 报文中 Network Mask 字段必须和接受端口的网络掩码一致，如果接收端口的网络类型为点到点类型或者是虚连接，则不检查 Network Mask 字段。</li>\n<li>所接收的 Hello 报文中 Hello Interval 字段必须和接收端口的配置一致。</li>\n<li>所接收的 Hello 报文中 Router Dead Interval 字段必须和接收端口的配置一致。</li>\n<li>所接收的 Hello 报文中 Options 字段中的 E-bit (表示是否接收外部路由信息) 必须和相关区域的配置一致。</li>\n</ul>\n<p class=\"red\">7，数据库同步：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6I9Xge.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器使用 DD 报文来进行主从路由器的选举和数据库摘要信息的交互。</ins></li>\n<li><ins class=\"wavy\">注：DD 报文包含 LSA 的头部信息，用来描述 LSDB 的摘要信息。</ins></li>\n<li>[2] 如上图所示，路由器在建立完成邻居关系之后，便开始进行数据库同步，具体关系如下：</li>\n<li>[3] 邻居状态变为 ExStart 以后，RTA\t向 RTB 发送第一个 DD 报文，在这个报文中，DD 序列号被设置为 X (假设)，RTA 宣告自己为主路由器。</li>\n<li>[4] RTB 也向 RTA 发送第一个 DD 报文，在这个报文中。DD 序列号被设置为 Y (假设)。RTB 也宣告自己为主路由器，由于 RTB 的 Router ID 比 RTA 的大，所以 RTB 应当为真正的主路由器。</li>\n<li>[5] RTA 发送一个新的 DD 报文，在这个新的报文中包含 LSDB 的摘要信息，序列号设置为 RTB 在步骤 2 里使用的序列号，因此 RTB 将邻居状态改变为 Exchange。</li>\n<li>[6] 邻居状态变为 Exchange 以后，RTB 发送一个新的 DD 报文，该报文中包含 LSDB 的描述信息。DD 序列号设置为 Y+1 (上次使用的序列号加 1)</li>\n<li>[7] 即使 RTA 不需要新的 DD 报文描述自己的 LSDB，但是作为从路由器，RTA 需要对主路由器 RTB 发送的每一个 DD 报文进行确认。所以，RTA 向 RTB 发送一个内容为空的 DD 报文，序列号为 Y+1</li>\n<li>[8] 发送完最后一个 DD 报文之后，RTA 将邻居状态改变为 Loading，RTB\t收到最后一个 DD 报文之后，改变状态为 Full (假设 RTB 的 LSDB 是最新最全的，不需要向 RTA 请求更新)。</li>\n</ul>\n<p class=\"red\">8，建立完全邻接关系：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6IiwcD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：LSR 用于向对方请求所需的 LSA。</ins></li>\n<li><ins class=\"wavy\">注：LSU 用于向对方发送其所需的 LSA。</ins></li>\n<li><ins class=\"wavy\">注：LSACK 用于向对方发送收到 LSA 的确认。</ins></li>\n<li>[2] 邻居状态变为 Loading 之后，RTA 开始向 RTB 发送 LSR 报文，请求那些在 Exchange 状态下通过 DD 报文发现的，而且在本地 LSDB 中没有的链路状态信息。</li>\n<li>[3] RTB 收到 LSR 报文之后，向 RTA 发送 LSU 报文，在 LSU 报文中，包含了那些被请求的链路状态的详细信息。RTA 收到 LSU 报文后，将邻居状态从 Loading 改变成 Full。</li>\n<li>[4] RTA 向 RTB 发送 LSACK 报文，用于对已接受 LSA 的确认。</li>\n<li>[5] 此时，RTA 和 RTB 之间的邻居状态变为 Full，表示达到完全邻接状态。</li>\n</ul>\n<p class=\"red\">9，OSPF 支持的网络类型 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6IFAgO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省情况下，OSPF 认为以太网的网络类型是广播类型，PPP，HDLC 的网络类型是点到点类型。</ins></li>\n<li>[2] OSPF 定义了四种网络类型，分别是点到点网络，广播型网络，NBMA 网络和点到多点网络。</li>\n<li>[3] 点到点网络是指只把两台路由器直接相连的网络，一个运行 PPP 的 64k 串行线路就是一个点到点的网络例子。</li>\n<li>[4] 广播型网络是指支持两台以上路由器，并且具有广播功能的网络，一个含有三台路由器的以太网就是一个广播型网络的例子。</li>\n</ul>\n<p class=\"red\">10，OSPF 支持的网络类型 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IFrxU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省情况下，OSPF 认为帧中继，ATM 的网络类型是 NBMA。</ins></li>\n<li>[2] OSPF 可以在不支持广播的多路访问网络上运行，此类网络包括在 hub~spoke 拓扑上运行的帧中继 (FR) 和异步传输模式 (ATM) 网络，这些网络的通信依赖于虚电路，OSPF 定义了两种支持多路访问的网络类型：非广播多路访问网络 (NBMA) 和点到多点网络 (Point To Multi-Points)。</li>\n<li>[3] NBMA：在 NBMA 网络上，OSPF 模拟在广播型网络上的操作，但是每个路由器的邻居需要手动配置，NBMA 方式要求网络中的路由器组成全连接。</li>\n<li>[4] P2MP：将整个网络看成是一组点到点网络，对于不能组成全连接的网络应当使用点到多点方式，例如只使用 PVC 的不完全连接的帧中继网络。</li>\n</ul>\n<p class=\"red\">11，DR&amp;BDR：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IkcSf.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DR 可以减少广播型网络中的邻接关系的数量。</ins></li>\n<li>[2] 每一个含有至少两个路由器的广播型网络和 NBMA 网络都有一个 DR 和 BDR。</li>\n<li>[3] DR 和 BDR 可以减少邻接关系的数量，从而减少链路状态信息以及路由信息的交换次数，这样可以节省带宽，降低对路由器处理能力的压力。</li>\n<li>[4] 一个既不是 DR 也不是 BDR 的路由器只与 DR 和 BDR 形成邻接关系并交换链路状态信息以及路由信息。这样就大大减少了大型广播型网络和 NBMA 网络中的邻接关系数量，在没有 DR 的广播网络上，邻接关系的数量可以根据公式 n (n-1)/2 计算出，n 代表参与 OSPF 的路由器接口的数量。</li>\n<li>[5] 如上图所示，使用路由器之间有 6 个邻接关系，当指定 DR 后，所有的路由器都与 DR 建立起邻接关系，DR 成为该广播网络上的中心点。</li>\n<li>[6] BDR 在 DR 发生故障时接管业务，一个广播网络上所有路由器都必须同 BDR 建立邻接关系，上图使用 DR 和 BDR 将邻接关系从 6 减少到了 5，RTA 和 RTB 都只需要同 DR 和 BDR 建立邻接关系，RTA 和 RTB 之间建立的是邻居关系。</li>\n<li>[7] 上图中，邻接关系数量的减少效果并不明显，但是，当网络上部署了大量路由器时，比如 100 台，那么情况就不一样了。</li>\n</ul>\n<p class=\"red\">12，DR&amp;BDR 选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IEUVH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DR 是基于端口的 DR 优先级的值进行选举的。</ins></li>\n<li>[2] 在邻居发现完成之后，路由器会根据网段类型进行 DR 选举，在广播和 NBMA 网络上，路由器会根据参与选举的每个接口的优先级进行 DR 选举，优先级取值范围为 0-255，值越高越优先，缺省情况下，接口优先级为 1，如果一个接口优先级为 0，那么该端口将不会参与 DR 或者 BDR 的选举，如果优先级相同时，则比较 Router ID，值越大越优先被选举为 DR。</li>\n<li>[3] 为了给 DR 做备份，每个广播和 NBMA 网络上还要选举一个 BDR。BDR 也会与 2 网络上所有的路由器建立邻接关系。</li>\n<li>[4] 为了维护网络上邻接关系的稳定性，如果网络中已经存在 DR 和 BDR，则新添加进该网络的路由器不会成为 DR 和 BDR，不管该路由器的 Router Priority 是否最大，如果当前 DR 发生故障，则当前 BDR 自动成为新的 DR，网络中重新选举 BDR，如果当前 BDR 发生故障，则 DR 不变，重新选举 BDR，这种机制的目的是为了保持邻接关系的稳定，使拓扑结构的改变对邻接关系的影响尽量小。</li>\n</ul>\n<p class=\"red\">13，OSPF 区域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IVrk9.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每个区域都维护一个独立的 LSDB。</ins></li>\n<li><ins class=\"wavy\">注：Area 0 是骨干区域，其他区域都必须与此区域相连。</ins></li>\n<li>[2] OSPF 支持将一组网段组合在一起，这样的一个组合称为一个区域。</li>\n<li>[3] 划分 OSPF 区域可以缩小路由器的 LSDB 规模，减少网络流量。</li>\n<li>[4] 区域内的详细拓扑信息不向其他区域发送，区域间传递的是抽象的路由信息，而不是详细的描述拓扑结构的链路状态信息，每个区域都有自己的 LSDB，不同区域的 LSDB 是不同的，路由器会为每一个自己所连接到的区域维护一个单独的 LSDB，由于详细链路状态信息不会被发布到区域以外，因此 LSDB 的规模大大缩小了。</li>\n<li>[5] Area0 为骨干区域，为了避免区域间路由环路，非骨干区域之间不允许直接相互发布路由信息，因此，每个区域都必须连接到骨干区域。</li>\n<li>[6] 运行在区域之间的路由器叫做区域边界路由器 ABR (Ares Boundary Router)，它包含所有相连的区域的 LSDB，自治系统边界路由器 ASBR (Autonomous System Boundary Router) 是指和其他 AS 中的路由器交换路由信息的路由器，这种路由器会向整个 AS 通告 AS 外部路由信息。</li>\n<li>[7] 在规模较小的企业网络中，可以把所有的路由器划分到同一个区域中，同一个 OSPF 区域中的路由器中的 LSDB 是完全一致的，OSPF 区域号可以手动配置，为了便于将来的网络拓展，推荐将该区域设置为 0，即骨干区域。</li>\n</ul>\n<p class=\"red\">14，OSPF 开销：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IZhvV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：OSPF 的开销计算公式为带宽参考值 / 带宽。</ins></li>\n<li><ins class=\"wavy\">注：可以通过 bandwidth-reference 命令来设置带宽参考值。</ins></li>\n<li>[2] OSPF 基于接口带宽计算开销，计算公式为：接口开销 = 带宽参考值 / 带宽。带宽参考值可配置，缺省为 100Mbit/s。以此，一个 64Kbit/s 串口的开销为 1562，一个 E1 接口 (2.048Mbit/s) 的开销为 48。</li>\n<li>[3] 命令 bandwidth-reference 可以用来调整带宽参考值，从而可以改变接口开销，带宽参考值越大，开销越准确，在支持 10Gbit/s 速率的情况下，推荐将带宽参考值提高到 10000Mbit/s 来分别为 10Gbit/s，1Gbit/s 和 100Mbit/s 的链路提供 1，10，100 的开销。注意，配置带宽参考值时，需要在整个 OSPF 网络中统一进行调整。</li>\n<li>[4] 另外，还可以通过 OSPF cost 命令来手动为一个接口调整开销，开销取值 f 范围是 1~65535，缺省值为 1。</li>\n</ul>\n<p class=\"red\">15，OSPF 配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TnY4g.png\" alt=\"图片\"></li>\n<li>[2] 在配置 OSPF 时。需要首先使能 OSPF 进程。</li>\n<li>[3] 命令 OSPF (process id ) 用来使能 OSPF，在该命令中可以配置进程 ID，如果没有配置进程 ID。则使用 1 作为缺省进程 ID。</li>\n<li>[4] 命令 OSPF (process id) (Router-id\t) 即可以使能 OSPF 进程，还同时可以用于配置 Router ID，在该命令中，Router -ID 代表路由器 ID。</li>\n<li>[5] 命令 network 用于指定运行 OSPF 协议的接口，在该命令中需要指定一个反掩码。反掩码中，“0” 代表此位必须严格匹配，“1” 表示该地址可以为任意值。</li>\n</ul>\n<p class=\"red\">16，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TnxqP.png\" alt=\"图片\"></li>\n<li>[2] 命令 display ospf peer 可以用来查看邻居相关的属性，包括区域，邻居的状态，邻接协商的主从状态以及 DR 和 BDR 情况。</li>\n</ul>\n<p class=\"red\">17，OSPF 认证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TuwJe.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：华为 ARG3 系列路由器运行 OSPF 时，支持两种认证方式：区域认证和接口认证。</ins></li>\n<li>[2] OSPF 支持简单认证及加密认证功能，加密认证对潜在的攻击行为有更强的防范行。OSPF 认证可以配置在接口上或者区域上，配置接口认证方式的优先级高于区域认证方式。</li>\n<li>[3] 接口或区域上都可以运行 OSPF authentication-mode 命令来配置简单认证，参数 simple 表示使用明文传输密码，参数 plain 表示密码以明文形式存放在设备中，参数 cipher 表示密码以密文形式存放在设备中，参数 Null 表示不认证。</li>\n<li>[4] 命令 OSPF authentication-mode 用于配置加密认证，MD5 是一种保证链路认证安全的加密算法，参数 key-id 表示接口加密认证中的认证密钥 ID，它必须与对端的 key-id 一致。</li>\n</ul>\n<p class=\"red\">18，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TKBkT.png\" alt=\"图片\"></li>\n<li>[2] 在启用认证功能后，可以在终端上进行调试来查看认证过程。</li>\n<li>[3] debugging ospf packet 命令用来指定调试 OSPF 报文，然后便可以查看认证过程，以确定认证配置是否成功。</li>\n</ul>\n<p class=\"red\">19，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] OSPF Hello 报文中 Router Dead Interval 字段的作用是什么？</li>\n<li>Hello 报文中的 Router Dead Interval 字段代表死亡间隔，如果在此时间内未收到邻居发送来的 Hello 报文，则认为邻居失效，死亡间隔时 Hello 间隔的四倍，在广播网络上缺省为 40 秒 (因为 Hello 间隔缺省为 10 秒)</li>\n<li>[2] 在广播网络中，DR 和 BDR 用来接收链路状态更新报文的目的地址是什么？</li>\n<li>在广播网络上，DR 和 BDR 都使用组播地址 224.0.0.6 来接收链路状态更新报文。</li>\n</ul>\n<h1 id=\"第十八章dhcp原理与配置\"><a class=\"anchor\" href=\"#第十八章dhcp原理与配置\">#</a> 第十八章【DHCP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>在大型企业网络中，会有大量的主机或设备需要获取 IP 地址等网络参数，如果采用手工配置，工作量大且不好管理，如果有用户擅自修改网络参数，还可能会造成\tIP 地址冲突等问题，使用动态主机配置协议 DHCP (Dynamic Host Configuration Protocol) 来分配 IP 地址等网络参数，可以减少管理员的工作量，避免用户手动配置网络参数时造成的地址冲突。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，DHCP 应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TQndP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DHCP 服务器能够为大量主机分配 IP 地址，并能集中管理。</ins></li>\n<li>[2] 在大型企业网络中，一般会有大量的主机等终端设备，每个终端设备都需要配置 IP 地址等网络参数才能接入网络。</li>\n<li>[3] 在小型网络中，终端数量小，可以手动配置 IP 地址，但是在大中型网络中，终端数量很多，手动配置 IP 地址工作量大，而且配置时容易导致 IP 地址冲突等错误。</li>\n<li>[4] DHCP 可以为网络终端动态分配 IP 地址，解决了手动配置 IP 地址时的各种问题。</li>\n</ul>\n<p class=\"red\">2，DHCP 报文类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TQ0WF.png\" alt=\"图片\"></li>\n<li>[2] DHCP 客户端初次接入网络时，会发送 DHCP 发现报文 (DHCP Discover)，用于查找和定位 DHCP 服务器。</li>\n<li>[3] DHCP 服务器在接收到 DHCP 发现报文后，发送 DHCP 提供报文 (DHCP Offer)，此报文中包含 IP 地址等配置信息。</li>\n<li>[4] 在 DHCP 客户端收到服务器发送的 DHCP 提供报文后，会发送 DHCP 请求报文 (DHCP Request)，另外在 DHCP 客户端获取 IP 地址并重启之后，同样也会发送 DHCP 请求报文，用于确认分配的 IP 地址等配置信息。DHCP 客户端获取的 IP 地址租期快要到期时，也发送 DHCP 请求报文向服务器申请延长 IP 地址租期。</li>\n<li>[5] 收到 DHCP 客户端发送的 DHCP 请求报文后，DHCP 服务器会回复 DHCP 确认报文 (DHCP ACK)。客户端收到 DHCP 确认报文后，会将获取的 IP 地址等信息进行配置和使用。</li>\n<li>[6] 如果 DHCP 服务器收到 DHCP-REQUEST 报文后，没有找到相应的租约记录，则发送 DHCP-NAK 报文作为回应，告知 DHCP 客户端无法分配合适的 IP 地址。</li>\n<li>[7] DHCP 客户端通过发送 DHCP 释放报文 (DHCP Release) 来释放 IP 地址，收到 DHCP 释放报文后，DHCP 服务器可以把该 IP 地址分配给其他 DHCP 客户端。</li>\n</ul>\n<p class=\"red\">3，地址池：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TlT9U.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARG3 系列路由器支持两种地址池：全局地址池和接口地址池。</ins></li>\n<li>[2] ARG3 系列路由器和 X7 系列交换机都可以作为 DHCP 服务器，为主机等设备分配 IP 地址。DHCP 服务器的地址池是用来定义分配给主机的 IP 地址范围，有两种形式。</li>\n<li>[3] 接口地址池为连接到同一网段的主机或终端分配 IP 地址。可以在服务器的接口下执行 dhcp select interface 命令，配置 DHCP 服务器采用接口地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li>\n<li>[4] 全局地址池为所有连接到 DHCP 服务器的终端分配 IP 地址，可以在服务器的接口下执行 dhcp select global 命令，配置 DHCP 服务器采用全局地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li>\n<li>[5] 接口地址池的优先级比全局地址池高，配置了全局地址池后，如果又在接口上配置了地址池，客户端将会从接口地址池中获取 IP 地址，在 X7 系列交换机上，只能在 VLAN IF 逻辑接口上配置接口地址池。</li>\n</ul>\n<p class=\"red\">4，DHCP 工作原理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T1MvQ.png\" alt=\"图片\"></li>\n<li>[2] 为了获取 IP 地址等配置信息，DHCP 客户端需要和 DHCP 服务器进行报文交互。</li>\n<li>[3] 首先。DHCP 客户端发送 DHCP 发现报文来发现 DHCP 服务器，DHCP 服务器会选取一个未分配的 IP 地址，向 DHCP 客户端发送 DHCP 提供报文，此报文中包含分配给客户端的 IP 地址和其他配置信息。如果存在多个 DHCP 服务器，每个 DHCP 服务器都会响应。</li>\n<li>[4] 如果有多个 DHCP 服务器向 DHCP 客户端发送 DHCP 提供报文，DHCP 客户端会选择收到的第一个 DHCP 提供报文，然后发送 DHCP 请求报文，报文中包含请求的 IP 地址，收到 DHCP 请求报文后，提供该 IP 地址的 DHCP 服务器会向 DHCP 客户端发送一个 DHCP 确认报文，包含提供的 IP 地址和其他配置信息。</li>\n<li>[5] DHCP 客户端收到 DHCP 确认报文后，会发送免费 ARP 报文，检查网络中是否有其他主机使用分配的 IP 地址，如果指定时间内没有收到 ARP 应答，DHCP 客户端会使用这个 IP 地址，如果有主机使用该 IP 地址，DHCP 客户端会向 DHCP 服务器发送 DHCP 拒绝报文，通知服务器该 IP 地址已被占用，然后 DHCP 客户端会向服务器重新申请一个 IP 地址。</li>\n</ul>\n<p class=\"red\">5，DHCP 租期更新：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T1Tat.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IP 租约期限到达 50% 时，DHCP 客户端会请求更新 IP 地址租约。</ins></li>\n<li>[2] 申请到 IP 地址后，DHCP 客户端中会保存三个定时器，分别用来控制租约更新，租期重绑定和租期失效。</li>\n<li>[3] DHCP 服务器为 DHCP 客户端分配 IP 地址时会指定三个定时器的值，如果，DHCP 服务器没有指定定时器的值，DHCP 客户端会使用缺省值，缺省租期为 1 天。</li>\n<li>[4] 默认情况下，还剩下 50% 的租期时，DHCP 客户端开始租约更新过程，DHCP 客户端向分配 IP 地址的服务器发送 DHCP 请求报文来申请延迟 IP 地址的租期，DHCP 服务器向客户端发送 DHCP 确认报文，给予 DHCP 客户端一个新的租期。</li>\n</ul>\n<p class=\"red\">6，DHCP 重绑定：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3FRU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DHCP 客户端在租约期限到达 87.5% 时，还没有收到服务器响应，会申请重绑定 IP。</ins></li>\n<li>[2] DHCP 客户端发送 DHCP 请求报文续租时，如果 DHCP 客户端没有收到 DHCP 服务器的 DHCP 应答报文，默认情况下，重绑定定时器在租期剩余 12.5% 的时候超时，超时后，DHCP 客户端就会认为原 DHCP 服务器不可用，开始重新发送 DHCP 请求报文，网络上任何一台 DHCP 服务器都可以应答 DHCP 确认或 DHCP 非确认报文。</li>\n<li>[3] 如果收到 DHCP 确认报文，DHCP 客户端重新进入绑定状态，复位租期更新计时器和重绑定计时器，如果收到 DHCP 非确认报文，DHCP 客户端进入初始化状态，此时，DHCP 客户端必须立即停止使用现有 IP 地址，重新申请 IP 地址。</li>\n</ul>\n<p class=\"red\">7，IP 地址释放：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3QJK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：如果 IP 租约到期前都没有收到服务器响应，客户端停止使用此 IP 地址。</ins></li>\n<li>++ 注：如果 DHCP 客户端不再使用分配的 IP 地址，也可以主动向 DHCP 服务器发送 DHCP Release 报文，释放该 IP 地址。</li>\n<li>[2] 租期计时器是地址失效进程中的最后一个定时器，超时时间为 IP 地址的租期时间，如果 DHCP 客户端在租期失效定时器超时前没有收到服务器的任何回应，DHCP 客户端必须立刻停止使用现有 IP 地址，发送 DHCP Release 报文，并进入初始化状态，然后，DHCP 客户端重新发送 DHCP 发现报文，申请 IP 地址。</li>\n</ul>\n<p class=\"red\">8，DHCP 接口地址池的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3TOJ.png\" alt=\"图片\"></li>\n<li>[2] DHCP 支持配置两种地址池，包括全局地址池和接口地址池。</li>\n<li>[3] DHCP enable 命令用来使能 DHCP 功能，在配置 DHCP 服务器时，必须先执行 dhcp enable 命令，才能配置 DHCP 的其他功能并生效。</li>\n<li>[4] dhcp select interface 命令用来关联接口和接口地址池，为连接到接口的主机提供配置信息，上图所示，接口 G0/0/0 被加入到接口地址池中。</li>\n<li>[5] dhcp server dns-list 命令用来指定接口地址池下的 DNS 服务器地址。</li>\n<li>[6] dhcp server excluded-ip-address 命令用来配置接口地址池中不参与自动分配的 IP 地址范围</li>\n<li>[7] dhcp server lease 命令用来配置 DHCP 服务器接口地址池中 IP 地址的租用有效期限功能。缺省情况下，接口地址池中 IP 地址的租用有效期限为 1 天。</li>\n</ul>\n<p class=\"red\">9，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T8NX4.png\" alt=\"图片\"></li>\n<li>[2] 每个 DHCP 服务器可以定义一个或多个全局地址池和接口地址池，上图中执行 display ip pool 命令查看接口地址池的属性。</li>\n<li>[3] display 信息中包含地址池的 IP 地址范围，还包括 IP 网关\t，子网掩码等信息。</li>\n</ul>\n<p class=\"red\">10，DHCP 全局地址池配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T8z40.png\" alt=\"图片\"></li>\n<li>[2] 上图所示，配置了一个 DHCP 全局地址池。</li>\n<li>ip pool 命令用来创建全局地址池。</li>\n<li>network 命令用来配置全局地址池下可分配的网段。</li>\n<li>gateway-list 命令用来配置 DHCP 服务器全局地址池的出口网关地址。</li>\n<li>lease 命令用来配置 DHCP 全局地址池下的地址租期，缺省情况下，IP 地址租期是 1 天。</li>\n<li>dhcp select global 命令用来使能接口的 DHCP 服务器功能。</li>\n</ul>\n<p class=\"red\">11，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TGlKe.png\" alt=\"图片\"></li>\n<li>[2] display ip pool 命令可以查看全局 IP 地址池信息，管理员可以查看地址池的网关，子网掩码，IP 地址统计信息等内容，监控地址池的使用情况，了解已分配的 IP 地址数量，以及其他使用统计信息。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 地址池中的那些 IP 地址一般会被保留？</li>\n<li>在 IP 地址池中，应该排除分配给 DNS 等服务器的 IP 地址，DHCP 服务器接口的 IP 地址等，避免 IP 地址冲突。</li>\n<li>[2] DHCP 服务器的 IP 地址租期默认是多久？</li>\n<li>默认的 IP 地址租期是 86400 秒。即一天。</li>\n</ul>\n<h1 id=\"第十九章ftp原理与配置\"><a class=\"anchor\" href=\"#第十九章ftp原理与配置\">#</a> 第十九章【FTP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>FTP 是用来传输文件的协议\t，使用 FTP 实现远程文件传输的同时，也可以保证数据传输的可靠性和高效性。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，FTP 的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TG0Kg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：FTP 提供了一种在服务器和客户机之间上传和下载文件的有效方式。</ins></li>\n<li>[2] 在企业网络中部署一台 FTP 服务器，将网络设备配置为 FTP 客户端，则可以使用 FTP 来备份或更新 VRP 文件和配置文件。也可以把网络设备配置为 FTP 服务器，将设备的日志文件保存到某台主机上方便查看。</li>\n</ul>\n<p class=\"red\">2，FTP 传输文件的过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TanPA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：使用 FTP 传输数据时，需要在服务器和客户机之间建立控制连接和数据连接。</ins></li>\n<li>[2] 使用 FTP 进行文件传输时，会使用两个 TCP 连接，第一个连接是 FTP 客户端和 FTP 服务器间的控制连接，FTP 服务器开启 21 号端口，等待 FTP 客户端发送链接请求，FTP 客户端随机开启端口，向服务器发送建立连接的请求，控制连接用于在服务器和客户端之间传输控制命令。</li>\n<li>[3] 第二个连接是 FTP 客户端和 FTP 服务器间的数据连接，服务器使用 TCP 的 20 号端口与客户端建立数据连接，通常情况下，服务器主动建立或中断数据连接。</li>\n</ul>\n<p class=\"red\">3，FTP 传输模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6Ta0MV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：传输模式定义了数据在客户端和服务器之间传输时的格式。</ins></li>\n<li>[2] FTP 传输数据时支持两种传输模式：ASCII 模式和二进制模式。</li>\n<li>[3] ASCII 模式用于传输文本，发送端的字符在发送前被转换成 ASCII 码格式之后进行传输，接收端收到之后再将其转换成字符。</li>\n<li>[4] 二进制模式常用于发送图片文件和程序文件，发送端在发送这些文件时无需转换格式，即可传输。</li>\n</ul>\n<p class=\"red\">4，FTP 配置 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6Ta7IH.png\" alt=\"图片\"></li>\n<li>[2] ARG3 系列路由器和 X7 系列路由器均可提供 FTP 功能。</li>\n<li>[3] 执行 ftp server enable 命令使能 FTP 功能。</li>\n<li>[4] 执行 set default ftp-directory 命令设置 FTP 用户的默认工作目录。</li>\n</ul>\n<p class=\"red\">5，FTP 配置 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TdGy6.png\" alt=\"图片\"></li>\n<li>[2] 在配置 FTP 服务器时，可以使用 AAA 为每个用户分别配置登录账号和访问权限。</li>\n<li>[3] aaa 命令用来进入 AAA 视图。</li>\n<li>[4] local-user user-name 命令用来创建本地用户，并配置本地用户的各项参数。</li>\n<li>[5] user-name 指定用户名。</li>\n<li>[6] local-user huawei service-type ftp 命令用来配置本地用户的接入类型为 ftp。</li>\n<li>[7] ftp-directory 指定 FTP 用户可访问的目录，如果不配置 FTP 用户可访问的目录，则 FTP 用户无法登录设备。</li>\n<li>[8] access-limit 指定用户可以建立的最大连接数目。</li>\n<li>[9] idle-timeout 指定用户的闲置超时时间。</li>\n<li>[10] privilege level 指定用户的优先级。</li>\n</ul>\n<p class=\"red\">6，FTP 配置 (3)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TwkAe.png\" alt=\"图片\"></li>\n<li>[2] ftp 用户用来与远程 FTP 服务器建立控制连接，并进入 FTP 客户端视图。</li>\n<li>[3] binary 命令用来在设备作为 FTP 客户端时设置文件传输方式为 Binary 模式，又称为二进制模式。</li>\n<li>[4] 缺省情况下，文件传输模式为 ASCII 模式。</li>\n<li>[5] get 命令用来从远程 FTP 服务器下载文件并保存在本地。</li>\n</ul>\n<p class=\"red\">7，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] FTP 服务默认使用服务器哪些端口？</li>\n<li>FTP 服务器需要开启 TCP 的 21 号端口来建立控制连接，20 号端口来建立数据连接。</li>\n<li>[2] 用户反馈没有权限去访问 FTP 服务器上的目录，应该如何解决？</li>\n<li>如果用户无法访问任何工作目录，则需要定义一个默认的 FTP 目录，执行 set default ftp-direcory 命令建立默认目录。</li>\n</ul>\n<h1 id=\"第二十章telnet原理与配置\"><a class=\"anchor\" href=\"#第二十章telnet原理与配置\">#</a> 第二十章【Telnet 原理与配置】</h1>\n<p>1.4 1-11 机器人  1-12</p>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>如果企业网络中有一台或多台网络设备需要远程进行配置和管理，管理员可以使用 Telnet 远程连接到每一台设备上，对这些网络设备进行集中的管理和维护。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，Telnet 应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TgE4K.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Telnet 可以通过终端对本地和远程的网络设备进行集中管理。</ins></li>\n<li>[2] Telnet 提供了一个交互式操作页面，允许终端远程登录到任何可以充当 Telnet 服务器的设备，Telnet 用户可以像通过 Console 口本地登录一样对设备进行操作。</li>\n<li>[3] 远端 Telnet 服务器和终端之间无需直连，只需保证两者之间可以相互通信即可，通过使用 Telnet，用户可以方便地实现对设备进行远程管理和维护。</li>\n</ul>\n<p class=\"red\">2，Telnet 连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T2hQg.png\" alt=\"图片\"></li>\n<li><ins ,wavy>注：Telnet 客户端和服务器基于 TCP 连接来传输命令。</ins></li>\n<li>[2] Telnet 以客户端 / 服务器模式运行，Telnet 基于 TCP 协议，服务器端口默认是 23，服务器通过该端口与客户端建立 Telnet 连接。</li>\n</ul>\n<p class=\"red\">3，认证模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TRpwR.png\" alt=\"图片\"></li>\n<li>[2] 在配置 Telnet 登录用户界面时，必须配置认证方式，否则用户无法成功登录设备。</li>\n<li>[3] Telnet 认证有两种模式：AAA 认证，密码认证。</li>\n<li>当配置用户界面的认证方式为 AAA 时，用户登录设备时需要首先输入登录用户名和密码才能登录。</li>\n<li>当配置用户界面的认证方式为 password 时，用户登录设备时需要先输入登陆密码才能登录。</li>\n</ul>\n<p class=\"red\">4，Telnet 配置 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TRgB9.png\" alt=\"图片\"></li>\n<li>[2] 网络设备作为 Telnet 服务器，通常使用密码认证机制来认证连接到 VTY 接口的用户。</li>\n<li>[3] VTY (Virtual Type Terminal) 是网络设备用来管理和监控通过 Telnet 方式登录的用户的界面，网络设备为每个 Telnet 用户分配一个 VTY 界面。缺省情况下，ARG3 系列路由器支持的 Telnet 用户最大数目为 5 个，VTY 0 4 的含义是 VTY0 VTY1 VTY2 VTY3 VTY4。如果需要增加 Telnet 用户的登录数量，可以使用 user-interface maximum-vty 命令来调整 VTY 界面的数量。</li>\n<li>[4] 执行 authentication-mode password 命令，可以配置 VTY 通过密码对用户进性认证。</li>\n<li>[5] 注：不同的 VRP 版本执行 set authentication password cipher 命令有差异：有些平台需要回车后输入密码，另外一些平台可以直接在命令后输入密码，故，在操作具体产品时需要查阅相应的 VRP 产品文档。</li>\n</ul>\n<p class=\"red\">5，Telnet 配置 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TfaWV.png\" alt=\"图片\"></li>\n<li>[2] 远程设备配置为 Telnet 服务器之后，可以在客户端上执行 telnet 命令来与服务器建立 Telnet 连接，客户端会收到需要认证相关的提示信息，用户输入的认证密码需要匹配 Telnet 服务器上保存的密码，认证通过之后，用户就可以通过 Telnet 远程连接到 Telnet 服务器上，在本地对远端的设备进行配置和管理。</li>\n</ul>\n<p class=\"red\">6，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如果网络设备已经配置完成 Telnet 服务，但是用户仍然不能实现远程访问，原因可能是什么？</li>\n<li>如果无法建立 Telnet 连接，首先验证设备是否可达，如果设备可达，再检查用户输入的密码是否正确，如果密码正确，再查看当前通过 Telnet 访问设备的用户量是否到达最大限制。如需增加用户数量，可以执行 user-\tinterface maximum-vty&lt;0-15&gt; 命令，0-15 表示支持的用户数。</li>\n</ul>\n",
            "tags": [
                "技术",
                "HUAWEI"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/",
            "url": "https://manshan.top/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/",
            "title": "数据通信与计算机网络",
            "date_published": "2021-03-06T15:39:28.474Z",
            "content_html": "<h1 id=\"第一章-概述\"><a class=\"anchor\" href=\"#第一章-概述\">#</a> 第一章 【概述】</h1>\n<h2 id=\"数据通信概述\"><a class=\"anchor\" href=\"#数据通信概述\">#</a> 数据通信概述</h2>\n<p class=\"red\">1，通信 (Communication)</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<details class=\"primary\"><summary>通信简介</summary><div>\n<ul>\n<li>[1] 通信是指人与人或人与自然之间，通过某种行为或媒体进行的信息交流与传递。不同的环境对通信有着不同的解释，在出现电波传递信息后，通信被单一解释为信息的传递，是指一地向另一地进行信息的传输与交换的过程。其目的是传递消息 (messgae) 中包含的信息 (Information)。</li>\n<li>[2] 通信传递的消息有多种形式，如，符号，文字，数据，语音，图形，图像等。他们大致可以归纳为两种类型：连续消息和离散消息。</li>\n<li>[3] 连续消息是指：消息的状态是随时间 l 连续变化的，如强弱变化的语音。</li>\n<li>[4] 离散消息是指：消息的状态是可数的或离散的，如，文字，符号和数据等。</li>\n<li>[5] 通常，我们把连续消息和离散消息分别称为模拟消息和数字消息。</li>\n<li>[6] 模拟信号：其信号的波形可以表示为时间的连续函数，通常，以模拟信号来传送消息的通信方式称为模拟通信，而传输模拟信号的通信系统称为模拟通信系统，</li>\n<li>[7] 数字信号：其特征是幅度不随时间连续变化，只能取有限个离散值。通常以两个离散值 (0,1) 来表示二进制数字信号。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6K7OKJ.png\" alt=\"图片\"></li>\n<li>[8] 注意：模拟信号和数字信号虽然是两种不同形式的信号，但他们在传输过程中可以相互变换的，模拟信号可以采用模数转换技术变换为离散的数字信号，而数字信号可以通过数模转换技术变换为连续的模拟信号。</li>\n<li>[9] 与模拟通信相比，数字信号具有以下优点：抗干扰性强，保密性好，设备易于集成化和便于使用计算技术对其进行处理等。缺点是占用的信道频带比模拟通信宽的多，降低了信道的使用率。但随着信道技术的改善，这一问题将会得到解决。</li>\n<li>[10] 数据通信是通信技术和计算机技术相结合而产生的一种新的通信方式。从某种意义上来说，数据通信可看成是数字通信的案例，具有数字通信的一切优点，</li>\n<li>[11] 数据通信主要是 “人 (通过终端)—— 机 (计算机)” 通信或 “机 —— 机” 通信。它以数据传输为基础，包括数据传输和数据交换，以及在数据传输前后的数据处理过程。由于数据通信离不开计算机，因此人们常把数据通信与计算机通信这两个名词混用。</li>\n</ul>\n</div></details>\n<h2 id=\"数据通信系统\"><a class=\"anchor\" href=\"#数据通信系统\">#</a> 数据通信系统</h2>\n<p class=\"red\">1，数据通信系统的模型</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>下面以两台 PC 通过电话线，在经公用电话网进行通信的简单例子，来说明任何一个通信系统都可以用一个简单的通信模型来抽象地描述其内在含义。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6KXUv8.png\" alt=\"图片\"></li>\n<li>该模型包括：源系统，传输系统和目的系统三个部分，有以下五个组成要素。</li>\n<li>[1] 源点：它是生成传输数据的设备，如，PC。</li>\n<li>[2] 发送器：通常，源点生成的数据要通过发送器编码后才能成为在传输系统中进行传输的电信号，如，调制解调器从相连的 PC 获得数字比特流，并变换成能在电话网上传输的模拟信号。</li>\n<li>[3] 传输系统：它是简单的传输线或复杂的网络系统。</li>\n<li>[4] 接收器：接收来自传输系统的信号并转换为终点能处理的信息，如，调制解调器接收来自传输系统的模拟信号，并将其转换成数字比特流。</li>\n<li>[5] 终点：它是获取来自接收器数据的设备。</li>\n</ul>\n<p class=\"red\">2，数据通信系统的组成</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>如前所述，数据通信主要是 “人 —— 机” 通信或 “机 —— 机” 通信，而，数据传输又是实现数据通信的基础。</li>\n<li>因此：凡是将终端设备与计算机经由模拟或数字传输系统连接起来，并以收集，传输，分配和处理数据为目的的系统都称为数据通信系统。它是实现数据通信的功能性物理实体。</li>\n</ul>\n<details class=\"primary\"><summary>具体组成</summary><div>\n<ul>\n<li>数据通信系统的具体组成可以从不同的角度给予不同的描述，从该系统设备级的构成，可认为数据通信系统由以下三个子系统组成。</li>\n</ul>\n<h1 id=\"第二章-数据通信基础知识\"><a class=\"anchor\" href=\"#第二章-数据通信基础知识\">#</a> 第二章 【数据通信基础知识】</h1>\n<h1 id=\"第三章-数据传输信道\"><a class=\"anchor\" href=\"#第三章-数据传输信道\">#</a> 第三章 【数据传输信道】</h1>\n<h1 id=\"第四章-数据传输技术\"><a class=\"anchor\" href=\"#第四章-数据传输技术\">#</a> 第四章 【数据传输技术】</h1>\n<h1 id=\"第五章-物理层\"><a class=\"anchor\" href=\"#第五章-物理层\">#</a> 第五章 【物理层】</h1>\n<h1 id=\"第六章-数据链路层\"><a class=\"anchor\" href=\"#第六章-数据链路层\">#</a> 第六章 【数据链路层】</h1>\n<h1 id=\"第七章-网络层\"><a class=\"anchor\" href=\"#第七章-网络层\">#</a> 第七章 【网络层】</h1>\n<h1 id=\"第八章-传输层\"><a class=\"anchor\" href=\"#第八章-传输层\">#</a> 第八章 【传输层】</h1>\n<h1 id=\"第九章-应用层\"><a class=\"anchor\" href=\"#第九章-应用层\">#</a> 第九章 【应用层】</h1>\n<h1 id=\"第十章-因特网的多媒体应用服务\"><a class=\"anchor\" href=\"#第十章-因特网的多媒体应用服务\">#</a> 第十章 【因特网的多媒体应用服务】</h1>\n<h1 id=\"第十一章-无线网络\"><a class=\"anchor\" href=\"#第十一章-无线网络\">#</a> 第十一章 【无线网络】</h1>\n<h1 id=\"第十二章-计算机网络的管理与安全\"><a class=\"anchor\" href=\"#第十二章-计算机网络的管理与安全\">#</a> 第十二章 【计算机网络的管理与安全】</h1>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n</div></details>\n",
            "tags": [
                "技术",
                "数通"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/",
            "url": "https://manshan.top/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/",
            "title": "新华三H3C刷题",
            "date_published": "2021-01-21T13:04:39.266Z",
            "content_html": "<h1 id=\"写再前面\"><a class=\"anchor\" href=\"#写再前面\">#</a> 写再前面</h1>\n<div class=\"note warning\">\n<p>注意注意</p>\n</div>\n<ul>\n<li>这是不同的题库，所以没有顺序。</li>\n<li>可能会有重复的题或解析。</li>\n</ul>\n<h1 id=\"第一章\"><a class=\"anchor\" href=\"#第一章\">#</a> 第一章</h1>\n<p>1，AAA 作为一种网络安全管理机制，可以通过如下哪些协议来实现？（选择一项或多项）<br>\nA：TACACS+<br>\nB: 802.1X<br>\nC: RADIUS+<br>\nD: EAPOL<br>\n<span class=\"red\"> 答案：AC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>AAA 包括三种功能：认证、授权、计费，常用 RADIUS 协议和 TACACS + 协议使用远程服务器，或交换机设备本身作为认证服务器.</li>\n</ul>\n<details class=\"primary\"><summary>AAA简介</summary><div>\n<ul>\n<li>\n<p>AAA 是认证（Authentication）、授权（Authorization）和计费（Accounting）的简称，是网络安全中进行访问控制的一种安全管理机制，提供认证、授权和计费三种安全服务。</p>\n</li>\n<li>\n<p>认证（Authentication）：是对用户的身份进行验证，判断其是否为合法用户。</p>\n</li>\n<li>\n<p>授权（Authorization）：是对通过认证的用户，授权其可以使用哪些服务。</p>\n</li>\n<li>\n<p>计费（Accounting）：是记录用户使用网络服务的资源情况，这些信息将作为计费的依据。</p>\n</li>\n<li>\n<p>AAA 一般采用 C/S（客户端 / 服务器）模式，这种模式结构简单、扩展性好，且便于集中管理用户信息，如图所示。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/21/s47bT0.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>AAA 客户端运行于 NAS（Network Access Server，网络接入服务器）上，AAA 服务器用于集中管理用户信息。</p>\n</li>\n<li>\n<p>远程接入用户通过网络（如 ISDN、PSTN 等）与 NAS 建立连接，从而获得访问其它网络（如 Internet）的权利或取得网络资源。</p>\n</li>\n<li>\n<p>NAS 负责把用户的认证、授权、计费信息透传给 AAA 服务器。</p>\n</li>\n<li>\n<p>AAA 服务器负责接收用户的连接请求，并对用户身份进行验证，返回用户配置信息给 NAS。</p>\n</li>\n<li>\n<p>NAS 根据服务器的返回信息进行配置并告知用户结果。</p>\n</li>\n</ul>\n</div></details>\n<p>2，园区网中可以采取如下那些措施来保证网络或者设备的安全？<br>\nA：对于非法访问网络资源，可以部署 ACL 来进行访问控制<br>\n B: 在网络中的交换机上配置 BPDU 保护功能<br>\n C: 部署 IPSEC VPN 来构建专用网络<br>\n D：园区网络通过 NAT 转换访问 INTERNET<br>\n<span class=\"red\"> 答案：ABCD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>ACL简介</summary><div>\n<ul>\n<li>\n<p>访问控制列表 (ACL)：是一种基于包过滤的访问控制技术，它可以根据设定的条件对接口上的数据包进行过滤，允许其通过或丢弃。访问控制列表被广泛地应用于路由器和三层交换机，借助于访问控制列表，可以有效地控制用户对网络的访问，从而最大程度地保障网络安全。</p>\n</li>\n<li>\n<p>功能：限制网络流量、提高网络性能；通信流量的控制，在网络设备接口处，决定哪种类型的通信流量被转发、哪种类型的通信流量被阻塞。</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>BPDU简介</summary><div>\n<ul>\n<li>\n<p>网桥协议数据单元 (BPDU,Bridge Protocol Data Unit) 生成树协议是一种桥嵌套协议，在 IEEE 802.1d 规范里定义，可以用来消除桥回路。它的工作原理是这样的：生成树协议定义了一个数据包，叫做桥协议数据单元 BPDU。</p>\n</li>\n<li>\n<p>网桥用 BPDU 来相互通信，并用 BPDU 的相关机能来动态选择根桥和备份桥。但是因为从中心桥到任何网段只有一个路径存在，所以桥回路被消除。</p>\n</li>\n<li>\n<p>在一个生成树环境里，桥不会立即开始转发功能，它们必须首先选择一个桥为根桥，然后建立一个指定路径。在一个网络里边拥有最低桥 ID 的将变成一个根桥，全部的生成树网络里面只有一个根桥。</p>\n</li>\n<li>\n<p>功能：根桥的主要职责是定期发送配置信息，然后这种配置信息将会被所有的指定桥发送。这在生成树网络里面是一种机制，一旦网络结构发生变化，网络状态将会重新配置。</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>IPSEC VPN简介</summary><div>\n<ul>\n<li>\n<p>指采用 IPSec 协议来实现远程接入的一种 VPN 技术，IPSec 全称为 Internet Protocol Security，是由 Internet Engineering Task Force (IETF) 定义的安全标准框架，在公网上为两个私有网络提供安全通信通道，通过加密通道保证连接的安全 —— 在两个公共网关间提供私密数据封包服务</p>\n</li>\n<li>\n<p>IPSEC 是一套比较完整成体系的 VPN 技术，它规定了一系列的协议标准。</p>\n</li>\n<li>\n<p>相关协议：</p>\n</li>\n<li>\n<p>1，VPN 作为一项成熟的技术，广泛应用于组织总部和分支机构之间的组网互联，其利用组织已有的互联网出口，虚拟出一条 “专线”，将组织的分支机构和总部连接起来，组成一个大的局域网。</p>\n</li>\n<li>\n<p>2，VPN 用户访问内网资源还需为拨入到 UTM25 的用户分配一个虚拟的私有 IP，使 SSL VPN 客户端的用户可以像局域网用户一样能正常访问局域网内的资源。</p>\n</li>\n<li>\n<p>导入 IPsec 协议原因：</p>\n</li>\n<li>\n<p>1，原因有 2 个，一个是原来的 TCP/IP 体系中间，没有包括基于安全的设计，任何人，只要能够搭入线路，即可分析所有的通讯数据。IPSEC 引进了完整的安全机制，包括加密、认证和数据防篡改功能。</p>\n</li>\n<li>\n<p>2，IPSEC 协议通过包封装技术，能够利用 Internet 可路由的地址，封装内部网络的 IP 地址，实现异地网络的互通。</p>\n</li>\n</ul>\n</div></details>\n<p>3，SSH 协议作为一种安全的远程登录协议，被广泛应用，关于 SSH 的描述正确的是____<br>\nA：SSH 采用额外的加密技术确保登录安全性<br>\n B:SSH 采用 TCP 端口 22 传输数据，端口 23 建立连接<br>\n C：SSH 还可以为 FTP 提供安全的传输通道<br>\n D：SSH 即 Secure Shell，可以采用 DES 认证方式保证数据的安全性<br>\n<span class=\"red\">答案：ACD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>SSH简介</summary><div>\n<ul>\n<li>\n<p>SSH (Secure Shell) 是一种安全远程登录协议，SSH 协议基于 TCP 进行传输，端口是 22。</p>\n</li>\n<li>\n<p>通过使用 SSH 协议，远程登录访问的安全性得到了很大提升，此外，SSH 还提供 SFTP (SSH File Transfer Protocol)，对在公共的 Internet 上的数据传输进行了安全保护。</p>\n</li>\n<li>\n<p>SSH 协议的特点：</p>\n</li>\n<li>\n<p>1，支持 DES、3DES 数据加密算法</p>\n</li>\n<li>\n<p>2，支持公钥验证方式、密钥改变、不验证方式</p>\n</li>\n<li>\n<p>3，支持 RSA 认证，具有防篡改功能</p>\n</li>\n</ul>\n</div></details>\n<p>4，关于 POE 系统，说法正确的是_____________<br>\nA：POE 系统包含 PSE 设备和 PD 设备两部分，其中 PD 为供电设备，PSE 为受电设备<br>\n B：POE 通常采用 mid-span 和 end-span 两种供电方法<br>\n C：通常 PSE 可以支持 mid-span 和 end-span 两种方法，PD 只能支持一种<br>\n D：POE 电源提供的电压为 48V，输出功率通常不超过 13W<br>\n<span class=\"red\"> 答案：BD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>POE简介</summary><div>\n<ul>\n<li>\n<p>POE (Power Over Ethernet) 指的是在现有的以太网 Cat.5 布线基础架构不作任何改动的情况下，在为一些基于 IP 的终端（如 IP 电话机、无线局域网接入点 AP、网络摄像机等）传输数据信号的同时，还能为此类设备提供直流供电的技术。POE 技术能在确保现有结构化布线安全的同时保证现有网络的正常运作，最大限度地降低成本。</p>\n</li>\n<li>\n<p>POE 也被称为基于局域网的供电系统 (PoL, Power over LAN) 或有源以太网 (ActiveEthernet)，有时也被简称为以太网供电。</p>\n</li>\n<li></li>\n<li>\n<p>PSE 供电设备，PD 受电设备</p>\n</li>\n<li>\n<p>mid-span 和 end-span 的区别在于</p>\n</li>\n<li>\n<p>1，mid-span 是普通交换机（无内置 POE 模块），需要外接 POE 电源的方式。</p>\n</li>\n<li>\n<p>2，end-span 是具有 POE 功能的交换机供电模式。</p>\n</li>\n</ul>\n</div></details>\n<p>5，在 NTP 客户端 / 服务器模式中，有关配置验证的说法正确的有____<br>\nA：在使能验证的同时必须同时配置验证密钥和可信密钥，否则无法正常启动验证<br>\n B：应在客户端上将制定密钥玉服务器关联，才可以成功完成验证<br>\n C：客户端未使能验证，而服务器使能验证的情况下，客户端的时钟也能同步<br>\n D: 客户端和服务器端的验证必须保持一致，否则时钟同步失败<br>\n<span class=\"red\">答案：ABC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>NTP简介</summary><div>\n<ul>\n<li>\n<p>NTP 服务器【Network Time Protocol（NTP）】是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS 等等) 做同步化，它可以提供高精准度的时间校正（LAN 上与标准间差小于 1 毫秒，WAN 上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。时间按 NTP 服务器的等级传播。按照离外部 UTC 源的远近把所有服务器归入不同的 Stratum（层）中。</p>\n</li>\n<li>\n<p>NTP 验证功能可以分为客户端的 NTP 验证和服务器端的 NTP 验证两个部分。在应用 NTP 验证功能时，应注意以下原则：</p>\n</li>\n<li>\n<p>1、对于所有同步模式，如果使能了 NTP 验证功能，应同时配置验证密钥并将密钥设为可信密钥，否则，无法正常启动 NTP 验证功能。</p>\n</li>\n<li>\n<p>对于客户端 / 服务器模式和对等体模式，还应在客户端（对等体模式中的主动对等体）将指定密钥与对应的 NTP 服务器（对等体模式的被动对等体）关联；对于广播服务器模式和组播服务器模式，应在广播服务器或组播服务器上将指定密钥与对应的 NTP 服务器关联。否则，无法正常启动 NTP 验证功能。</p>\n</li>\n<li>\n<p>对于客户端 / 服务器同步模式，如果客户端没有成功启动 NTP 验证功能，不论服务器端是否使能 NTP 验证，客户端均可以与服务器同步；如果客户端上成功启用了 NTP 验证功能，则客户端只会同步到提供可信密钥的服务器，如果服务器提供的密钥不是可信的密钥，那么客户端不会与其同步。</p>\n</li>\n<li>\n<p>对于所有同步模式，服务器端的配置与客户端的配置应保持一致。</p>\n</li>\n</ul>\n</div></details>\n<p>6，路由器 IGMP 协议的版本可以在___视图中配置<br>\n A：用户视图<br>\n B：系统全局视图<br>\n C：IGMP 视图<br>\n D：接口视图<br>\n<span class=\"red\">答案：CD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>IGMP协议简介</summary><div>\n<ul>\n<li>\n<p>Internet 组管理协议称为 IGMP 协议（Internet Group Management Protocol），是因特网协议家族中的一个组播协议。该协议运行在主机和组播路由器之间。IGMP 协议共有三个版本，即 IGMPv1、v2 和 v3。</p>\n</li>\n<li>\n<p>IGMP（Internet Group Management Protocol）因特网组管理协议，是 TCP/IP 协议族中负责 IPv4 组播成员管理的协议，用来在 IP 主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系。</p>\n</li>\n<li>\n<p>在配置路由器的 IGMP 具体参数之前，需要指定 IGMP 协议的版本，IGMP 的版本可以在 IGMP 视图配置也可以在接口视图配置。</p>\n</li>\n<li>\n<p>在 IGMP 视图配置全局 IGMP 版本的命令为：</p>\n</li>\n<li>\n<p>[H3C-igmp]version version-number</p>\n</li>\n<li>\n<p>在接口视图配置 IGMP 版本的命令为：</p>\n</li>\n<li>\n<p>[H3C-Vlan-interface100]igmp version version-number</p>\n</li>\n</ul>\n</div></details>\n<p>7，关于交换机的端口模式和 IP 电话语音流类型的配合关系，说法正确的有___<br>\nA: 如果 IP 电话语音流为 tagged 语音流，则交换机端口可以工作在自动和手动模式 B：如果 IP 电话语音流在 untagged 语音流，则交换机端口只能工作在手动模式<br>\n C：自动模式下，端口不能为 access 端口<br>\n D：手动模式下，端口只能为 trunk 端口<br>\n<span class=\"red\">答案：ABC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>端口模式和IP电话语音流类型的配合关系简介</summary><div>\n<ul>\n<li>端口模式与 IP 电话语音流类型配合关系：</li>\n<li>1，自动模式：</li>\n<li>(1) 如果是 tagged 语音流 ：</li>\n<li>access: 不支持，</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须存在且不能是 voice VLAN，同时接入端口允许缺省 VLAN 通过</li>\n<li>hybrid: 支持，但是接入端口的缺省 VLAN 必须存在且不能是 voice VLAN，同时缺省 VLAN 应在接入端口允许通过的 tagged VLAn 列表中。</li>\n<li>(2) 如果是 untagged 语音流：</li>\n<li>access、Trunk、hybrid: 不支持</li>\n<li>2，手动模式：</li>\n<li>(1) 如果是 tagged 语音流</li>\n<li>access；不支持</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须存在，且不能那个是 voice vlan，同时接入端口允许该缺省 VLAN 通过</li>\n<li>hybrid: 支持，但接入端口的缺省 VLAN 必须存在且不能是 voice vlan，同时 voice vlan 应在接入端口允许通过的 tagged vlan 列表中</li>\n<li>(2) 如果是 untagged 语音流</li>\n<li>access: 支持，但接入端口的缺省 VLAN 必须是 voice vlan</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须是 voice vlan，且接入端口允许 voice vlan 通过</li>\n<li>hybrid: 支持，但接入端口的缺省 VLAN 必须是 voice vlan, 且在接入端口允许通过 untagged vlan 列表中</li>\n</ul>\n</div></details>\n<p>8，下面说法正确的是__（选择一项或多项）<br>\nA.MSTP 和 RSTP 能够互相识别对方的协议报文，可以互相兼容<br>\n B. 在 STP 兼容模式下，设备的各个端口将向外发送 STP BPDU 报文<br>\n C. 在 RSTP 模式下，设备的各个端口将向外发送 RSTP BPDU 报文，当发现与 STP 设备相连时，该端口会自动迁移到 STP 兼容模式下工作<br>\n D. 在 MSTP 模式下，设备的各个端口将向外发送 MSTP BPDU 报文，当发现某端口与 STP 设备相连时，该端口会自动迁移到 STP 兼容模式下工作<br>\n<span class=\"red\">答案：BCD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>MSTP与RSTP，STP的简介</summary><div>\n<ul>\n<li>MSTP-RSTP-STP  这样的兼容顺序，不能从 STP 向 MSTP 兼容。</li>\n<li>MSTP 是多生成树协议，是在有多个 vlan 的情况下使用的一种生成树协议</li>\n<li>RSTP 是快速生成树协议，是从 STP 生成树协议简化升级而来，去掉了 2 种状态，从而提高计算时间。</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>MSTP简介</summary><div>\n<ul>\n<li>\n<p>MSTP 是多生成树协议，允许一个交换环境中运行多个生成树，每个生成树称为一个实例，MSTP 将路由环路网络修剪成一个无环的树形网络，避免广播风暴的产生，同时还提供了数据转发的多个冗余路径，在数据转发过程中实现 VLAN 数据的负载均衡，MSTP 还兼容 STP 和 RSTP。</p>\n</li>\n<li>\n<p>MSTP 的基本原理：</p>\n</li>\n<li>\n<p>1，MSTP 的网络层次：</p>\n</li>\n<li>\n<p>一个二层交换网络可以划分多个 MST 域，每个生成树域可以划分多个 MSTI，每个实例中可以映射多个 VLAN</p>\n</li>\n<li>\n<p>2，MST 域：</p>\n</li>\n<li>\n<p>MST 域是多生成树域，由局域网中的多台交换机他们之间的网段构成一个局域网可以存在多个 MST 域，各 MST 域之间在物理上直接或间接相连。</p>\n</li>\n<li>\n<p>3，MSTI：</p>\n</li>\n<li>\n<p>一个 MSTI 域内可以运行多个 MSTI，MSTI 之间彼此独立，MSTI 可以与一个或者多个 VLAN 对应，但一个 VLAN 只能与一个 MSTI 对应。</p>\n</li>\n<li>\n<p>4，端口角色：</p>\n</li>\n<li>\n<p>MSTP 中的角色主要有根端口，指定端口，预备端口，备份端口和边缘端口，除边缘端口外其他端口角色都参与 MSTP 的计算过程。</p>\n</li>\n<li>\n<p>5，MSTP 的端口状态主要有三种：</p>\n</li>\n<li>\n<p>Forwarding：转发状态</p>\n</li>\n<li>\n<p>Learning：学习状态</p>\n</li>\n<li>\n<p>Discarding：阻塞状态</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>RSTP简介</summary><div>\n<ul>\n<li>\n<p>RSTP（rapid spanning Tree Protocol ），即快速生成树协议，这种协议在网络结构发生变化时，能更快的收敛网络。它比 802.1d 多了一种端口类型：备份端口（backup port）类型，用来做指定端口的备份。 STP（Spanning Tree Protocol ）是生成树协议的英文缩写。该协议可应用于环路网络，通过一定的算法实现路径冗余，同时将环路网络修剪成无环路的树型网络，从而避免报文在环路网络中的增生和无限循环。</p>\n</li>\n<li>\n<p>快速生成树协议（Rapid Spanning Tree Protocol ，RSTP） 用于在局域网中消除数据链路层物理环路，其核心是快速生成树算法。</p>\n</li>\n<li>\n<p>RSTP 完全向下兼容 STP 协议除了和传统的 STP 协议一样具有避免回路、动态管理冗余链路的功能外，RSTP 极大的缩短了拓扑收敛时间，在理想的网络拓扑规模下，所有交换设备均支持 RSTP 协议且配置得当时，拓扑发生变化（链路 UP/DOWN）后恢复稳定的时间可以控制在秒级，而传统的拓扑稳定且能正常工作所需时间为 50 秒。</p>\n</li>\n<li>\n<p>RSTP 的主要功能可以归纳如下：</p>\n</li>\n<li>\n<p>1、 发现并生成局域网的一个最佳树型拓扑结构；</p>\n</li>\n<li>\n<p>2、 发现拓扑故障并随之进行恢复，自动更新网络拓扑结构，启用备份链路，同时保持最佳树型结构；</p>\n</li>\n<li>\n<p>运行 RSTP 协议的网络交换设备通过对自身网桥信息和接收到的 BPDU 中来自其他网桥的信息进行比较，利用 RSTP 算法进行计算，更新系统状态机，选举端口角色并阻塞某些端口，将环形网络裁剪成树形网络，防止环形网络中的报文增生和无限循环产生的广播风暴，避免因此带来的报文处理能力下降问题的发生</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>STP简介</summary><div>\n<ul>\n<li>\n<p>STP（Spanning Tree Protocol）是生成树协议的英文缩写，可应用于计算机网络中树形拓扑结构建立，主要作用是防止网桥网络中的冗余链路形成环路工作。但某些特定因素会导致 STP 失败，要排除故障可能非常困难，这取决于网络设计 [1]  。生成树协议适合所有厂商的网络设备，在配置上和体现功能强度上有所差别，但是在原理和应用效果是一致的。</p>\n</li>\n<li>\n<p>STP 的基本原理是，通过在交换机之间传递一种特殊的协议报文，网桥协议数据单元（Bridge Protocol Data Unit，简称 BPDU），来确定网络的拓扑结构。BPDU 有两种，配置 BPDU（Configuration BPDU）和 TCN BPDU。前者是用于计算无环的生成树的，后者则是用于在二层网络拓扑发生变化时产生用来缩短 MAC 表项的刷新时间的（由默认的 300s 缩短为 15s）。</p>\n</li>\n<li>\n<p>Spanning Tree Protocol（STP）是在 IEEE 802.1D 文档中定义，该协议的原理是按照树的结构来构造网络拓扑，消除网络中的环路，避免由于环路的存在而造成广播风暴问题。</p>\n</li>\n</ul>\n</div></details>\n<p>9，以太网交换机的二层转发基本流程包括__<br>\nA. 根据接收到的以太网帧的源 MAC 地址和 VLAN ID 信息添加或刷新 MAC 地址表项；<br>\nB. 根据目的 MAC 地址查找 MAC 地址表如果没有找到匹配项，那么在报文对应的 VLAN 内广播；<br>\nC. 如果找到匹配项，但是表项对应的端口并不属于报文对应的 VLAN，那么丢弃该帧；<br>\nD. 如果找到匹配项，且表项对应的端口属于报文对应的 VLAN，那么将报文转发到该端口，但是如果表项对应端口与收到以太网帧的端口相同，则丢弃该帧。</p>\n",
            "tags": [
                "技术",
                "H3C"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/",
            "url": "https://manshan.top/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/",
            "title": "Python爬虫入门到高级",
            "date_published": "2021-01-18T11:36:46.777Z",
            "content_html": "<h1 id=\"第一章爬虫的概念\"><a class=\"anchor\" href=\"#第一章爬虫的概念\">#</a> 第一章【爬虫的概念】</h1>\n<p class=\"red\">1，什么是爬虫？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，程序员：写程序，然后去互联网上<em><strong>抓取数据</strong></em>的过程。</p>\n</li>\n<li>\n<p>2，互联网：庞大的网，有好多 a 链接组成的，网的节点就是一个 a 链接 ——&gt;URL (统一资源定位符)。</p>\n</li>\n</ul>\n<p class=\"red\">2，哪些语言可以实现爬虫？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，PHP：可以做，但对多进程，多线程支持的不好。</p>\n</li>\n<li>\n<p>2，JAVA：可以做，做的不错，最主要的竞争对手。但，代码臃肿，重构成本大。</p>\n</li>\n<li>\n<p>3，C，C++：可以做，但对个人能力要求高。</p>\n</li>\n<li>\n<p>4，Python：可以做，语法简单，代码优美，成本低，支持的模块多，强大的框架 Scrapy，最好的选择。</p>\n</li>\n</ul>\n<p class=\"red\">3，爬虫的两个概念</p>\n<div class=\"note info\">\n<p>通用爬虫</p>\n</div>\n<ul>\n<li>1，有：</li>\n<li>百度，360，谷歌，搜狐，Bing。</li>\n<li>2，原理：</li>\n<li>抓取网页</li>\n<li>采集数据</li>\n<li>数据处理</li>\n<li>提供检索服务</li>\n<li>3，通用爬虫如何抓取新网站？</li>\n<li>主动提交 URL</li>\n<li>设置友情链接</li>\n<li>百度会和 DNS 服务商合作，抓取新网站</li>\n<li>4，检索排名：</li>\n<li>竞价排名</li>\n<li>根据 pagerank 值，访问量，点击量 (SEO: 负责提升网站排名）</li>\n<li>5，robots.txt:</li>\n<li>限制哪些可以爬取，哪些不可以爬取，<span>是一个口头上的协议。自己写的爬虫程序不需要遵循。</span>{.red</li>\n</ul>\n<div class=\"note info\">\n<p>聚焦爬虫</p>\n</div>\n<ul>\n<li>1，简介：</li>\n<li>根据特定的需求，抓取指定的数据。</li>\n<li>2，思路：</li>\n<li>代替浏览器上网</li>\n<li>给一个 URL</li>\n<li>写程序，模拟浏览器访问 URL</li>\n<li>解析内容，提取数据</li>\n<li>3，网页的特点：</li>\n<li>网页都有自己唯一的 URL</li>\n<li>网页内容都是 HTML 结构</li>\n<li>使用的都是 http，https 协议</li>\n<li></li>\n</ul>\n",
            "tags": [
                "技术",
                "爬虫"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/",
            "url": "https://manshan.top/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/",
            "title": "Python高级编程",
            "date_published": "2021-01-18T11:34:34.882Z",
            "content_html": "<h1 id=\"第一章python基本语法\"><a class=\"anchor\" href=\"#第一章python基本语法\">#</a> 第一章【Python 基本语法】</h1>\n<h2 id=\"基本语法一\"><a class=\"anchor\" href=\"#基本语法一\">#</a> 基本语法 (一)</h2>\n<p class=\"red\">1，Python 程序的构成：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1）命令的路径：</li>\n<li>#！/usr/bin/python</li>\n<li>2）中文编码的说明：</li>\n<li># -<em>- coding: UTF-8 -</em>- 或者 #coding=utf-8</li>\n<li>3）导入模块或模块的部分：</li>\n<li>import sys</li>\n<li>from modname import name</li>\n</ul>\n<p class=\"red\">2，第一个 Python 程序：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1]&quot;HELLO XXX&quot;(XXX 为你的名字)</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># _*_coding:utf-8_*_</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>name <span class=\"token operator\">=</span> input<span class=\"token punctuation\">(</span>\"what`s your name ? <span class=\"token string\">\")</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>print(\"HELLO,%s\" % <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">))</span></pre></td></tr></table></figure><ul>\n<li>[2] python 脚本语句的特点：</li>\n<li>①：一般情况下，每行一条语句，不需要用 &quot;;&quot; 结尾，也可以每行多条语句，语句之间用 &quot;;&quot; 分割，如下图：</li>\n</ul>\n",
            "tags": [
                "技术",
                "Python"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/",
            "url": "https://manshan.top/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/",
            "title": "深信服SCSA",
            "date_published": "2021-01-14T12:46:30.884Z",
            "content_html": "<h1 id=\"第一章信息安全概念\"><a class=\"anchor\" href=\"#第一章信息安全概念\">#</a> 第一章【信息安全概念】</h1>\n<h2 id=\"写在前面\"><a class=\"anchor\" href=\"#写在前面\">#</a> 写在前面</h2>\n<div class=\"note success\">\n<p>提示</p>\n</div>\n<ul>\n<li>缓存较大，图片需要加载一会。</li>\n<li>第一章关于伦理基础，只是截屏概括。</li>\n</ul>\n<h2 id=\"安全概念与网络层攻击\"><a class=\"anchor\" href=\"#安全概念与网络层攻击\">#</a> <strong>安全概念与网络层攻击：</strong></h2>\n<p>1，信息安全：通过采用<em><strong>软硬件技术，网络技术，密钥技术</strong></em>等安全技术和各种组织管理措施，来保护信息在其生命周期内的产生，传输，交换，处理和存储的各个环节中，信息的<em><strong>机密性，完整性和可用性</strong></em>不被破环。</p>\n<p>2，信息安全四个阶段：<em><strong>1，通信保密阶段。2，计算机安全阶段。3，信息技术安全阶段。4，信息保障阶段。</strong></em></p>\n<p>3，信息安全五要素：<em><strong>保密性，完整性，可用性，可控性，不可否认性。</strong></em></p>\n<p>4，五要素具体介绍：<br>\n- 保密性：确保信息不暴露给未授权的实体或进程。目的：即使信息被窃听或者截获，攻击者也无法知晓信息的真实内容，可以对抗网络攻击中的被动攻击。通过加密技术保障信息的保密性。<br>\n- 完整性：只有得到允许的人才能修改实体或进程，并且能够判别出实体或进程是否以被修改。完整性鉴别机制，保障只有允许的人才能修改数据，可以防篡改。靠 HASH。<br>\n- 可用性：得到授权的实体可获得服务，用访问控制机制，阻止非授权用户进入网络，使静态・信息可见，动态信息可操作，防止业务突然中断。<br>\n- 可控性：对信息进行监视审查，实现对网络资源及信息的可控性。<br>\n- 不可否认性：对出现的安全问题提供调查的依据和手段，使用审计，监控，防抵赖等安全机制，实现信息安全法的可审查性。</p>\n<p class=\"red\">5，信息安全风险有：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s0UmD0.png\" alt=\"图片\"><br>\n<img data-src=\"https://s3.ax1x.com/2021/01/15/s0wkCD.png\" alt=\"图片\"></p>\n<p>6，网络安全：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>计算机网络环境下的信息安全，指<span class=\"red\">网络系统的硬件，软件及其系统中的数据</span>受到保护，不因偶然的或者恶意的原因而遭到<span class=\"red\">破坏，更改，泄露，</span>系统连续可靠正常的运行，网络服务不中断。</li>\n</ul>\n<p class=\"red\">7，常见的网络安全风险：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s0woxH.png\" alt=\"图片\"></p>\n<p class=\"red\">8，常见的网络安全术语：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s00AoV.png\" alt=\"图片\"></p>\n<p class=\"red\">9，网络的基本攻击模式：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssQqcq.png\" alt=\"图片\"></p>\n<p class=\"red\">10，网络的基本攻击模式有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，物理攻击</li>\n<li>2，流量型攻击</li>\n<li>3，单包攻击</li>\n</ul>\n<p class=\"red\">物理攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss1MoF.png\" alt=\"图片\"></p>\n<p class=\"red\">流量型攻击有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>(1)，网络层攻击，</li>\n<li>(2)，应用层攻击。</li>\n</ul>\n<p class=\"red\">流量攻击类型：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss1yQI.png\" alt=\"图片\"></p>\n<p class=\"red\">单包攻击有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>(1)，畸形报文攻击，</li>\n<li>(2)，特殊报文攻击，</li>\n<li>(3)，扫描窥探攻击。</li>\n</ul>\n<p class=\"red\">单包攻击类型：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss8lvR.png\" alt=\"图片\"></p>\n<p class=\"red\">单包攻击的种类：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss8xMR.png\" alt=\"图片\"></p>\n<p class=\"red\">11，地址扫描攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssJKXR.png\" alt=\"图片\"></p>\n<p class=\"red\">12 端口扫描攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssJIEV.png\" alt=\"图片\"></p>\n<p class=\"red\">13，SMURF 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYp4O.png\" alt=\"图片\"></p>\n<p class=\"red\">14，LAND 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYlvj.png\" alt=\"图片\"></p>\n<p class=\"red\">15，Fraggle 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYfRe.png\" alt=\"图片\"></p>\n<p class=\"red\">16，IP Fragment (分片) 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/sst1JO.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li class=\"red\">DF 位为 1 时，表示不能分片。</li>\n</ul>\n<p class=\"red\">17，IP Spoofing 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssNsN6.png\" alt=\"图片\"></p>\n<p class=\"red\">18，Teardrop (泪滴) 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssUOJK.png\" alt=\"图片\"></p>\n<p class=\"red\">19，WinNuke 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssaYy4.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，URG（紧急位）：设置为 1 时，首部中的紧急指针有效；为 0 时，紧急指针没有意义。</li>\n<li>2，PSH（推位）：当设置为 1 时，要求把数据尽快的交给应用层，不做处理。</li>\n<li>3，通常的数据中都会带有 PSH 但 URG 只在紧急数据的时设置，也称 “带外数据”，解释如下：</li>\n<li>URG 标志设置为 1 时，紧急指针才有效，紧急方式是向对方发送紧急数据的一种方式，表示数据要优先处理。</li>\n<li>URG=1，表示紧急指针指向包内数据段的某个字节（数据从第一字节到指针所指向字节就是紧急数据）不进入</li>\n<li>缓冲区（一般不都是待发送的数据要先进入发送缓存吗) 就直接交个上层进程，</li>\n<li>余下的数据都是要进入接收缓冲的；一般来说 TCP 是要等到整个缓存都填满了后在向上交付，</li>\n<li>但是如果 PSH=1 的话，就不用等到整个缓存都填满，直接交付，</li>\n<li>但是这里的交付仍然是从缓冲区交付的，URG 是不要经过缓冲区的。</li>\n</ul>\n</div></details>\n<p class=\"red\">20，超大 ICMP 报文攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sRH7h4.png\" alt=\"图片\"></p>\n<p class=\"red\">21，ICMP 重定向与不可达攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sRqeMR.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，ICMP 重定向：如上图，攻击者 1.5，被攻击者 100.2。攻击者截获其他主机发往网关 1.1 的数据包，攻击者修改完之后，在转发到互联网上。互联网回包时再发给攻击者 1.5</li>\n<li>2，ICMP 不可达：如上图，攻击者，向其他主机发送目的主机不可达信息，告诉其他主机 100.2 不可达，这样其他主机不会给 100.2 发包。</li>\n</ul>\n</div></details>\n<p class=\"red\">简介：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW3GyF.png\" alt=\"图片\"></p>\n<p class=\"red\">22，Tracert 报文攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW3HmQ.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>\n<p>1，Tracert 工作原理：利用 ICMP 协议，Tracert 命令用 IP 生存时间 (TTL) 字段和 ICMP 错误消息来确定从一个主机到网络上其他主机的路由。首先，tracert 送出一个 TTL 是 1 的 IP 数据包到目的地，当路径上的第一个路由器收到这个数据包时，它将 TTL 减 1。此时，TTL 变为 0，所以该路由器会将此数据包丢掉，并送回一个「ICMP time exceeded」消息（包括发 IP 包的源地址，IP 包的所有内容及路由器的 IP 地址），</p>\n</li>\n<li>\n<p>tracert 收到这个消息后，便知道这个路由器存在于这个路径上，接着 tracert 再送出另一个 TTL 是 2 的数据包，发现第 2 个路由器…… tracert 每次将送出的数据包的 TTL 加 1 来发现另一个路由器，这个重复的动作一直持续到某个数据包 抵达目的地。当数据包到达目的地后，该主机则不会送回 ICMP time exceeded 消息，一旦到达目的地，由于 tracert 通过 UDP 数据包向不常见端口 (30000 以上) 发送数据包，因此会收到「ICMP port unreachable」消息，故可判断到达目的地。</p>\n</li>\n<li>\n<p>tracert 有一个固定的时间等待响应 (ICMP TTL 到期消息)。如果这个时间过了，它将打印出一系列的 * 号表明：在这个路径上，这个设备不能在给定的时间内发出 ICMP TTL 到期消息的响应。然后，Tracert 给 TTL 记数器加 1，继续进行。</p>\n</li>\n<li>\n<p>2，Traceruote 工作原理：利用 UDP 协议，通过 traceroute 我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。当然每次数据包由某一同样的出发点（source）到达某一同样的目的地 (destination) 走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的。linux 系统中，我们称之为 traceroute, 在 MS Windows 中为 tracert。 traceroute 通过发送小的数据包到目的设备直到其返回，来测量其需要多长时间。</p>\n</li>\n<li>\n<p>一条路径上的每个设备 traceroute 要测 3 次。输出结果中包括每次测试的时间 (ms) 和设备的名称（如有的话）及其 IP 地址</p>\n</li>\n</ul>\n</div></details>\n<h2 id=\"应用层攻击防护\"><a class=\"anchor\" href=\"#应用层攻击防护\">#</a> <strong>应用层攻击防护：</strong></h2>\n<p class=\"red\">1，URPF 技术：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWaJaD.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，严格模式： 数据包必须和路由器的路由表中的出接口一一对应，1 号口进 1 号口出。</li>\n<li>2，松散模式：如果是默认路由，由于没有公网的路由表，主要匹配到默认路由 1 号口就行。</li>\n</ul>\n</div></details>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>URPF简介</summary><div>\n<ul>\n<li>1，基本概念：</li>\n<li>通常情况下，网络中的路由器接收到报文后，获取报文的目的地址，针对目的地址查找路由，如果查找到则进行正常的转发，否则丢弃该报文。由此得知，路由器转发报文时，并不关心数据包的源地址，这就给源地址欺骗攻击有了可乘之机。</li>\n<li>源地址欺骗攻击就是入侵者通过构造一系列带有伪造源地址的报文，频繁访问目的地址所在设备或者主机，即使受害主机或网络的回应报文不能返回到入侵者，也会对被攻击对象造成一定程度的破坏。</li>\n<li>URPF 通过检查数据包中源 IP 地址，并根据接收到数据包的接口和路由表中是否存在源地址路由信息条目，来确定流量是否真实有效，并选择数据包是转发或丢弃。</li>\n<li>2，检查方式：</li>\n<li>uRPF 对报文源地址的合法性检查主要有两种：严格型（strict）和松散型（loose）。另外还支持忽略缺省路由的 uRPF 检查以及配置了 ACL 规则的 uRPF 检查。</li>\n<li>在接口上设置严格模式的 uRPF：路由器对从该接口进入的数据包源地址进行查询，如果报文的源地址在路由表中存在（为正常的源地址路由或者缺省路由），并且报文的入接口等于路由的出接口，则认为该报文合法，否则丢弃该报文。</li>\n<li>在接口上设置松散模式的 uRPF：路由器仅检查报文的源地址是否在路由表中存在（正常的源地址路由或者缺省路由），而不再检查报文的入接口与路由表是否匹配。这使得 uRPF 既可以有效地阻止网络攻击，又可以避免错误的拦截合法用户的报文。</li>\n<li>当路由器上配置了缺省路由后，会导致 uRPF 根据路由表检查源地址路由时，对查不到源地址路由的报文自动检查到缺省路由。针对这种情况，用户可以配置 uRPF 忽略缺省路由的检查。</li>\n<li>通过 ACL 规则的引入，uRPF 给用户提供了一种更加灵活的定制方案。配置了 ACL 后，在 uRPF 检查失败的情况下，路由器按照 ACL 规则 permit 或者 deny 报文进行操作。</li>\n<li>3，作用：</li>\n<li>通信网络中，诸如 DoS 攻击、TCP SYN 洪泛攻击、UDP 洪泛攻击和 ICMP 洪泛攻击等，都可能通过借助源地址欺骗的方式攻击目标设备或者主机，造成被攻击者系统性能严重的降低，甚至导致系统崩溃。uRPF 技术就是网络设备为了防范此类攻击而使用的一种常用技术。</li>\n</ul>\n</div></details>\n<p class=\"red\">2，链路层 ——MAC 泛洪攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWDiHP.png\" alt=\"图片\"></p>\n<p class=\"red\">3，DDOS 通用攻击防范技术：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWss6H.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用阻断和限流来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWsOA0.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用过滤器来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWyKud.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用黑白名单来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWygv4.png\" alt=\"图片\"></p>\n<p class=\"red\">4，SYN Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW6BsH.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>预防：限制断开连接数。</li>\n</ul>\n<p class=\"red\">5，SYN-ACK Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWgiHs.png\" alt=\"图片\"></p>\n<p class=\"red\">6，ACK Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWcx9f.png\" alt=\"图片\"></p>\n<p class=\"red\">7，一个完整的网络攻击链：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>情报收集 —— 工具准备 —— 载荷投递 —— 漏洞利用 —— 释放载荷 —— 建立通道 —— 目标达成。</li>\n</ul>\n<p class=\"red\">8，协议栈自身的脆弱性：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>缺乏数据源验证机制</li>\n<li>缺乏机密性保障机制</li>\n<li>缺乏完整性验证机制</li>\n</ul>\n<p class=\"red\">9，DDOS 攻击风险防护方案：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTcsoD.png\" alt=\"图片\"></p>\n<p class=\"red\">10，应用层 ——DNS 欺骗攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTcRSA.png\" alt=\"图片\"></p>\n<p class=\"red\">11，缓冲区溢出攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTc7Fg.png\" alt=\"图片\"></p>\n<p>防范：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/23/sTcOln.png\" alt=\"图片\"></p>\n<p class=\"red\">12，勒索病毒攻击链分析：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>感染媒介：钓鱼软件，蠕虫病毒，恶意邮件。</li>\n<li>C&amp;C 通信：匿名通信，下载载荷，DGA 通信。</li>\n<li>文件加密：混合加密体系，弹出勒索对话框。</li>\n<li>横向移动：弱点横向探测，蠕虫式传播，MS17-010 永恒之蓝漏洞。</li>\n</ul>\n<p class=\"red\">13，勒索病毒特点：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>针对攻击者：传播入口多，传播技术隐蔽，勒索产业化发展。</li>\n<li>针对受害者：安全状况看不清，安全设备防不住，问题处置不及时。</li>\n</ul>\n<p class=\"red\">14，终端安全防范措施：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>不点击来历不明的邮件附件，不从不明的网站下载软件。</li>\n<li>及时给主机打补丁，修复相应的高危病毒。</li>\n<li>对重要的数据进行定期备份。</li>\n<li>关闭不必要的端口。</li>\n<li>RDP 远程服务器等连接尽量使用强密码。</li>\n<li>安装专业的防病毒软件，定期检查。</li>\n</ul>\n<h2 id=\"整体安全解决方案\"><a class=\"anchor\" href=\"#整体安全解决方案\">#</a> <strong>整体安全解决方案</strong></h2>\n<p class=\"red\">1，企业信息安全建设规划目标：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>风险可视化</li>\n<li>防御主动化</li>\n<li>运行自动化</li>\n<li>安全智能化</li>\n</ul>\n<p class=\"red\">2，网络安全行业对风险的应对：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>检测</li>\n<li>相应</li>\n<li>防御</li>\n</ul>\n<p class=\"red\">3，深信服 ARDRO 智安全架构：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT28C4.png\" alt=\"图片\"></p>\n<p class=\"red\">4，企业级安全体系整体框架：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT2UDx.png\" alt=\"图片\"></p>\n<p class=\"red\">5，安全产品矩阵及说明：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT2y2d.png\" alt=\"图片\"></p>\n<p class=\"red\">6，网络安全 —— 设备规划：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRis1.png\" alt=\"图片\"></p>\n<p class=\"red\">7，网络安全 —— 减少内部风险：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRnRH.png\" alt=\"图片\"></p>\n<p class=\"red\">8，网络安全 —— 边界最佳实践：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRlLt.png\" alt=\"图片\"></p>\n<p class=\"red\">9，网络安全 —— 构建统一的安全接入平台：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRwyn.png\" alt=\"图片\"></p>\n<p class=\"red\">10，端点安全 —— 巩固最后一道防线：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRhO1.png\" alt=\"图片\"></p>\n<p class=\"red\">11，网络安全 —— 端到端的安全重构：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRX6A.png\" alt=\"图片\"></p>\n<p class=\"red\">12，网络安全 —— 构建安全大脑：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRxmt.png\" alt=\"图片\"></p>\n<p class=\"red\">13，网络安全拓扑参考：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTW9k8.png\" alt=\"图片\"></p>\n<h1 id=\"第二章数据传输安全\"><a class=\"anchor\" href=\"#第二章数据传输安全\">#</a> 第二章【数据传输安全】</h1>\n<h2 id=\"vpn技术概念\"><a class=\"anchor\" href=\"#vpn技术概念\">#</a> <strong>VPN 技术概念：</strong></h2>\n<h3 class=\"blue\" id=\"vpn需求背景\"><a class=\"anchor\" href=\"#vpn需求背景\">#</a> VPN 需求背景</h3>\n<p class=\"red\">1，VPN 需求场景：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/24/sHbi5j.png\" alt=\"图片\"></p>\n<p class=\"red\">2，需求背景：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 企业，组织，商家等，对专用网有强大的需求。</li>\n<li>[2] 高性能，高速度和高安全性是专用网明显的优势。</li>\n<li>[3] 物理专用网价格昂贵，物理架构实施有难度，传统的通过租用专线或拨号网络的方式越来越不适用。(性价比较低)</li>\n<li>[4] TCP/IP 协议的本身的局限性，不能保障信息直接传输的保密性，存在许多固有的安全缺陷。</li>\n<li>[5] VPN = 对专用网的需求越来越高 + 物理专用网络架设难，性价比低。</li>\n</ul>\n<p class=\"red\">3，VPN 概述：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>[1] VPN (虚拟专用网)：指依靠 ISP 或其他 NSP 在公用网络基础设施之上构建专用的安全数据通信网络。只不过这个专线网络是逻辑上的而不是物理的。所以称为虚拟专用网。</p>\n</li>\n<li>\n<p>[2] 虚拟：用户不再需要拥有实际的长途数据线路，而是使用公共网络资源建立自己的私有网络。</p>\n</li>\n<li>\n<p>[3] 专用：用户可以定制最符合自身需求的网络。</p>\n</li>\n<li>\n<p>[4] 核心技术：隧道技术。</p>\n</li>\n</ul>\n<h3 class=\"blue\" id=\"vpn分类\"><a class=\"anchor\" href=\"#vpn分类\">#</a> VPN 分类</h3>\n<p class=\"red\">1，按业务型分类有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li class=\"red\">\n<p>1，Client——LAN VPN(Access VPN)</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sL2h9K.png\" alt=\"图片\"></p>\n</li>\n<li class=\"red\">\n<p>2，LAN——LAN VPN</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLRCHs.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，按网络层次分类有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 应用层 ——SSL VPN 等</li>\n<li>[2] 传输层 ——Sangfor VPN</li>\n<li>[3] 网络层 ——IPSec，GRE 等</li>\n<li>[4] 物理接口层 ——L2F/L2TP，PPTP 等</li>\n</ul>\n<h3 class=\"blue\" id=\"vpn常用技术\"><a class=\"anchor\" href=\"#vpn常用技术\">#</a> VPN 常用技术</h3>\n<p class=\"red\">1，常用技术有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 隧道技术</li>\n<li>[2] 加解密技术</li>\n<li>[3] 身份认证技术</li>\n<li>[4] 数据认证技术</li>\n<li>[5] 密钥管理技术</li>\n</ul>\n<p class=\"red\">2，隧道技术详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>[1] 隧道：是在公共通信网络上构建的一条数据路径，可以提供与专用通信线路等同的连接特性。</p>\n</li>\n<li>\n<p>[2] 隧道技术：指在隧道的两端通过封装以及解封装技术在公网上建立的一条数据通道，使用这条通道对数据报文进行传输，隧道是由隧道协议构建形成的，<ins class=\"wavy\">隧道技术是 VPN 技术中最关键的技术。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLhwVJ.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLhIPI.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">3，加解密技术详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 目的：即使信息被窃听或者截取，攻击者也无法知晓信息的真实内容。<ins class=\"wavy\">可以对抗网络攻击中的被动攻击。</ins></li>\n<li>[2] 通常使用<ins class=\"wavy\">加密机制</ins>来保护信息的<ins class=\"wavy\">保密性</ins>，防止信息泄露。<ins class=\"wavy\">信息的加密机制通常是建立在密码学的基础上。</ins></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/25/sLICbF.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">4，密码学基础：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 从明文到密文的过程，一般是通过加密算法加密进行的。</li>\n<li>[2] 从变明文到密文，称为脱密 (解密) 变换。</li>\n<li>[3] 主流的加密算法有：</li>\n<li>对称加密算法</li>\n<li>非对称加密算法 (公钥加密算法)</li>\n</ul>\n<p class=\"red\">5，对称加密算法详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1, 对称加密过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLoOlq.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，常见的对称加密算法有：</p>\n</li>\n<li>\n<p>[1] IDEA: 国际数据加密算法，使用 128 位密钥提供非常强的安全性。</p>\n</li>\n<li>\n<p>[2] DES/3DES 算法: DES 加密采用的是<ins class=\"wavy\">分组加密</ins>的方法，<ins class=\"wavy\">使用 56 位密钥加密 64 位明文，最后产生 64 位密文。</ins></p>\n</li>\n<li>\n<p>[3] RC 系列算法：包括<ins class=\"wavy\"> RC2，RC4，RC5，RC6 算法，</ins>其中<ins class=\"wavy\"> RC4 是序列密码算法，其他三种是分组序列算法。</ins></p>\n</li>\n<li>\n<p>[4] AES 算法: AES 为分组密码：<ins class=\"wavy\">分组密码也就是把明文分层一组一组的，每组长度相等，每次加密一组数据，直到加密完整个明文。高级加密标准，是下一代的加密算法标准，速度快，安全级别高，在 21 世纪 AES 标准的一个实现是 Rijndael 算法。</ins></p>\n</li>\n<li>\n<p>3，对称算法的缺陷：</p>\n</li>\n<li>\n<p>[1] 密钥传输风险</p>\n</li>\n<li>\n<p>[2] 密钥多，难管理。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOipf1.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">6，弥补对称加密的缺陷思路：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOinfI.png\" alt=\"图片\"></p>\n<p class=\"red\">7，非对称加密算法详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，简介：</p>\n</li>\n<li>\n<p>加密和解密使用的是不同的密钥 (公钥，私钥)，<ins class=\"wavy\">两个密钥之间存在相互依存关系。(用其中任一个密钥加密的信息只能用另一个密钥进行解密：即用公钥加密，用私钥解密就可以得到明文。)</ins></p>\n</li>\n<li>\n<p>这使得通信双方<ins class=\"wavy\">无需事先交换密钥</ins>就可以进行保密通信。</p>\n</li>\n<li>\n<p>2，非对称加密过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOF6r8.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，常见的非对称加密算法：</p>\n</li>\n<li>\n<p>[1] ECC: 椭圆曲线加密。</p>\n</li>\n<li>\n<p>[2] RSA: 是一个<ins class=\"wavy\">支持变长密钥的公共密钥算法，需要加密的文件块的长度也是可变的</ins>，非对称算法。</p>\n</li>\n<li>\n<p>[3] Rabin: 基于计算模合数平方根困难性问题的公钥密码算法。</p>\n</li>\n<li>\n<p>[4] Elgamal: 其基础是 Diffie—Hellman 密钥交换算法，后者使通信双方能通过公开通信来推导出只有他们知道的密钥。</p>\n</li>\n</ul>\n<p class=\"red\">8，对称加密 VS 非对称加密：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOkweU.png\" alt=\"图片\"></p>\n<p class=\"red\">9，身份认证技术：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，简介：</p>\n</li>\n<li>\n<p>身份认证：<ins class=\"wavy\">通过标识和鉴别用户的身份</ins>，防止攻击者假冒合法用户来获取访问权限。</p>\n</li>\n<li>\n<p>身份认证技术：是在网络中确认操作者身份的过程而产生的有效解决方法。</p>\n</li>\n<li>\n<p>2，应用场景：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOAwct.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>上图 Alice 生成数字签名过程：</p>\n</li>\n<li>\n<p>原始信息 + HASH 生成信息摘要。信息摘要 + Alice 的私钥签名 生成数字签名。</p>\n</li>\n<li>\n<p>复杂情况出现：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOe9ET.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>Bob 无法确认公钥的真实性。</p>\n</li>\n<li>\n<p>3，解决方案：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOmZWQ.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>BOb 使用 CA 的公钥解开数字证书，这样得到的 Alice 的公钥才是 Alice 的。</p>\n</li>\n<li>\n<p>4，PKI 体系 (CA)：</p>\n</li>\n<li>\n<p>[1] PKI (公开密钥体系) 是一种遵循标准的利用<ins class=\"wavy\">非对称加密</ins>技术为电子商务的开展提供一套安全基础平台的技术和防范。</p>\n</li>\n<li>\n<p>[2] 简单来说，<ins class=\"wavy\">PKI 就是利用公钥理论和技术建立的提供安全服务的基础设施，</ins>用户可以利用 PKI 平台提供的服务进行安全的电子交易，通信和互联网上的各种活动。</p>\n</li>\n<li>\n<p>[3] PKI 技术采用证书管理公钥，通过第三方的可信任机构 ——CA 认证中心，<ins class=\"wavy\">把用户的公钥和用户的其他标识信息捆绑在一起放在用户证书中</ins>，在互联网上验证用户的身份。</p>\n</li>\n<li>\n<p>[4] 目前，通用的办法是采用建立在 PKI 基础之上的数字证书，通过把要传输的数字信息进行加密何签名，保证信息传输的机密性，真实性，完整性和不可否认性，从而保证信息的安全传输。</p>\n</li>\n<li>\n<p>5，PKI 体系的组成：</p>\n</li>\n<li>\n<p>[1] PKI 是创建，颁发，管理，注销公钥证书所涉及到的所以软件，硬件的集合体。其核心元素是<ins class=\"wavy\">数字证书</ins>，核心执行者是<ins> CA 认证机构</ins> {}。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uVlKs.png\" alt=\"tp\"></p>\n</li>\n<li>\n<p>6，CA 中心：</p>\n</li>\n<li>\n<p>[1] 简介：</p>\n</li>\n<li>\n<p>证书授权中心或称证书授权机构，作为电子商务交易中受信用的第三方。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uVRRe.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[2] 作用：</p>\n</li>\n<li>\n<p>颁发证书，规定证书的有效期和通过发布证书废除列表 (CRL) 确保必要时可以废除证书，以及对证书和密钥进行管理。</p>\n</li>\n<li>\n<p>CA 中心为每个使用公开密钥的用户发放一个数字证书，数字证书的作用是证明证书中列出的用户合法拥有证书中列出的公钥。</p>\n</li>\n<li>\n<p>CA 中心的数字签名使得攻击者不能伪造和篡改证书</p>\n</li>\n<li>\n<p>7，数字证书认证技术原理：</p>\n</li>\n<li>\n<p>[1] 数字证书：</p>\n</li>\n<li>\n<p>一个经证书授权中心数字签名的包含公开密钥拥有者信息和公开密钥的文件。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uZndx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[2] 数字证书是一般包含：</p>\n</li>\n<li>\n<p>用户身份信息。</p>\n</li>\n<li>\n<p>用户公钥信息</p>\n</li>\n<li>\n<p>身份验证机构数字签名的数据</p>\n</li>\n<li>\n<p>[3] 从证书的用途来看，数字证书可分为签名证书和加密证书。</p>\n</li>\n<li>\n<p>签名证书：</p>\n</li>\n<li>\n<p>主要用于对用户信息进行签名，以保证信息的真实性和不可否认性。</p>\n</li>\n<li>\n<p>加密证书：</p>\n</li>\n<li>\n<p>主要用于对用户传送的信息进行加密，以保证信息的机密性和完整性。</p>\n</li>\n<li>\n<p>8，常见的证书类型：</p>\n</li>\n<li>\n<p>数字证书</p>\n</li>\n<li>\n<p>根证书</p>\n</li>\n<li>\n<p>用户证书</p>\n</li>\n<li>\n<p>设备证书</p>\n</li>\n<li>\n<p>9，数据传输安全案例：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uefHI.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>10，数字证书实列 ——HTTPS 协议：</p>\n</li>\n<li>\n<p>[1] HTTP 是常用的 eb 协议，用来交互网页数据。</p>\n</li>\n<li>\n<p>[2] 由于 HTTP 是不加密的，在公网上明文传输，缺少保密性。所以出现安全加密的 HTTP 协议 ————HTTPS 协议。</p>\n</li>\n<li>\n<p>[3] HTTPS 是在 SSL 协议的基础上的 HTTP 协议。</p>\n</li>\n<li>\n<p>[4] SSL 协议的握手过程需要传输服务器的证书，并验证证书的可靠性。</p>\n</li>\n<li>\n<p>11，证书的请求和发送：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6ulJaj.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<h2 id=\"ipsec协议详解\"><a class=\"anchor\" href=\"#ipsec协议详解\">#</a> <strong>IPSec 协议详解：</strong></h2>\n<h3 class=\"blue\" id=\"ipsec协议族安全框架\"><a class=\"anchor\" href=\"#ipsec协议族安全框架\">#</a> IPSEC 协议族安全框架</h3>\n<p class=\"red\">1，需求背景：</p>\n<ul>\n<li>[1] 对保密性的需求越来越高。</li>\n<li>[2] GRE，L2TP 等 VPN 技术不支持保密性的要求。</li>\n<li class=\"red\">[3] 所以产生了 IPSEC 技术。<br>\n2，IPSec VPN 简介：</li>\n<li>[1] IPSec (Internet Protocol Security): 是一组基于<ins class=\"wavy\">网络层</ins>的，应用密码学的安全通信协议族，<ins class=\"wavy\">IPSec 不是具体指哪一个协议，而是一个开放的协议族。</ins></li>\n<li>[2] IPSec 协议的设计目标：是在 IPV4 和 IPV6 环境中为网络层流量提供灵活的安全服务。</li>\n<li>[3] IPSec VPN：是基于 IPSec 协议族构建的在 IP 层实现的安全虚拟专用网，通过在数据包中插入一个预定义头部的方式，来保障 OSI 上层协议数据的安全，主要用于保护 TCP，UDP，ICMP 和隧道的 IP 数据包。<br>\n3，IPSec 提供的安全服务：{.red</li>\n<li>[1] 机密性</li>\n<li>[2] 完整性</li>\n<li>[3] 数据源鉴别</li>\n<li>[4] 重传攻击保护</li>\n<li>[5] 不可否认性</li>\n<li class=\"red\">[6] 访问控制，有限的流量保密等其他安全服务。<br>\n4，IPSec 协议族安全体系框架：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uGuTg.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，IPSec 协议族：</p>\n<ul>\n<li>[1] 两种工作模式：</li>\n<li>传输模式 (transport)</li>\n<li>隧道模式 (Tunnel)</li>\n<li>[2] 两个通信保护协议：</li>\n<li>鉴别头 (AH)</li>\n<li>封装安全载荷 (ESP)</li>\n<li>[3] 密钥交换管理协议：</li>\n<li>阶段一 (两种基本模式)：主模式，野蛮模式</li>\n<li>阶段二：快速模式 (Quick mode)</li>\n<li>[4] 两个数据库：</li>\n<li>安全策略数据库 SPD</li>\n<li>安全关联数据库 SAD</li>\n<li>[5] 解释域 DOI</li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec工作模式\"><a class=\"anchor\" href=\"#ipsec工作模式\">#</a> IPSEC 工作模式：</h3>\n<p class=\"red\">1，传输模式 (Transport mode)：</p>\n<ul>\n<li>[1] 应用场景：</li>\n<li>经常用于主机和主机之间端到端通信的数据保护。</li>\n<li>[2] 封装方式：</li>\n<li>不改变原有的 IP 包头，在数据包头后面插入 IPsec 包头，将原来的数据封装成被保护的数据。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6utG6I.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，隧道模式 (Tunnel mode)：</p>\n<ul>\n<li>[1] 应用场景：</li>\n<li>经常用于私网与私网之间通过公网进行通信，建立安全 VPN 通道。</li>\n<li>[2] 封装方式：</li>\n<li>增加新的 IP (外网 IP) 头，其后是 IPSec 包头，之后再将原来的整个数据包封装。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6utz3d.png\" alt=\"图片\"></li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec通信协议\"><a class=\"anchor\" href=\"#ipsec通信协议\">#</a> IPSEC 通信协议：</h3>\n<p class=\"red\">1，AH 协议：</p>\n<ul>\n<li>[1] 通信保护协议 AH-AH (Authentication Header，认证报头)。</li>\n<li>[2] AH 提供的安全服务有：</li>\n<li>无连接数据完整性 ———— 通过哈希函数 (如 MD5，SHA1) 产生的校验来保证。</li>\n<li>数据源认证 ———— 通过在计算验证码时加入一个共享密钥来实现。</li>\n<li>抗重放服务 ————AH 报头中的序列号可以防止重放攻击。</li>\n<li>[3] AH 不提供任何保密性服务，它不加密所保护的数据包。</li>\n<li>[4]<ins class=\"wavy\"> 无论是传输模式还是隧道模式下，AH 提供对数据包的保护时，它保护的是整个 IP 数据包 (易变的字段除外，如 IP 头中的 TTL 和 TOS 字段)。</ins></li>\n<li>[5] AH 头：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uU6oT.png\" alt=\"图片\"></li>\n<li>[6] AH 在传输模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uaU76.png\" alt=\"图片\"></li>\n<li>[7] AH 在隧道模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uacnI.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，ESP 协议：</p>\n<ul>\n<li>[1] ESP (Encapsulating Security Payload, 封装安全有效载荷)。</li>\n<li>[2] ESP 提供的安全服务有：</li>\n<li>无连接数据完整性 ———— 通过哈希函数 (如 MD5，SHA1) 产生的校验来保证。</li>\n<li>数据源认证 ———— 通过在计算验证码时加入一个共享密钥来实现。</li>\n<li>抗重放服务 ————AH 报头中的序列号可以防止重放攻击。</li>\n<li>数据保密</li>\n<li>有限的数据流保护</li>\n<li>[3] 保密服务通过使用密码算法加密 IP 数据包的相关部分来实现。</li>\n<li>[4] 数据流保密由隧道模式下的保密服务提供。</li>\n<li>[5] ESP 通常使用 DES，3DES，AES 等加密算法实现数据加密，使用 MD5 或 SHA1 来实现数据完整性认证。</li>\n<li>[6] ESP 头：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6udLMd.png\" alt=\"图片\"></li>\n<li>[7] ESP 在传输模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uw9JS.png\" alt=\"图片\"></li>\n<li>[8] ESP 在隧道模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uwFMj.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，AH 与 ESP 对比：</p>\n<ul>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uwKWF.png\" alt=\"图片\"></li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec建立阶段\"><a class=\"anchor\" href=\"#ipsec建立阶段\">#</a> IPSEC 建立阶段：</h3>\n<p class=\"red\">1，IKE (Internet Key Exchange) 协商阶段：</p>\n<ul>\n<li>\n<p>[1] 安全联盟 SA：</p>\n</li>\n<li>\n<p>是通信对等体间对某些要素的约定，通信的双方符合 SA 约定的内容，就可以建立 SA。</p>\n</li>\n<li>\n<p>[2] SA 由三元组来唯一标识，包括：</p>\n</li>\n<li>\n<p>安全参数索引，目的 IP 地址，安全协议号。</p>\n</li>\n<li>\n<p>[3] IKE 的产生背景：</p>\n</li>\n<li>\n<p>用 IPSec 保护一个 IP 包之前，必须先建立安全联盟 SA</p>\n</li>\n<li>\n<p>IPSec 的安全联盟可以通过手工配置的方式建立，但是当网络中节点较多时，手工配置将非常困难，而且难以保证安全性，这时就可以使用 IKE 自动进行安全联盟建立与密钥交换的过程，Internet 密钥交换 (IKE) 就用于动态建立 SA，代表 IPsec 对 SA 进行协商。</p>\n</li>\n<li>\n<p>[4] IKE 的用途：</p>\n</li>\n<li>\n<p>IKE 为 IPSEC 协商生成密钥，供 AH/ESP 加解密和验证使用。</p>\n</li>\n<li>\n<p>在 IPSEC 通信双方之间，动态地建立安全关联 (SA), 对 SA 进行管理和维护。</p>\n</li>\n<li>\n<p>[5] IKE 的工作过程：</p>\n</li>\n<li>\n<p>IKE 经过两个阶段为 IPSEc 进行密钥协商并建立安全联盟。</p>\n</li>\n<li>\n<p><ins class=\"dot\">第一阶段交换：</ins></p>\n</li>\n<li>\n<p>通信各方彼此间建立了一个已通过身份验证和安全保护的通道，此阶段的交换建立了一个 ISAKMP 安全联盟，即 ISAKMP SA (也可称为 IKE SA)。第一阶段有两种协商模式：<ins class=\"wavy\">主模式协商与野蛮模式协商。</ins></p>\n</li>\n<li>\n<p><ins class=\"dot\">第二阶段交换：</ins></p>\n</li>\n<li>\n<p>用已经建立的安全联盟 (IKE SA) 为 IPSec 协商安全服务，即为 IPSec 协商具体的安全联盟，建立 IPSec SA，产生真正可以用来加密数据流的密钥，IPSec SA 用于最终的 IP 数据安全传送。</p>\n</li>\n<li>\n<p>[6] IKE 阶段一：</p>\n</li>\n<li>\n<p><ins class=\"dot\">主模式：</ins></p>\n</li>\n<li>\n<p>默认使用 IP 地址作为身份标识，默认是传递自己的出口地址做身份标识，校验对端的公网 IP 做对端身份识别。(自动生成双方的身份 ID)</p>\n</li>\n<li>\n<p><ins class=\"dot\">野蛮模式：</ins></p>\n</li>\n<li>\n<p>可以使用用户名或 IP 等作为双方身份识别，即可手动配置身份 ID。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/616Jw8.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[7] IKE 阶段一协商过程：</p>\n</li>\n<li>\n<p>如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/616aWj.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[8] IKE 阶段一：主模式协商：</p>\n</li>\n<li>\n<p>如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61cogs.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[9] IKE 阶段一：主模式交互过程：</p>\n</li>\n<li>\n<p>主模式下 IKEv1 采用三个步骤 6 条 ISAKMP 建立 IKE SA。下面是主动发起 IKE 协商为例的整个构成。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61cTvn.png\" alt=\"如图\"></p>\n</li>\n<li>\n<p>[10] 野蛮模式 IKE 交互过程：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">野蛮模式下有三个交互包：</ins></p>\n</li>\n<li>\n<p>1) 第一个交互包发起方建议 SA，发起 DH 交换</p>\n</li>\n<li>\n<p>2) 第二个交互包接收方接受 SA</p>\n</li>\n<li>\n<p>3) 第三个交互包发起方认证接收方</p>\n</li>\n<li>\n<p>++ 注：野蛮模式交互过程少，所以在传输过程中，其传输的数据比较多，并且，前两个数据为明文传输，仅消息三为加密传输。</p>\n</li>\n<li>\n<p>[11] 野蛮模式 IKE 交互过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61gNxs.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[12] IKE 阶段一两张模式对比：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61gfqx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[13] IKE 阶段二协商过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/63V0o9.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[14] 标准 IPsec VPN 建立过程：</p>\n</li>\n<li>\n<p>IKE 阶段 2</p>\n</li>\n<li>\n<p>双方协商 IPSec 安全参数，称为变换集 transform set，包括：</p>\n</li>\n<li>\n<p>加密算法</p>\n</li>\n<li>\n<p>Hash 算法</p>\n</li>\n<li>\n<p>安全协议</p>\n</li>\n<li>\n<p>封装模式</p>\n</li>\n<li>\n<p>存活时间</p>\n</li>\n<li>\n<p>[15] 标准 IPSEc 第二阶段：</p>\n</li>\n<li>\n<p>ISAKMP/IKE 阶段只有一种消息交换模式 - 快速模式，它定义了受保护数据链接是如何在两个 IPSE 对等体之间构成的。</p>\n</li>\n<li>\n<p>深信服的标准 IPSECyo 有几对的 chu 出站如站，在 DLANyu 运行状态里面 jiu 就会显示几条链接，<ins class=\"wavy\">每一对快快速模式交互的包都是三个，第一个包由主链接发起方发起响应.</ins></p>\n</li>\n<li>\n<p><ins class=\"dot\">快速模式有两个主要的功能：</ins></p>\n</li>\n<li>\n<p>1）协商安全参数来保护数据连接。</p>\n</li>\n<li>\n<p>2）周期性的对数据连接更新密钥信息。第二阶段的效果为协商出 IPsec 单项 SA，为保护 IPSec 数据流而创建，第二阶段整个协商过程受第一阶段 ISAKMP/IKE SA 保护。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">注：第二阶段数据都经过了加密，在公网抓取的数据如下：</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/63VtMT.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，数据传输阶段：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 数据传输阶段是通过 AH 或者 ESP 通信协议进行数据的传输。</li>\n<li>[2] 数据传输建立在网络层</li>\n<li>[3] VPN 黑洞的产生：</li>\n<li>可能情况：</li>\n<li>1）对端的 VPN 连接已经断开而我方还处在 SA 的有效生存时间内，从而形成了 VPN 隧道的黑洞。</li>\n<li>2）我方不停地发送加密后的 VPN 数据过去，但对方拒绝接受。</li>\n<li>[4] DPD 解决 VPN 隧道黑洞：</li>\n<li><ins class=\"wavy\">DPD：死亡对等体检测 (Dead Peer Detevtion), 检测对端的 ISAKMP SA 是否存在，当 VPN 隧道异常的时候，能检测到并重新发送协商，来维持 VPN 隧道。</ins></li>\n<li><ins class=\"wavy\">DPD 主要是为了防止标准 IPSEC 出现 “隧道黑洞”。</ins></li>\n<li><ins wavy>DPD 只对第一阶段生效，如果第一阶段本身已经超时断开，则不会再发 DPD 包。</ins></li>\n<li>[5] DPD 概述：</li>\n<li>1）DPD 包并不是连续发送，而是采用空闲计时器机制。</li>\n<li>2）每接收到一个 IPSec 加密的包后就重置这个包对应 IKE SA 的空闲计时器。</li>\n<li>3）如果空闲定时器计时开始到计时结束 m'y 没有接受到该 SA 对应的加密包，那么下一次有 IP 包要被这个 SA 加密发送或接收到加密包之前就需要使用 DPD 来检测对方是否存活。</li>\n<li>4）DPD 检测主要考超时计时器，超时计时器用于判断是否再次发起请求，默认是发出 5 次请求 (请求 -》超时 -》请求 -》超时 -》请求 -》超时) 都没有收到如何 DPD 应答就会删除 SA。</li>\n</ul>\n<h2 id=\"ipsec-vpn解决方案\"><a class=\"anchor\" href=\"#ipsec-vpn解决方案\">#</a> <strong>IPSec VPN 解决方案：</strong></h2>\n<h3 id=\"ipsec-vpn网关部署场景\"><a class=\"anchor\" href=\"#ipsec-vpn网关部署场景\">#</a> IPSEC VPN 网关部署场景</h3>\n<p class=\"red\">1，网关部署场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63Mq9H.png\" alt=\"图片\"></li>\n<li>[2] 企业的分支与总部都安放了 VPN 设备，分支机构希望通过 VPN 同步企业总部的研发资源。</li>\n<li>[3] 研发资源属于商业机密，必须要在公网上能够安全保密传输。</li>\n<li><ins class=\"wavy\">解决方案：可以直接用 IPSec VPN 的隧道工作模式进行传输，使用 IPSEc VPN 的 ESP 通信协议来保障数据传输的保密性。</ins></li>\n<li>[4] 具体过程如下：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63lofe.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63lX0P.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63ljTf.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，NAT 下的 VPN 部署场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/631QXR.png\" alt=\"图片\"></li>\n<li>[2] 企业为了内部局域网安全考虑，在网络出口安放了防火墙，要求内网所有设备通过防火墙代理上网 (NAT:Network Addess Translation)</li>\n</ul>\n<p class=\"red\">3，SANGFOR IPsec VPN 协商：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68GHYV.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">4，IKE 协商总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] SANGFOR 的 IPSEC VPN 主模式身份 ID 是默认配置的，不能修改，在 NAT 环境下会出现上述协商问题，所以只能选用野蛮模式。</li>\n<li>[2] 其他厂商的 IPSEC 主模式身份 ID 如果可以自由配置，在 NAT 环境下则可以协商成功。</li>\n<li>[3] IKE 第一阶段的身份识别：</li>\n<li>IPV4_ADDR,FQDN,USER_FQDN 只是三种不同类型的身份认证方式，可以理解为 SANGFOR 设备中 VPN 的用户名，主要用来确认对端身份。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68tX6S.png\" alt=\"图片\"></li>\n<li>[4] 协商建立 VPN 隧道：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68Nm79.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68wIi9.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/680SJA.png\" alt=\"图片\"></li>\n<li>[5] NAT 下的数据传输可行性：</li>\n<li>1) AH 传输模式：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/680Go4.png\" alt=\"图片\"></li>\n<li>2) ESP 传输模式：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68BW4J.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68DBIe.png\" alt=\"图片\"></li>\n<li>[6] TCP/UDP 伪首部校验机制：</li>\n<li>1) 伪首部是为了增加校验和的检错能力。</li>\n<li>2) 伪首部校验 12 个字节的内容，如下：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68BEX6.png\" alt=\"图片\"></li>\n<li>[7] NAT 下的数据传输总结：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68rPQ1.png\" alt=\"图片\"></li>\n</ul>\n<h2 id=\"sangfor-vpn解决方案\"><a class=\"anchor\" href=\"#sangfor-vpn解决方案\">#</a> <strong>SANGFOR VPN 解决方案：</strong></h2>\n<h1 id=\"第三章上网行为安全\"><a class=\"anchor\" href=\"#第三章上网行为安全\">#</a> 第三章【上网行为安全】</h1>\n<h2 id=\"ac概念与部署\"><a class=\"anchor\" href=\"#ac概念与部署\">#</a> <strong>AC 概念与部署：</strong></h2>\n<p>1，什么是上网行为管理？对那些行为管控，为什么要管控？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>前提：身份认证。</li>\n<li>1，访问网站：hhttp/https</li>\n<li>2，应用管控</li>\n<li>3，流量管控：流控，以色列 allot，SCE。</li>\n<li>4，行为审计：</li>\n<li>AC —— 全网行为管理。</li>\n</ul>\n<ul>\n<li>\n<p><strong>用户认证技术：</strong></p>\n</li>\n<li>\n<p><strong>应用控制技术：</strong></p>\n</li>\n<li>\n<p><strong>终端与流量管理：</strong></p>\n</li>\n<li>\n<p><strong>审计与 BA 部署：</strong></p>\n</li>\n<li>\n<p><strong>全网行为管理：</strong></p>\n</li>\n<li>\n<p><strong>AC 知识串讲：</strong></p>\n</li>\n</ul>\n<h1 id=\"第四章网络边界安全\"><a class=\"anchor\" href=\"#第四章网络边界安全\">#</a> 第四章【网络边界安全】</h1>\n<h2 id=\"ngaf概述与组网方案\"><a class=\"anchor\" href=\"#ngaf概述与组网方案\">#</a> <strong>NGAF 概述与组网方案：</strong></h2>\n<h3 class=\"blue\" id=\"ngaf概念\"><a class=\"anchor\" href=\"#ngaf概念\">#</a> NGAF 概念</h3>\n<p class=\"red\">1，什么是防火墙？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>企业内网隔离</li>\n<li>数据中心隔离</li>\n<li>互联网边界防护</li>\n<li>企业分支互联</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/27/svyOmQ.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，防火墙分类：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，按物理特性划分：</p>\n</li>\n<li>\n<p>软件防火墙</p>\n</li>\n<li>\n<p>硬件防火墙</p>\n</li>\n<li>\n<p>2，按性能分：</p>\n</li>\n<li>\n<p>百兆级防火墙</p>\n</li>\n<li>\n<p>千兆级防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n<li>\n<p>3，按防火墙结构分：</p>\n</li>\n<li>\n<p>单一主机防火墙</p>\n</li>\n<li>\n<p>路由集成防火墙</p>\n</li>\n<li>\n<p>分布式防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n<li>\n<p>4，按防火墙技术分：</p>\n</li>\n<li>\n<p>包过滤防火墙</p>\n</li>\n<li>\n<p>应用代理防火墙</p>\n</li>\n<li>\n<p>状态检测防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n</ul>\n<p class=\"red\">3，防火墙的功能：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，访问控制。</li>\n<li>2，地址转换</li>\n<li>3，网络环境支持。</li>\n<li>4，带宽管理功能。</li>\n<li>5，入侵检测和攻击防御。</li>\n<li>6，用户认证。</li>\n<li>7，高可用性。</li>\n</ul>\n<p class=\"red\">4，防火墙安全策略：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，定义：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">安全策略是按一定规则，控制设备对流量转发以及对流量进行内容安全一体化检测的策略。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy\">规则的本质是包过滤。</ins></p>\n</li>\n<li>\n<p>2，主要应用：</p>\n</li>\n<li>\n<p>对跨防火墙的网络互访进行控制。</p>\n</li>\n<li>\n<p>对设备本身的访问进行控制。</p>\n</li>\n<li>\n<p>3，作用：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">根据定义的规则对经过防火墙的流量进行过滤筛选，在进行下一步操作。</ins></p>\n</li>\n</ul>\n<p class=\"red\">5，防火墙安全策略的原理：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svcVKS.png\" alt=\"图片\"></p>\n<p class=\"red\">6，安全策略分类：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>域间安全策略</li>\n<li>域内安全策略</li>\n<li>接口包过滤</li>\n</ul>\n<p class=\"red\">7，防火墙的发展进程：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svcNVJ.png\" alt=\"图片\"></p>\n<p class=\"red\">8，传统防火墙 (包过滤防火墙)—— 一个严格的规则表：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>数据包的源 IP 地址，目的 IP 地址，源端口，目的端口，协议类型。(五元组)</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>网络层，传输层。</p>\n</li>\n<li>\n<p>3，和路由器的区别：</p>\n</li>\n<li>\n<p>普通的路由器只检查数据包的目的地址，并选择一个到达目的地址的最佳路径。防火墙除了要解决目的路径以外还需要根据已经设置的规则进行判断 “是与否”。</p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>包过滤技术。</p>\n</li>\n<li>\n<p>5，优势：</p>\n</li>\n<li>\n<p>对于小型站点容易实现，处理速度快，价格便宜。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>规则表很快变得复杂，难运维，只能基于五元组。</p>\n</li>\n</ul>\n<p class=\"red\">9，传统防火墙 (应用代理防火墙)—— 每个应用添加代理：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>所有应用层的数据包。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>应用层。</p>\n</li>\n<li>\n<p>3，和包过滤防火墙的区别：</p>\n</li>\n<li>\n<p>包过滤防火墙工作基于 3-4 层，通过检验报头进行规则表匹配。应用代理防火墙工作在 7 层，检查所有的应用层数据包，每个应用需要添加对应的代理服务。</p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>应用代理技术。</p>\n</li>\n<li>\n<p>5，优势：</p>\n</li>\n<li>\n<p>检查了应用层的数据。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>检查效率低，配置运维难度极高，可伸缩性差。</p>\n</li>\n</ul>\n<p class=\"red\">10，传统防火墙 (状态检测防火墙)—— 首次检查建立会话表：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>IP 地址，端口号，TCP 标记。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>数据链路层，网络层，传输层。</p>\n</li>\n<li>\n<p>3，和包过滤防火墙的区别：</p>\n</li>\n<li>\n<p>包过滤防火墙工作在 3-4 层，通过检查报头进行规则表匹配。<ins class=\"wavy\">是包过滤防火墙的升级版，一次检查建立会话表，后期直接按会话表放行。</ins></p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>状态检测技术。</p>\n</li>\n<li>\n<p>5，优势</p>\n</li>\n<li>\n<p>主要检查 3-4 层，能够保障效率，对 TCP 防御较好。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>应用层控制较弱，不检查数据区。</p>\n</li>\n</ul>\n<p class=\"red\">11，入侵检测系统 (IDS)—— 网络摄像头：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，部署方式：</p>\n</li>\n<li>\n<p>旁路部署，可多点部署。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，工作特点：</p>\n</li>\n<li>\n<p>根据部署位置监控到的流量进行攻击事件监控，<ins class=\"wavy\">属于一个事后呈现的系统，</ins>相当于网络上的摄像头。</p>\n</li>\n<li>\n<p>4，目的：</p>\n</li>\n<li>\n<p>传统防火墙只能基于规则执行 &quot;是&quot; 与 &quot;否&quot; 的策略，IDS 主要为了管理员清晰地了解到网络环境中发生了什么事情。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svgUOS.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">12，入侵防御系统 (IPS)—— 抵御 2-7 层已知威胁：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，部署方式：</p>\n</li>\n<li>\n<p>串联部署。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，工作特点：</p>\n</li>\n<li>\n<p>根据已知的安全威胁生成对应的过滤器 (规则)，对于识别为流量的阻断，对于未识别的放通。</p>\n</li>\n<li>\n<p>4，目的：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">IDS 只能对网络环境进行检测，但却无法进行防御，IPS 主要是针对已知的威胁进行防御。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sv2ets.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">13，防病毒网关 (AV)—— 基于网络侧识别病毒文件：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>数据包</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>防止病毒文件通过外网络进入到内网环境。</p>\n</li>\n<li>\n<p>和防火墙区别：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxI2Af.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">14，Web 应用防火墙 (WAF)—— 专门用来保护 web 应用：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>http 协议数据的<ins class=\"wavy\"> request 和 response。</ins></p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>应用层。</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>防止基于应用层的攻击・影响 Web 应用系统。</p>\n</li>\n<li>\n<p>4，主要技术原理：</p>\n</li>\n<li>\n<p>(1) 代理服务：会话双向代理，用户与服务器不产生直接连接，对于 DDOS 攻击可以抑制。</p>\n</li>\n<li>\n<p>(2) 特征识别：通过正则表达式的特征库进行特征识别。</p>\n</li>\n<li>\n<p>(3) 算法识别：针对攻击方式进行模糊化识别，如 SQL 注入，DDOS，XSS 等。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxT5mn.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">15，统一威胁管理 (UTM)—— 多合一安全网关：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，包含功能：</p>\n</li>\n<li>\n<p>FW，IDS，IPS，AV。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层，(但不具备 Web 应用防控能力)</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>将多种安全问题通过一台设备解决。</p>\n</li>\n<li>\n<p>4，优点：</p>\n</li>\n<li>\n<p>功能多合一，有效降低了硬件成本，人力成本，时间成本。</p>\n</li>\n<li>\n<p>5，缺点：</p>\n</li>\n<li>\n<p>模块串联检测效率低，性能消耗大。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sx7rjJ.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">16，下一代防火墙 (NGFW)—— 升级版的 UTM：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，包含功能：</p>\n</li>\n<li>\n<p>FW，IDS，IPS，AV，WAF。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，和 UTM 的区别：</p>\n</li>\n<li>\n<p>与 UTM 相比增加的 Web 应用防控功能。</p>\n</li>\n<li>\n<p>UTM 是串行处理机制，NGFW 是并行处理机制。</p>\n</li>\n<li>\n<p>NGFW 性能更强，管理更高效。</p>\n</li>\n</ul>\n<p class=\"red\">17，防火墙的性能指标：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，性能指标 1—— 吞吐量：</p>\n</li>\n<li>\n<p>吞吐量：防火墙能同时处理的最大数据量。</p>\n</li>\n<li>\n<p>有效吞吐量：除掉 TCP 因为丢包和超时重发的数据，实际的每秒传输有效速率。</p>\n</li>\n<li>\n<p>衡量标准：吞吐量越大，性能越高。</p>\n</li>\n<li>\n<p>2，性能指标 2—— 时延：</p>\n</li>\n<li>\n<p>定义：数据包的第一个比特进入防火墙到最后一个比特传出防火墙的时间间隔指标。</p>\n</li>\n<li>\n<p>用于测量防火墙处理数据的速度理想情况，测试的是其存储转发的性能。</p>\n</li>\n<li>\n<p>衡量标准：时延越小，性能越高。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxjZ26.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，性能指标 3—— 丢包率：</p>\n</li>\n<li>\n<p>定义：在连续负载的情况下，防火墙由于资源不足，应该转发但是未转发的百分比。</p>\n</li>\n<li>\n<p>衡量标准：丢包率越小，防火墙的性能越高。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxj6zV.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>4，性能指标 4—— 背靠背：</p>\n</li>\n<li>\n<p>衡量标准：背靠背主要是指防火墙缓存容量的大小，网络上常会出现一些突发的大流量，(NFS，备份，路由更新等)，而且这样的数据包的丢失可能会产生更多的数据包丢失。强大的缓冲能力可以减小对这种突发网络情况造成的影响。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxxS74.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>5，性能指标 5—— 并发连接数：</p>\n</li>\n<li>\n<p>定义：由于防火墙是针对连接进行处理的，并发连接数目是指防火墙可以同时容纳的最大链接数目，一个连接就是一个 TCP/UDP 的访问。</p>\n</li>\n<li>\n<p>衡量标准：并发链接数指标越大，抗攻击能力越强。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxzgQP.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">18，传统防火墙防御模式：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>通过防御设备划分边界，基于 IP / 端口和特征进行判断。</li>\n<li>以隔离为基础，基于信任原则构建安全框架。</li>\n<li>以防护为核心，基于静态特征的攻击检测。</li>\n</ul>\n<p class=\"red\">19，传统安全产品的形态：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>&quot;串糖葫芦式&quot;，&quot;打补丁式&quot; 建设。</li>\n<li>成本高：环境，空间，重复采购。</li>\n<li>管理难：多设备，多厂商，安全风险无法分析。</li>\n<li>效率低：重复解析，单点故障。</li>\n</ul>\n<p class=\"red\">20，深信服 AF 的核心价值：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>安全的基础是风险全面可视化。</li>\n<li>安全的目标是保障企业业务安全。</li>\n<li>安全的未来是抵御未知风险。</li>\n</ul>\n<h3 class=\"blue\" id=\"组网方案\"><a class=\"anchor\" href=\"#组网方案\">#</a> 组网方案</h3>\n<p class=\"red\">1，部署模式简介：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，AF 基本应用场景：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szPSHK.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，下一代防火墙具备灵活的网络适应能力，支持：<ins class=\"wavy\">路由模式，透明模式，虚拟网线模式，混合模式，旁路模式。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szQQc6.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，根据接口属性分为：物理接口，子接口，VLAN 接口，聚合接口。</p>\n</li>\n<li>\n<p>其中物理接口可选择为：路由口，透明口，虚拟网线口，旁路镜像口。</p>\n</li>\n<li>\n<p>2，根据接口不同的工作层面，可以划分为：二层区域，三层区域，虚拟网线区域。</p>\n</li>\n<li>\n<p>3，AF 的部署模式是根据各个接口的属性决定的。</p>\n</li>\n</ul>\n<p class=\"red\">3，物理接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，物理接口与 AF 设备面板上的接口一一对应 (eth0 为 manage 口)，根据网口数据转发特性的不同，可选择路由，透明，虚拟网线和旁路镜像 4 种类型，前三种接口又可设置 WAN 或非 WAN 属性。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szlxWn.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，物理接口无法删除或新增，物理接口的数目由硬件决定 (个别平台支持可拓展)。</p>\n</li>\n</ul>\n<p class=\"red\">4，路由接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，路由接口：如果设置为路由接口，则需要给该接口配置 IP 地址，且，该接口具备路由转发功能。</li>\n<li>2，ADSL 拨号：如果设置为路由接口，并且是 ADSL 拨号，需要选上添加默认路由选项，默认勾选。</li>\n<li>3，管理口：Eth0 为固定的管理口，接口类型为路由口，无法修改，Eth0 可增加管理 IP 地址，<ins class=\"wavy\">默认的管理 IP 10.251.251.251/24. 如需修改，AF8.0.13 版本后，可在 [系统]-[通用配置]-[网络参数] 中进行修改。</ins></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/27/sz1mS1.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，透明接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>透明接口：相当于普通的交换网口，不需要配置 IP 地址，不支持路由转发，根据 MAC 地址表转发数据。</li>\n</ul>\n<p class=\"red\">6，虚拟网线接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，虚拟网线接口：也是普通的交换接口，不能配置 IP 地址，不支持路由转发，转发数据时，也无需检查 MAC 表，直接从虚拟网线配对的接口转发。</li>\n<li>2，<ins class=\"wavy\">虚拟网线口的转发性能高于透明接口，单进单出，双进双出等成对的网桥的环境下，推荐使用虚拟网线接口部署。</ins></li>\n</ul>\n<p class=\"red\">7，旁路镜像接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，<ins class=\"wavy\">不能配置 IP 地址，也不支持数据转发。</ins>只是用来接收从外部镜像过来的镜像数据。</li>\n<li>2，镜像接口可以配置多个，根据现场实际业务场景，需要接受的数据情况进行选择。</li>\n</ul>\n<p class=\"wavy\">8，聚合接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>将多个以太网接口捆绑在一起所形成的逻辑接口，创建的聚合接口成为一个逻辑接口，而不是底层的物理接口。</li>\n</ul>\n<p class=\"wavy\">9，子接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，<ins class=\"wavy\">应用于路由接口，需要启用 VLAN 或 TRUNK 的场景。</ins></li>\n<li>2，<ins class=\"wavy\">子接口是逻辑接口，只能在路由口下添加子接口。</ins></li>\n<li>3，子接口的下一跳网关和链路状态检测根据实际情况进行配置。</li>\n</ul>\n<p class=\"red\">10，VLAN 接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，为 VLAN 定义 IP 地址，则会产生 VLAN 接口，VLAN 接口也是逻辑接口。</li>\n<li>2，根据实际情况配置。</li>\n</ul>\n<p class=\"red\">11，接口设置注意事项：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，设备支持配置多个 WAN 属性的路由接口连接多条外网线路，但是，需要开通多条线路的授权。</li>\n<li>2，管理口不支持设置成透明接口或虚拟网线接口，如果要设置两对或两对以上的虚拟网线接口，则必须要求设备不少于五个物理接口，预留一个专门的管理口 Eth0。</li>\n<li>3，一个路由接口下可以配置多个子接口，路由接口的 IP 地址不能与子接口的 IP 地址在同一网段。</li>\n</ul>\n<p class=\"red\">12，区域：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，什么是区域？</li>\n<li>是本地逻辑安全区域的概念</li>\n<li>一个或多个接口所连接的网络</li>\n<li>用于定义和归类接口，以供各类安全策略等模块调用</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/28/ySPPJg.png\" alt=\"图片\"></li>\n<li>2，定义区域时，需根据控制的需求来规划，可以将一个接口划分到一个区域，或将几个相同需求接口划分到同一区域。</li>\n<li>3，<ins class=\"wavy\">一个接口只能属于一个区域，而，一个区域可以有多个接口。</ins></li>\n<li>4，可以在区域中选择接口，也可以预先设置好区域名称，在接口中选择区域。</li>\n<li>5，二层区域 —— 只能选择所有的透明接口</li>\n<li>6，三层区域 —— 只能选择所有的三层接口</li>\n<li>7，虚拟网线区域 —— 只能选择所有的虚拟网线接口</li>\n</ul>\n<p class=\"red\">13，路由模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>现有的拓扑图如下，使用 AF 代替现有防火墙，部署在出口，实现内网用户和服务器安全防护。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9b5kj.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，需求分析 —— 部署前我们需要做哪些准备工作？</p>\n</li>\n<li>\n<p>现有设备的接口配置。</p>\n</li>\n<li>\n<p>内网网段规划，好写回包路由。</p>\n</li>\n<li>\n<p>是否有服务器要映射。</p>\n</li>\n<li>\n<p>是否需要代理内网用户上网。</p>\n</li>\n<li>\n<p>进行内外网哪些访问权限的控制。</p>\n</li>\n<li>\n<p>进行哪些安全策略配置，实现用户需求。</p>\n</li>\n<li>\n<p>现在拓扑是否完整。</p>\n</li>\n</ul>\n<p class=\"red\">14，单臂路由模式：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>单臂路由时指在路由器的一个接口上通过配置子接口 (逻辑接口，并不存在真正物理接口) 的方式，实现原来相互隔离的不同 VLAN (虚拟局域网) 之间的通信。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/28/y9qt4s.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">15，路由模式总结：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，在此组网方式时，防火墙位于内部网络和外部网络之间，负责在内部网络，外部网络进行路由寻址，相当于路由器，与其内部网络，外部网络相连的上下行业务接口均工作在三层，需要分别配置不同网段的 IP 地址。</li>\n<li>2，此组网方式支持更多的安全特性，如：NAT，策略路由选择，动态路由协议 (OSPF,BGP,RIP 等)。</li>\n<li>需要修改原网络拓扑，对现有环境改动大。</li>\n<li>一般部署在需要进行路由转发的位置，如，出口路由器，或替换已有路由器，老防火墙等场景。</li>\n</ul>\n<p class=\"red\">16，透明模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>部署一台 AF 设备进行安全防护，但是，又不改动现有的网络环境。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9xBK1.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，需求分析 —— 部署前我们需要做哪些准备工作？</p>\n</li>\n<li>\n<p>接口定义</p>\n</li>\n<li>\n<p>管理地址配置</p>\n</li>\n<li>\n<p>配置路由，一般缺省路由用作防火墙上网，回程路由用作防火墙管理。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">不用配置地址转换。</ins></p>\n</li>\n<li>\n<p>应用控制，进行访问权限控制。</p>\n</li>\n<li>\n<p>安全防护策略实现用户安全防护需求。</p>\n</li>\n</ul>\n<p class=\"red\">17，虚拟网线部署：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，用户需求：</p>\n</li>\n<li>\n<p>路由器和交换机聚合口对接，要求透明部署防火墙设备，即，从 1 号口进来的数据，只能从 2 号口出，不再转发到其他接口，其他接口的效果也一样，同时，防火墙设备可以被日常管理。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9zeqx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，虚拟网线部署是透明部署中另外一种特殊情况：</p>\n</li>\n<li>\n<p>和透明部署一样，接口也是二层接口，但是被定义为虚拟网线接口</p>\n</li>\n<li>\n<p><ins class=\"wavy\">虚拟网线接口必须成对存在，转发数据时无需检查 MAC 表，直接从虚拟网线配的的接口转发。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy\">虚拟网线接口的转发性能高于透明接口。</ins>单进单出网桥的环境下，推荐使用虚拟网线接口部署。</p>\n</li>\n</ul>\n<p class=\"wavy\">18，混合模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，用户需求：</p>\n</li>\n<li>\n<p>某用户内网有服务器群，服务器均配置公网 IP 地址，提供所有用户直接通过公网 IP 地址接入访问，内网用户使用私网地址，通过 NAT 转换代理上网，希望将 AF 设备部署在公网出口的位置，实现内外部数据通信的同时，保护服务器群和内网上网数据的安全。</p>\n</li>\n<li>\n<p>2，部署方式推荐：</p>\n</li>\n<li>\n<p>推荐使用混合模式部署，AF 设备连接公网和服务器群的 2 个接口使用透明 access 口，连接内网网段使用路由接口。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/29/yCUdW6.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，部署分析：</p>\n</li>\n<li>\n<p>用于服务器均有公网 IP 地址，所以 AF 连接公网线路的接口 Eth1 与连接服务器群的 Eth2 接口，使用透明 acces 口，并设置相同的 VLAN ID。皆可实现所有用户使用公网 IP 直接访问服务器群。</p>\n</li>\n<li>\n<p>新增 VLAN1 口，分配一个公网 IP，划分区域为外网区。</p>\n</li>\n<li>\n<p>AF 设备与内网相连的接口 Eth3 使用路由接口，设置与内网交换机同网段的 IP 地址，并设置静态路由，与内网通信。</p>\n</li>\n<li>\n<p>内网用户上网时，转换原 IP 地址为 VLAN1 接口的 IP 地址，根据需求划分一个二层区域选择网口 eth1 和 eth2，划分两个三层区域，其中，” 外网区域 “选择 VLAN 接口 VLAN1，“内网区域” 选择接口 eth3。</p>\n</li>\n</ul>\n<p class=\"red\">19，旁路模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>使用 AF 来实现对各区域之前数据进行安全分析，同时不改动已有环境。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/20sz21/01/29/yCav4I.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，思考总结：</p>\n</li>\n<li>\n<p>设备旁挂在现有的网络设备上，不影响现有的网络结构，通过端口镜像技术，把流量镜像到下一代防护，实现对数据的分析与处理。</p>\n</li>\n<li>\n<p>需要另外设置单独管理接口才能对设备进行管理。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">启用管理口 reset 功能</ins></p>\n</li>\n<li>\n<p>旁路模式支持的功能仅有：</p>\n</li>\n<li>\n<p>APT (僵尸网络)。</p>\n</li>\n<li>\n<p>PVS (实时漏洞分析)。</p>\n</li>\n<li>\n<p>WAF (web 应用防护)。</p>\n</li>\n<li>\n<p>入侵防御系统。</p>\n</li>\n<li>\n<p>DLP (数据泄密防护)。</p>\n</li>\n<li>\n<p>网站防篡改部分功能 (客户端保护)。</p>\n</li>\n</ul>\n<p class=\"red\">20，策略路由解决方案：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，策略路由：</p>\n</li>\n<li>\n<p>是路由的一种。</p>\n</li>\n<li>\n<p>静态路由的匹配条件相对较少：匹配目的 IP，子网掩码与下一跳网关。</p>\n</li>\n<li>\n<p>策略路由可以弥补静态路由的不足，更灵活多样的匹配条件，根据相应策略来进行匹配，包括：匹配源，目的，协议，应用等。出口在外网多条线路情况下，建议匹配策略路由。</p>\n</li>\n<li>\n<p>2，策略路由分为：</p>\n</li>\n<li>\n<p>源地址策略路由：可指定内网哪些 IP 地址走指定线路出公网。</p>\n</li>\n<li>\n<p>多线路负载路由：可指定多条线路进行负载选路。</p>\n</li>\n<li>\n<p>3，总结思考：</p>\n</li>\n<li>\n<p>AF 路由的优先级默认是：[VPN 路由]&gt;[静态路由 / 动态路由]&gt;[策略路由]&gt;[默认路由]。</p>\n</li>\n<li>\n<p>AF6.8 新增了【VPN 专线互备路由】功能，开启该功能后，路由优先级调整为：【静态路由 / 动态路由】&gt;【策略路由】&gt;【VPN 路由】&gt;【默认路由】。</p>\n</li>\n<li>\n<p>每一条外网线路必须至少有一条策略路由与之对应，源地址策略路由或多线路负载路由均可。</p>\n</li>\n<li>\n<p>源地址策略路由，通过直接填写路由的下一跳，可以实现从设备非 WAN 属性的接口转发数据。</p>\n</li>\n<li>\n<p>多线路负载路由选择的接口，必须开启链路故障检测功能，才能实现线路故障自动切换。</p>\n</li>\n<li>\n<p>多条策略路由，按照从上往下的顺序匹配，一旦匹配到某条策略路由后，不再往下匹配。</p>\n</li>\n</ul>\n<h2 id=\"终端安全检测和防御技术\"><a class=\"anchor\" href=\"#终端安全检测和防御技术\">#</a> <strong>终端安全检测和防御技术：</strong></h2>\n<h3 class=\"blue\" id=\"终端安全风险\"><a class=\"anchor\" href=\"#终端安全风险\">#</a> 终端安全风险</h3>\n<p class=\"red\">1，风险：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，APT 攻击最常采用的跳板就是僵尸网络，黑客利用僵尸网络来实现：渗透，监视，窃取敏感数据等目的，危害非常大。</li>\n<li>2，僵尸网络的主要危害有：</li>\n<li>看不见的风险。</li>\n<li>高级持续威胁。</li>\n<li>本地渗透扩散。</li>\n<li>敏感信息窃取。</li>\n<li>脆弱信息收集。</li>\n</ul>\n<h3 class=\"blue\" id=\"终端上网安全可视可控技术\"><a class=\"anchor\" href=\"#终端上网安全可视可控技术\">#</a> 终端上网安全可视可控技术</h3>\n<p>1，背景：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiVsde.png\" alt=\"图片\"></p>\n<p class=\"red\">2，方案：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>基于七层应用的深度数据包检测可实现终端安全可控</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/29/yiZQfA.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，应用控制策略简介：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，应用控制策略可对<ins class=\"wavy\">应用 / 服务</ins>的访问做双向控制。AF 存在一条默认拒绝所有应用 / 服务的控制策略。</p>\n</li>\n<li>\n<p>2，基于应用的控制策略：</p>\n</li>\n<li>\n<p>通过匹配数据包特征来进行过滤动作，需要一定数量的数据包通行后，才能判断应用类型，然后进行拦截动作的判断。</p>\n</li>\n<li>\n<p>3，基于服务的控制策略：</p>\n</li>\n<li>\n<p>通过匹配数据包的五元组 (源地址，目的地址，源端口，目的端口，协议号) 来进行过滤动作，对于任何包可以立即进行拦截动作判断。</p>\n</li>\n</ul>\n<p class=\"red\">4，Web 过滤：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，WEB 过滤是指针对符合设定条件的访问网页数据进行过滤。包括 URL 过滤，文件过滤，根据 HTTP 不同的动作进行区分，可以针对 HTTPS URL 进行过滤。</li>\n</ul>\n<h3 class=\"blue\" id=\"计算机病毒\"><a class=\"anchor\" href=\"#计算机病毒\">#</a> 计算机病毒</h3>\n<p class=\"red\">1，计算机病毒：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，1994 年 2 月 18 日颁布实施的《中华人民共和国计算机信息系统安全保护条例》中明确指出：“计算机病毒，是编制或者在计算机程序中能插入的破坏计算机功能或者毁坏数据，影响计算机使用，并能自我复制的一组计算机指令或者程序代码”</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/29/yinfhQ.png\" alt=\"图片\"></li>\n</ul>\n<p>2，计算机病毒工作步骤：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiKpGQ.png\" alt=\"图片\"></p>\n<p class=\"red\">3，杀毒防御产品的发展：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，发展过程：</p>\n</li>\n<li>\n<p>单机版杀毒软件 —— 网络版杀毒软件 —— 杀毒软件 + 杀毒网关。</p>\n</li>\n<li>\n<p>2，网络杀毒功能的优势 (防病毒网关)</p>\n</li>\n<li>\n<p>基于应用层过滤病毒</p>\n</li>\n<li>\n<p>过滤出入网关的数据</p>\n</li>\n<li>\n<p>网关阻断病毒传输，主动防御病毒于网络之外</p>\n</li>\n<li>\n<p>部署简单，方便管理，维护成本低</p>\n</li>\n<li>\n<p>与杀毒软件联动，建立多层防护</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/29/yiMCFO.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">4，网关杀毒实现方式：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，代理扫描方式：</li>\n<li>将所有经过网关的需要进行病毒检测的数据报文透明地交给网关自身的协议栈，通过网关的自身的协议栈将全部文件缓存下来后，再送入病毒检测引擎进行病毒检测。</li>\n<li>2，流扫描方式：</li>\n<li>依赖于状态检测技术以及协议解析技术，简单的提取文件的特征与本地前面库进行匹配。</li>\n</ul>\n<p>5，AF 网关杀毒实现方式：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiMbHP.png\" alt=\"图片\"></p>\n<p class=\"red\">6，AF 网关杀毒优势：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，支持各类主流协议文件传播杀毒，包括 SMB v1/v2/v3 协议，通过采用 SAVE 智能文件检测引擎 (杀毒)，大幅提高恶意文件识别率。</li>\n<li>2，支持对邮件正文中的恶意域名，URL 进行检测。</li>\n<li>3，提供覆盖更广的杀毒能力，支持文档类，脚本类的非 PE 文件检测，office 宏病毒的杀毒能力。</li>\n<li>4，杀毒文件的大小限制，可以灵活调整，界面可调整的大小限制为 1-20M。</li>\n<li>5，支持对压缩文件的检测，且可设置层级，界面可调整的层级最多 16 层。</li>\n</ul>\n<p class=\"red\">7，SAVE 引擎优势：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，基于 Ai 技术提取稳定可靠的高层次特征，拥有强大的泛化能力，能够识别未知病毒或者已知病毒的新变种。</li>\n<li>2，对勒索病毒检测效果达到业内领先，影响广泛的如：Wannacry，BadRabbit，Globelposter 等勒索病毒，Save 均有检测出新变种的案例，同时，对非勒索病毒也有较好的检出效果。</li>\n<li>3，轻量级，资源占用少，隔离网环境检测能力业内领先。</li>\n<li>4，云 + 边界设备 + 端联动，依托于深信服安全云脑海量的安全数据，SAVE 能够持续进化，不断更新模型并提示检测能力，未知威胁能够再云端分钟级返回检测结果并全网同步，构成了深信服的安全云脑 + 安全网关 AF/SIP/AC + 终端安全 EDR 的整体解决方案。</li>\n</ul>\n<p>8，网关杀毒配置思路：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/31/yAh7xP.png\" alt=\"图片\"></p>\n<ul>\n<li>\n<p><strong>服务器安全检测和防御技术：</strong></p>\n</li>\n<li>\n<p><strong>安全评估与动态检测技术：</strong></p>\n</li>\n</ul>\n<h1 id=\"第五章移动接入安全\"><a class=\"anchor\" href=\"#第五章移动接入安全\">#</a> 第五章【移动接入安全】</h1>\n<ul>\n<li><strong>移动接入方案概述：</strong></li>\n<li><strong>移动接入身份认证技术：</strong></li>\n<li><strong>资源发布与安全接入策略：</strong></li>\n</ul>\n<h1 id=\"第六章终端安全\"><a class=\"anchor\" href=\"#第六章终端安全\">#</a> 第六章【终端安全】</h1>\n<ul>\n<li><strong>EDR 部署与终端管理：</strong></li>\n<li><strong>EDR 策略配置及联动管理：</strong></li>\n<li><strong>EDR 知识串讲：</strong></li>\n</ul>\n<h1 id=\"第七章网络安全可视\"><a class=\"anchor\" href=\"#第七章网络安全可视\">#</a> 第七章【网络安全可视】</h1>\n<ul>\n<li><strong>态势感知概述与 SIP 部署：</strong></li>\n<li><strong>SIP 功能介绍与配置：</strong></li>\n</ul>\n<h1 id=\"实验部分\"><a class=\"anchor\" href=\"#实验部分\">#</a> 实验部分</h1>\n<h2 id=\"第二章-数据传输安全\"><a class=\"anchor\" href=\"#第二章-数据传输安全\">#</a> 第二章 - 数据传输安全</h2>\n<h3 id=\"22ipsec-vpn解决方案\"><a class=\"anchor\" href=\"#22ipsec-vpn解决方案\">#</a> 2.2IPsec VPN 解决方案</h3>\n",
            "tags": [
                "技术",
                "深信服"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/13/%E8%B7%AF%E7%94%B1%E6%9D%BF%E5%9D%97/",
            "url": "https://manshan.top/2021/01/13/%E8%B7%AF%E7%94%B1%E6%9D%BF%E5%9D%97/",
            "title": "路由板块",
            "date_published": "2021-01-13T11:00:25.975Z",
            "content_html": "<h1 id=\"第一章ospf\"><a class=\"anchor\" href=\"#第一章ospf\">#</a> 第一章【OSPF】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>OSPF【开放最短路径优先】（现网使用最多）【注：OSPF查看RFC2328文档】</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1</span>：动态路由协议分为：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    距离矢量路由协议<span class=\"token punctuation\">(</span>RIP,EIGRP,BGP<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    链路状态路由协议<span class=\"token punctuation\">(</span>OSPF,ISIS<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2</span>，基础：管理距离<span class=\"token punctuation\">(</span>AD<span class=\"token punctuation\">)</span>:【注】管理距离不会传递，值越小越优</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    CISCO的AD值<span class=\"token punctuation\">[</span>ospf:110  static:1<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    HW的AD值<span class=\"token punctuation\">[</span>ospf:10 static:60<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">3</span>，度量值：Metric【ospf用cosf来表示，并且ospf只用带宽来表示，值<span class=\"token operator\">=</span><span class=\"token number\">100</span>除以带宽<span class=\"token punctuation\">(</span>M<span class=\"token punctuation\">)</span>】</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，cost计算方法：路由收接口进行累加，<span class=\"token punctuation\">(</span>可以手动调,在收接口）</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>cost：E口<span class=\"token operator\">=</span>10m，F口<span class=\"token operator\">=</span>100m，G口<span class=\"token operator\">=</span>1000m，TEN <span class=\"token assign-left variable\">G</span><span class=\"token operator\">=</span>10000m，S<span class=\"token operator\">=</span><span class=\"token number\">1</span>.544m <span class=\"token assign-left variable\">cost</span><span class=\"token operator\">=</span><span class=\"token number\">100</span>/1.544<span class=\"token operator\">=</span><span class=\"token number\">64</span>【注国内S<span class=\"token operator\">=</span>2m】</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token number\">100</span>/带宽<span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span>：其中100可以修改，命令：bandwidth-reference <span class=\"token number\">10000</span>。</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">4</span>，OSPF报文类型：</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，hello：建立<span class=\"token punctuation\">(</span>同区域，同网段<span class=\"token punctuation\">)</span>和维护<span class=\"token punctuation\">(</span>周期性发送，10s一次，40s超时，1800s重新泛洪，</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    3600s路由丢失<span class=\"token punctuation\">)</span>OSPF邻居关系。</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，DBD：链路状态数据库描述信息<span class=\"token punctuation\">(</span>描述LSDB中LSA头部的信息<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>，LSR：链路状态请求<span class=\"token punctuation\">(</span>DBD中对应的路由信息<span class=\"token punctuation\">)</span>,向OSPF邻居请求链路状态信息。</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>，LSU：链路状态更新<span class=\"token punctuation\">(</span>发送路由信息<span class=\"token punctuation\">)</span>（包含一条或多条LSA）</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>，LSACK：链路状态确认包，对LSU中的LSA进行确认。</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">5</span>，OSPF区域：</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，骨干区域：area0<span class=\"token punctuation\">(</span>不能修改<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，非骨干区域；arother<span class=\"token punctuation\">(</span>可以修改<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">6</span>，OSPF的三张表：</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，邻居表；建立的邻居关系如何。查看：show <span class=\"token function\">ip</span> ospf neighbor。</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，拓扑表；所有有关OSPF传递过来的信息。查看：show <span class=\"token function\">ip</span> ospf database。</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>，路由表；使能的路由加入表项。 查看：show <span class=\"token function\">ip</span> route ospf。</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">7</span>，OSPF区域的配置<span class=\"token punctuation\">(</span>PK实验步骤<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>R1：</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token comment\">#router ospf 1   &lt;1 代表进程，不同的进程相对独立 ></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.12.0 0.0.0.255 area 1   &lt; 配置网段，反掩码，和区域 1></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>R2：</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token comment\">#router ospf 1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.12.0 0.0.0.255 area 1</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.23.0 0.0.0.255 area 0</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>R3：</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token comment\">#router ospf 1</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.23.0 0.0.0.255 area 0</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.34.0 0.0.0.255 area 2</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>R4：</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token comment\">#router ospf 1</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>Router<span class=\"token punctuation\">(</span>config-router<span class=\"token punctuation\">)</span><span class=\"token comment\">#network 172.16.34.0 0.0.0.255 area 2</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>验证：</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>Router<span class=\"token comment\">#show ip ospf neighbor（查看邻居）</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>此时R1能ping通R4（由于OSPF的自动学习）</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>思考：为什么能通？——》有路由<span class=\"token punctuation\">(</span>为什么?<span class=\"token punctuation\">)</span>——》建立邻居关系<span class=\"token punctuation\">(</span>为什么?<span class=\"token punctuation\">)</span>——》邻居表正常<span class=\"token punctuation\">(</span>为什么?<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    - ——》宣告配置没问题。</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token number\">8</span>，OSPF建立邻居的过程：七种状态 【注，重置进程命令：clear <span class=\"token function\">ip</span> ospf process】</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，down：</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token number\">1</span>，没有宣告。</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token number\">2</span>，接口down。</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，init<span class=\"token punctuation\">(</span>初始化<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token number\">1</span>，互发hello包。</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token number\">2</span>，router-id：标识对方设备在ospf中的名称。</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    router-id如何选举：（1）手动（命令：router-id <span class=\"token number\">2.2</span>.2.2）。</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    （2）逻辑接口IP地址最大<span class=\"token punctuation\">(</span>环回口<span class=\"token punctuation\">)</span>。（3）物理接口IP地址最大。</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token number\">3</span>，跳转条件：设备之间了解了对方的router-id。</pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>，two-way：</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token number\">1</span>， 选举DR，【注：DR不抢占。】</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t<span class=\"token number\">2</span>，DR概念：DR指定路由器，收集同一广播域其他DRother路由信息，进行打包发送。</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token number\">3</span>，选举过程：（1）DR优先级：越大越优<span class=\"token punctuation\">(</span>默认为1，为0时不参与选举，范围0-255<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t    【注：优先级0的配置命令：ip ospf priority <span class=\"token number\">0</span>】</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>  Router-id:越大越优。</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t<span class=\"token number\">4</span>，DR选举很慢，10-30s。</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t<span class=\"token number\">5</span>，优化：ip ospf network point-to-point<span class=\"token punctuation\">(</span>两端同时配置<span class=\"token punctuation\">)</span> 配置为点对点，</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t    不会选举DR。</pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>，exstart</pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>，exchange</pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span>，loading</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span>，full（最稳定）</pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token number\">9</span>，OSPF的组播地址：</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，224.0.0.5</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，224.0.0.6</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>，DR接收 <span class=\"token number\">224.0</span>.0.6 DRother发送。</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>，DRother接收 <span class=\"token number\">224.0</span>.0.5 DR发送。</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>，LSU：路由信息,224.0.0.6就是LSU。</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token number\">10</span>，DRother与DRother之间是two-way。（不传递路由信息）</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token number\">11</span>，two-way与full：</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，2way—邻居（不传递路由信息）。</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，full—邻接 （传递所有信息）。</pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token number\">12</span>，稳定状态下只能看到Hello包。</pre></td></tr></table></figure><h1 id=\"第二章交换基础\"><a class=\"anchor\" href=\"#第二章交换基础\">#</a> 第二章【交换基础】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，交换机类型：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">1</span>，二层交换机。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t    二层：可网管，只能配置一个IP，配置一条的静态路由，相对便宜，MAC地址转发。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token number\">2</span>，三层交换机。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t    三层：可以配置ip地址。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">2</span>，交换机用芯片转发速度快，路由器用cpu转发速度慢。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>未完待续<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h1 id=\"第三章交换机的vlan-trunk\"><a class=\"anchor\" href=\"#第三章交换机的vlan-trunk\">#</a> 第三章【交换机的 VLAN TRUNK】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，VLAN隔离：切割广播域，同一VALN属于同一广播域。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>，默认情况下交换机属于同一VLAN——VLAN1。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">3</span>，同一VLAN能互发信息，不同VLAN不能。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">4</span>，VLAN操作流程：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    交换机接口<span class=\"token punctuation\">(</span>ACCESS接口<span class=\"token punctuation\">)</span>：入方向：打上TAG。 出方向：去掉TAG。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">5</span>，ACCESS配置方式：【PK实验】</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token number\">1</span>，新建VLAN：vlan <span class=\"token number\">10</span>。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">2</span>，查看新建的VLAN：show vlan。</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">3</span>，配置物理接口类型：<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>access：关联vlan，命令:switchport mode access。</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t    <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>trunk:命令：switchport mode trunk。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">4</span>，物理接口关联vlan10命令：switchport access vlan <span class=\"token number\">10</span>。</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">6</span>，TRUNK配置方式：【PK实验】</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token number\">1</span>，TRUNK接口模式：Switch<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#switchport mode trunk</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token number\">2</span>，注意：trunk接口两端都要配置！！</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token number\">3</span>，trunk不允许指定vlan <span class=\"token number\">10</span>口通过：Switch<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#switchport trunk allowed </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t    vlan remove  <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token number\">4</span>，允许指定接口通过：Switch<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#switchport trunk allowed vlan 10</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token number\">5</span>，允许所有接口通过：Switch<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#switchport trunk allowed vlan all</span></pre></td></tr></table></figure><h1 id=\"第四章单臂路由svi\"><a class=\"anchor\" href=\"#第四章单臂路由svi\">#</a> 第四章【单臂路由 SVI】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，路由器物理接口：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    本身是没办法关联VLAN。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2</span>，路由器子接口：数据入方向：去TAG，数据出方向：打上TAG。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">3</span>，单臂路由配置：【PK实验】</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token number\">1</span>，开启物理接口：</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t    Router<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token comment\">#int g0/0/0</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t    Router<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#no shutdown</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">2</span>，配置子接口：</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t    <span class=\"token number\">1</span>，Router<span class=\"token punctuation\">(</span>config-if<span class=\"token punctuation\">)</span><span class=\"token comment\">#int g0/0/0.1   // 进入子接口</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token number\">2</span>，Router<span class=\"token punctuation\">(</span>config-subif<span class=\"token punctuation\">)</span><span class=\"token comment\">#encapsulation dot1Q 10   // 进行封装。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token number\">3</span>，Router<span class=\"token punctuation\">(</span>config-subif<span class=\"token punctuation\">)</span><span class=\"token comment\">#ip address 172.16.10.254 255.255.255.0  </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t//配置网段</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token number\">4</span>，Router<span class=\"token punctuation\">(</span>config-subif<span class=\"token punctuation\">)</span><span class=\"token comment\">#no shutdown    // 开启接口</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token number\">3</span>，注意：PC机一定要配置默认网关！！！</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token number\">4</span>，具体流程解释：</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t    <span class=\"token number\">1</span>，PC1：源地址：172.16.10.2 目的地址：172.16.11.2 不同网段：</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t发给网关<span class=\"token punctuation\">(</span>路由器的172.16.10.254<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token number\">2</span>，交换机：access接口vlan10收到。打上TAG10标签。trunk接口发送出</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t保留TAG10。</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token number\">3</span>，路由器：g0/0/0接收到TAG10，在入方向去掉TAG10。</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token number\">4</span>，查询路由表：目的地址172.16.11.2   g0/0/0.2 。g0/0/0.2对应</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tvlan20，数据发出去打上TAG20。</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token number\">5</span>，交换机：trunk接口收到保留TAG20，源：172.16.10.2 目的：</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t    <span class=\"token number\">172.16</span>.11.2。access VLAN20接口发送出去。</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token number\">5</span>，SVI<span class=\"token punctuation\">(</span>三层交换机使用<span class=\"token punctuation\">)</span>:</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t    <span class=\"token number\">1</span>，int  vlan <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token number\">2</span>，ip addr <span class=\"token number\">172.16</span>.10.1 <span class=\"token number\">255.255</span>.255.0</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token number\">3</span>，int vlan <span class=\"token number\">10</span> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token number\">4</span>，ip addr <span class=\"token number\">172.16</span>.11.1 <span class=\"token number\">255.255</span>.255.0</pre></td></tr></table></figure><h1 id=\"第五章生成树\"><a class=\"anchor\" href=\"#第五章生成树\">#</a> 第五章【生成树】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，什么是冗余：备份，备胎。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>，二层环路不可解，三层环路可解<span class=\"token punctuation\">(</span>TTL值为零停止<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">3</span>，生成树<span class=\"token punctuation\">(</span>STP<span class=\"token punctuation\">)</span>解决二层环路。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">4</span>，生成树有：STP，RSTP，MSTP<span class=\"token punctuation\">(</span>HW默认运行<span class=\"token punctuation\">)</span>，PVST+<span class=\"token punctuation\">(</span>CS默认运行<span class=\"token punctuation\">)</span>，PVRST+。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>【注：1，2，3，共有的。4，5，私有】</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token number\">1</span>，STP基本了解：</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>,ROOT根桥，选举条件:桥ID：由<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>优先级<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>MAC地址组成。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t值都是4096的倍数。每台设备都有桥ID。选举条件：桥ID 越小越优先。</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t各个设备的桥I封装在BPDU里进行发送。</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">2</span>，RP<span class=\"token punctuation\">(</span>根端口<span class=\"token punctuation\">)</span>，选举条件:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，COST值：10m <span class=\"token assign-left variable\">cost</span><span class=\"token operator\">=</span><span class=\"token number\">100</span>，100m <span class=\"token assign-left variable\">cost</span><span class=\"token operator\">=</span><span class=\"token number\">19</span>，1000mcost<span class=\"token operator\">=</span><span class=\"token number\">4</span>，</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t10000m <span class=\"token assign-left variable\">cost</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>。只能 是非ROOT才可以选举！</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，发送端的桥ID:越小越优先。</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>，发送端的接口 ID：越小越优先。作用：接收最优的BPDU包。</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t【注：一台设备只有一个RP】</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token number\">3</span>，DP<span class=\"token punctuation\">(</span>指定端口<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，作用：发送最优的BPDU包，</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>，选举条件：1，Cost值，2，桥ID。【注：根桥所有端口都为 DP！】</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token number\">4</span>，NDP<span class=\"token punctuation\">(</span>非指定端口<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>，作用：1，discarding<span class=\"token punctuation\">(</span>阻塞<span class=\"token punctuation\">)</span>，2，阻塞数据转发，3，只能接受BPDU包。</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token number\">4</span>，dis到lis需要20s<span class=\"token punctuation\">(</span>dis状态只收不发，lis同时收发<span class=\"token punctuation\">)</span>lis到lea需要15s</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token punctuation\">(</span>学习MAC表<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token number\">5</span>，具体状态：</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t    <span class=\"token number\">1</span>，DISCARDING状态<span class=\"token punctuation\">(</span>只接收BPDU,不转发数据<span class=\"token punctuation\">)</span>—<span class=\"token operator\">></span>NDP口。</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token number\">2</span>，到LISTING状态<span class=\"token punctuation\">(</span>接收和发送BPDU，也不转发数据 <span class=\"token punctuation\">)</span>需要20s。</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token number\">3</span>，到LEARNING状态<span class=\"token punctuation\">(</span>接收和发送BPDU，也不转发数据，但学习MAC地址<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t需要15s。</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token number\">4</span>，到FORWARDING状态<span class=\"token punctuation\">(</span>转发数据， <span class=\"token punctuation\">)</span>需要15s。【注：BPDU每2s发送一个】</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token number\">5</span>，RP：接收数据包<span class=\"token punctuation\">(</span>BPDU<span class=\"token punctuation\">)</span>，DP：发送数据包<span class=\"token punctuation\">(</span>BPDU<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token number\">6</span>，PC接入到运行 STP交换机<span class=\"token punctuation\">(</span>标准生成树时间为30s<span class=\"token punctuation\">)</span>：从，LIS，LES，FWD共30s。</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token number\">7</span>，PC直连STP交换机可以配置边缘端口<span class=\"token punctuation\">(</span>速度快<span class=\"token punctuation\">)</span>，具体配置如下：</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t    <span class=\"token number\">1</span>，HW：</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tint g0/0/0  stp edged-port enable。</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t针对全局的access端口开启edge：stp edge-port default。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t<span class=\"token number\">2</span>，CSICO：</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\tspanning-tree portfast default</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token number\">8</span>，批量配置端口；</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t    <span class=\"token number\">1</span>，HW:</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\tport-group group-number g0/0/0 to g0/0/24。</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t<span class=\"token number\">2</span>，CISCO:</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\tint ran g0/30 - <span class=\"token number\">48</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token number\">9</span>，Cost新标准：2乘以10的七次方除以带宽<span class=\"token punctuation\">(</span>M<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token number\">10</span>，STP最大缺点：</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t    <span class=\"token number\">1</span>，时间慢！！再好的设备也没用。</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t    <span class=\"token number\">2</span>，NDP阻塞所有的VLAN，不会只阻塞其中的一个。</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token number\">11</span>，STP配置命令<span class=\"token punctuation\">(</span>HW<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t    <span class=\"token number\">1</span>，stp mode stp</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token number\">2</span>，stp priority <span class=\"token number\">4096</span>（配置优先级）。【配置简单，理论难】</pre></td></tr></table></figure><h1 id=\"第六章端口聚合\"><a class=\"anchor\" href=\"#第六章端口聚合\">#</a> 第六章【端口聚合】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，端口聚合：带宽加倍。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>，捆绑接口<span class=\"token punctuation\">(</span>以太网捆绑<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">1</span>，把多条线路进行叠加使用。1000*2<span class=\"token operator\">=</span>2000m。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token number\">2</span>，冗余。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span>，注意：线路最好偶数使用。否则，负载不均等。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">4</span>，查看捆绑情况命令<span class=\"token punctuation\">(</span>CISCO<span class=\"token punctuation\">)</span>：sh etherchannel summary。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">5</span>，负载方式：</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token number\">1</span>，数据包<span class=\"token punctuation\">(</span>交换接口上使用最多，均等分重组的问题，但线路的快慢会受影响<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">2</span>，数据流<span class=\"token punctuation\">(</span>路由器最多使用，现网使用最多，不均等分，五因素：1，源ip,</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t    <span class=\"token number\">2</span>,目的ip，3，源端口，4，目的端口，5，协议号<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">6</span>，协议：</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token number\">1</span>，动态：LACP<span class=\"token punctuation\">(</span>共有协议<span class=\"token punctuation\">)</span>，PAGP<span class=\"token punctuation\">(</span>思科私有<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token number\">2</span>，静态<span class=\"token punctuation\">(</span>推荐<span class=\"token punctuation\">)</span>：LACP静态。</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">7</span>，配置命令：</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token number\">1</span>，静态<span class=\"token punctuation\">(</span>CISCO<span class=\"token punctuation\">)</span>：</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t    int range g0/1 - <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t    channel-group <span class=\"token number\">1</span> mode on </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t    <span class=\"token function\">shutdown</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t    【配置完成生成port <span class=\"token number\">1</span>端口】</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t    int port <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t    sw mode ac</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t    sw acc vlan <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t【注：两端都配置完成之后再启用接口，防止接口起不来】</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token number\">2</span>，HW配置命令:</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t    <span class=\"token function\">clear</span> configuration interface g0/0/1<span class=\"token punctuation\">(</span>清除接口以前的配置<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tport-group group-member g0/0/1 g0/0/2（要配置的接口）</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t【注：两端都要配置】</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\tint eth-trunk <span class=\"token number\">1</span>（创建trunk1端口）</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tint g0/0/1<span class=\"token punctuation\">(</span>加入捆绑口1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\teth-trunk <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tint g0/0/2</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\teth-trunk <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">8</span>，什么是堆叠：</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    把两台物理设备变为一台设备。二层交换机不能堆叠，</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t【注：堆叠+捆绑去STP！！ ！堆叠必须与捆绑在一起使用】</pre></td></tr></table></figure><h1 id=\"第七章首跳冗余协议hsrpvrrp\"><a class=\"anchor\" href=\"#第七章首跳冗余协议hsrpvrrp\">#</a> 第七章【首跳冗余协议 HSRP，VRRP】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，与冗余有关联。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>，冗余概念：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token number\">1</span>，能通。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token number\">2</span>，故障情况下稳定使用，如：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t    <span class=\"token number\">1</span>，单线路故障<span class=\"token punctuation\">(</span>解决<span class=\"token punctuation\">)</span>——多线路捆绑。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t    <span class=\"token number\">2</span>，单台设备故障<span class=\"token punctuation\">(</span>解决<span class=\"token punctuation\">)</span>——堆叠或VRRP。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token number\">3</span>，电源——双电源<span class=\"token punctuation\">(</span>市电，UPS<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token number\">4</span>，服务器<span class=\"token punctuation\">(</span>解决<span class=\"token punctuation\">)</span>——集群<span class=\"token punctuation\">(</span>LB负载均衡器<span class=\"token punctuation\">(</span>分法数据<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t前端应用<span class=\"token punctuation\">(</span>多台服务器<span class=\"token punctuation\">)</span>，数据库<span class=\"token punctuation\">(</span>主备冗余<span class=\"token punctuation\">)</span>，存储<span class=\"token punctuation\">(</span>阵列，多个磁盘柜<span class=\"token punctuation\">)</span>。</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token number\">5</span>，机房冗余<span class=\"token punctuation\">(</span>解决<span class=\"token punctuation\">)</span>：A机房，B机房。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3</span>，VRRP配置<span class=\"token punctuation\">(</span>HW<span class=\"token punctuation\">)</span>:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    int vlan <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvrrp vrid <span class=\"token number\">1</span> virtual-ip <span class=\"token number\">172.16</span>.10.254</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tvrrp vrid  <span class=\"token number\">1</span> priority <span class=\"token number\">101</span><span class=\"token punctuation\">(</span>配置优先级，越大越优先。<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t【注】vrid：1，一个网段占用一个vrid。2，虚拟IP的MAC地址是根据vrid生产的。</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t查看的命令：dis vrrp brief</pre></td></tr></table></figure><h1 id=\"第八章acl访问控制列表\"><a class=\"anchor\" href=\"#第八章acl访问控制列表\">#</a> 第八章【ACL (访问控制列表)】</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>，ACL层面：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token number\">1</span>，控制层面：路由。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token number\">2</span>，转发层面：数据。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span>，作用：过滤/抓取数据。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span>，动作：允许-permit。拒绝-deny。</pre></td></tr></table></figure>",
            "tags": [
                "技术",
                "路由"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/10/hello-world/",
            "url": "https://manshan.top/2021/01/10/hello-world/",
            "title": "Welcome",
            "date_published": "2021-01-10T12:03:25.104Z",
            "content_html": "<p class=\"rainbow\">Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is my second blog post.Author:Ruri Shimotsuki @優萌初華. If you get any problems when using Hexo, you can ask me on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pvY2VseW5mbG9yZXNYWFg=\">GitHub</span>.</p>\n",
            "tags": []
        }
    ]
}