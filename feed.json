{
    "version": "https://jsonfeed.org/version/1",
    "title": "I",
    "subtitle": "",
    "icon": "https://manshan.top/images/favicon.ico",
    "description": "",
    "home_page_url": "https://Manshan.top",
    "items": [
        {
            "id": "https://manshan.top/2021/07/13/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E9%81%87%E5%88%B0%E7%9A%84%E5%8D%8F%E8%AE%AE/",
            "url": "https://manshan.top/2021/07/13/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E9%81%87%E5%88%B0%E7%9A%84%E5%8D%8F%E8%AE%AE/",
            "title": "遇到的协议",
            "date_published": "2021-07-13T01:16:40.474Z",
            "content_html": "<h1 id=\"iscsi\"><a class=\"anchor\" href=\"#iscsi\">#</a> iSCSI</h1>\n<p>1，iSCSI</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，iSCSI：</li>\n<li>Internet 小型计算机系统接口，又称为 IP-SAN，是一种基于因特网及 SCSI-3 协议下的存储技术</li>\n<li>2，简介：</li>\n<li>iSCSI 技术有以下三个革命性的改变：</li>\n<li>(1) 把原来只用于本机的 SCSI 协议透过 TCP/IP 网络发送，使连接距离可作无限的区域延伸。</li>\n<li>(2) 连接的服务器数量无线 (原来的 SCSI-3 的上限是 15)</li>\n<li>(3) 由于是服务器架构，因此也可以实现在线扩容已致动态部署。</li>\n<li>3，功能：</li>\n<li>iSCSI 利用了 TCP/IP 的 port 860 和 3260 作为沟通的渠道，透过两台计算机之间利用 iSCSI 的协议来交换 SCSI 命令，让计算机可以透过高速的局域网集线来把 SAN 模拟成为本地的存储装置。</li>\n<li>本质上，iSCSI 让两个主机通过 IP 网络相互协商然后交换 SCSI 命令，这样一来，ISCSI 就是用广域网仿真了一个常用的高性能本地存储总线，从而创建了一个存储局域网 (SAN)，不想某些 SAN 协议，iSCSI 不需要专用的电缆，它可以在已有的交换和 IP 基础架构上运行，然而，如果不使用专用的网络或者子网 (LAN 或者 VLAN)，iSCSI SAN 的部署性能可能会严重下降，于是，iSCSI 尝尝被认为是光纤通道的一个低成本替代方法，光纤通道是需要专用的基础架构，但是，基于以太网的光纤通道则不需要专用的基础架构。</li>\n</ul>\n<h1 id=\"cdp数据保护\"><a class=\"anchor\" href=\"#cdp数据保护\">#</a> CDP (数据保护)</h1>\n<p>1，CDP</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，CDP (持续数据保护)：</li>\n<li>是对传统数据备份技术的一次革命性的重大突破的技术，传统的数据备份解决方案专注在对数据的周期性备份上，因此一直伴随着有备份窗口，数据一致性以及对生产系统的影响等问题。</li>\n<li>2，定义：</li>\n<li>CDP 为用户提供了新的数据保护阶段，系统管理者无需关注数据的备份过程 (因为 CDP 系统会不断检测关键数据的变化，从而不断地自动实现数据的保护)，而且仅仅当灾难发生后，简单的选择需要恢复到的时间点即可实现数据的快速恢复。从理论上说，任何一次的文件变化都会被自动记录，因而称为持续数据保护。</li>\n</ul>\n<h1 id=\"san存储区域网络\"><a class=\"anchor\" href=\"#san存储区域网络\">#</a> SAN (存储区域网络)</h1>\n<p>1，SAN</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，SAN (存储区域网络)：</li>\n<li>采用网状通道 (简称 FC) 技术，通过 FC 交换机连接存储阵列和服务器主机，建立专用于数据存储的区域网络，SAN 专注于企业级存储的问题，当前企业存储方案所遇到的问题的两个根源是：数据与应用系统紧密结合所产生的结构性限制，以及小型计算机系统接口 (SCSI) 标准的限制，大多数分析都认为 SAN 是未来企业级的存储方案，这是因为 SAN 便于集成，能改善数据可用性及网络性能，而且还可以减轻管理作业。</li>\n<li>2，定义：</li>\n<li>SAN 其实是一种专门为存储建立的独立于 TCP/IP 网络之外的专用网络，目前一般的 SAN 提供 2Gb/S 到 4G/bS 的传输速率，同时 SAN 网络独立于数据网络存在，因此存取数度很快，另外 SAN 一般采用高端的 RAID 阵列，使 SAN 的性能更高。</li>\n</ul>\n<h1 id=\"nfs网络文件系统\"><a class=\"anchor\" href=\"#nfs网络文件系统\">#</a> NFS (网络文件系统)</h1>\n<p>1，NFS</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，NFS (网络文件系统)</li>\n<li>能使使用者访问别处的文件就像在使用自己的计算机一样。</li>\n<li>2，定义：</li>\n<li>NFS 是基于 UDP/IP 协议的应用，其实现主要是采用远程过程调用 RPC 机制，RPC 提供了一组与机器，操作系统以及底层传输协议无关的存取远程文件的操作，RPC 采用了 XDR 的支持，XDR 是一种与机器无关的数据描述编码的协议，它与独立于任意机器体系结构的格式对网上传输的数据进行编码和解码，支持在异构系统之间的数据的传送。</li>\n<li>3，演化：</li>\n<li>NFS 是文件系统之上的网络抽象，来允许远程客户端以与本地文件系统类似的方式，来通过网络进行访问，NFS 允许在多个用户之间共享公共文件系统，并提供数据集中的优势，来最小化所需的存储空间。</li>\n</ul>\n<h1 id=\"nfv网络功能虚拟化\"><a class=\"anchor\" href=\"#nfv网络功能虚拟化\">#</a> NFV (网络功能虚拟化)</h1>\n<p>1，NFV</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，NFV (网络功能虚拟化)：</li>\n<li>一种对网络架构的概念，利用虚拟化技术，将网络节点阶层的功能，分割成几个功能区块，分别以软件方式实现，不再局限于硬件架构。</li>\n<li>2，定义：</li>\n<li>NFV (网络功能虚拟化) 的核心是虚拟网络功能，它提供只能在硬件中找到的网络功能，包括路由，CPE，移动核心，IMS，CDN，饰品，安全性，策略等等。</li>\n<li>但是，虚拟化网络功能需要把应用程序，业务流程和可以进行整合和调整的基础设施软件结合起来。</li>\n</ul>\n<h1 id=\"nas网络存储\"><a class=\"anchor\" href=\"#nas网络存储\">#</a> NAS (网络存储)</h1>\n<p>1，NAS</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，NAS 网络存储：</li>\n<li>基于标准网络协议实现数据传输，为网络中的 Windows/Linux/Mac os 等各种不同的操作系统的计算机提供文件共享和数据备份。</li>\n<li>2，定义：</li>\n<li>NAS 是一种采用直接与网络介质相连的特殊设备实现数据存储的机制，由于这些设备度分配有 IP 地址，所以客户机通过充当数据网关的服务器可以对其进行存取访问，甚至在某些情况下，不需要任何中间介质客户机也可以直接访问这些设备。</li>\n<li>NAS 适用于那些需要通过网络将文件数据传送到多台客户机上的用户，NAS 设备在数据必须长距离传送的环境中可以很好地发挥作用。</li>\n<li>NAS 设备非常易于部署，可以使 NAS 主机，客户机和其他设备广泛分布在整个企业的网络环境中，NAS 可以提供可靠的文件级数据整合，因为文件锁定是由设备自身来处理的。</li>\n<li>NAS 应用于高效的文件共享任务中，例如 UNIX 中的 NFS 和 Windows NT 中的 CIFS，其中基于网络的文件级锁定提供了高级并发访问保护的功能。</li>\n</ul>\n",
            "tags": [
                "协议",
                "协议"
            ]
        },
        {
            "id": "https://manshan.top/2021/07/07/HCIE/",
            "url": "https://manshan.top/2021/07/07/HCIE/",
            "title": "HCIE",
            "date_published": "2021-07-07T08:31:59.851Z",
            "content_html": "<h1 id=\"mac地址表\"><a class=\"anchor\" href=\"#mac地址表\">#</a> MAC 地址表</h1>\n<h2 id=\"mac地址表的组成\"><a class=\"anchor\" href=\"#mac地址表的组成\">#</a> MAC 地址表的组成</h2>\n<p>1，组成：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，动态表项：</li>\n<li>由接口通过报文中的源 MAC 地址学习获得，表向可老化，默认老化时间 300 秒。</li>\n<li>在系统复位，接口板热插拔或接口板复位后，动态表项会丢失。</li>\n<li>2，静态表项：</li>\n<li>由用户手工配置，并下发到各接口板，表项不可老化。</li>\n<li>在系统复位，接口板热插拔或接口板复位后，动态表项不会丢失。</li>\n<li>3，黑洞表项：</li>\n<li>由用户手工配置，并下发到各接口板，表项不可老化。</li>\n<li>配置黑洞 MAC 地址后，源 MAC 地址或目的 MAC 地址是该 MAC 的报文将会丢弃。</li>\n<li>4，查看 MAC 表：</li>\n<li>命令： dis mac-address。</li>\n<li>5，MAC 地址表的配置：</li>\n<li>配置静态 MAC 表项命令：mac-address static 0011-2233-4455 g0/0/1 vlan 1</li>\n<li>配置黑洞 MAC 表项命令：mac-address blackhole 00aa-bbcc-ddee</li>\n<li>配置动态 MAC 表项的老化时间命令：mac-address aging-time 400</li>\n</ul>\n<p>2，配置安全 MAC 功能：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，使能端口安全功能命令：</li>\n<li>port-security enable</li>\n<li>2，配置端口安全保护动作命令：</li>\n<li>port-security protect-action shutdown</li>\n<li>3，配置端口安全动态 MAC 学习限制数量命令：</li>\n<li>port-security max-mac-num 5</li>\n<li>4，配置动态学习的 mac 地址老化时间命令：</li>\n<li>port-security aging-time 1000</li>\n</ul>\n<p>3，配置 Sticky MAC 功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，使能端口安全功能命令：</li>\n<li>porrt-security enable</li>\n<li>2，使能接口 Sticky MAC 功能：</li>\n<li>port-security mac-address sticky</li>\n</ul>\n<p>4，MAC 地址漂移：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>产生现象：设备环路，MAC 地址攻击。</li>\n<li>1，概念：</li>\n<li>MAC 地址漂移是指设备上一个 VLAN 内有两个端口学习到同一个 MAC 地址，后学习到的 MAC 地址表项覆盖原 MAC 地址表项的现象。</li>\n<li>2，MAC 地址漂移避免机制：</li>\n<li>提高接口 MAC 地址学习优先级。</li>\n<li>不允许相同优先级的接口发生 MAC 地址表项覆盖。</li>\n</ul>\n<p>5，MAC 地址防漂移配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，配置接口 MAC 地址学习优先级命令 (默认情况下接口优先级为 0)：</li>\n<li>mac-learning priority 3</li>\n<li>2，配置不允许相同优先级接口 MAC 地址漂移命令：</li>\n<li>undo mac-learning priority 3 allow-flapping</li>\n<li>3，配置全局 MAC 地址漂移检测命令：</li>\n<li>mac-address flapping detection</li>\n<li>4，配置基于 VLAN 的 MAC 地址漂移检测命令：</li>\n<li>vlan 2</li>\n<li>loop-detect eth-loop block-time 100 retry-times 3</li>\n</ul>\n<h1 id><a class=\"anchor\" href=\"#\">#</a> </h1>\n",
            "tags": [
                "IE",
                "IE"
            ]
        },
        {
            "id": "https://manshan.top/2021/07/06/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "https://manshan.top/2021/07/06/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "实习日记",
            "date_published": "2021-07-06T00:49:40.330Z",
            "content_html": "<h1 id=\"2021-07-05\"><a class=\"anchor\" href=\"#2021-07-05\">#</a> 2021-07-05</h1>\n<h1 id=\"从去到做的好你需要准备什么\"><a class=\"anchor\" href=\"#从去到做的好你需要准备什么\">#</a> 从去到做的好，你需要准备什么？</h1>\n<p class=\"red\">一，成长路径上的角色转变 - 思想意识：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，从思想上完成一个网络安全工程师的转变。</li>\n<li>思考问题，处理问题，解决问题跳出单个设备，单个终端的思维局限，而是站在全网全局的角度上去思考解决方案。思想决定行动，想法决定做法。</li>\n</ul>\n<p>二：如何沉淀自己的知识框架</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，网络工程师要掌握那些知识体系，准备那些技能，才能胜任自己的工作。</li>\n<li>实现从技术工程师 ——》技术专家 ——》技术顾问的转变。</li>\n</ul>\n<p>三：工程师的三个阶段，必备的核心素质</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，对专业技能的自信</li>\n<li>2，对自身能力的自信</li>\n<li>3，沟通能力，99.9% 的问题通过沟通都可以找到解决方法</li>\n<li></li>\n</ul>\n<h1 id=\"一个网络安全工程师的日常\"><a class=\"anchor\" href=\"#一个网络安全工程师的日常\">#</a> 一个网络安全工程师的日常</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，测试</li>\n<li>2，实施</li>\n<li>3，售后</li>\n<li>注：</li>\n<li>1，策略路由的优先级最高。</li>\n<li>2，静态路由高于默认路由。</li>\n</ul>\n<p>1，如何避免被客户引导：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>准备充分</li>\n<li>思路清晰</li>\n<li>自信</li>\n</ul>\n<p>2，跳出思维误区</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>整体思考问题，不局限在故障点，一开始要跳出故障点是很难得，但也要往这个方向尝试。</li>\n</ul>\n<p>3，准备要充分</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>在设备上架前，先对客户的网络有充分的了解，不要等出现问题后，在临时去了解客户的网络</li>\n</ul>\n<h1 id=\"如何提升自我\"><a class=\"anchor\" href=\"#如何提升自我\">#</a> 如何提升自我</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，实践合作伙伴实验室：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zYW5nZm9yLnNlZG5zLmNuOjQ0Mzc=\">https://sangfor.sedns.cn:4437</span></li>\n<li>2，演示平台：<span class=\"exturl\" data-url=\"aHR0cDovL3Zwbi5zYW5nZm9yLmNvbS5jbg==\">vpn.sangfor.com.cn</span></li>\n<li>3，文档资料：<span class=\"exturl\" data-url=\"aHR0cDovL2Jicy5zYW5nZm9yLmNvbS5jbg==\">bbs.sangfor.com.cn</span></li>\n</ul>\n<h1 id=\"2021-07-11补充\"><a class=\"anchor\" href=\"#2021-07-11补充\">#</a> 2021-07-11 补充</h1>\n<h2 id=\"设备登录方法恢复出厂恢复控制台密码\"><a class=\"anchor\" href=\"#设备登录方法恢复出厂恢复控制台密码\">#</a> 设备登录方法，恢复出厂，恢复控制台密码</h2>\n<p>1，如何登录设备：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，SANGFOR AC/SG 设备各网口的出厂 IP：</li>\n<li>ETH0(LAN)：10.251.251.251/24，ETH1(DMZ\t)：10.252.252.252/24</li>\n<li>2，使用一根交叉线链接设备和电脑：</li>\n<li>(1)：如果电脑链接的是设备的 eth0 口，需要先在电脑上配置 10.251.251.0/24 网段的地址 (10.251.251.251 除外)，打开浏览器输入 https://10.251.251.251 登录设备网关控制台。</li>\n<li>(2) 如果电脑链接的是设备的 eth1 口，需要先在电脑上配置 10.252.252.0/24 网段的地址 (10.252.252.252 除外)，打开浏览器输入 https://10.252.252.252 登录设备网关控制台。</li>\n<li>3，默认的登录密码为 admin/admin</li>\n<li>4，如果设备接口地址被修改，在不知道更改后接口地址的情况下，提供以下 2 种方法登录设备。</li>\n<li>(1)：SANGFOR AC/SG 设备的 lan 口 (默认 eth0 为 lan) 有保留 IP 地址为 128.127.125.252/29，配置电脑 IP 地址为 128.127.125.253/29，用交叉线链接电脑和设备 eth0 口，通过 https://128.127.125.252 登录设备网关控制台。</li>\n<li>(2)：AC/SG 设备 dmz 口 (默认 eth1 口为 dmz) 也有保留地址 128.128.125.252/29，也可以通过交叉线链接电脑与设备 eth1 口，且电脑配置 IP 为 128.128.125.253/29，通过 https://128.128.125.252 登录设备控制台。</li>\n<li>5，注：</li>\n<li>(1)，路由模式部署时 lan 和 dmz 口都有保留地址，网桥模式网桥 br0 和 dmz 有保留地址，旁路模式部署时管理口有保留地址。</li>\n<li>(2)，路由模式出厂默认 eth0 定义为 lan，eth1 口定义为 dmz。</li>\n</ul>\n<p>2，如何恢复出厂设置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>注：恢复出厂设置会使设备重启。</li>\n<li>1，通过控制台界面恢复出厂配置：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/Wpja60.png\" alt=\"T\"></li>\n<li>2，通过 SANGFOR 升级系统工具恢复出厂配置：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/WpjR6x.png\" alt=\"T\"></li>\n<li>3，通过交叉线短接设备两个电口恢复：</li>\n<li>如果无法登录设备 (如无法获得设备接口地址)，可以尝试以下方法恢复出厂配置。</li>\n<li>(1) 先将设备关机。</li>\n<li>(2) 准备一根交叉线。</li>\n<li>(3) 使用交叉线连接设备面板上任意两个非一组 bypasse 电口（例如 eth0 和 eth2 是 bypasse 口，就不能短接这两个口恢复密码）</li>\n<li>(4) 将设备加电开机。</li>\n<li>一直等待，直到设备重启（说明设备恢复出厂配置成功），此时务必拨掉短接电口的交叉线。</li>\n<li>(5) 等设备起来后，即可通过出厂地址，默认控制台帐号和密码登录设备</li>\n</ul>\n<p>3，如何恢复控制台密码：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>注：如果忘记 admin 密码，导致无法登录设备，又需要保留设备配置 (即不能恢复出厂设置)，可以通过下面方法单独恢复 admin 的密码。</li>\n<li>1，确保电脑和设备可以通信，访问设备地址 https://acip/php/rp.php。如下，提示 “创建文件成功”，请链接交叉线并重启设备。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/WpxAGd.png\" alt=\"T\"></li>\n<li>2、准备交叉线短接设备任意两个非一组 bypasse 电口（例如 eth0 和 eth2 是 bypasse 口，就不能短接这两个口恢复密码）</li>\n<li>3、手动重启设备，重启过程中，注意观察交叉线短接的两个电口 ACT 灯状态，两个电口 ACT 灯同时闪烁 10 次后，说明密码恢复完成，此时可以拔掉短接的交叉线，通过默认的控制台帐号密码 admin/admin 登 录设备即可。设备重启到密码恢复成功大约 3 到 5 分钟左右。</li>\n<li>4、如果第 3 步无法根据网口灯状态判断密码恢复是否成功，你可以一 直等待，等待 5 到 10 分钟左右，尝试通过默认帐号 admin/admin 帐号 登录设备</li>\n</ul>\n<h1 id=\"2021-07-06\"><a class=\"anchor\" href=\"#2021-07-06\">#</a> 2021-07-06</h1>\n<p>1，传统的 IT 基础架构：烟囱式建造模式。</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RId8gg.png\" alt=\"T\"></li>\n</ul>\n<p>2，云计算 IT 基础架构。</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIdYuj.png\" alt=\"T\"></li>\n</ul>\n<p>1，四大 IT 基础设施：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>计算</li>\n<li>储存</li>\n<li>网络</li>\n<li>安全</li>\n</ul>\n<p>2，云计算的本质</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>把计算，储存，网络等硬件资源，通过虚拟化技术变成共享资源池，做到随需可取，按需分配，满足弹性需求。云计算让大数据成为可能。</li>\n</ul>\n<p>3，POC 测试概念：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>POC 测试（即 proof of Concept），是业界流行的针对客户具体业务应用而开展的实验性测试，用户根据业务需求所需的指标项目（功能和性能），从而进行一系列的测算和验证活动，业界内用来通过 POC 测试来验证供应商的能力。</li>\n</ul>\n<p>4，POC 测试的目标是：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>配合市场销售部门，通过验证性的活动的达成，最大化的展现产品能力。</li>\n</ul>\n<p>5，POC 流程执行：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>项目发起</li>\n<li>物料准备</li>\n<li>方案验证</li>\n<li>验证跟进</li>\n<li>测试汇报</li>\n</ul>\n<p>6，项目的定义：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>项目是为创造独特的产品、服务或成果而进行的临时性工作。项目的 “临时性” 是指项目有明确的起点和终点。“临时性” 并不一定意味着项目的持续时间短。当项目目标达成时，或项目因不会或不能达到目标而中止，亦或是项目需求不复存在，则项目便已结束。结束项目的决定必须得到有关当局的审批。</li>\n</ul>\n<p>7，管理一个项目通常包括 (但不限于)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1. 识别项目需求；</li>\n<li>2. 处理相关方的各种需要、关注和期望；</li>\n<li>3. 与相关方建立并维护积极的沟通；</li>\n<li>4. 管理资源；</li>\n<li>5. 以及平衡相互竞争的项目制约因素，包括 (但不限于):</li>\n<li>A. 范围；B. 进度；C. 成本；D. 质量；E. 资源；F. 风险</li>\n</ul>\n<p>8，POC 测试流程角色及职责：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>项目发起人：一般为销售 / BU 承担对应角色，负责项目的测试发起。</li>\n<li>POC 负责人：项目测试的负责人，根据项目重要程度而确定，小项目一般为销售；负责项目的测试物料筹备、测试方案梳理，完成测试汇报；</li>\n<li>资产管理员：区域自行设定，一般为测试设备管理员，由区域助理兼职；负责测试设备的调拨，测试设备入库；</li>\n<li>技服主管（组长）/ 渠道经理专员：项目审核员，主要审核项目物料、需求和方案把控，协助测试工程师保障测试效果，确保测试结果达到客户预期，同时也负责测试异常升级管理；</li>\n<li>服务中心工程师：上门测试工程师，负责测试项目现场测试、测试跟进、测试结果保障、输出测试结果。</li>\n</ul>\n<p>9，POC 流程执行阶段详细说明：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIwuM4.png\" alt=\"T\"></li>\n</ul>\n<p>10，POC 风险项目管理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，・定义</li>\n<li>POC 风险项目，即影响 POC 测试的最终效果达成的项目。</li>\n<li>2，・分类</li>\n<li>技术风险：技术认可存在无法满足客户需求的技术障碍（功能和性能)，和专家研发确认无法满足；</li>\n<li>商务风险：技术认可感知客户明确表达的诉求或客户故意刁难无法满足的情况；</li>\n<li>竞争对手风险：技术认可过程中，识别客户侧存在竞争对手相同功能产品或有代理商引道其他竞争对手品牌介入的情况；</li>\n<li>3，・管理原则</li>\n<li>1. 先进行风险预判，判断确认风险类型；</li>\n<li>2. 立即进行风险上报（一般情况下识别风险后，10 分钟内），上报至技术组长、POC 负责人；</li>\n<li>3. 进行风险处置方案沟通确认，同 POC 负责人沟通明确风险处置方案，并进行处置方案实施；</li>\n<li>4. 风险归档记录说明，明确风险类型，客户侧反应，风险处置方案，下一步计划）；</li>\n</ul>\n<p>11，PRM 系统：整体模块。</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI0rnJ.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI0X38.png\" alt=\"T\"></li>\n</ul>\n<p>12，返修流程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIDxTs.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"prm系统使用流程指导\"><a class=\"anchor\" href=\"#prm系统使用流程指导\">#</a> PRM 系统使用流程指导</h1>\n<p>1、登录公司层级 PRM 账号:</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>每个合作伙伴公司均具有用于商务报备的 PRM 系统账号，该账号将用于创建具体执行的【技术主管】、【工程师】的账号。</li>\n</ul>\n<p>2，创建角色、创建账号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1QUk12cG4tZGcyajk2cDlsbjR2cHA3M2RzZndhNGwzYXd0Z2RxYXk5bjk5OGIyOWQuc2FuZ2Zvci5jb20uY24=\">外网登录该 PRM 账号需要先访问 vpn.sangfor.com.cn</span>, 账号和密码与 PRM 账号相同，无需绑定硬件特征码。后续创建账号和密码登录方式相同。</li>\n</ul>\n<h1 id=\"渠道技术工程师工作规范交付规范\"><a class=\"anchor\" href=\"#渠道技术工程师工作规范交付规范\">#</a> 渠道技术工程师工作规范 —— 交付规范</h1>\n<p>1，目的：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>渠道伙伴价值交付的目的是全面细致的了解客户需求，并用产品满足客户需求，并获得客户认可。</li>\n</ul>\n<p>2，适用范围：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>适用对象：渠道伙伴项目经理、工程师。</li>\n<li>适用项目：新产品交付、售后服务。</li>\n</ul>\n<p>3，交付流程和规范：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>所交付项目均需按价值交付的方法开展工作，即四个阶段，需求调研、方案设计、现场交付和效果确认阶段。</li>\n</ul>\n<p>4，人员分配：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>人员方面一般有两个角色，一是项目经理，负责该项目需求调研和方案设计阶段，二是交付工程师，负责现场交付和效果确认。两个角色可以是一个人。</li>\n</ul>\n<h1 id=\"渠道技术工程师工作规范售后服务规范\"><a class=\"anchor\" href=\"#渠道技术工程师工作规范售后服务规范\">#</a> 渠道技术工程师工作规范 —— 售后服务规范</h1>\n<p>1，目的：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>规范技术服务工程师的服务过程和操作规范，保证技术支持工作的高质量、高效率。</li>\n</ul>\n<p>2，适用范围：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1、所有售后解决问题类均需遵照该指导书要求；</li>\n<li>2、适用于现场、远程等全部服务方式；</li>\n</ul>\n<h1 id=\"渠道技术工程师工作规范行为规范\"><a class=\"anchor\" href=\"#渠道技术工程师工作规范行为规范\">#</a> 渠道技术工程师工作规范 —— 行为规范</h1>\n<p>1，精神风貌：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>a、仪表举止端庄、落落大方，不矫揉造作、不轻浮放肆。</li>\n<li>b、衣着整洁、大方，禁止穿休闲衫、短裤、凉鞋进入用户现场。</li>\n<li>c、保持愉快、自信的工作心态，不将个人情绪带到工作之中。</li>\n<li>d、保持良好的坐、立、行习惯，不过于拘谨，禁忌散漫。</li>\n</ul>\n<h1 id=\"补充\"><a class=\"anchor\" href=\"#补充\">#</a> 补充</h1>\n<h2 id=\"1下一代防火墙ngaf组网简介\"><a class=\"anchor\" href=\"#1下一代防火墙ngaf组网简介\">#</a> 1. 下一代防火墙（NGAF）组网简介</h2>\n<h3 id=\"11部署模式简介\"><a class=\"anchor\" href=\"#11部署模式简介\">#</a> 1.1 部署模式简介</h3>\n<p>1，支持：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>路由模式：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI4Uld.png\" alt=\"T\"></li>\n<li>透明模式 / 虚拟网线模式：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI4gpQ.png\" alt=\"T\"></li>\n<li>混合模式：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI5VBt.png\" alt=\"T\"></li>\n<li>旁路模式：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RI5dCF.png\" alt=\"T\"></li>\n</ul>\n<h3 id=\"12ngaf接口类型\"><a class=\"anchor\" href=\"#12ngaf接口类型\">#</a> 1.2NGAF 接口类型：</h3>\n<p>1，分类：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIo9QH.png\" alt=\"T\"></li>\n</ul>\n<h4 id=\"121根据接口属性分类\"><a class=\"anchor\" href=\"#121根据接口属性分类\">#</a> 1.2.1 根据接口属性分类</h4>\n<p>1，物理接口</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>物理接口与 NGAF 设备面板上的接口一一对应（eth0 为 manage 口），根据网口数据转发特性的不同，可选择路由、透明、虚拟网线和旁路镜像 4 种类型，前三种接口又可设置 WAN 或非 WAN 属性。</li>\n<li>注：物理接口无法删除或新增，物理接口的数目由硬件型号决定。</li>\n</ul>\n<p>1.1 路由口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>如果设置为路由接口，则需要给 该接口配置 IP 地址，且该接口具 有路由转发功能。</li>\n<li>注：实时检测接口的链路状态，以及多条外网线路情况下，某条线路故障，流量自动切换到其他线路，均需开启链路故障检测，WAN 属性的接口必须开启链路故障检测功能。</li>\n</ul>\n<p>1.2 管理口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>Eth0 为固定的管理口，接口类型为路由口，且无法修改。Eth0 可增加管理 IP 地址，默认的管理 IP 10.251.251.251/24 无法删除。</li>\n</ul>\n<p>1.3 透明口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>透明接口：透明接口相当于普通的交换网口， 不需要配置 IP 地址，不支持路由转发，根据 MAC 地址表转发数据。</li>\n<li>注：部分功能要求接口是 WAN 属性，当接口设置成透明 WAN 口时，注意设备上架时接线方向，内外网网口接反会导致部分功能失效。</li>\n</ul>\n<p>1.4 虚拟网线接口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>虚拟网线接口： 虚拟网线接口也是普通的交换接口，不需要配置 IP 地址，不支持路由转发，转发数据时，无需检查 MAC 表，直接从虚拟网线配对的接口转发。</li>\n<li>注：虚拟网线接口的转发性能高于透明接口，单进单出网桥的环境下 ，推荐使用虚拟网线接口部署。</li>\n</ul>\n<p>2，子接口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>子接口： 子接口应用于路由接口需要启用 VLAN 或 TRUNK 的场景。</li>\n<li>子接口是逻辑接口，只能在路由口下添加子接口。 子接口的下一跳网关和链路故障检测根据实际环境进行配置。</li>\n</ul>\n<p>3，VLAN 接口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>VLAN 接口： 为 VLAN 定义 IP 地址，则会产生 VLAN 接口。VLAN 接口也是逻辑接口。</li>\n<li>注：VLAN 接口的下一跳网关和链路故障检测根据实际环境进行配置。</li>\n</ul>\n<p>4，聚合端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>将多个以太网接口捆绑在一起所形成的逻辑接口，创建的聚合接口成为一个逻辑接口，而不是底层的物理接口。</li>\n</ul>\n<p>5，接口设置注意事项：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1. 设备支持配置多个 WAN 属性的路由接口连接多条外网线路，但是需要开通多条线路的授权。</li>\n<li>2. 管理口不支持设置成透明接口或虚拟网线接口，如果要设置 2 对或 2 对以上的虚拟网线接口，则必须要求设备不少于 5 个物理接口，预留一个专门的管理口 Eth0。</li>\n<li>3. 一个路由接口下可添加多个子接口，路由接口的 IP 地址不能与子接口的 IP 地址在同网段。</li>\n</ul>\n<h4 id=\"122根据接口区域分类\"><a class=\"anchor\" href=\"#122根据接口区域分类\">#</a> 1.2.2 根据接口区域分类</h4>\n<p>1，定义：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>区域： 用于定义和归类接口，以供防火墙、内容安全、服务器保护等模块调用。</li>\n<li>注：定义区域时，需根据控制的需求来规划，可以将一个接口划分到一个区域，或将几个相同需求的接口划分到同一个区域。一个接口只能属于一个区域。</li>\n</ul>\n<h2 id=\"2下一代防火墙组网方案\"><a class=\"anchor\" href=\"#2下一代防火墙组网方案\">#</a> 2, 下一代防火墙组网方案</h2>\n<h3 id=\"21路由模式组网\"><a class=\"anchor\" href=\"#21路由模式组网\">#</a> 2.1 路由模式组网</h3>\n<p>1，如图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIvu59.png\" alt=\"T\"></li>\n</ul>\n<p>2，配置思路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>1、配置接口地址，并定义接口对应的区域：</p>\n</li>\n<li>\n<p>在【网络配置】－【接口 / 区域】－【物理接口】中，选择接口，并配置接口类型、所属区域、基本属性、IP 地址。</p>\n</li>\n<li>\n<p>2、配置路由：</p>\n</li>\n<li>\n<p>在【网络配置】－【路由】中，新增静态路由，配置默认路由或回程路由。</p>\n</li>\n<li>\n<p>3、配置代理上网：</p>\n</li>\n<li>\n<p>在【防火墙】-【地址转换】中，新增源地址转换。</p>\n</li>\n<li>\n<p>4、配置应用控制策略，放通内网用户上网权限：</p>\n</li>\n<li>\n<p>在【内容安全】-【应用控制策略】中，新增应用控制策略，放通内到外的数据访问权限。</p>\n</li>\n<li>\n<p>5、配置安全防护策略： 如：僵尸网络、IPS、DOS 等防护策略。</p>\n</li>\n</ul>\n<h3 id=\"22单臂路由模式组网\"><a class=\"anchor\" href=\"#22单臂路由模式组网\">#</a> 2.2 单臂路由模式组网</h3>\n<p>1，单臂路由概述：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>单臂路由是指在路由器的一个接口上通过配置子接口（逻辑接口，并不存在真正物理接口）的方式，实现原来相互隔离的不同 VLAN（虚拟局域网） 之间的互联互通。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIxpqO.png\" alt=\"T\"></li>\n</ul>\n<p>2，配置思路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1、配置接口地址，并定义接口对应的区域：</li>\n<li>在【网络配置】－【接口 / 区域】－【子接口】中，设置对应子接口，选择 VLAN ID，并配置接口类型、所属区域、基本属性、IP 地址。</li>\n<li>2、配置路由：</li>\n<li>在【网络配置】－【路由】中，新增静态路由，配置默认路由或回程路由。</li>\n<li>3、配置代理上网：</li>\n<li>在【防火墙】-【地址转换】中，新增源地址转换。</li>\n<li>4、配置应用控制策略，放通内网用户上网权限：</li>\n<li>在【内容安全】-【应用控制策略】中，新增应用控制策略，放通内到外的 数据访问权限。</li>\n<li>5、配置安全防护策略：</li>\n<li>如：僵尸网络、IPS、DOS 等防护策略。</li>\n</ul>\n<h3 id=\"路由模式总结\"><a class=\"anchor\" href=\"#路由模式总结\">#</a> 路由模式总结</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1. 在此组网方式时，防火墙位于内部网络和外部网络之间，负责在内部网络、外部网络中进行路由寻址，相当于路由器。其与内部网络、外部网络相连的上下行业务接口均工作在三层，需要分别配置不同网段的 IP 地 址。</li>\n<li>2. 此组网方式支持更多的安全特性，如 NAT、策略路由选择，动态路由协议（OSPF、BGP、RIP 等）等。</li>\n<li>3. 需要修改原网络拓扑，对现有环境改动较大。</li>\n<li>4. 一般替换出口路由器或老防火墙。</li>\n</ul>\n<h3 id=\"23透明模式组网\"><a class=\"anchor\" href=\"#23透明模式组网\">#</a> 2.3 透明模式组网</h3>\n<p>1，需求背景：</p>\n<ul>\n<li>部署一台 NGAF 设备进行安全防护，但是又不改动现有的网络环境。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RIzu11.png\" alt=\"T\"></li>\n</ul>\n<p>2，配置思路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>１、配置接口地址，并定义接口对应的区域:</li>\n<li>在【网络配置】－【接口 / 区域】－【物理接口】中，选择接口，并配置 接口类型、所属区域、基本属性、IP 地址。</li>\n<li>2、配置管理接口：</li>\n<li>在【网络配置】中，新增管理接口，并分配管理地址。</li>\n<li>3、配置路由：</li>\n<li>在【网络配置】－【路由】中，新增静态路由，配置默认路由。</li>\n<li>4、配置应用控制策略，放通内网用户上网权限：</li>\n<li>在【内容安全】-【应用控制策略】中，新增应用控制策略，放通内到外 的数据访问权限。</li>\n<li>5、配置安全防护策略：</li>\n<li>如：僵尸网络、IPS、DOS 等防护策略。</li>\n</ul>\n<h3 id=\"24虚拟网线部署\"><a class=\"anchor\" href=\"#24虚拟网线部署\">#</a> 2.4 虚拟网线部署</h3>\n<p>1，前提：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>透明部署 NGAF 设备，要求 eth1 和 eth3 这对网口，与 eth2 和 eth4 这对网口二层隔 离，即从 eth1 口进入的数据必须从 eth3 口转发，eth2 口进入的数据必须从 eth4 口 转发。<br>\n2，与透明部署的区别：</li>\n</ul>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>透明部署中另外一种特殊情况：虚拟网线部署</li>\n<li>1, 和透明部署一样，接口也是二层接口，但是被定义成虚拟网线接口。</li>\n<li>2, 虚拟网络接口是成对存在的，转发数据时，无需检查 MAC 表，直接从虚拟网线配对的接口转发。</li>\n<li>3, 虚拟网线接口的转发性能高于透明接口，单进单出网桥的环境下，推荐使用虚拟网线接口部署。</li>\n</ul>\n<h3 id=\"25混合模式部署\"><a class=\"anchor\" href=\"#25混合模式部署\">#</a> 2.5 混合模式部署</h3>\n<p>1，需求背景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RoPtyR.png\" alt=\"T\"></li>\n<li>某用户内网有服务器群，服务器均配置公网 IP 地址，提供所有用户直接 通过公网 IP 地址接入访问。内网用户使用私有地址，通过 NAT 转换上网。希望将 NGAF 设备部署在公网出口的位置，保护服务器群和内网上 网数据的安全。</li>\n<li>部署方式推荐： 使用混合模式部署，NGAF 设备连接公网和服务器群的 2 个接口使用透明 access 口， 连接内网网段使用路由接口。</li>\n</ul>\n<p>2，混合模式部署分析：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1, 由于服务器均有公网 IP 地址，所以 NGAF 设备连接公网线路的接口 eth1 与连 接服务器群接口 eth2 使用透明 access 接口，并设置相同的 VLAN ID。即可实 现所有用户通过公网 IP 直接访问到服务器群。</li>\n<li>2, 新增 VLAN1 接口，分配一个公网 IP 地址，划入区域为外网区域。</li>\n<li>3,AF 设备与内网相连的接口 eth3 使用路由接口，设置与内网交换机同网段的 IP 地址，并设置静态路由与内网通信。</li>\n<li>4, 内网用户上网时，转换源 IP 地址为 VLAN1 接口的 IP 地址。根据需求，划分 为一个二层区域选择网口 eth1 和 eth2；划分两个三层区域，其中 “外网区域” 选择 VLAN 接口 vlan1；“内网区域” 选择接口 eth3。</li>\n</ul>\n<h3 id=\"旁路模式部署\"><a class=\"anchor\" href=\"#旁路模式部署\">#</a> 旁路模式部署</h3>\n<p>1，需求背景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1, 使用 NGAF 来实现内网防护和对内网防护数据进行分析，但是不能改动已有的环境。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RoPNO1.png\" alt=\"T\"></li>\n</ul>\n<p>2，配置思路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1、配置镜像接口，定义接口对应的区域，并配置流量监听网络对象：</li>\n<li>在【网络配置】－【接口 / 区域】－【物理接口】中，选择接口，并配置 接口类型、所属区域、旁路流量统计网络对象。</li>\n<li>2、配置管理接口：</li>\n<li>在【网络配置】－【接口区域】－【物理接口】中，选择接口。</li>\n<li>3、启用旁路 reset 功能：</li>\n<li>在【系统】-【系统配置】-【网络参数】中，勾选【旁路 reset】。</li>\n<li>4、配置安全防护策略：</li>\n<li>如：僵尸网络、IPS、DOS 等防护策略</li>\n</ul>\n<p>3，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>设备旁挂在现有的网络设备上，不影响现有的网络结构，通过端口镜像技术把流量镜像到下一代防火墙，实现对数据的分析和处理。</li>\n<li>➢ 需要另外设置接口才能对设备进行管理。</li>\n<li>➢ 启用管理口 reset 功能。</li>\n</ul>\n<h2 id=\"策略路由解决方案\"><a class=\"anchor\" href=\"#策略路由解决方案\">#</a> 策略路由解决方案</h2>\n<h3 id=\"策略路由\"><a class=\"anchor\" href=\"#策略路由\">#</a> 策略路由</h3>\n<p>1，需求背景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>网络环境如下图，公网出口两条线路：电信线路和专线。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/06/RoFQGF.png\" alt=\"T\"></li>\n<li>客户需求：</li>\n<li>1、内网用户访问教育网资源必须通过专线才能访问到。</li>\n<li>2、内网所有用户访问网上银行 TCP 443 端口的数据全部走 10M 电信线路。</li>\n<li>3、内网所有 P2P 应用走 10M 电信。</li>\n<li>4、内网用户访问公网时按照带宽比例 自动选择线路。</li>\n<li>5、访问教育网的所有资源均走专线。</li>\n</ul>\n<p>2，策略路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>策略路由是路由中的一种。</li>\n<li>静态路由的匹配条件相对较少：匹配目的 IP、子网掩码与下一跳网关。</li>\n<li>策略路由可以弥补静态路由的不足，匹配条件会灵活很多，根据相应策略来匹配 ：匹配源、目的、协议、出口在外网多条线路情况下，建议配置策略路由。</li>\n</ul>\n<p>3，策略路由分为：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1. 源地址策略路由 —— 可指定内网哪些 IP 走指定线路出公网</li>\n<li>2. 多线路负载路由 —— 可指定多条线路进行负载选路</li>\n</ul>\n<p>4，配置思路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1、接口和区域设置和路由部署一致，但接口要开启链路状态检测。</li>\n<li>2、代理上网和应用控制策略配置和路由部署一致。</li>\n<li>3、策略路由配置：在【系统管理】-【网络配置】-【路由设置】-【策略路由】中，</li>\n<li>3.1、添加源地址策略路由，来自于 “内网区域”，目标 ISP 为教育网，目标端口为 TCP 443 的数据，填写下一跳地址为 192.168.1.2。</li>\n<li>3.2、添加源地址策略路由，来自于 “内网区域”，目标 IP 选择全部，目标端口为 TCP443 的数据，选择接口 eth2。</li>\n<li>3.3、添加源地址策略路由，来自于 “内网区域”，目标 ISP 为教育网，填写下一跳地址为 192.168.1.2。</li>\n<li>3.4、添加源地址策略路由，来自于 “内网区域”，属于 P2P 应用的选择接口 eth2。</li>\n<li>3.5、添加多线路负载路由，来自于 “内网区域”，目标 IP 选择全部，选择接口 eth1 和 eth2，接口选择策略为带宽比例。</li>\n<li>注：还需要添加一条静态路由，下一跳指向 eth2 接口的网关。目的是为了确保策略路由失效的情况下用户还可以通过默认的静态路由访问公网。</li>\n</ul>\n<p>5，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>注意事项：</li>\n<li>1. 路由优先级：VPN 路由 &gt; 静态路由 &gt; 策略路由 &gt; 默认路由。</li>\n<li>2. 每一条外网线路必须至少有一条策略路由与之对应，源地址策略路由或多线路负载路由均可。</li>\n<li>3. 源地址策略路由，通过直接填写路由的下一跳，可以实现从设备非 WAN 属性的接口转发数据。</li>\n<li>4. 多线路负载路由选择的接口，必须开启链路故障检测功能，才能实现线路故障自动切换。</li>\n<li>5. 多条策略路由，按照从上往下的顺序匹配，一旦匹配到某条策略路由后，不再往下匹配。</li>\n</ul>\n<h1 id=\"2021-07-07\"><a class=\"anchor\" href=\"#2021-07-07\">#</a> 2021-07-07</h1>\n<h1 id=\"合作伙伴-l2学习地图-安全方向\"><a class=\"anchor\" href=\"#合作伙伴-l2学习地图-安全方向\">#</a> 合作伙伴 - L2 学习地图 - 安全方向</h1>\n<h2 id=\"安全威胁和挑战\"><a class=\"anchor\" href=\"#安全威胁和挑战\">#</a> 安全威胁和挑战</h2>\n<p>1，威胁网络安全的主要因素：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>系统漏洞和应用软件漏洞难以避免</li>\n<li>网络的开放性</li>\n<li>网络管理制度存在缺失</li>\n<li>网络对应安全策略缺乏</li>\n</ul>\n<h2 id=\"安全发展趋势\"><a class=\"anchor\" href=\"#安全发展趋势\">#</a> 安全发展趋势</h2>\n<p>1，信息安全发展的四个阶段：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1，通信保密阶段</li>\n<li>2，计算机安全阶段</li>\n<li>3，信息技术安全阶段</li>\n<li>4，信息保障阶段</li>\n</ul>\n<p>2，智安全能力模型 - APDRO</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>智能</li>\n<li>防御</li>\n<li>检测</li>\n<li>响应</li>\n<li>运营</li>\n<li>PDR：从防御能力向检测和响应能力增强。</li>\n<li>智能：提升自动化能力应对大量未知威胁。</li>\n<li>运营：让安全产品用起来，管理制度落地。</li>\n</ul>\n<h2 id=\"接入认证概述\"><a class=\"anchor\" href=\"#接入认证概述\">#</a> 接入认证概述</h2>\n<p>1，为什么上网 / 访问业务需要用户认证？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，身份风险：</li>\n<li>非法 “用户” 和 “终端” 采用非法方式接入网络。</li>\n</ul>\n<p>2，深信服产品支持认证详解：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RH9ZRg.png\" alt=\"T\"></li>\n</ul>\n<h2 id=\"接入认证技术及配置\"><a class=\"anchor\" href=\"#接入认证技术及配置\">#</a> 接入认证技术及配置</h2>\n<h3 id=\"ldap高级认证技术及配置\"><a class=\"anchor\" href=\"#ldap高级认证技术及配置\">#</a> LDAP 高级认证技术及配置</h3>\n<p>1，认识 LDAP 服务器：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，LDAP 是轻量目录访问协议，以树状的层次结构来储存数据。</li>\n<li>2，LDAP 认证即用户的账号密码信息保存在第三方 LDAP 服务器上，AC 将用户提交的用户名密码信息转给 LDAP 服务器校验，通过服务器返回的认证成功与否信息，决定用户是否通过 AC/SG 的认证。</li>\n<li>问：LDAP 的校验是在第三方服务器还是 AC 上？</li>\n</ul>\n<p>2，LDAP 中的基本概念：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，Entry：条目，也叫记录项，是 LDAP 中最基本的颗粒。</li>\n<li>2，Ou：组织单元。</li>\n<li>3，Cn：名称。</li>\n<li>4，Dn：每一个条目都有一个唯一的标签名，通过 Dn 可以方便地表示出条目在 LDAP 服务器中的位置，通过用于检索。</li>\n<li>5，Base Dn：LDAP 目录树的最顶端就根，也就是所谓的 Base Dn。</li>\n<li>6，Attribute：每个条目 (entry) 都可以有很多属性（Attribute），比如常见的人都有姓名，地址等属性，每个属性都有名称及对应的值，属性值可以有单个，多个。</li>\n<li>7，安全组：可以理解为具有同一类权限的一组用户，可以把用户加入到安全组中，那么这个用户就具有对应安全组的权限。</li>\n<li>8，安全组就是把权限与用户做关联。</li>\n</ul>\n<h3 id=\"radius协议介绍\"><a class=\"anchor\" href=\"#radius协议介绍\">#</a> RADIUS 协议介绍</h3>\n<p>1，协议介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1， 远程用户拨号认证系统，是目前应用最广泛的 AAA 协议。</li>\n<li>2，一种 C/S 结构协议，它的客户端最初就是 NAS 服务器，任何运行 RAIUS 客户端软件的计算机都可以成为 RADIUS 的客户端，RADIUS 协议认证机制灵活，可以采用 PAP，CHAP 或者 Unix 登录认证等多种方式。</li>\n<li>3，AC/SG 和 VPN 的外部 RADIUS 认证过程，AC/SG 和 VPN 是作为 NAS 服务器，也就是客户端角色，同时，从 11.8 开始 AC/SG 也可作为服务器角色，结合无线控制做免认证和准入模式下结合交换机做 802.1X 认证收取 redius 计费报文实现用户上线。</li>\n</ul>\n<p>2，RADIUS 认证交互过程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，用户输入用户名和口令</li>\n<li>2，redius 客户端（NAS）根据获取的用户名和口令，向 radius 服务器发送认证请求包 (access-request)</li>\n<li>3，radius 服务器将该用户信息与 users 数据库信息进行对比分析，如果认证成功，则将用户的权限信息以认证响应包（access-accept）发送给 redius 客户端，如果认证失败，则返回 access-reject 响应包。</li>\n</ul>\n<p>3，RADIUS 认证常用端口：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>UDP1812 (认证)，UDP1813 (计费)。</li>\n</ul>\n<p>4，RADIUS 报文格式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>Code: 一个字节，用于区分 RADIUS 包的类型：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHK0iQ.png\" alt=\"T\"></li>\n<li>常用类型有：</li>\n<li>接入请求 (Access-Request),Code=1;</li>\n<li>接入允许 (Access-Accept),Code=2;</li>\n<li>接入拒绝 (Access-Reject),Code=3;</li>\n<li>计费请求 (Accounting-Request),Code=4;</li>\n</ul>\n<p>5，CLASS 分组交互过程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHGIA0.png\" alt=\"T\"></li>\n</ul>\n<h4 id=\"外部认证radius认证流程pap认证协议\"><a class=\"anchor\" href=\"#外部认证radius认证流程pap认证协议\">#</a> 外部认证 RADIUS 认证流程 ——PAP 认证协议</h4>\n<p>1，远端（RADIUS）验证 ——PAP 方式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>密码验证协议 PAP 是认证协议的一种。</li>\n<li>具体过程：</li>\n<li>1，当用户把用户名密码传给 RADIUS 客户端（AC/SG 设备）；</li>\n<li>2，然后，RADIUS 客户端（AC/SG 设备）会把用户名密码发给 RADIUS 服务器，RADIUS 服务器通过用户名去数据库查询出密码。</li>\n<li>3，最后 RADIUS 服务器进行验证，如果一致就通过验证，如果不一致就验证失败。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHJ3uj.png\" alt=\"T\"></li>\n</ul>\n<h4 id=\"外部认证radius认证流程chap认证协议\"><a class=\"anchor\" href=\"#外部认证radius认证流程chap认证协议\">#</a> 外部认证 RADIUS 认证流程 ——CHAP 认证协议</h4>\n<p>1，远端（RADIUS）验证 ——CHAP 方式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>CHAP 是查询握手验证协议的简称。</li>\n<li>具体过程：</li>\n<li>1，当用户把用户名密码传给我们设备之后，我们的设备首先会生成一个 16 字节的 Chap-challenge，同时，生成一个 1-256 的随机数。</li>\n<li>2，然后，我们的设备会对 Chap-challenge，随机数，password 做一个 MD5，并且将 Chap-Challenge，随机数，用户名以及 MD5 的结果一起传给 RADIUS 服务器。</li>\n<li>3，RADIUS 服务器通过用户名去数据库查询出密码，最后 RADIUS 服务器会用 Chap-challenge，随机数以及 password 算出一个 MD5，与从我们设备传过来的进行比较，如果一致则验证通过，否则，验证失败。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHYPI0.png\" alt=\"T\"></li>\n</ul>\n<h3 id=\"ad域单点登录\"><a class=\"anchor\" href=\"#ad域单点登录\">#</a> AD 域单点登录</h3>\n<p>1，AD 域单点登录背景：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，域单点登录适用于客户内网已知一台域控制器做管理，部署 AC/SG 设备后，用户开机登录域即自动通过 AC/SG 以域用户身份直接上网，并终端的上网日志可以追溯到具体域用户。</li>\n<li>域单点登录有：脚本方式，免插件，IWA 方式，监听方式。</li>\n<li>只有微软的 AD 域才支持这四种。</li>\n</ul>\n<p>2，AD 域单点登录总结：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHUARf.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"2021-07-07-2\"><a class=\"anchor\" href=\"#2021-07-07-2\">#</a> 2021-07-07</h1>\n<h3 id=\"城市热点单点登录\"><a class=\"anchor\" href=\"#城市热点单点登录\">#</a> 城市热点单点登录</h3>\n<p>1，城市热点：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，作用：</li>\n<li>认证计费</li>\n<li>2，工作过程：</li>\n<li>城市热点主动把认证信息 (默认 udp61440 携带用户名和 IP) 传递到 AC 上，AC 获取这些用户信息，实现用户的单点登录。</li>\n</ul>\n<h3 id=\"portal协议介绍\"><a class=\"anchor\" href=\"#portal协议介绍\">#</a> Portal 协议介绍</h3>\n<p>1，Portal 协议的起源：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>Portal--&gt; 入口，Portal 认证也称为 Web 认证，一般将 Portal 认证网站称为门户网站。</li>\n<li>基本思想：</li>\n<li>未认证用户上网时，设备强制用户登录到特定站点，用户可以免费访问其中的服务。</li>\n<li>当用户需要使用互联网中的其他信息时，必须在门户网站进行认证，只有认证通过之后才能使用互联网资源。</li>\n<li>认证方式：</li>\n<li>微信认证，短信认证，访客认证，二维码认证，账号密码认证等。</li>\n</ul>\n<p>2，Portal 认证与 802.1x 认证的比较。</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，优势：</li>\n<li>支持网页方式认证，免客户端安装。</li>\n<li>部署方式灵活，快捷，适合旧网改造</li>\n<li>2，不足：</li>\n<li>没有 802.1x 认证对客户端的严格控制。</li>\n</ul>\n<h3 id=\"oauth认证及技术\"><a class=\"anchor\" href=\"#oauth认证及技术\">#</a> Oauth 认证及技术</h3>\n<p>1，定义：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>OAuth (开放授权) 是一个开放的授权标准，允许用户让第三方应用访问该用户在某一 web 服务上储存的私密的资源 (照片，视频等)，而无需将用户名密码提供给第三方应用。</li>\n<li>OAuth 允许用户提供一个令牌 (token)，而不是用户名和密码来访问他们存放在特定服务者的数据，每一个令牌授权一个特定的第三方系统。</li>\n<li>在特定的时间内访问特定的资源。</li>\n<li>这样，OAuth 让用户可以授权第三方网站访问他们储存在另外服务提供者的某些特定信息，而非所有内容。</li>\n</ul>\n<p>2，OAuth2.0 的流程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/08/RLN7N9.png\" alt=\"T\"></li>\n</ul>\n<h3 id=\"动态令牌概述\"><a class=\"anchor\" href=\"#动态令牌概述\">#</a> 动态令牌概述</h3>\n<p>1，动态口令：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>概述：</li>\n<li>动态口令是根据专门的算法生成一个不可预测的随机数字组合，一个密码使用一次有效，目前被广泛运用在网银，网游，电信运营商，电子商务，企业等运用领域。</li>\n<li>动态口令是一种安全便捷的账号防盗技术，可以有效保护交易和登录的认证安全，采用动态口令就无需定期修改密码，安全省心。</li>\n<li>动态令牌即是用来生成动态口令的终端，分为硬件动态令牌和软件动态令牌。</li>\n</ul>\n<p>2，动态令牌分类：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，从技术来分有三种形式：</li>\n<li>时间同步</li>\n<li>事件同步</li>\n<li>挑战 / 应答</li>\n<li>1》时间同步：</li>\n<li>原理是基于动态令牌和动态口令验证服务器的时间比对，基于时间同步的令牌，一般每 60 秒产生一个新口令，要求服务器能十分精确的保持正确的时钟，同时对其令牌的晶振频率有严格的要求，这种技术对应的终端是硬件令牌。</li>\n<li>2》事件同步：</li>\n<li>基于事件同步的令牌，其原理是通过某一特定的事件次序及相同的种子值作为输入，通过 HASH 算法中运算出一致的密码。</li>\n<li>3》挑战 / 应答：</li>\n<li>常用于网上业务，在网站 / 应答上输入服务端下发的挑战码，动态令牌输入该挑战码，通过内置的算法生成一个 6/8 位的随机数字，口令一次有效，这种技术目前应用最为普遍，包括刮刮卡，短信密码，动态令牌也有挑战 / 应答形式。</li>\n</ul>\n<p>3，动态令牌认证流程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>用户向 SSL VPN 设备发起接入请求。</li>\n<li>SSL VPN 向用户提出用户名密码认证。</li>\n<li>用户提交用户名密码完成第一项认证。</li>\n<li>SSL VPN 向用户提出动态令牌认证请求。</li>\n<li>用户根据动态令牌 6 位随机码提交验证码。</li>\n<li>SSL VPN 将用户名及验证码以标准 Raius 包封装提交给动态令牌服务器 (Radius) 进行验证。</li>\n<li>动态令牌服务器根据用户名查找到该令牌关联的验证码库，基于时间验证机制进行验证码校验，并完成令牌数据库的该用户时间校验 (若为采用基于事件验证的令牌，则根据验证码的漂移进行种子校验)。</li>\n<li>动态令牌服务器根据标准 Radius 协议将验证结果返回给 SSL VPN 设备。</li>\n<li>SSL VPN 设备根据验证结果允许 / 拒绝用户的 SSL VPN 接入。</li>\n</ul>\n<h3 id=\"匿名认证\"><a class=\"anchor\" href=\"#匿名认证\">#</a> 匿名认证</h3>\n<p>1，功能简介：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，不经过任何认证步骤即可登录。</li>\n<li>2，场景：</li>\n<li>简化登录过程。</li>\n<li>安全性要求低。</li>\n</ul>\n<h3 id=\"8021x接入认证技术\"><a class=\"anchor\" href=\"#8021x接入认证技术\">#</a> 802.1X 接入认证技术</h3>\n<p>1，准入概念澄清：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，业界准入定义：</li>\n<li>边界的入网管控 + 入网终端的管控</li>\n<li>2，深信服准入：</li>\n<li>AC13.0.X 版本主推的功能，主要功能包括接入认证 (802.1x 认证，旁路重定向认证和 Portal 认证方式)，终端检测和管控功能，外设管控和终端识别等准入功能，支持路由，网桥，旁路模式部署实现上述准入功能。</li>\n<li>3，与准入策略的区别：</li>\n<li>准入策略目前更名为终端检查策略，实现终端管控功能，属于准入功能的一部分。</li>\n</ul>\n<p>2，准入功能产生背景和功能说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，补齐内网安全功能。</li>\n<li>2，全网行为管理 AC=AC 原有功能 + 认证中心功能 + 准入功能 (入网认证 + 终端检查 + 内网权限控制)</li>\n</ul>\n<p>3，AC 新增 802.1x 功能背景介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>AC 一般放在出口位置，只能对访问外网的用户做认证和管控，内网这些终端设备无法管控，没有经过可信认证就可以随便接入内网，准入新增 802.1x 功能即是在这种背景下产生的，结合终端管控和外设管控等功能，一起补齐 AC 在内网安全这块的短板。</li>\n</ul>\n<p>4，802.1X 认证与\tPortal 认证对比：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/08/RLIShR.png\" alt=\"T\"></li>\n</ul>\n<p>5，802.1X 协议介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，802.1x 认证，又称为 EAPOE 认证，主要目的是为了解决局域网用户接入认证问题，AC 通过合入开源软件 freeradius 实现 802.1x 功能。</li>\n<li>2，802.1x 认证中用到了 RADIUS 协议认证方式，典型的 C/S 结构。</li>\n<li>3，认证模式：基于接口，基于 MAC</li>\n<li>4，认证方式：EAP 终结，EAP 穿透 (中继)</li>\n<li>注：AC 是使用 EAP 穿透的方式。</li>\n<li>5，端口控制方式：自动识别，强制授权，强制非授权。</li>\n</ul>\n<p>6，802.1x 上线流程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>完成认证之后就放通了端口，但是未在 AC 设备上线，上线过程如下：</li>\n<li>1，认证成功之后，将终端 MAC 地址缓存在设备内存中 5 分钟。</li>\n<li>2，需要获取 IP/MAC 对应关系完成上线。</li>\n<li>计费报文带 IP</li>\n<li>通过镜像获取 DHCP，ARP 广播报文</li>\n<li>跨三层取 MAC 的方式</li>\n</ul>\n<p>7，802.1X 接入认证 - 交换机配置 (信锐交换机)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，配置 Radius 服务器为 AC 地址，设置共享密钥为 123，开启计费和认证功能。</li>\n<li>radius-server key 0 123</li>\n<li>radius-srver authentication host 10.130.250.185 pfimary</li>\n<li>radius-server accounting host 10.130.250.185 primary</li>\n<li>aaa-accounting enable</li>\n<li>aaa enable</li>\n<li>2，开启全局 802.1x 功能</li>\n<li>dot1x enable</li>\n<li>dot1x eapor enable #开启 eap 中继认证方式</li>\n<li>3，接口开启 802.1x 认证</li>\n<li>int e1/0/9</li>\n<li>dot1x enable</li>\n<li>dot1x port-control auto</li>\n<li>dot1x port-method macbased #配置接口基于 MAC 地址的 802.1x 认证。</li>\n</ul>\n<p>8，简单排错：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，准入中交换机状态里面没有显示，交换机对接不了准入。</li>\n<li>排查手段：</li>\n<li>准入后台抓包，tcpdump -i any port 1812 or port 1813 -nnv -s0 -w /tmp/xx.pcap</li>\n<li>2，终端认证出错无法上线：</li>\n<li>排查手段：</li>\n<li>查看进程端口命令：ps-aux|grep freeradius 和 netstat -ano |grep 1812 和 netstat -ano |grep 1813</li>\n<li>日志查看：</li>\n<li>先停掉进程 daemonstop freeradius-server</li>\n<li>开启调试实时查看日志：/ac/module/freeradius-server/sbin/radius -X 退出调试需要重启进程。</li>\n</ul>\n<p>9，注意事项：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，配置 802.1x 认证，用户来源只能是 AC 本地用户或者 AD 域用户。</li>\n<li>2，802.1x 认证基于端口和基于 MAC，建议客户交换机配置为基于 MAC；</li>\n<li>3，802.1X 认证有 eap 中继和 eap 终结方式，AC 的 802.1x 是 eap 中继方式。</li>\n</ul>\n<h1 id=\"2021-07-09\"><a class=\"anchor\" href=\"#2021-07-09\">#</a> 2021-07-09</h1>\n<h3 id=\"oauth认证\"><a class=\"anchor\" href=\"#oauth认证\">#</a> OAuth 认证</h3>\n<p>1，场景分析</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>OAuth 认证，高频使用场景：微信认证。</li>\n<li>随着办公 OA 的普及，用户越来越多期望可以结合办公 OA 完成用户认证，并可以结合办公 OA 的组织结构关联策略。</li>\n<li>深信服上网行为管理内置了 7 种认证方式，并开放第三方 OAuth 认证平台用于满足场景。</li>\n</ul>\n<h3 id=\"网络安全设备概述\"><a class=\"anchor\" href=\"#网络安全设备概述\">#</a> 网络安全设备概述</h3>\n<p>1，安全行业分类：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，安全网安：</li>\n<li>防火墙，网络隔离 (网闸)，入侵检测 / 入侵防御，网络准入 (NAC), 统一威胁管理 (UTM)，抗 DDOS，上网行为管理，WEB 安全网关。</li>\n<li>2，端点安全：</li>\n<li>终端防护 / 防病毒，终端检测与响应。</li>\n<li>3，应用安全：</li>\n<li>代码安全，漏洞扫描，Web 应用扫描与监控，网页防篡改，WEb 应用防火墙，域名安全。</li>\n<li>4，数据安全：</li>\n<li>数据防泄密 / DLP，磁盘加密，容灾备份，文档安全，加密机，数据库安全，大数据安全。</li>\n<li>5，身份与访问安全：</li>\n<li>IAM，堡垒机，数字证书，VPN，身份认证。</li>\n<li>6，内容安全：</li>\n<li>不良信息检测与过滤，舆情监控，邮件安全，反钓鱼。</li>\n<li>7，云安全：</li>\n<li>云抗 D，云 WAF，云身份管理，云基础架构安全，云主机安全。</li>\n</ul>\n<p>2，互联网出口：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，链路负载均衡 (AD)：</li>\n<li>一般负责出口多条线路的出栈，入栈的负载均衡。</li>\n<li>2，下一代防火墙 (AF)：</li>\n<li>对内，外数据交互进行整体安全防护。</li>\n<li>3，流控 / 审计设备 (AC)：</li>\n<li>对内网访问外网数据进行管控，流量整形以及访问行为审计。</li>\n</ul>\n<p>3，对外发布：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，WEB 应用防火墙 (WAF)：</li>\n<li>侧重于网站安全防护，对针对 web 类的攻击进行检测及防护。</li>\n<li>2，潜伏威胁探针 (STA)：</li>\n<li>监控对外发布区域的整体流量情况，对流量进行安全分析，并汇总到 SIP 进行统一分析，展示，处置等。</li>\n<li>3，企业级云 (aCloud)：</li>\n<li>自建私有云平台。</li>\n<li>4，应用交付 (AD)：</li>\n<li>业务发布区域的应用进行负载，保障业务的连续性同时，提供一系列访问优化。</li>\n<li>5，端点安全 (EDR)：</li>\n<li>终端安全管控。</li>\n</ul>\n<p>4，内网办公：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，桌面云 (aDesk)：</li>\n<li>云化的办公终端。</li>\n<li>2，企业级无线 (AP)：</li>\n<li>无线接入终端。</li>\n<li>3，端点安全 (EDR)：</li>\n<li>终端安全管控。</li>\n<li>4，准入认证 (NAC)：</li>\n<li>终端准入，设定终端安全基线，对不符合基线的终端进行通信限制。</li>\n</ul>\n<p>5，移动办公：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，移动安全接入 (SSL)：</li>\n<li>远程办公，运维的安全接入。</li>\n<li>2，远程应用发布 (EC)：</li>\n<li>发布相应的业务到外部，同时可以适应不同的接入终端，包括 PC，手机，PAD 等。</li>\n<li>3，应用安全加固 (EA)：</li>\n<li>对用户自主开发的 APP 进行安全封闭，保障在外部使用的安全性。</li>\n<li>4，办公双域隔离 (EW)：</li>\n<li>对用户的移动终端进行个人域和办公域的隔离，办公域只运行已做安全封装的 APP，保障数据的安全性。</li>\n<li>5，口袋助理 (MOA)：</li>\n<li>企业级办公软件。</li>\n</ul>\n<p>6，数据中心：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，相应的防火墙 (AF)：</li>\n<li>核心区域与外部数据交互的安全管理平台，负责南北向流量的安全建设。</li>\n<li>2，潜伏威胁探针 (STA)：</li>\n<li>监控核心区域的整体流量的情况，对流量进行安全分析，并汇总到 SIP 进行统一分析，展示，处置等。</li>\n<li>3，企业级云 (aCloud)：</li>\n<li>自建私有云平台。</li>\n<li>4，数据库审计 (DAS)：</li>\n<li>审计数据库的相关日志，对风险行为进行分析并预警。</li>\n<li>5，NFV 安全组件 (aSEC)：</li>\n<li>部署在云平台的安全组件，除了外部到云平台的南北向流量进行防护外，东西向流量也支持相应的检测防护。</li>\n<li>6，端口安全 (EDR)：</li>\n<li>终端安全管控。</li>\n</ul>\n<p>7，分支互联：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，下一代防火墙 (AF)：</li>\n<li>分支安全管控平台，一方面管理分支的内，外部数据安全交互，另一方面控制分支与总部间的数据安全交互。</li>\n<li>2，广域网优化 (WOC)：</li>\n<li>建立分支与总部的 IPSEC VPN 安全互联，同时对分支与总部的数据传输进行优化加速。</li>\n<li>3，分支一体机 (aBOS)：</li>\n<li>适用分支端的一体化安全集成平台，包括 VAF，VAC，VSSL，VWOC 等安全组件，快速完成分支的安全建设。</li>\n<li>4，一体化网关 (MIG)：</li>\n<li>主要负责分支与总部的 IPSEC VPN 安全互联。</li>\n</ul>\n<p>8，云 SAAS 服务：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，公有云 / 专属云 (XYclouds)：</li>\n<li>业务云托管。</li>\n<li>2，网站安全检测 (云眼)：</li>\n<li>实时检测网站的风险状态，持续评估，快速预警。</li>\n<li>3，网站安全防护 (云盾)：</li>\n<li>网站访问数据引流到云盾，通过云盾对网站进行实时防护，同时有 7*24 小时专家值守。</li>\n<li>4，云端威胁情报 (云脑)：</li>\n<li>深信服的安全能力中心，可提供包含威胁情报，未知威胁检测在内的多种安全服务。</li>\n<li>5，安全代管服务 (云图)：</li>\n<li>与用户端 AF 协同，实现威胁快速微信预警，同时一键处置的响应方案，同时还提供在线巡检，定制化策略等多项功能。</li>\n<li>6，安全运营中心 (云脑)：</li>\n<li>单一平台上做到对深信服所有的网络设备，端点防护和云安全应用的统一管理和可视化，可以一站式集中展示安全风险，处置和批量管理设备策略。</li>\n</ul>\n<p>9，深信服整体安全加固思路：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，构建一个中心，三种能力，加固三个重点场景的建设思路，</li>\n<li>2，一个中心：安全可视化平台。</li>\n<li>3，三种能力：主动防御，持续检测，快速响应的能力。</li>\n<li>4，三个重点场景：互联网接入区，内外网交换区，内网外联区。</li>\n</ul>\n<p>10，AC/SG 规则库包括：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>应用识别库，URL 规则库，审计规则库，SAVE 引擎模型。</li>\n</ul>\n<p>11，AC/SG 数据流基本走行：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>数据 —— 基础识别 —— 用户认证 —— 应用 / URL 识别 —— 行为识别 —— 防火墙 —— 流量控制 —— 应用审计 —— 流量审计。</li>\n<li>注：无论是测试项目还是交付项目，要求上架前检查规则库是否更新到最新。</li>\n</ul>\n<p>12，UEBA 概述：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，定义：</li>\n<li>UEBA (用户和实体行为分析技术)：目的是根据用户的兴趣及以前的购买和行为来推荐产品。</li>\n<li>2，原理：</li>\n<li>首先，收集网络多个节点产生的信息，例如会从网络设备，系统，应用，数据库和用户处收集数据，进而创建一条基线以确定各种不同情况下的正常状态是什么。</li>\n<li>其次，基准线建立，UEBA 解决方案会跟进聚合数据，寻找被认为是非正常的模式，例如，横向对比发现某些主体的通讯行为和同类主体不一样，或纵向对比发现某些主体和组件过去的行为规律不一样。</li>\n<li>优势：UEBA 解决的，更多的是异常行为而非一般的攻击事件，特别是对于隐蔽的内部攻击和控制内部资产的跳板攻击效果思想。</li>\n<li>目前：SIP，BA，DLA 等产品均用到了 UEBA 技术。</li>\n</ul>\n<h1 id=\"2021-07-010\"><a class=\"anchor\" href=\"#2021-07-010\">#</a> 2021-07-010</h1>\n<h1 id=\"全网行为管理识别能力\"><a class=\"anchor\" href=\"#全网行为管理识别能力\">#</a> 全网行为管理识别能力</h1>\n<p>1，识别概述：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>AC/SG 规则库包括：</li>\n<li>应用识别规则库，URL 规则库，审计规则库，SAVE 引擎模型。</li>\n<li>AC/SG 数据流基本走向：</li>\n<li>数据 —— 基础识别 —— 用户认证 —— 应用 / URL 识别 —— 行为识别 —— 防火墙 —— 流量控制 —— 应用审计 —— 流量审计</li>\n</ul>\n<p>2，基础识别之代理识别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，是 SG 代理上网功能识别出是否是代理数据，接着打上代理标志，最后负责找出代理后真实的 IP 和端口，供后续调用。</li>\n<li>2，代理识别主要识别 http，socker4，sockrt5，isa 这几种代理方式。</li>\n<li>3，http 代理识别是根据 http 数据包的内容中含有 CONNECT，GET http，POST http 这 3 哥特征之一就识别为 http 代理。</li>\n<li>4，socket4 跟 socket5 主要是对其数据包交互过程的连接状态的检测，以判断其属于代理行为。</li>\n<li>5，isa 是根据其包中前 4 个字节中含有特定的内容字段，以及端口是 1745，则段读为 isa 客户端代理。</li>\n</ul>\n<p>3，单包识别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，应用 A 的数据包中，有其独有的特征值，应用识别规则可以根据这个独有的特征将数据包识别为应用 A。</li>\n</ul>\n<p>4，多包识别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>有的链接需要识别多包特征才能确定其应用类型，比如一个链接的第 K 个数据包在匹配规则时不能确定该链接是什么具体应用，还需要后续的数据包匹配规则 B 时确定应用 B 或者匹配规则 C 时确定应用 C。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/10/WSJA2j.png\" alt=\"T\"></li>\n</ul>\n<p>5，URL 识别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，相比于应用识别，URL 识别就简单多了。</li>\n<li>2，识别方式 HTTP：</li>\n<li>从 HTTP Get 包中提取信息。</li>\n<li>提取的 URL 查找对应的 URL 组。</li>\n<li>URL 识别，就是通过检测用户发送的 http 请求数据包中的 HOST 字段是否与 URL 规则库中的 URL 相符。</li>\n<li>只有当判断用户的链接请求是 http 请求时，设备才会检测 HOST 字段。</li>\n<li>3，HTTPS：</li>\n<li>https 的 URL 主要通过根证书颁发给和颁发者同我们设定的规则进行匹配。</li>\n<li>设备通过获取证书的 &quot;颁发给&quot; 信息，实际上是获得一个 URL，来进行和普通 URL 识别类似的匹配标记，控制和审计。</li>\n</ul>\n<p>6，代理注意事项：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，代理工具模块支持全局排除，当配置全局排除后，代理工具模块失效。</li>\n<li>2，高可用及 BBC 环境支持代理工具管理工具。</li>\n<li>3，支持路由模式及网桥模式下使用代理工具模块，其他模式不支持。</li>\n<li>4，代理工具模块与应用控制模块独立，但是不建议通过应用控制模块实现代理工具封堵。</li>\n<li>5，DNS 请求不经过 AC/SG 设备时，不支持，内网有 NAT 环境不建议使用。</li>\n<li>6，SG 设备开启了代理功能不支持代理工具管理。</li>\n<li>7，需要保证设备可以联网，及时更新地址列表。</li>\n</ul>\n<p>7，准入原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/10/WSD96U.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"ac流量管理\"><a class=\"anchor\" href=\"#ac流量管理\">#</a> AC 流量管理</h1>\n<h2 id=\"链路负载\"><a class=\"anchor\" href=\"#链路负载\">#</a> 链路负载</h2>\n<p>1，功能说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，支持模式：</li>\n<li>“链路负载” 功能支持模式：路由模式，网桥模式。</li>\n<li>2，配置路径：【流量管理】——【链路负载】配置页面</li>\n<li>3，优先级说明：链路负载 &gt; 优先负载策略 &gt; 默认负载策略。</li>\n</ul>\n<p>2，路由的优先级说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，直连路由 &gt; 静态路由 &gt; 动态路由 &gt; DNS 代理 (重定向到指定线路)&gt; 优先负载策略 &gt; 默认负载策略 &gt; 默认路由。</li>\n<li>2，DNS 代理策略只有在配置重定向致指定线路时，才和链路负载策略发生冲突，当两者配置冲突时，DNS 代理策略优先级更高，以 DNS 代理策略配置的重定向线路为准。</li>\n</ul>\n<p>3，网桥的优先级说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>DNS 代理 (重定向致指定线路)&gt; 优先负载策略 &gt; 默认负载策略。</li>\n<li>DNS 代理策略只有配置重定向致指定线路时，才和链路负载发生冲突，当两者配置冲突时，DNS 代理策略优先级更高，以 DNS 代理策略配置的重定向线路为准。</li>\n<li>内网 ——AC (网桥)—— 代理服务器 ——F5 场景，不支持链路负载功能。</li>\n</ul>\n<p>4，DNS 代理功能</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，DNS 代理需求背景：</li>\n<li>“限制非法 DNS 请求”(例如邪教网站访问，会被网监查到)</li>\n<li>将某些域名强制重定向到自己的服务器</li>\n<li>2，功能说明：</li>\n<li>支持模式：路由模式，网桥模式。</li>\n<li>配置路径：【流量管理】-【DNS 代理】- 配置页面</li>\n<li>优先级说明：DNS 代理 &gt; 优先负载策略 &gt; 默认负载策略。</li>\n<li>注：一般和链路负载一起使用。</li>\n<li>3，主要功能有：</li>\n<li>重定向致 DNS 服务器，DNS 服务器的 IP</li>\n<li>解析为 IP：直接把域名解析为该 IP</li>\n<li>丢弃：直接将 DNS 请求丢弃。</li>\n<li>重定向致指定线路：重定向到指定的出口 (运营商)</li>\n<li>注：</li>\n<li>指定线路中，路由模式下展示网口，网桥模式下展示虚拟线路。</li>\n<li>重定向指定线路策略中，对于没有配置 dns 的线路，不可选，提示只能选择设置了 dns 的线路。</li>\n</ul>\n<p>5，DNS 代理注意事项：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>代理到内网 DNS 服务器的场景：DNS 代理策略到内网的 DNS 服务器 (DNS 服务器在 DMZ 区)</li>\n<li>【出现现象】</li>\n<li>代理到内网 DNS 服务器失败 (如果用户自己电脑有配置有效的 DNS 服务器，则走自己的 DNS 服务器，DNS 服务器无效则会导致断网)</li>\n<li>【解决办法】</li>\n<li>1，防火墙配置放通 DMZ——&gt;LAN 的流量。</li>\n<li>2，开启全局排除，直通的场景下，DNS 代理功能是否生效？</li>\n<li>DNS 代理配置 “丢弃”，将域名加入全局排出后，DNS 代理 “丢弃” 策略再不生效，开直通后，DNS 代理不生效。</li>\n<li>3，网桥下 DNS 检测是从 dmz 口发包出去检测，部署场景需要保障 dmz 口发包可以到达出口。</li>\n</ul>\n<h1 id=\"代理上网sg\"><a class=\"anchor\" href=\"#代理上网sg\">#</a> 代理上网 SG</h1>\n<p>1，SG (上网优化管理)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，部署模式：</li>\n<li>单臂模式部署只适用于 SG 产品，当客户有代理需求，又不希望影响网络中其他的设备部署或替代原有代理服务器，考虑用单臂部署。</li>\n<li>2，作用：</li>\n<li>隐藏真实 IP，上网者也可以通过这种方式隐藏自己的 IP，免受攻击。</li>\n<li>突破自身的 IP 访问限制，访问国外站点。</li>\n<li>作为网络访问的一种方式，方便跟进策略进行 URL 过滤，应用过滤。</li>\n</ul>\n<p>2，代理上网：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，正向代理 (SG 支持)：</li>\n<li>就是代理服务器替代 [用户 A] 去访问目标服务器 [服务器 B]</li>\n<li>显示代理即正向代理，正向代理是一个位于客户端和原始服务器之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定 (原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端，客户端必须要进行一些特别的设置才能使用正向代理。</li>\n<li>透明代理：客户端根本不需要知道有代理服务器的存在，它改编你的 reques fields (报文)，并会传送真实 IP，注意，加密的透明代理则属于匿名代理，意思是不用设置使用代理了。</li>\n<li>2，反向代理：</li>\n<li>反向代理正好与正向代理相反，对于客户端而言代理服务器就像是原始服务器，并且客户端不需要进行任何特别的设置，客户端向反向代理的命名空间中的内容发送普通请求，接着反向代理将判断向何处 (原始服务器) 转交请求，并将获得的内容返回给客户端。支持的设备有 (AD，WAF)</li>\n</ul>\n<h1 id=\"2021-07-11\"><a class=\"anchor\" href=\"#2021-07-11\">#</a> 2021-07-11</h1>\n<p>1，HTTP 显示代理原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/W9GoV0.png\" alt=\"T\"></li>\n<li>2，过程：</li>\n<li>(1)，PC 和 SG 建立三次握手。</li>\n<li>(2)，PC 发出 HTTP CONNECT  www.qq.com 的请求。</li>\n<li>(3)，SG 开始向 DNS 服务器请求解析 www.qq.com 的 ip。</li>\n<li>(4)，DNS 服务器返回 www.qq.com 的请求。</li>\n<li>(5)，SG 主动向 www.qq.com 建立 TCP 链接，并发送 HTTP_GET 请求。</li>\n<li>(6)，得到响应并以自己的 IP 将响应数据发送给 PC。</li>\n</ul>\n<p>2，HTTPS 显示代理原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/W9Jgdx.png\" alt=\"T\"></li>\n<li>2，过程：</li>\n<li>(1)，PC 和 SG 建立三次握手。</li>\n<li>(2)，PC 发出 HTTP CONNECT  www.baidu.com:443 的请求。</li>\n<li>(3)，SG 开始向 DNS 服务器请求解析 www.baidu.com 的 ip。</li>\n<li>(4)，DNS 服务器返回 www.baidu.com 的请求。</li>\n<li>(5)，SG 主动向 www.qq.com 建立 TCP 链接，并给 PC 返回建立成功的保证。</li>\n<li>(6)，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1QQ3d3dy16ZjZoMDNpLmJhaWR1LmNvbQ==\">PC 发出 www.baidu.com</span> SSL 握手的数据包。</li>\n<li>(7)，SG 以自己的 iP 转发该数据包给 www.baidu.com 并将响应的数据以自己的 IP 地址转发给 PC。</li>\n</ul>\n<p>3，ICAP 协议：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>ICAP 是一种应用层协议，ICAP 客户端传送请求数据到 ICAP 服务器做校验，常用于金融客户，常见的 ICAP 服务器有 Macfee (杀毒)，赛门铁克，websense (url 过滤)，dlp (防泄密)。</li>\n<li>注：SOCK 代理不支持和 ICAP 服务器结合使用。</li>\n</ul>\n<p>4，SOCKS 代理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>工作在会话层，只能简单的传输数据包，比应用层代理快。</li>\n<li>SOCKS 是一组由 Internet 工程工作小组 (IEIF) 所开发出来的开放软件开放标准，用来处理网络安全的事宜。</li>\n<li>SOCKS 像一堵墙被夹在 internet 服务器与客户端之间，对于出入企业网络的资讯提供流量和安全的管理。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/W9dZLQ.png\" alt=\"T\"></li>\n</ul>\n<p>5，SOCKS 代理原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>sock5 协议没有规定加密，所以是明文传输，可以搭配 SSL 加密。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/11/W9dTOg.png\" alt=\"T\"></li>\n<li>(1)，Client 和 DNS 服务器进行交互得到 IP 地址</li>\n<li>(2)，Client 发出建立链接的请求信息。</li>\n<li>(3)，sock5 server 应答。</li>\n<li>(4)，接到应答后像 Client 发送目的 IP 和端口。</li>\n<li>(5)，与目的 IP 连接。</li>\n</ul>\n<p>6，SOCKS 代理与 HTTP 代理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，SOCKS 工作在会话层上，而 HTTP 工作在应用层上。</li>\n<li>2，SOCKS 代理只是简单地传递数据包，而不必关心是何种应用协议 (如：FTP，HTTP 和 NNTP 请求)，所以 SOCKS 代理服务器比应用层代理服务器要快得多。</li>\n<li>3，HTTP 代理是用来浏览网页用的，而 SOCKS5 代理则可以看成是一种全能的代理，不管是 telnet，ftp 还是 irc 聊天都可以用它。</li>\n<li>4，HTTP 代理的 DNS 解析是由代理服务器进行的，但是 socks 代理的 DNS 解析需要由客户端本身的首选 DNS 服务器进行解析的，</li>\n</ul>\n<p>7，PAC 脚本上网代理</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，客户需求：</li>\n<li>因为单位是用的代理上网，家里是直接连接，因此每次都要修改 IE 的代理设置，因此客户希望通过自动配置加载 ie 代理检测脚本实现选择代理服务器及访问某些目标地址是否需要代理或者用那种代理等功能。</li>\n<li>2，PAC (proxy auto-config)：一个自动代理配置脚本，包含了很多使用 JS 编写的规则，它能够决定网络流量走默认通道还是代理服务器通道，控制的流量类型包括：HTTP，HTTPS，和 FTP。</li>\n<li>3，PAC 语法举列：</li>\n<li>return &quot;PROXY 222.20.74.89:8800;SOCKS 222.20.74.89:8899;DIRECT&quot;;</li>\n</ul>\n<p>8，Hosts：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，在显示代理的场景，DNS 解析由设备进行，因此就衍生出了用户需要编辑设备 HOSTS 表的需求，以便于客户自定义 HOSTS 表。</li>\n<li>2，设备会先查看是否在 Host 表里，如果不在，再去进行 DNS 服务器上进行解析。</li>\n</ul>\n<p>9，Forward：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>公司内部服务器发布在网上，员工浏览器通过代理访问公司内部服务器地址，SG 可以直接将收到的数据转发到内部服务器。</li>\n<li>注：配置了 Forward 策略就不会匹配代理策略了。</li>\n</ul>\n<p>10，代理和 NAT 的区别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，在 Internet 共享上网技术上，一般有两种方式：一种是 proxy 代理型，一种是 NAT 网关型。</li>\n<li>2，NAT 工作在网络层，而 Proxy 工作在应用层。</li>\n<li>3，Proxy 在实现上具体到了应用层上的协议，因此带来了一些额外的管理功能和 cache 功能。</li>\n<li>4，Proxy 可以在服务器上进行更细粒度的管理，限制客户端对某种协议及端口的访问等。</li>\n</ul>\n<h1 id=\"2021-07-12超融合hci\"><a class=\"anchor\" href=\"#2021-07-12超融合hci\">#</a> 2021-07-12 (超融合 HCI)</h1>\n<p>1，HCI：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，具备完整的 IT 基础设施访问能力和运维管理服务能力，并能承载核心数据库，ERP，财务系统，生产系统等企业关键业务应用。将用户的 IT 资源池化，IT 使用服务化，IT 运维自动化，让关键业务轻松上天。</li>\n</ul>\n<p>2，产品简介：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1， HCI 将计算，网络和储存等资源作为基本组成元素，形成根据系统需求进行选择和预定义的一种技术架构，</li>\n<li>2，实现方式：</li>\n<li>是在同一套单元节点 (X86 服务器) 中融入软件虚拟化技术 (包括计算，网络，储存，安全等虚拟化)，而每一套单元节点可以通过网络聚合起来，实现模块化的无缝横向拓展 (scale-out)，构建统一的资源池，实现云架构的极简。</li>\n<li>3，HCI 依托超融合技术将数据中心简化为 2 种设备：X86 服务器和交换机，降低了成本，通过接入 SCP 云计算平台实现平滑扩容，以支持业务高性能的需求，</li>\n<li>4，HCI 内置了 P2V 迁移技术，可以实现一键迁移应用上云，提升 IT 的创新效率，</li>\n<li>5，HCI 通过 CDP 技术，数据多副本技术，虚拟机备份技术，应用数据备份，网络行为管理等多项技术保障数据可靠</li>\n<li>6，内置防火墙，WAF，云杀毒等运行在云平台上的业务应用，使其具备完善的安全防护体系，保障数据中心安全需求。</li>\n<li>7，HCI 具备全局的资源管理能力，部署配置 &quot;所画即所得&quot;，降低应用部署时间，减少故障定位和修复时间，无需专门培训即可掌握平台使用方法。</li>\n</ul>\n<p>3，产品架构</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，深信服超融合 HCI 架构由两部分组成：超融合基础设施，云计算管理平台。</li>\n<li>在超融合架构之上，用户可以基于自身需求架构业务系统。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPGm8S.png\" alt=\"T\"></li>\n<li>2，深信服超融合 HCI 基于超融合架构，以虚拟化技术为核心，利用计算虚拟化 aSV，储存虚拟化 aSAN，网络虚拟化 aNET，安全虚拟化 aSEC 等组件，将计算，储存，网络等虚拟资源融合到一台标准的 X86 服务器中，形成基准架构单元，并且多套单元设备可以通过网络聚合起来，实现模块化的无缝横向拓展 (Scale-Out)，形成统一的资源池。</li>\n<li>3，深信服云计算管理平台 SCP，提供对深信服超融合，第三方资源池的管理和资源调配能力，通过自动化运维工具，降低平台运维的难度，减少运营工作量。</li>\n<li>4，HCI 有四大主要组件为：aSV (服务器虚拟化)，aNET (网络虚拟化)，aSAN (储存虚拟化)，aSEC (安全虚拟化和 NFV)，aSV 为整个 HCI 的内核，是必选项，aNET，aSAN 和 aSEC 可以根据具体的需求三选一或者全选。</li>\n<li>5，aSV 是深信服超融合架构解决方案中的计算虚拟化组件，也是整个超融合架构中的核心组件，计算资源虚拟化技术将通用的 X86 服务器经过 aSV 组件，对最终用户呈现标准的虚拟机，虚拟机具备系列化的硬件配置，使用相同的驱动程序。</li>\n<li>6，aSAN 是一款自主开发的分布式存储系统，利用虚拟化技术 &quot;池化&quot; 集群储存卷内通用 X86 服务器中的本地硬盘，实现服务器存储资源的统一整合，管理及调度，最终向上层提供 NFS/ISCSI 储存接口，供虚拟机根据自身的存储需求自由分配使用资源池中的储存空间。</li>\n<li>7，aNET 是深信服超融合架构解决方案中的网络虚拟化组件，通过 Overlay 的方式构建大二层和实现业务系统之间的租户隔离，通过 NFV 实现网络中所需各类网络功能资源 (包括基础的路由交换，安全以及应用交付等) 按需分配和灵活调度，从而实现超融合架构中的网络虚拟化。</li>\n<li>8，aSEC 为深信服的安全虚拟化和 NFV (包括：vAC，vAD，vAF，vSSL，VPN，vWOC，vDAS)。其将深信服现有的网络设备 (SSL，WOC，AD，AF，AC，DAS) 进行虚拟化，并通过模板形式单独提供。</li>\n</ul>\n<p>4，云平台关键特性</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，云计算平台：</li>\n<li>深信服 SCP 云计算平台能够提供丰富的管理功能，包括纳管 HCI 集群，VMware 平台，支持统一对多个 HCI 集群授权，支持多租户管理和自主服务管理，在安全方面，支持租户配置自己的分布式防火墙，容灾方面，SCP 集成了 “可靠中心”，能够为用户提供完整的虚拟机级别异地容灾方案。</li>\n<li>2，应用迁移服务：</li>\n<li>HCI 迁移工具可以将现有物理主机或 VMWare 或 Citrix 平台上的 Windows/Linus 操作系统通过网络复制到 HCI 平台上。</li>\n<li>3，构建虚拟化管理：</li>\n<li>HCI 可添加 VMware vCenter 并对其进行纳管，实现双平台的集中管理，VMware vCenter 和 HCI 之间的虚拟机可以实现支持双向迁移。</li>\n<li>4，数据库向导部署：</li>\n<li>深信服超融合平台上的 Oracle RAC 支持向导式部署，也支持向导式部署 SQL Server AlwaysOn 集群数据库。</li>\n<li>5，一键检测：</li>\n<li>一键检测能够识别系统硬件，配置，系统运行情况，快速定位问题位置 (硬件，平台，业务)，进行分层检查，提供故障详细解决方案。</li>\n<li>6，集群资源调度：</li>\n<li>集群资源调度是指在特定的场景下会调度集群资源，将虚拟机从 CPU 或者内存利用率比较高的主机迁移到利用率比较低的主机上，将负载过高的主机的利用率降到阈值以下。</li>\n</ul>\n<p>5，aSV 关键特性：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，aSV 的 Hypervisor 实现：</li>\n<li>aSV 平台通过 VMM (Virtual Machine Monitor，虚拟机监视器) 对 CPU，内存以及 IO 设备进行虚拟化。</li>\n<li>aSV 基于硬件辅助虚拟化技术利用 VMM 实现 X86 架构的虚拟化，将单个物理 CPU 划分成多个 vCPU，虚拟机只看到 VMM 呈现的 vCPU 不直接感知物理 CPU，用户操作系统负责第 2 级调度，即线程或进程在 vCPU 上的调度，虚拟机监视器负责第 1 级调度，即 vCPU 在物理处理单元上的调度。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPDUBT.png\" alt=\"T\"></li>\n<li>aSV 基于页表虚拟化技术完成内存虚拟化，VMM 负责页式内存管理，维护虚拟地址到机器地址的映射关系，将物理内存虚拟化为虚拟机可以使用虚拟内存。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPgIPS.png\" alt=\"T\"></li>\n<li>aSV 利用 VMM 截获 Guest OS 对 I/O 设备的访问请求，然后通过软件模拟真实的硬件，实现 I/O 虚拟化。</li>\n<li>2，虚拟机资源热添加：</li>\n<li>aSV 支持对虚拟机的 CPU，内存执行热添加，对虚拟机的网口和磁盘执行热插拔操作。</li>\n<li>3，动态热添加：</li>\n<li>动态热添加功能提供的自动化策略，快速响应业务状态增长变化对虚拟机 CPU，内存资源进行动态拓展，既保证了业务的连续性，又解决用户业务增长带来的敏捷运维问题。</li>\n<li>4，虚拟机高可用 HA：</li>\n<li>虚拟机高可用 HA 分为主机故障 HA 和虚拟机故障 HA。</li>\n<li>主机故障 HA 指当虚拟机所在节点发生意外 (主机掉电，网口掉线等) 时，将选择一台资源充足的节点重启该虚拟机，极大的降低了业务中断时间。</li>\n<li>虚拟机故障 HA 指当虚拟机发生了蓝屏，黑屏等故障，将虚拟机关机并在原物理主机重启。</li>\n<li>5，智能 NUMA 调度：</li>\n<li>通过对核心业务的数据库进行建模，利用 AI 算法，生成核心数据库在通用场景下的 NUMA 绑定规则库，提高业务性能。</li>\n<li>6，内存隔离和内存超配：</li>\n<li>通过对各个模块的内存进行隔离，保障系统不因内存被抢占导致系统假死，宕机，提升平台可靠性，同时，支持虚拟机内存超配，实际使用量可超过物理限制，优先保障重要虚拟机的内存使用，提高内存使用率。</li>\n</ul>\n<p>6，aSAN 关键特性：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，数据条带化：</li>\n<li>aSAN 利用条带化技术获得最大程度上的 I/O 并发能力，条带化技术是将一块连续的数据切分成很多个小的数据块，然后并发地储存到不同物理硬盘上，实现对数据进行写入或读取时可以获得最大程度上的 I/O 并发能力，从而获得优异的性能。</li>\n<li>如下图，经过条带化处理的数据可以并发地写入到三块磁盘，而未经条带化处理的数据每次只能写入到一块磁盘中，因此数据经过条带化后的写入性能则是未经条带化的写入性能的 3 倍。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPfhLj.png\" alt=\"T\"></li>\n<li>2，分片：</li>\n<li>aSAN 通过数据分片技术对单个 qcow2 文件按照固定单位大小进行切分成若干个颗粒度更小的分片，让数据在储存卷中分布更加均衡，数据管理更加灵活。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPhe0A.png\" alt=\"T\"></li>\n<li>3，储存快照：</li>\n<li>在对虚拟机创建快照时，系统会将原虚拟磁设置为只读，并生成对应数量的新磁盘文件 (即快照空间)</li>\n<li>创建快照后，虚拟机的所有新增数据和对原数据的修改都将写入到新生的快照空间，并将源虚拟磁盘和快照空间逻辑地址的对应关系写入映射表。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WP4T2T.png\" alt=\"T\"></li>\n<li>快照创建后，虚拟机对数据的读取存在两种情况：</li>\n<li>若读取的数据是快照创建之前已有的数据，且创建快照后未进行修改，则从源虚拟磁盘中读取。</li>\n<li>若读取的数据是快照创建之后新增 / 修改的数据，则从快照空间读取。</li>\n<li>4，磁盘多卷：</li>\n<li>按主机划分多个卷至少 6 个主机起步才能支持，对于承载业务节点较小的小集群，无法按主机划分为多个卷，可以采用按磁盘划分多个卷。</li>\n<li>5，虚拟 ISCSI 技术：</li>\n<li>aSAN 具备虚拟 iSCSI 技术，可以创建虚拟 iSCSI 硬盘，并且支持从虚拟储存通信网口接入，</li>\n</ul>\n<p>7，aNET 关键特性：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，网络虚拟化：</li>\n<li>虚拟分布式交换机可以保障虚拟机在主机之间迁移时网络配置的一致性，同时提供丰富的网络配置管理功能，端口动态绑定，静态绑定。</li>\n<li>分布式防火墙提供 IP 接入控制，虚拟机网络 Qos，实现网络资源统一管理，实时化网络监控。</li>\n<li>虚拟化路由器可解决虚拟化出口路由的问题，同时提供其他包括 VLAN 子接口，NAT 规则，ACL 策略，DHCP 地址池，DNS 代理等功能。</li>\n<li>2，网络功能虚拟化：</li>\n<li>NFV 将网络功能与专有硬件设备分离，并将这些功能使用软件的方法实现，以支持虚拟化组件完全融合的基础架构，深信服的超融合平台在 NFV 的实现上十分完整，包括安全领域技术领先的深信服网络设备软件，包括虚拟下一代防火墙 vAF，虚拟应用交付 vAD，虚拟行为管理 vAC，虚拟广域网加速 vWOC，虚拟 vSSL VPN 等。</li>\n<li>3，分布式虚拟防火墙：</li>\n<li>分布式防火墙，相当于在每台虚拟机出口和入口都放着一个防火墙，只要配置一条策略，无论拓扑如何变化，虚拟机在哪运行，IP 是否更改，后台都可以动态进行调整，因此无论何时业务都能进行安全防护。</li>\n</ul>\n<p>8，安装部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，数据通信口的组网交换机，应确认是否支持巨帧，如果支持，则建议开启数据通信口的高性能模式，即把 VXLAN 口的 MTU 改为 1600，如果不支持，则禁止开启数据通信口的高性能模式，否则会导致虚拟机数据不通。</li>\n<li>2，一键检测的连通性探测只是 ping 检测，只要能 ping 通，即使组播不通，但是检测结果是正常。</li>\n<li>3，四种通信网口类型 (管理通信口，VXLAN 数据通信口，VS 储存通信口。物理出口) 不允许复用，但如果网口不够的情况下一定要用复用网口就复用物理出口与 VXLAN 口，建议网口使用规划为：2 个管理口，2 个储存口，2 个聚合做 VXLAN 和物理出口复用。</li>\n<li>4，无论是第三方服务器还是超融合一体机，不要对网卡进行热插拔，否则可能会出现网口乱序的情况。</li>\n</ul>\n<p>9，HCI 标准集群组网介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WPXTuq.png\" alt=\"T\"></li>\n<li>1，管理网络：</li>\n<li>用于平台管理，服务器 IPMI/BMC/IDRAC 等远程管理网口复用管理网络。</li>\n<li>2，VXLAN 网络：</li>\n<li>用于承载虚拟机的东西向流量，二层通信。</li>\n<li>3，储存网络：</li>\n<li>用于 aSAN 储存，负责 HCI 节点间储存数据通信，在使用 IPSAN 时，也作为与外置储存进行通信的接口，二层通信。</li>\n<li>4，业务网络：</li>\n<li>用于承载虚拟机的南北向通信。</li>\n</ul>\n<p>10，HCI 超融合部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，网络类型：</li>\n<li>HCI 超融合部署方案中，需要两台及以上的主机才能够组建标准的 HCI 超融合集群。</li>\n<li>HCI 超融合部署需要连接四类网络：</li>\n<li>管理网络：集群间心跳，管理，虚拟机克隆，迁移，备份，都是通过集群管理网络来传输数据，需要和管理网络可以通信。</li>\n<li>存储通信网络：这里特指 aSAN 的数据通信，全部的写磁盘数据及部分读磁盘数据要通过此网络传输。</li>\n<li>数据通信网络 (VXLAN)：用于东西向的流量传输，如果每台主机都直接连接了物理出口，就没有东西向流量，VXLAN 网络实际用不上，如果用了 aNET 或 aSEC，就只有部分主机连接物理出口，那么未连接物理出口的主机上面的虚拟机要跟外部通信，就要通过 VXLAN 网络。</li>\n<li>业务通信网络：</li>\n<li>南北向流量传输，作为物理出口，连接虚拟路由器或者虚拟机，承载和物理网络互访的业务流量。</li>\n<li>2，组网最佳实践：</li>\n<li>HCI 超融合四类网络按照最佳实践的部署，每类网络采用双链路聚合 / 交换机堆叠的方式进行组网，避免单交换机 / 单链路的故障。存储网络采用万兆链路。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WigtOA.png\" alt=\"T\"></li>\n<li>3，系统安装：</li>\n<li>深信服超融合一体机默认出厂已经安装好了 HCI 超融合系统，直接可以使用默认登录 IP 地址 10.250.0.7 登录到 HCI web 控制台进行操作，默认账号密码为 admin/admin, 如果是第三方服务器则需要进行 HCI 系统安装。</li>\n<li>第三方服务器硬件配置：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WiRzsH.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"桌面云adesk\"><a class=\"anchor\" href=\"#桌面云adesk\">#</a> 桌面云 aDESK</h1>\n<p>1，产品说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>深信服桌面云是基于超融合架构的新型桌面模式，通过深度整合服务器虚拟化，桌面虚拟化以及储存虚拟化，只需要桌面云一体机和云终端两种硬件设备，即可实现云平台的快速交付，为用户提供操作体验及软硬件兼容性媲美物理 PC，更安全，更高效的云桌面。<br>\n2，产品简介：</li>\n</ul>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>深信服桌面云 (aDesk) 通过提供统一虚拟化管理平台 (VMP) 和虚拟桌面控制器 (VDC) 来保证桌面管理和运维工作的简化，大大减少了维护成本，同时，虚拟化管理平台可直观的看到计算，网络，储存及桌面的各项资源使用情况，虚拟桌面控制器上可对桌面用户，桌面资源，桌面权限等进行相关配置，此外，深信服提供 aDESK 瘦终端，用于接入桌面资源，且配置简单，终端用户只需要使用用户名和密码进行登录即可。</li>\n</ul>\n<p>3，产品特点：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，深信服提供端到端从软件到硬件融合的极致体验，更安全，更高效的桌面云解决方案，只需要云终端，桌面云一体机 (预装桌面虚拟化，服务器虚拟化，储存虚拟化等软件平台) 两种硬件，即可完成桌面云的搭建。</li>\n<li>桌面云一体机 VDS 是一款专为云桌面设计的软硬件超融合服务器，出厂预集成了服务器虚拟化，储存虚拟化，桌面虚拟化 (控制器) 等软件平台，用户无需复杂的安全调试过程，将 VDS 开启后，只需要按照向导配置界面执行几个步骤，即可完成桌面云部署上线，非常方便。</li>\n</ul>\n<p>4，产品相关概念：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WiFPl8.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/12/WiF5ng.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"2021-07-13\"><a class=\"anchor\" href=\"#2021-07-13\">#</a> 2021-07-13</h1>\n<h1 id=\"hci部署\"><a class=\"anchor\" href=\"#hci部署\">#</a> HCI 部署</h1>\n<p>1，交换机基本配置要求：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 管理，业务，存储，隧道等基于安全合规考虑采用不同 VLAN 隔离。</li>\n<li>(2) 交换机关闭 STP 协议。</li>\n<li>(3) 交换机 VXLAN 端口开启巨帧 (隧道口)。</li>\n<li>(4) 管理网络，VXLAN 网络所接入的交换机关闭 IGMP Snooping</li>\n<li>(5) 采用主备模式的聚合口对端交换机无需配置聚合。</li>\n</ul>\n<p>2，HCI 安装流程概要图：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WkQgC8.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"hci系统化系统安装\"><a class=\"anchor\" href=\"#hci系统化系统安装\">#</a> HCI 系统化系统安装</h1>\n<p>1，aServer 一体机：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1)，aServer 一体机出厂已经预装超融合操作系统，并设置 ETH0 接口为管理接口\t，默认 IP 地址为 10.250.0.7/24。把 PC 配置同网段 IP 地址，直连 ETH0 口，用浏览器打开 https://10.250.0.7 / 可以登录 aServer 一体机的控制台。默认登录账号密码为 admin/admin。</li>\n<li>(2)，如果有多台 aServer 主机，需要在组建集群之前分别登录以修改默认 IP 地址，且要求 IP 地址在同网段。</li>\n<li>(3)，注意事项：</li>\n<li>如果一体机插入第三方磁盘，在虚拟存储中不能识别使用，只能用于本地存储。</li>\n<li>使用了虚拟存储时，不支持删除主机，禁止将集群拆开后把主机拿出去单独使用。</li>\n<li>一体机不可重装系统，重装系统后需要对主机和磁盘重新签名。</li>\n<li>一体机磁盘不要进行低级格式化，格式化后需要重新签名。</li>\n</ul>\n<h1 id=\"hci集群初始化\"><a class=\"anchor\" href=\"#hci集群初始化\">#</a> HCI 集群初始化</h1>\n<p>1，HCI 集群初始化条件：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>不管是创建普通集群还是延伸集群，在 HCI 的集群初始化流程中，授权激活，组建集群，数据通信口配置都是一样的，前提是按照标准组网，然后进行集群初始化包括授权激活，组建集群，配置数据通信口，之后再根据实际情况配置虚拟存储，创建普通卷或是延伸卷。</li>\n</ul>\n<p>2，虚拟机快照：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1)，指导管理员给开机或者关机状态下的虚拟机创建快照，常用于虚拟机补丁升级，软件更新等操作后需要对原有数据进行恢复的场景。</li>\n<li>(2)，注意事项：</li>\n<li>虚拟机快照不作为备份手段，仅用于虚拟机补丁升级，软件更新等高危操作前的虚拟机保护。</li>\n<li>三主机及以上集群，使用 aSAN 虚拟储存时，默认采用储存快照 (基于储存的 ROW 技术) 对虚拟机打快照，当虚拟机在老版本平台打过快照时，可以选择 &quot;继续使用虚拟磁盘快照&quot; 或者 &quot;切换为存储快照&quot;，当切换至存储快照时，需要清楚已创建的虚拟磁盘快照。</li>\n<li>使用外置存储时，采用虚拟磁盘快照 (基于 qemu 的 COW 技术) 对虚拟机打快照。</li>\n<li>两主机集群，使用 aSAN 虚拟存储时，默认采用虚拟磁盘快照，无法使用存储快照，当扩容致三主机时可以切换至存储快照 (前提是需要清除已创建的虚拟磁盘快照)</li>\n<li>存储快照支持的最大快照个数为 128 个。</li>\n<li>虚拟机快照会中断业务，中断时间 &lt;=1s</li>\n<li>看到了 219</li>\n</ul>\n<h1 id=\"桌面云adesk-2\"><a class=\"anchor\" href=\"#桌面云adesk-2\">#</a> 桌面云 aDESK</h1>\n<p>1，aDESK 架构概述</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 传统 PC 的众多弊端是由 &quot;终端分散化&quot; 所引起的，为了降低综合维护成本，提升信息安全管理水平，“云端集中化” 模式应运而生，通过云桌面技术将办公桌面集中部署在服务器上，使得不同设备可以随意访问，并且实现桌面维护简单化，业务数据集中化。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WA8ouD.png\" alt=\"T\"></li>\n<li>深信服提供端到端从软件到硬件融合的极致体验，更安全，更高效的桌面云解决方案，只需要：云终端，桌面云一体机 (预装桌面虚拟化，服务器虚拟化，存储虚拟化等软件平台) 两种硬件，即可完成桌面云的搭建。</li>\n</ul>\n<p>2，新一代云终端 (aDsk)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WAJkee.png\" alt=\"T\"></li>\n<li>(1) ARM 架构：硬件架构采用 ARM Cortex A9 芯片，其优势在于系统运行效率更高，而且长期使用更为稳定。</li>\n<li>(2) 一体化设计：设备采用集成化设计模式，无多余零部件，并且运行过程中发热少，所以寿命更长。5~8n</li>\n<li>(3) 绿色环保：平均功耗仅 10W，相对 PC 可节省 10 倍电力成本，而且全程无噪音。</li>\n</ul>\n<p>3，桌面云一体机 (VDS)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 是一款专为 “云桌面” 量身定制的软硬件一体化服务器 (包括桌面虚拟化，服务器虚拟化，存储虚拟化等软件平台)，通过提供简单，一站式交付方案，极大降低部署难度，从而帮助用户建设简单，易运维，高性能的桌面云环境。</li>\n</ul>\n<p>4，软件平台：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 桌面虚拟化 (VDC)：提供用户认证管理，细粒度策略控制，桌面 / 云终端统一监控及管理等功能，实现更安全，更可靠地交付云桌面。</li>\n<li>(2) 服务器虚拟化 (VMP)：裸金属架构，可为云桌面提供高性能负载平台和先进管理功能，包括虚拟机快速部署，资源管理及监控，集群高可用，动态迁移，数据备份及恢复等功能。</li>\n<li>(3) 存储虚拟化 (VS)：将服务器直连硬盘形成分布式共享数据存储，通过内置冗余机制可透明存储多个数据副本，确保磁盘和服务器故障时，数据不会丢失，且依然可用。</li>\n<li>(4) aCenter：对组织中多个分支进行集中管理，包括统一升级，统一授权，资源分配等。</li>\n<li>(5) 报表中心：桌面云集群的资产管理，安全策略审计，文档导出审计和日志审计。</li>\n</ul>\n<p>5，单点登录与一体化关机：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WAsq9U.png\" alt=\"T\"></li>\n<li>(1) 客户很可能使用多个虚拟应用程序或 Windows 虚拟桌面，而每套应用系统或桌面系统都会有单独的身份认证措施，一般情况下需要多次认证才能正常办公，这种工作非常繁琐且容易出错，影响工作效率，为了提升操作便捷性，保障用户体验，可采用单点登录功能，将 VDI 认证，操作系统认证合二为一，在通过 VDC 严格认证之后，无需再次进行虚拟应用和虚拟桌面的认证，让用户从开机到进入云桌面，全称只有一次登录动作。</li>\n</ul>\n<p>6，SRAP 高效交付：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WActhV.png\" alt=\"T\"></li>\n<li>(1) 云桌面需要通过网络交付给前端设备，其中最重要的组成部分就是桌面交付协议，为实现云桌面的高校交付，深信服专门为虚拟桌面及远程应用程序设计并研制了 SRAP 协议，深信服自研了 SRAP 协议，深信服自研的 SRAP 高效交付协议，采用高效流压缩，智能数据缓存，动态图像优化等多项优化技术，相对 RDP 协议提升 6 倍传输效率，最大程度保障用户桌面体验。</li>\n</ul>\n<p>7，GPU 虚拟化 (vGPU)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>GPU 硬件虚拟化就是将显卡进行切片，并将这些切片分配给虚拟机使用，支持硬件虚拟化的显卡可以根据需要切分成不同规格的时间片，因此可用分配给多台虚拟机使用。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WA2fwd.png\" alt=\"T\"></li>\n</ul>\n<p>8，多用户竞争体验改进</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>对满足宽带要求的广域网 (分支) 部署项目，多用户同时使用存在流量互抢，体验不稳定情况，在这种情况下 aDesk 会自动感知每个用户当前的行为，在优先保障办公的前提下将视频帧率降低，画质压缩比列调高，从而保证体验。</li>\n</ul>\n<p>9，网络波动下用户体验自适应：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>在网络波动比较大的情况下，基于自适应感知 aDesk 会在网络变差的时候自动调低对网络的带宽的占用，而在网络恢复后 aDesk 又会将画面质量调到最佳状态，从而保证在网络波动的整个期间用户的体验是流畅的。</li>\n</ul>\n<p>10，广泛终端支持：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>只要网络是可达的，用户可以通过瘦终端，PC，笔记本，PAD，智能手机等终端设备来访问属于自己的个人桌面，实现随时随地办公，同时，深信服桌面云可以实现终端迁移功能，用户在多个终端间任意切换，不会影响原先的桌面操作行为，真正做到桌面随身行，满足移动办公需求。</li>\n</ul>\n<p>11，云终端，瘦终端和胖终端三者之间的区别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 云终端：</li>\n<li>云终端更多说的是采用 ARM 架构的终端，它采用 ARM 架构的嵌入式处理器，具有体积小，功耗低，价格优惠使用简单和开机即用的特点。在更多情况下云终端需要搭配 VDI 或者 RDP 云桌面来使用，它本身是无法单独当电脑来进行使用的，更多应用于学校，培训机构等不是很复杂的使用场景。</li>\n<li>(2) 瘦终端：</li>\n<li>瘦终端一般是指 X86 架构的终端设备，它和 ARM 架构的终端相比具有独立的内存和硬盘，具备和传统 PC 一样的特点，但是它本身的配置并不需要很高，一般不单独的使用，更多的是和 VDI 云桌面一起使用，和 ARM 架构云终端相比，在和云桌面的搭配使用中具有更高的性能和兼容性，一般应用于企业办公和高效的云教室中。</li>\n<li>(3) 胖终端：</li>\n<li>胖终端也可以称为迷你主机或者迷你电脑，采用 X86 架构，也具有体积小，功耗低和价格便宜的特点，但是它和前面介绍的两款终端相比配置会更高，它不需要搭配云桌面和服务器就可以实现和传统 PC 一样的性能，主要应用于一些电商企业，当然它也可以搭配 VOI 和 IDV 云桌面来实现统一管理的。</li>\n</ul>\n<p>12，SSD 缓存优化：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>深信服桌面云一体机基于 “SSD + 机器硬盘” 的混合磁盘组合，使用具有很高 IO 性能的 SSD 盘缓存桌面云运行过程中的经常访问的数据 (热点数据), 以加快读取热点数据的速度，高达 60% 的热点数据缓存命中率，有效保障了桌面云一体机的服务器读写效率，而机器硬盘 IO 较低，但比较便宜，用于保护用户个人数据，通过 “SSD + 机器硬盘” 的混合存储模式，实现以较低成本，获得更高 IO 性能，满足桌面云方案对高 IO 的性能需求。</li>\n</ul>\n<p>13，内存页合并技术：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/13/WAq4KA.png\" alt=\"T\"></li>\n<li>当一台服务器承载了较多虚拟机时，但这些虚拟机都有相同的只读内存页面，比如操作系统执行代码等，针对相同的页面，深信服内存页合并技术实现内存区域的共享。从而发挥内存的最大效率，节省服务器的物理内存空间，提升用户虚拟机的部署密度，通过实际测试数据表明，此技术至少可以节省 20% 服务端成本。</li>\n</ul>\n<p>14，虚拟机 HA</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>HA (高可用性集群)：需要两个或者两个以上的主机节点组成集群，当虚拟机所在节点发生意外 (主机掉电，断网等) 时，集群心跳机制侦测到后，将选择一台资源充足的节点重启该虚拟机，从而实现业务的不中断或短暂中断。</li>\n<li>注：</li>\n<li>HA 是集群环境必备的功能，它是保障业务连续性最有效，最常用的解决方案，堪称自动化运维的神器。</li>\n<li>大多数集群环境实现的是外部环境故障层面的 HA，当外部环境发生意外时能主动地重启，恢复业务。</li>\n<li>而业务系统本身因硬件，驱动的原因，出现蓝屏之类的故障时，却需要管理员自己手动才能恢复。</li>\n</ul>\n<h1 id=\"2021-07-14\"><a class=\"anchor\" href=\"#2021-07-14\">#</a> 2021-07-14</h1>\n<p>1，HCI 虚拟网络配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 创建物理出口：</li>\n<li>物理出口：物理出口用来连通虚拟网络和物理网络，对用户呈现为服务器物理口，“物理出口” 对内可以通过端口组连接虚拟路由器，虚拟网络设备，对外通过主机的物理网口连接交换机与外部网络联通。</li>\n<li>端口组：通过划分 “端口组”，将虚拟网络连接到 “物理出口” 的网口进行分组，通过将具有相同网络属性 (如相同的 VLAN) 的网口集合划分法到一个组，虚拟网络中的设备或虚拟机可以通过端口组连接到 “物理出口”。</li>\n</ul>\n<p>2，多网段端口组的物理出口创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 多网段标签端口组关联的物理网口的对端必须配置为 trunk，交换机端口的 pvid 为物理出口关联端口组设置的 pvid VLAN，此种类型的端口组允许用户使用多个业务网段。</li>\n<li>(2) 物理出口支持单网口，链路聚合的双网口，链路聚合的四网口。链路聚合需要在实体机详情的物理网络中进行配置，交换机的端口也需要配置相应的链路聚合模式。</li>\n<li>(3) 同一个端口组的 pvid 与交换机保持一致。</li>\n</ul>\n<p>3，单网段端口组的物理口创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 非多网段标签端口组的物理出口关联的服务器网口对端的交换机必须配置为 access，交换机端口允许通过的 vlan 为物理出口关联端口组设置的 pvid VLAN 此种类型的端口组只允许用户使用一个业务网口段。</li>\n<li>(2) 物理出口支持单网口和链路聚合，链路聚合需要在实体机的物理网络中进行配置，交换机的端口也需要配置相应的链路聚合模式。</li>\n<li>注：同一个物理出口的端口组的 pvid 与交换机保持一致。</li>\n</ul>\n<p>4，虚拟路由器创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 路由器可以直连物理出口端口组。</li>\n<li>(2) 路由器连接二层虚拟交换机，才能连接虚拟机。</li>\n<li>(3) 路由器与路由器，防火墙等其他三层设备对接时中间需要连接二层交换机。</li>\n<li>(4) 单个虚拟路由器运行在单个主机上，可以通过故障 HA 实现冗余。</li>\n</ul>\n<p>5，分布式虚拟机交换机创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 分布式虚拟交换机都是二层交换机。</li>\n<li>(2) 通常与虚拟路由器\t等三层设备相连。</li>\n</ul>\n<p>6，虚拟交换机路由器典型拓扑：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WVPjjP.png\" alt=\"T\"></li>\n<li>(1) 交换机作为二层设备，连接虚拟机和路由器，路由配置业务网络 IP 与外部业务网关进行对接。</li>\n<li>(2) 路由器上配置路由以及 NAT 策略使内部虚拟机与外部互通。</li>\n</ul>\n<p>7，其他 NFV 设备创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>NFV 设备包括深信服下一代防火墙 vAF，应用交付 vAD，上网行为管理 vAC，SSLVPN，广域网优化 vWOC，创建的方式一致。前提获得授权。</li>\n</ul>\n<p>8，管理 NFV 设备 (支持批量操作)：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) NFV 的开机，关机，关闭电源，迁移，删除操作，支持多台设备同时操作。</li>\n<li>(2) vAF 虚拟机的名字包含 &quot;服务器&quot; 字样，单点登录会被 vAF 拦截，被识别成 sql 注入，vAF 虚拟机名称不要有 “服务器” 字样，修改成其他的名称。</li>\n<li>(3) 同时打开 vSSL VPN 和 vAF 单点登录控制台，相互影响，导致无法单点登录，如需同时打开，请使用不同浏览器打开 vAF 和 SSL VPN 进行单点登录。</li>\n<li>(4) 不要在一个广播域部署多台使用透明模式的 vAF，会导致 MAC 地址冲突。</li>\n<li>(5) 东西向流量尽量不要经过 vAF，因为东西向流量会比较大，vAF 的性能比物理 AF 要低得多，一旦遇到性能瓶颈会导致网络变慢，东西向流量也没必要做 7 层清洗，使用 aNET 的分布式防火墙就可以满足需求，vAF 推荐部署在南北向流量的出口。</li>\n<li>(6) 集群部署完成后，如果有用 NFV (vAD,vAF 等) 不建议修改主机中的 “网络转发消耗的 CPU 核数” 和 “网络转发消耗的内存”，如果修改有可能会导致网络中断，此时必须手动将所有虚拟网络设备的网线删掉重连才能恢复。</li>\n<li>(7) 不支持对 NFV 进行克隆部署，需要从 “网络拓扑” 新加部署。</li>\n</ul>\n<p>9，查看存储状态：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) IO 次数趋势：展示的是虚拟存储每秒发生的读和写的次数，应用于业界术语 IOPS 值，展示的是虚拟存储的并发 IO 次数趋势，反映了虚拟存储的随机 IO 能力。</li>\n<li>(2) IO 速率趋势：展示的是虚拟存储每秒读写的字节数，即每秒读 xxxMB，写 xxMB，展示的是虚拟存储的并发 IO 吞趋势，通过 IO 速率趋势可以反映了虚拟存储的顺序 IO 能力。</li>\n<li>(3) IO 时延趋势：展示的是虚拟存储平均每次读写需要的时间，通过 IO 时延趋势可以看出存储的 IO 负载，如果 IO 时延增大，那说明 IO 请求已经在排队，性能开始不够，通常平均 IO 延时低于 30ms 表示负载很轻，低于 60ms 处于正常水平。</li>\n<li>(4) 主机命中率：展示的主机开机以来的平均缓存命中率，通过柱状图可以形象地对比不同主机命中率的差别，</li>\n</ul>\n<p>10，添加卷：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) HCI 支持多卷管理，一个集群上可以同时存在普通卷，也可以存在延伸卷，在一个超融合的集群中可以创建多个虚拟存储卷，组建多卷可以以主机为单位，也可以以下、磁盘为单位，卷与卷之间物理上和逻辑上都是隔离的，但是对于虚拟机而言可以在卷之间进行选择和迁移，也可以满足集群不同业务对于硬件的异构要求。</li>\n<li>(2) 以主机为单位的多卷至少需要 6 台主机，3 台主机一个卷，另外 3 台组成一个卷，而以磁盘为单位的多卷，3 台主机或以上即可划分多卷，因此单主机可以在创建 1 个混合卷的基础上再单独划分出一个全闪卷，将对磁盘性能要求高的业务放在全闪卷中运行，提高磁盘的利用率，主机多卷和磁盘多卷的方式可以在一个 HCI 集群上并存。</li>\n<li>以三主机为例，支持的组多卷方式如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WVKV7n.png\" alt=\"T\"></li>\n<li>注意事项：</li>\n<li>(1) 新添加的卷在创建时会将卷进行格式化，在添加前请确认用于添加新卷的磁盘上没有需要保留的数据。</li>\n<li>(2) 一个集群最多允许存在 6 个存储卷，其中最多允许存在一个延伸卷。</li>\n<li>(3) 1 个卷至少由三台主机上的硬盘组成，1 台主机最多划分 2 个卷。</li>\n<li>(4) 单主机不支持使用虚拟存储，单主机时虚拟存储没有冗余，建议直接做 RAID-0。</li>\n<li>(5) 虚拟存储不支持单副本，单副本时虚拟存储没有冗余，有丢失数据风险。</li>\n<li>(6) 不支持三副本部署，如需用到三副本，请使用 5.8.5 版本。</li>\n<li>(7) 两主机不支持数据平衡。</li>\n<li>(8) 两主机的虚拟机不支持使用条带化功能。</li>\n<li>(9) 虚拟存储是全 HDD 部署，不支持升级，也不支持全新部署。</li>\n<li>(10) 三主机容量异构过大的场景，会限制部署虚拟存储，要求一台主机的容量不能超过其余主机容量之和。</li>\n<li>(11) 一个卷横跨的主机不能分别属于另外两个卷。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WV1326.png\" alt=\"T\"></li>\n<li>(12) 延伸集群不支持多卷，如下图，一个主机不能即属于延伸卷，又属于普通卷。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WV3j0g.png\" alt=\"T\"></li>\n<li>(13) 全闪卷 (重删压缩)，不支持硬盘分卷，只支持主机卷，硬盘分卷的全闪子卷，不支持重删压缩。</li>\n<li>注：卷与卷之间物理上和逻辑上都是隔离的，但是对于虚拟机而言可以在卷之间进行选择和迁移。</li>\n</ul>\n<h1 id=\"astor-eds\"><a class=\"anchor\" href=\"#astor-eds\">#</a> aStor-EDS</h1>\n<p>1，EDS 部署要求：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WVsVtP.png\" alt=\"T\"></li>\n<li>(1) 存储外网和存储私网需使用万兆网络，根据安全需求来确认是否要做堆叠。</li>\n<li>(2) 确定需要部署的类型和业务服务器的 IP 及部署位置，从而确定虚拟 IP 池的地址规划。</li>\n</ul>\n<p>2，EDS 部署要求：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>硬件配置要求：</li>\n<li>(1)，服务器要求：</li>\n<li>通常是深信服 EDS 一体机。</li>\n<li>服务器数量：至少三台 EDS 主机。</li>\n<li>(2)，磁盘配比要求：</li>\n<li>即 SSD 和 HDD 配比，根据部署的存储类型不同，需要创建不同的存储池，而创建不同类型的存储池对 SSD 和 HDD 的配比要求均不同，故需根据实际业务的存储需求来确认服务器的磁盘配比。</li>\n<li>建议系统盘使用两块 SSD 做 RAID1，其余磁盘建议做 JBOD 或单盘 RAID0</li>\n</ul>\n<p>3，EDS 集群部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>部署准备：</li>\n<li>(1) 避免后续网络改动的影响，提前按照规划好的拓扑对交换机和 EDS 主机进行接线。</li>\n<li>(2) 确认 EDS 主机管理口是否均在同一网段，确认 EDS 主机管理网物理上连接互通，</li>\n<li>建议接显示器，逐台确认管理口 IP 地址。</li>\n<li>(3) 若规划 EDS 做网口聚合，请提前在交换机上配置好相应的聚合模式。</li>\n</ul>\n<p>4，存储池部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>存储池类型：</li>\n<li>(1) 存储池分为高性能块存储和容量型通用存储两种，容量型通用存储池提供文件存储和对象存储服务，高性能块存储池提供快存储服务。</li>\n<li>(2) 是一个集群只允许创建一个高性能块存储池和一个容量型通用存储池。</li>\n<li>(3) 创建不同类型的存储池前，务必确认好对应存储池对于缓存盘和机械盘配比的要求。</li>\n</ul>\n<p>5，EDS 组网规划：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>存储外网，存储私网，管理网。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WVH3Md.png\" alt=\"T\"></li>\n<li>EDS 网口聚合模式：</li>\n<li>(1) 轮询模式 (balance-rr)：</li>\n<li>提供负载平衡和容错能力，对端交换机对应网口也需配置为轮询负载均衡模式</li>\n<li>轮询式发包，如 eth0 和 eth1 聚合，第一个包从 eth0 发出，第二个包从 eth1 发出。</li>\n<li>(2) 主备模式 (active-backup)：</li>\n<li>提供网口级别的冗余，但做不到网口的负载均衡，对端交换机对应网口无需任何配置。</li>\n<li>同一时间只有一个网口处活动状态。</li>\n<li>(3) 主备和链路均衡模式 (balance-xor)：</li>\n<li>此模式提供负载平衡和容错能力，对端交换机对应网口也需要配置为哈希负载均衡模式，建议 xmit_hash_polcy 参数 (用于指定 hash 策略) 配置为：源 MAC 地址 XOR 目标 MAC 地址</li>\n<li>推荐使用 “主备和链路均衡模式”，交换机一侧配置哈希负载均衡模式，通常默认为静态聚合即可。</li>\n</ul>\n<p>6，EDS 文件存储功能介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 文件存储概念：</li>\n<li>文件存储是提高网络挂载 (操作对象是文件和文件夹)，存储端有独立的文件系统，即通常所说的 NAS 存储。</li>\n<li>EDS 文件存储支持对外提供 NFS，CIFS，FTP 接口。</li>\n<li>(2) 适用场景：</li>\n<li>主要应用于音视频，高性能计算，视频监控，数据备份等多业务场景，共享存储场景。</li>\n<li>(3) 虚拟 IP 池：</li>\n<li>配置文件存储的虚拟 IP 池，业务服务器通过虚拟 IP 池中的任一地址对存储资源进行访问。</li>\n<li>文件存储无需配置接入 IP，</li>\n<li>虚拟 IP 的作用是保障存储高可用，当一台 EDS 主机离线故障时，此主机上的虚拟 IP 会根据算法随机漂移到另一台 EDS 主机上，保障业务连续性。</li>\n<li>(4) 文件存储的权限设置为：目录权限和客户端权限。</li>\n<li>目录权限：在 EDS 系统上创建的目录，此目录本身的权限 (通常保持默认)</li>\n<li>客户端权限：客户端访问文件目录时的权限，如 NFS 客户端权限，CIFS 用户权限，FTP 用户权限。</li>\n</ul>\n<h1 id=\"adesk\"><a class=\"anchor\" href=\"#adesk\">#</a> aDesk</h1>\n<p>1，桌面云组成：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，终端设备：瘦终端，普通 PC，笔记本。智能终端 (如手机，IPAD)</li>\n<li>2，网络：局域网，广域网，会通过专有协议来传输图像和指令 (如 SRAP)</li>\n<li>3，软件：服务器虚拟化，存储虚拟化，桌面虚拟化。</li>\n<li>4，服务器和存储：其中存储可以用虚拟存储，也可以独立存储。</li>\n</ul>\n<p>2，组网说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/14/WZqYWT.png\" alt=\"T\"></li>\n<li>关键组件有以下几个：VMP 集群，VDC (虚拟桌面控制器)，存储网络，虚拟机和接入终端。</li>\n<li>(1) VMP 集群是虚拟机运行的基础环境，在每台服务器上安装系统，将服务器管理通信口通过交换机互联，组建为 VMP 集群，</li>\n<li>(2) 存储网络是指通过网络将每台服务器除系统盘以外的磁盘进行 &quot;池化&quot;，组成 “虚拟存储”。</li>\n<li>(3) VDC 用于对接入终端的访问控制，接入终端包括瘦客户机 aDesk，PC 和移动终端 (手机等)。</li>\n<li>(4) 在访问桌面的过程中，用户首先通过接入终端访问 VDC 进行认证，认证通过后接入终端才可访问 VMP 集群，从而获得 VMP 集群上的虚拟机资源，达到访问桌面的效果，虚拟机通过桥接的方式连接到 VMP 主机所在的物理网络，通过物理网络访问互联网，</li>\n<li>网络类型具体如下：</li>\n<li>管理网络：平台管理网络，包括 Web 网页登录，VMP 集群主机间通信和 VDC 与 VMP 集群通信等，要求 VMP 集群主机与 VMP 集群 IP 均在同一网段，VDC Lan 口与 VMP 集群 IP 通信。</li>\n<li>存储网络：负责 VMP 主机间存储数据通信，在使用 IPSAN 时，也作为与外置存储进行通信的接口。</li>\n<li>虚拟机业务网络：用于虚拟机访问业务网络或者互联网，可复用管理网络。</li>\n<li>客户端接入网络：客户端与 VDC 间的认证通信，客户端接入桌面时，与 VMP 集群的 “终端与主机通信口” 互通，获取虚拟机画面，默认的 “终端与主机通信口” 是管理口，故，客户端需要与 VMP 管理口互通。</li>\n</ul>\n<p>3，VMP 平台安装：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) VDS 一体机出厂时已经安装了 VMP 系统，上架前仅需要修改服务器默认 IP 即可。默认 ETH0 为管理口，IP 地址为 10.254.254.10，电脑配置同网段的 IP 地址进行登录，默认用户名密码为 admin。</li>\n<li></li>\n</ul>\n<h1 id=\"2021-7-15\"><a class=\"anchor\" href=\"#2021-7-15\">#</a> 2021-7-15</h1>\n<p>1，深信服云计算平台 SCP</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 定义：</li>\n<li>SCP (深信服云计算平台) 是一个功能全面，安全可靠的云管理平台，能够跨区域纳管 HCI 集群和 VMware 集群，并能将纳管的集群关联资源池，实现多资源池的管理。</li>\n<li>平台通过 “产品与服务”，“可靠中心”，“运营中心”，“应用中心” 和 “监控中心”，提供云主机，多租户管理，VPC 网络，弹性 IP，企业专线等基础服务的同时，还将备份，容灾，监控中心等可靠性服务集成到平台，降低了运维的难度，保证了业务的连续性和可靠性。</li>\n<li>(2) VPC 网络：</li>\n<li>vpc 网络是指私有网络，是针对公有云的基础网络来定义的一种概念，vpc 是公有云上自定义的逻辑隔离网络空间，是一块可我们自定义的网络空间，与我们在数据中心运行的传统网络相似，托管在 vpc 内的是我们在私有云上的服务器资源，如云主机，负载均衡等。</li>\n<li>(3) 简介：</li>\n<li>SCP 可以纳管多个数据中心，这些数据中心可以是跨地域的集群，也可以是 VMware 的数据中心，提供平台提供的超级管理员，租户，租户子账户三种角色类型，可以实现总公司与分公司，公司与部门间的分级管理，平台给租户提供了 VPC 网络，租户之间逻辑隔离，保障用户的信息与数据安全，并创新的将深信服 NFV 设备 (vAD，vAF，SSL VPN) 集成到 VPC 网络中，提供安全可靠，功能全面的网络环境。</li>\n<li>(4) 特点：</li>\n<li>SCP 集成了三大中心：“可靠中心”，“运营中心” 和 “监控中心”。</li>\n<li>可靠中心：包括业务可靠性\t，平台可靠性，硬件可靠性，以硬件为起点，平台为基础，业务为关键，多维度保障业务与数据的安全。</li>\n<li>运营中心：提供平台提供的超级管理员，租户，租户子账户三种角色类型，可实现总公司与分公司，公司与部门间的分级管理，平台支持自定义工单审批流程和计费功能，极大的增强了平台资源管理的灵活度。</li>\n<li>监控中心：平台提供了全方位的监控机制，可以实时监控云主机，数据库等关键业务，在保障业务连续性前提下，极大的降低了运维人员的运维难度。</li>\n<li>(5)OTP：</li>\n<li>动态口令 (OTP)：又称为一次性密码，是使用密码技术实现的在客户端和服务器之间通过共享密钥的一种认证技术，是一种强认证技术，是增强目前静态口令认证的一种非常方便技术手段，是一种重要的双因素认证技术，动态口令认证技术包括客户端用于生成口令产生器的，动态令牌，是一个硬件设备，和用于管理令牌及口令认证的后台动态口令认证系统组成。</li>\n</ul>\n<p>2，SCP 的安装部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>深信服 SCP 云计算平台目前只支持虚拟化部署在 HCI 平台上，以导入 VMA 格式的云主机方式部署，部署拓扑如下：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/16/WuxW7T.png\" alt=\"T\"></li>\n<li>注：SCP 云计算平台当前不支持部署在 VMware 平台上</li>\n<li>(2) 全新部署 SCP：</li>\n<li>登录 HCI 集群 ——&gt; 导入 SCP 虚拟机 ——&gt; 编辑虚拟机网络，映射 KEY——&gt; 控制台设置 SC 的 IP——&gt; 成功登录 SCP 平台 ——&gt; 导入序列号激活 SCP。</li>\n<li>(3) 主备部署 SCP：</li>\n<li>登录 HCI 集群 01——&gt; 部署主 SCP——&gt; 登录主 SCP 节点，添加备 SCP 节点。</li>\n<li>登录 HCI 集群 02——&gt; 部署备 SCP———&gt;</li>\n<li>(4) 安装步骤：</li>\n<li>登录 HCI 平台控制器</li>\n<li>点击【云主机 / 新增 / 导入云主机】</li>\n<li>选择 SCP 云主机，选择对应的分组，存储位置和运行位置，点击 &lt;开始导入&gt; 按钮，显示上传界面。</li>\n<li>上传成功后，选择导入的 SCP 云主机，点击【编辑】，添加 USB 硬件，将授权 key 映射给云主机。</li>\n<li>编辑网卡，将其连线与 HCI 平台管理网络二层 / 三层可达，点击 &lt;确认按钮&gt;。</li>\n<li>将导入的 SCP 云主机开机，登录 SCP 云主机控制台。</li>\n<li>鼠标点击云主机控制台任意一处，键盘键入 “enter” 键，进入维护模式，输入密码 (初始密码是 admin)</li>\n<li>使用键盘上下键选择 [设置网络]，键盘建入 “enter 键”。</li>\n<li>按照实际环境设置 IP 地址，掩码和网关，点击 &lt;确认&gt; 按钮。</li>\n<li>打开浏览器，输入 https:// 设置的 ip：4430，键入 “回车”。</li>\n<li>注：</li>\n<li>超级管理员 (admin)：登录需要加 4430 端口，租户和租户子账户用户登录则直接通过 ip 地址登录即可。</li>\n<li>默认账号密码为 admin/admin。</li>\n<li>(5) 主备部署：</li>\n<li>SCP 云计算平台支持主备部署，提升可靠性，可用于异地容灾场景，主 SCP 部署在主机房集群，备 SCP 部署在容灾机房集群，当主机方发生故障，SCP 主节点不可用时，可以手动将 SCP 备节点切换为主节点，保障管理平台的高可用性，目前只有当主节点不可用时再手动切换备节点，其他情况下无法随意切换。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/16/WKVRDe.png\" alt=\"T\"></li>\n<li>注：</li>\n<li>确保配置的 SCP 的 IP 不与其他主机 IP 地址冲突，且主备 SCP 之间网络可达。</li>\n<li>主备切换之后，备 SCP 节点进行重启操作后成为主 SCP 节点。</li>\n<li>切换后访问新的 SCP 会提示 USB-KEY 被拔出，授权即将过期，处理方法：30 天内必须将 USB-KEY 映射到切换后的新主 SCP 上，然后在主站点重新部署 SCP 云主机，将新部署 SCP 添加为备 SCP 节点。</li>\n</ul>\n<p>3，资源初始化：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 资源初始化流程：</li>\n<li>添加物理资源 ——&gt; 划分地址池 ——&gt; 集群授权</li>\n<li>1，添加物理资源：将已经准备好的物理资源，以集群为单位，添加到 SCP 平台，并将存储划分好标签。</li>\n<li>2，划分地址池：将添加好的集群，关联到资源地址池。</li>\n<li>3，集群授权，当前 SCP 云计算平台对超融合资源池有两种授权方式，分别为云管授权与独立授权。</li>\n<li>云管授权：通过 SCP 云计算平台，给关联到资源池中的集群进行授权，集群占用云平台授权，(该授权方式需要一个授权 key 与授权文件，例如：超融合集群 1 上部署有 SCP 平台，需要纳管超融合集群 2 和集群 3，集群 2 和集群 3 均通过云管授权的方式进行授权，此时仅需要一个授权 KEY 与匹配的授权文件。)</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/16/WKMJIg.png\" alt=\"T\"></li>\n<li>独立授权：超融合利用集群自身的 key 授权后，再被纳管致云平台，集群不占用云平台的授权，此时 SCP 平台对独立授权的集群只进行管理，不下发授权 (该授权方式需要 1+n 个 key，n 为独立授权的集群数量。例如：超融合集群 1 上部署有 SCP 平台，需要纳管超融合集群 2 和集群 3，集群 2 和 3 均通过独立授权的方式进行授权，此时需要 1+2 个授权 key，每个 key 有匹配的授权文件)。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/16/WK0GwQ.png\" alt=\"T\"></li>\n<li>注：</li>\n<li>由于一个超融合集群只能插一个授权 key，因此部署 SCP 平台的集群必须为云管授权。</li>\n<li>当 SCP 主备部署时，为避免备 SCP 切换为主 SCP30 天后授权丢失的情况，主备部署 SCP 时主备集群均使用云管授权。</li>\n</ul>\n<p>4，添加物理资源：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 深信服 SCP 支持纳管多个 HCI 集群和 VMware 集群，通过 SCP 平台实现统一管理多个资源池。</li>\n<li>(2) 指导 admin 管理员将已准备好的物理资源，以集群为单位，添加到 SCP 平台，并将存储资源划分好标签。</li>\n<li>(3) 高性能存储：读写性能强，用来创建高性能的云主机，一般给 SSD 存储类打此标签。</li>\n<li>(4) 性能型存储：读写性能较强，但是相对老化，一般是老旧存储。</li>\n<li>(5) 容量型存储：读写性能一般，但是容量大，安全性高，性价比高。</li>\n</ul>\n<p>5，划分地址池：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 纳管集群后，需要将集群与资源池关联，资源池是计算，存储，网络等资源的集合，是 SCP 云计算管理的基本单位，纳管后的集群只有关联资源池后，才能进行授权使用。</li>\n</ul>\n<p>6，安全资源授权：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 当 HCI 集群被 SCP 纳管并关联资源池后，NFV 设备只能在 SCP 上进行部署，同时需要在 SCP 上对 NFV 设备进行授权后，NFV 设备才能够正常使用。</li>\n<li>(2) NFV 资源池概览页面新增 “资源池” 和 “租户” 两个字段，用来区分 NFV 资源的所属，当 NFV 资源属于 admin 的时候显示 “-”，属于租户则显示租户名称。</li>\n<li>(3) 在【NFV 资源授权概述】处，对于租户的 NFV 设备，只支持编辑授权操作，不支持开机操作。</li>\n</ul>\n<h1 id=\"2021-07-16\"><a class=\"anchor\" href=\"#2021-07-16\">#</a> 2021-07-16</h1>\n<p>1，HCI 集群初始化有以下条件 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>需要根据集群内所有主机的 CPU 颗数购买充足的授权。</li>\n<li>单主机不支持虚拟存储；普通集群至少要求集群内需要 2 台或以上的主机；如果</li>\n<li>需要虚拟存储的条带化功能，则集群内需要 3 台或以上的主机；如果需要使用虚</li>\n<li>拟存储多卷功能，则需要至少 6 台或以上的主机。</li>\n<li>延伸集群至少 4 主机起步，加上 1 个仲裁节点。在实际部署中，要确保页面配置的主机位置与实际物理位置一致，否则不能起到机房级别的保护作用。两个故障域机房必须二层打通，仲裁节点链路不需要二层打通，只需要网络可达即可。</li>\n<li>如果不使用虚拟存储，使用外置存储作为集群的存储，则需要使用的外置存储支持共享（多台主机同时访问），支持 VAAI 特性（主要指 ats 属性），否则无法添加共享存储。</li>\n<li>建议生产环境和测试环境独立搭建不同集群。</li>\n<li>建议单集群不超过 24 台主机。</li>\n<li>禁止单台主机部署 HCI。</li>\n<li>序列号检查：序列号有效期如果低于一年，提醒用户及时续约。</li>\n<li>一键检测：实施完必须做，排除所有故障风险项。</li>\n<li>aDeploy 巡检工具检测：实施完必须做，排除所有故障风险项。</li>\n</ul>\n<p>2，数据通信口配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>HCI 集群部署后，需要为每台主机指定数据通信口，数据通信口要求使用千兆 (或万兆) 网口，并使用千兆 (或万兆) 交换机互联，（只有两台主机时，可以将数据通信口直连），为了提升数据通讯口的接口带宽和冗余，推荐配置聚合口作为数据通信口，此时对端交换机需要配置相应的聚合模式，</li>\n<li>数据通讯口默认配置为复用集群管理口，为了获得更高的网络转发性能，建议将管理通信口和数据通信口（Vxlan 设置到不同的网口）。</li>\n<li>不支持将两个不同角色的网口进行直接聚合，可将一个网口角色取消后再进行聚合，列：无法将 eth0（管理口）和 eth1（vxlan 口）直接聚合，可将 vxlan 口调整为 eth2，此时 eth0（管理口）和 eth1（无角色）可以聚合。</li>\n</ul>\n<p>3，创建全新虚拟机注意事项：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，Windows 系统磁盘分区列表有 MBR、GPT 两种，MBR 分区列表支持最大 2TB，GPT 分区列表支持最大 128PB。</li>\n<li>2.Linux 7 在安装时，请选择正确的时区，并检查时间是否正常，Linux 6 在安装时，请勾选 UTC，并选择正确的时区。</li>\n<li>3. 虚拟机启动时，其时间基准以 Host 机为准，不支持在运行中修改时间基准。</li>\n<li>4. 单个虚拟机核数不超过宿主物理主机核心数，避免 vCPU 调度会产生竞争问题。</li>\n<li>5. 每个虚拟机配置最多 16 块虚拟磁盘，单盘不超过 10T；如果需要更大容量磁盘，建议配置成多个磁盘。</li>\n<li>6.Host CPU 只有在虚拟机需要使用特殊指令集时开启（如大数据、人工智能等需要 AVX 指令集）。</li>\n<li>7. 重要虚拟机建议开启预先分配存储空间；勾选 “标记为重要虚拟机”； 关闭内存回收机制；勾选 “使用大页内存”。</li>\n<li>8.64 位 windows10 和 2016 使用 UEFI 方式安装失败，没有进入安装界面，进入了 UEFIshell 界面，可以通过在 shell 界面输入 exit，然后进入 boot 界面，boot 界面选择 continue 选项，然后按任意键开始安装。</li>\n<li>9. 新建虚拟机时，配置的操作系统类型一定要跟实际安装的操作系统类型一致。否则可能导致性能优化工具无法安装。</li>\n<li>10.RHEL5.5 等 Linux 系统的磁盘加载顺序跟 aSV 虚拟机的磁盘加载顺序不同，可能导致虚拟机磁盘顺序变化，虚拟机无法启动或磁盘无法访问等。可以编辑虚拟机选择启动磁盘，并建议 Linux 虚拟机使用 UUID 标识磁盘，不要用 sda、sdb 等名称标识。</li>\n<li>11.Linux 虚拟机的默认 BIOS 设置为 SANGFOR_LINUX_UEFI，如果导入虚拟机后系统无法启动，进入 UEFI Shell 界面，则尝试关机并修改设置为 Legacy BIOS 重新深信服超融合 HCI 用户手册 虚拟机配置指导</li>\n<li>12. 虚拟机挂起恢复后，时间还是以前的时间，没有跟现在的主机时间同步，需要手动修改时间。</li>\n</ul>\n<p>4，新磁盘的分配解释：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>动态分配：根据数据占用情况动态地分配存储空间，在提升性能的同时存储空间使用率也可以提高，最大容量为 8T。</li>\n<li>精简分配：根据实际数据占用大小，按需分配存储空间，可节省存储空间，最大容量为 63T。</li>\n<li>预分配：预先分配固定的存储空间，可提升磁盘性能但是会占用较多存储空间，最大容量为 4T。</li>\n<li>使用 Virtio 磁盘：能够大幅提升虚拟机的磁盘 IO 性能，但是某些版本的操作系统不支持此功能，可能会导致安装系统时找不到磁盘，建议不要更改默认设置。</li>\n<li>高级设置：条带数：指同时可以并发读或写的条带数量，这个数量等同于一个虚拟机同时使用的物理硬盘数量。该选项用来设置单台虚拟机的单块磁盘的条带数，建议采用默认设置。</li>\n</ul>\n<p>5，P2V：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>前情：</li>\n<li>将现有物理主机或其他虚拟化平台上的虚拟机的 windows/linux 操作系统及业务数据打包，通过网络克隆到 HCI 超融合平台上，迁移完成后原业务系统即可在 HCI 超融合平台上以虚拟机的形态继续运行，迁移过程中对原有操作系统不做任何修改。</li>\n<li>注意事项：</li>\n<li>迁移过程中需要保持网络稳定。</li>\n<li>ISO 和 exe 工具迁移虚拟机时，在超融合上操作都使用 admin 用户操作。</li>\n<li>P2V 迁移过程中，数据拷贝完成，代理已经收到迁移完成的消息并用已有镜像创建虚拟机的过程中断网 (在节点离线的情况下会出现)，只是任务日志会失败，实际已经迁移成功。</li>\n<li>不支持配置了 SR-IOV 直通类型网卡的 Vmware 虚拟机备份和迁移到 HCI。</li>\n<li>使用 ISO 包进行 P2V 迁移，要求物理机内存必须大于等于 3G。</li>\n<li>Oracle RAC 虚拟机禁止用 P2V 方案迁移。</li>\n<li>P2V 迁移只支持 windows 操作系统，且不支持迁移过程中产生的增量数据。</li>\n</ul>\n<p>6，全量克隆与快速全量克隆说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>全量克隆功能说明：</li>\n<li>通过虚拟机全量克隆，可以创建一台或多台跟原有虚拟机完全一致且独立于原虚拟机的全新虚拟机。</li>\n<li>注意事项：</li>\n<li>克隆出来的虚拟机跟原有虚拟机消息完全一致，克隆完成后的虚拟机网口默认未启用，启用网卡前关闭原虚拟机或修改克隆后虚拟机 IP，避免 IP 冲突。</li>\n<li>克隆出来的 MAC 地址会发生变化，Linux 操作系统的虚拟机克隆出来后需要注意配置网络。</li>\n<li>避免虚拟机在备份时进行全量克隆。</li>\n<li>快速全量克隆说明：</li>\n<li>通过虚拟机快速全量克隆，可以创建一台或多台跟原有虚拟机完全一致且独立于原虚拟机的全新虚拟机，此方式具有虚拟机启动快，数据最终独立，克隆完成后性能完全无影响等特点，时平台推荐的克隆方式。</li>\n<li>注：</li>\n<li>快速全量克隆数据合并过程中无法对虚拟机进行编辑操作。</li>\n</ul>\n<p>7，链接克隆：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>功能说明：</li>\n<li>通过虚拟机链接克隆，可以创建一台或多台跟原有虚拟机完全一致且独立于原虚拟机的全新虚拟机。</li>\n<li>此方式具有</li>\n<li>1，虚拟机启动快，</li>\n<li>2，数据非独立，节省存储空间，</li>\n<li>3，克隆完成后，性能仍会有影响等特点，推荐在功能开发测试等性能不敏感场景使用。</li>\n</ul>\n<p>8，虚拟机模板部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>通过虚拟机模板部署，可以创建一台依赖于原虚拟机模板且跟原有虚拟机完全一致的全新虚拟机，在虚拟机上执行模板部署后，该虚拟机的镜像将会作为基镜像并自动转换为模板虚拟机，此时模板虚拟机不能开机，也无法被删除，只有当模板虚拟机部署的虚拟机均删除后才能删除该模块。</li>\n<li>注：</li>\n<li>进行模板部署操作后，模板虚拟机不能开机，也无法被删除，只有当模板虚拟机部署的虚拟机均删除后才能删除改模板。</li>\n<li>由模板部署的虚拟机，不能再转换为模板。</li>\n<li>特点属性的虚拟机无法作为模板虚拟机，如多磁盘，配置了 CDP 策略。</li>\n<li>删除模板和派生虚拟机到回收站，再从回收站还原派生虚拟机会失败，</li>\n<li>跨存储热迁移会改变派生虚拟机属性，派生虚拟机变成普通虚拟机。</li>\n</ul>\n<p>9，规划 VPC 网络出口：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>VPC 网络出口是给每个资源池指定一个固定的 VPC 网络出口。设置成功后，在创建租户时生成 VPC 网络，默认连通该网络口；如需创建租户，请先为每个资源池指定一个固定的 VPC 网络出口。</li>\n<li>注：</li>\n<li>VPC 网络设置后，如果需要修改，请先删除资源池中的所有租户。</li>\n</ul>\n<p>10，SCP 镜像管理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>深信服 SCP 云计算平台镜像可分为公共镜像、私有镜像、NFV 镜像.</li>\n<li>公共镜像由平台管理员上传，可供平台管理员、租户、租户子账户使用。</li>\n<li>私有镜像由租户上传，供租户和租户子账户自己使用，平台管理员有删除私有镜像的权限。</li>\n<li>NFV 镜像由 admin 管理员上传，可供 admin 管理员、租户使用。</li>\n<li>公共镜像和私有镜像分为 ISO 镜像、内置镜像（HCI 镜像）两种类型，ISO 镜像是 iso 格式的文件，内置镜像（HCI 镜像）由云主机转换制作生成。</li>\n<li>注：</li>\n<li>上传镜像时，必须要选择一个分发的资源池。</li>\n<li>镜像分发到一个资源池后，可以通过 [编辑] 分发到其他的资源池。</li>\n<li>(1) 公共镜像：</li>\n<li>由 admin 管理员上传或制作，可供 admin 管理员、租户、租户子账户使用。</li>\n<li>注：</li>\n<li>ISO 类型的公共镜像可以直接上传并分发至不同版本的资源池。</li>\n<li>内置镜像类型的公共镜像仅支持分发至同版本的资源池，无法分发至不同版本的资源池。</li>\n<li>由 HCI 云主机制作镜像时，镜像由云主机的系统盘制作，请将其他盘的重要数据迁移至系统盘，再制作镜像。</li>\n<li>(2) 私有镜像：</li>\n<li>admin 可以为租户上传私有镜像，私有镜像只能租户自己使用，此时，私有镜像将占用租户的私有镜像空间。</li>\n<li>admin 可以将镜像上传至云平台，并将镜像分享给租户使用，且不占用其他租户的私有镜像空间。</li>\n<li>admin 可以将租户的私有镜像转为公有镜像，供其他租户使用。</li>\n<li>注：</li>\n<li>私有镜像为内置镜像类型时，无法分发给不同版本的资源池。</li>\n<li>admin 可以对租户的私有镜像进行删除和转为公共镜像操作，转为公共镜像后，所有租户均可使用该镜像。</li>\n<li>(3) NFV 镜像：</li>\n<li>当需要使用虚拟网络设备时，admin 管理员需要上传网络设备镜像，才能创建相应的网络设备实例。</li>\n<li>NFV 设备主要有：AF（下一代防火墙），AD（应用交付），SSL VPN，AC（上网行为管理），WOC（广域网优化），DAS（数据库安全审计）。</li>\n<li>其中 VPC 网络支持 AF、AD、SSL VPN 三种设备。</li>\n</ul>\n<p>11，云主机管理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>云主机作为深信服 SCP 云计算平台承载业务的基本单位之一，平台管理员可对云主机进行全生命周期的管理：包括创建、开机、关机、导入、导出、删除、分配、回收等。</li>\n<li>SCP 平台支持使用 ISO 镜像和内置镜像（HCI 镜像）创建全新云主机，也支持从本地导入已有的云主机。</li>\n<li>注：</li>\n<li>通过 ISO 创建的云主机，需要进入控制台手动安装操作系统。</li>\n<li>通过内置镜像创建的云主机，创建完毕后，可以直接使用，无需手动安装操作系统。</li>\n<li>克隆具有使用期限的云主机，克隆出来的云主机使用期限是无限制的。</li>\n<li>只支持对 HCI 云主机设置使用期限，不支持对 VMware 云主机设置使用期限。</li>\n<li>云主机即将到期或者已到期，不会影响云主机的任何操作，只会新增 1 条即将到期 / 已到期的告警日志并修改云主机的状态为告警。</li>\n</ul>\n<p>12，弹性 IP 池：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>弹性 IP 是独立的 “公网 IP” 资源，可以绑定到 VPC 网络的云主机、路由器、应用交付、SSL VPN 等设备上，并可以动态解绑，实现公网 IP 和这些设备的解耦，满足灵活管理、动态分配的要求。</li>\n<li>注：</li>\n<li>弹性 IP 需要先创建弹性 IP 池，将弹性 IP 池与资源池关联，IP 池才能供租户使用。</li>\n<li>一个弹性 IP 池可绑定给多个资源池，一个资源池也可绑定多个弹性 IP 池，资源池绑定的弹性 IP 池，其下所有的 VPC 都可见。</li>\n<li>线路类型可以自定义创建，但是系统内置的线路类型，不支持编辑。</li>\n<li>弹性 IP 配额支持分线路类型为租户设置配额。</li>\n<li>已分配配额的弹性 IP 池不支持修改弹性 IP 线路类型、删除弹性 IP。<br>\n13，公共服务网络 ：</li>\n</ul>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>深信服 SCP 云计算平台加入公共服务网络，用于云上公共服务场景，构建公共服务网络作为公共服务区和资源池租户之间的专用通道。可将 NTP 服务器、授权服务器、NAS、安全中心、应用中心等部署于公共服务区，满足租户对公共服务的访问需求。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/19/WG71n1.png\" alt=\"T\"></li>\n<li>注：</li>\n<li>租户经典网络无法通过域名访问公共服务，需单独部署 DNS 服务器。</li>\n<li>公共服务的 IP 需要与公共服务网络弹性 IP 同段，且排除在弹性 IP 池之外。</li>\n<li>存在公共服务的情况下，无法修改公共服务网络出口。</li>\n<li>公共服务网络的管理界面只能由 admin 进入，租户没有管理入口。</li>\n<li>公共服务网络的配置只会再 VPC 网络下生效，经典网络需要管理员手动配置，其中要求配备好 DNS 服务器使其能够解析公共服务域名，并且用户云主机的网络需要与公共服务区可达。</li>\n<li>公共服务仅支持单向访问，即支持租户访问公共服务，而公共服务区无法访问租户 vpc 内网。</li>\n</ul>\n<h1 id=\"2021-07-19\"><a class=\"anchor\" href=\"#2021-07-19\">#</a> 2021-07-19</h1>\n<h1 id=\"vgpu\"><a class=\"anchor\" href=\"#vgpu\">#</a> VGPU</h1>\n<p>1，VGPU 功能，主要适用于以下场景：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>win10 办公、上网、看视频普通办公场景；</li>\n<li>企业 2D 制图场景；</li>\n<li>企业 3D 设计、图形工作站设计类场景；</li>\n<li>3D 教学、实训室场景。</li>\n</ul>\n<p>2，VGPU 的优势：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，灵活：GPU 资源池化，能支持不同的显卡切分模式，硬件复用灵活，可适应客户不同需求场景，比如白天跑办公，晚上跑图形工作站；</li>\n<li>2. 高效：对显卡的核心进行切分，提高核心的利用率；</li>\n<li>3. 易使用：操作简单，易于使用。可直观看到显卡的使用状态；</li>\n<li>4. 可视化：动态监控显卡资源，为后续硬件扩容提供参考，促进合理化投资。</li>\n</ul>\n<p>3，VGPU 功能原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 虚拟机 VGPU 通过在虚拟化层 (超融合架构) 内置 NVIDIA 提供的 vGPU 管理组建，负责将物理显卡的 GPU 核心切分成多个虚拟 GPU 硬件，再由平台调度给虚拟机使用。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/19/WGkuJH.png\" alt=\"T\"></li>\n<li>(2) 显卡核心：</li>\n<li>即 CPU 显卡中负责承载图形计算的部分，普通显卡一般只有一个 GPU 核心，高端显卡在一块显卡上有多个显卡核心，每个核心各自有独立显存。</li>\n<li>(3) 显卡切分：</li>\n<li>vGPU 的实现方式，将单颗核心切分成多个 vGPU 提供给不同虚拟机使用，但这里切分的实际是显卡核心的显存，显卡核心的计算能力是共享的。由于 NVIDIA 目前 vGPU 技术的限制，现阶段只能实现对显存的等值切分，因此一个显卡核心只能虚拟出一种型号的 vGPU。当显卡核心上最后一台虚拟机关机时，会清理掉该核心上切分过的显卡类型，即重新初始化该显卡核心，以供下次使用。</li>\n</ul>\n<p>4，虚拟机 VGPU 模块具体配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) VMP 集群上部署 NVIDIA 授权服务器。</li>\n<li>(2) 模板虚拟机完成显卡配置。</li>\n<li>注：完成以上配置后，VDC 上用模板派生的虚拟机即为正常可用的 3D 虚拟机 (需保障派生机与授权服务器网络通信正常)。</li>\n</ul>\n<p>5，VGPU 模块功能 —— 显卡分配模式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 在主机内部，3D 虚拟机被分配运行在哪个 GPU 核心由显卡分配模式决定，显卡分配模式包含：密度模式和性能模式。</li>\n<li>“密度模式” 表示具有相同型号虚拟显卡的虚拟机会优先在同一 GPU 核心上运行，以空闲出更多核心供其他虚拟显卡类型虚拟机运行。因此 “密度模式” 适用于存在多种虚拟显卡类型虚拟机经常开关机的场景。</li>\n<li>“性能模式” 表示 3D 虚拟机优先选择显存空闲最大的 GPU 核心运行，以确保已开机的虚拟机都能得到最大的 GPU 核心算力。因此 “性能模式” 适用于大部分虚拟机为相同虚拟显卡类型的场景。</li>\n</ul>\n<p>6，VGUP 安装时注意事项：</p>\n<div class=\"note info\">\n<p>如下<br>\n:</p>\n<ul>\n<li>1.M10、M60 显卡主机上，直通模式虚拟机需要手动设置显卡核心为直通，虚拟机显卡类型为直通；</li>\n<li>2. 直通模式下，显卡核心的信息只能在虚拟机内部获取，VMP 无法获取核心信息（核心温度，使用率等）；</li>\n<li>3. 设计类场景系统必须使用 64 位，推荐优先采用 win7 企业版，win10 系统则必须采用专业版 1709 版本；</li>\n<li>4. 一个显卡核心只能切分成一种 VGPU，如 1Q 与 1B 不能同时运行在一个显卡核心上；</li>\n<li>5. 带显卡的 3D 服务器默认会限制 2D 派生虚拟机运行（已指定运行位置的除外），要允许 2D 派生虚拟机可在对应 3D 主机修改派生虚拟机运行限制为无限制；</li>\n<li>6. 同台服务器显卡不能异构，一个服务器只能配置一种型号显卡。<br>\n7，英伟达：</li>\n</ul>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n</div>\n<ul>\n<li>英伟达服务器地址访问不了时，关闭服务器防火墙设置！！。</li>\n</ul>\n<p>8，HCI 配置定时坏道扫描：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>系统将定时周期性的扫描硬盘上的数据，当检测到存在坏道时，将自动修复坏道上的数据。</li>\n<li>(2) 注：</li>\n<li>坏道扫描是支持机械盘，全闪存环境下不支持坏道扫描和修复。</li>\n<li>坏道扫描会在设定的时间内进行，如本次为完成一轮扫描，则会在下次扫描时从本次扫描结束的位置开始。</li>\n<li>坏道扫描的速度会根据磁盘繁忙程度动态调整，对存储性能影响 &lt; 5%。</li>\n<li>坏道扫描和修复仅对数据区进行，不扫描磁盘空白区。</li>\n<li>延伸集群仅支持坏道扫描，不支持坏道修复。</li>\n<li>触发坏道修复任务时，会界面同时存在一个数据同步任务。</li>\n</ul>\n<p>9，HCI 配置数据重建等待时间：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>通过数据重建功能，在组件发生故障后，将以故障组件上数据的另一副本作为修复源，以分片为单位在目的组件上重建出新的副本，恢复副本的完整性，实现系统自愈。</li>\n<li>(2) 注：</li>\n<li>要支持主机的自动重建功能，HCI 集群主机台数必须为 4 台及 4 台以上。</li>\n<li>两主机无热备盘时，发生磁盘故障，不支持自动重建。</li>\n</ul>\n<p>10，HCI 更改虚拟存储网络配置 (高危操作)</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>存储私网是单独为虚拟存储搭建通信网络，可以提升数据传输的效率，也可以保障数据同步的一致性。通常情况，虚拟存储中包含了非常重要的用户数据，为了避免因为网络问题带来的数据同步风险，可以搭建存储私网来保障。但存储私网要求物理主机提供单独的网口来供存储通信使用。</li>\n<li>(2) 说明：</li>\n<li>检查存储私网口采用链路聚合方式或者万兆口。</li>\n<li>禁止在 HCI 平台运行过程中调整网络布线，容易因插拔网线出现交替网络，导致数据脑裂，数据丢失。</li>\n<li>HCI 运行过程中禁止拔缓存盘，必要时通过磁盘管理替换磁盘，或停机处理。</li>\n<li>需要关闭所有运行的虚拟机以及虚拟网络设备。</li>\n</ul>\n<p>11，HCI 更改网络连通性探测 IP 地址（高危操作）：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>探测 IP 地址是一个网络连通性的探测 IP，通过 ping 这个 IP 地址，来判断是否因为网络中断而导致物理主机被孤立。</li>\n<li>(2) 注：</li>\n<li>两台主机才需要探测 IP，三台主机不需要。</li>\n<li>探测 IP 跟管理网络在同一网段，且能够 Ping 通。</li>\n</ul>\n<p>12，HCI 添加 FC 存储：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>HCI 支持添加 FC 存储作为外置存储，让虚拟机的存储位置放到 FC 存储上。FC 作为外置共享存储，存储位置为共享存储的虚拟机可以实现 HA 功能。</li>\n<li>(2) 注：</li>\n<li>添加 FC 存储的卷到 HCI 时会将卷进行格式化，在添加前请确认该卷没有被其他主机使用。</li>\n<li>如果待添加的 FC 存储之前被 HCI 添加过，那么再次添加时会提示是否恢复 FC 存储上的虚拟机。</li>\n<li>建议云服务器配置两个 HBA 卡，每个 HBA 卡配置一个存储光模块，单链路带宽 6GE 以上。</li>\n<li>禁止使用不支持 ATS 指令的外置存储跑生产业务，(明确存储上是否支持 VAAI 接口)，使用的外置存储需要支持共享 (多台主机同时访问)，支持 VAAI 特性 (主要指 ATS 属性)，否则无法添加共享存储。</li>\n<li>禁止在 HCI 使用的外置存储做缩容操作。</li>\n<li>禁止在 HCI 使用的外置存储上，使用精简分配 / 动态分配进行磁盘超配。</li>\n<li>添加 FC 外置存储之前，需要点击 &lt;重新发现硬盘&gt;，再点击 &lt; 添加存储 &gt;。</li>\n<li>HCI 主机上需要有 HBA 卡，可以连接到 FC 存储的光纤交换机上。</li>\n<li>FC 存储和光纤交换机需要正确配置，将相应的卷映射给 HCI 主机使用。</li>\n<li>存储必须支持硬件加速或 ATS 特性，否则无法添加到 HCI 平台。</li>\n</ul>\n<p>13，aDesk 配置集群 IP：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>通常情况可以直接通过平台中的任一主机 IP 来管理此集群。但如果该主机故障或连接该主机失败后，将无法继续管理集群。使用集群 IP 后，可以避免主机故障而导致无法正常管理集群的情况。通过集群 IP 连接到此集群时，可以更加稳定的管理虚拟机。集群 IP 是指访问 VMP 集群使用的 IP，默认访问的是主控。</li>\n<li>(2) 注：</li>\n<li>集群 Ip 与主机网卡 IP 需要再同一网段，但不能配置为相同的 IP，否则会引起 IP 冲突。</li>\n<li>集群 IP 需地址要和所有主机的管理 IP 在二层网络中同网段。</li>\n<li>配置完集群 IP 后，在浏览器中重新通过集群 IP 地址登录控制台。</li>\n</ul>\n<p>14，aDesk 虚拟存储部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 注：</li>\n<li>单台主机时默认使用复用 VMP 管理口。</li>\n<li>VMP 集群默认使用 ETH0 作为管理网口和集群通信口，用于同步 VMP 配置，存储通信网口用于同步虚拟存储的文件数据，两者建议使用不同的物理网口和不同的 IP 地址段，推荐使用 “双交换机链路聚合” 的方式组建存储通信网络。</li>\n<li>创建多卷时需要配置虚拟 IP 池，主要作用是卷之间进行通信，虚拟 IP 池的网段可以是任意，确保是没有用的就可以。</li>\n</ul>\n<p>15，aDesk 配置存储通信网口：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>VMP 主机组建为集群后，在 VMP 控制台 [存储 / 虚拟存储 / 创建卷]。</li>\n<li>点击 &lt;立即配置&gt;，为集群各台主机间的存储通信配置部署方式。</li>\n<li>(2) 部署方式介绍：</li>\n<li>无链路聚合：每台主机使用单独的一个网口进行存储通信。</li>\n<li>单交换机链路聚合：每台主机使用两个网口进行存储通信，通信网口全都接到同一个二层交换机上。主机间存储通信网口会自行进行链路聚合（不需要交换机配置链路聚合）。</li>\n<li>双交换机链路聚合：每台主机使用两个网口进行存储通信，两个网口分别接到两个二层交换机上。主机间存储通信网口会自行进行链路聚合（不需要交换机配置链路聚合）</li>\n<li>(3) 注：</li>\n<li>两台交主机可以选用双交换机链路聚合方式，用两条网线将 2 台主机的存储网口直连起来，无需额外的交换机。</li>\n<li>三台主机或以上建议使用双交换机链路聚合方式，每台主机使用 2 个存储网口分布接到不同的二层交换机中，交换机上无需配置聚合模式。</li>\n<li>选择存储通信部署方式后，按该部署方式的示意图进行接线 (主机间存储通信网口会自动进行链路聚合，不需要交换机配置链路聚合)</li>\n<li>选择每台主机对应的存储通信网口并配置通信网口地址，注意使用网口 IP 与其他网口 IP 不同段。</li>\n</ul>\n<h1 id=\"2021-07-20\"><a class=\"anchor\" href=\"#2021-07-20\">#</a> 2021-07-20</h1>\n<h2 id=\"vdc安装与配置\"><a class=\"anchor\" href=\"#vdc安装与配置\">#</a> VDC 安装与配置</h2>\n<p>1，VDC 平台安装：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) VDC 是桌面云平台不可少的一部分，独享桌面派生，VDI 用户权限管理等均在 VDC 平台上进行，对于新部署的桌面云环境，需要手动在 VMP 平台上创建软件 VDC 虚拟机，并配置 VDC 的管理地址。</li>\n<li>(2) 注：</li>\n<li>如果是多台 VMP 主机组集群，则建议至少创建两台软件 VDC，分别指定其运行位置为不同主机，关闭其故障迁移 HA 功能，然后将 VDC 组建为集群。</li>\n<li>软件 VDC 创建安装完成之后在高级选项，勾选 “虚拟机异常自动重启” 功能。</li>\n<li>(3) 另外：</li>\n<li>新建虚拟机，配置 VDC 的管理地址，IP 可配置为与管理网同一网段，然后使用配置的 IP 地址登录 VDC 控制台，打开浏览器输入 https://ip:4430。默认密码为 admin</li>\n</ul>\n<p>2，VDC 集群部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>集群可以使一组相互独立的服务器在网络中表现为单一的系统，并以单一系统的模式加以管理，集群的各个节点（就是指 VDC 设备）由一个分发器和一组真实服务器组成，分发器和真实服务器都是 VDC 设备 (分发器本身也是一台真实的服务器)，网络客户接入 VDI 的时候，会由分发器合理的分配给集群中最空闲的真实服务器为客户提供服务，集群可以达到提高容量和性能的目的，为客户提供更高可靠的服务。</li>\n<li>(2) 集群的条件：</li>\n<li>存在两台 VDC 设备版本是一致的，确认 VDC 的 IP 地址在同一个内网段内，即在一个同一个广播域内。</li>\n<li>每台 VDC 设备上均需要启用集群部署，且需要配置相同的集群 IP。</li>\n<li>软件 VDC 和硬件 VDC 可以组建集群。</li>\n<li>VDC 集群的授权是指集群授权之和。</li>\n<li>建议分别在分发器和真实服务器上都开授权序列号，如果只有一个授权序列号，则其他 VDC 上需开启零授权序列号进行授权。</li>\n<li>禁止将克隆出的软件 VDC 与克隆前的 VDC 组建集群。</li>\n<li>(3) 分发器选举规则：</li>\n<li>分发器选择优先级有，高，中，低，每种级别对应的优先级数值不同，也可以选择自定义级别，优先级数值越小，优先级越高，VDC 在组建集群的时候会根据各自的优先级来选举分发器，优先级最高的会被选举为分发器。VDC 集群中只有一台 VDC 勾选 “优先作为分发器”。</li>\n<li>(4) 设置集群 VDC 集群 IP：</li>\n<li>VDC 单臂模式部署时，集群中所有 VDC 设备的 LAN 口 IP 和此处的 LAN 口集群必须在同一个网段，</li>\n<li>网关模式部署时，集群中所有 VDC 设备的 wan 口 IP 需要在同一个网段，但是此处的 WAN 口集群 IP 必须在不同网段。</li>\n</ul>\n<p>3，配置虚拟化平台控制器：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>通过在 VDC 控制台添加虚拟化平台控制器，将 VDC 与 VMP 关联起来，后续 VDC 才可以利用 VMP 平台的虚拟机模板进行派生虚拟机，对虚拟机进行开关机等操作。</li>\n<li>(2) 注：</li>\n<li>VMP 为集群时，虚拟化平台控制器的地址需要写集群管理口 IP，不可填写主机 IP。</li>\n<li>如下情况可能会测试链接失败。</li>\n<li>VMP 离线，确保 VMP 处于在线状态。</li>\n<li>VMP 默认链接端口 4433 已修改，需将地址端口修改为 VMP 所使用端口。</li>\n</ul>\n<p>4，Windows 虚拟机安装 Agent 程序步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>进入虚拟机控制台。</li>\n<li>使用浏览器访问 https://VDC 管理口 IP:4430，进入 VDC 控制台。</li>\n<li>点击 [VDI 设置 / 虚拟机管理 / 其他操作]，在下拉菜单中选择 [下载 Windows 虚拟机 Agent 程序]，Agent 程序会自动下载至本地，根据向导安装即可。</li>\n<li>注：</li>\n<li>请勿在本地物理机上安装 Agent 程序。</li>\n</ul>\n<p>5，交换机 VLAN Trunk 和 Access 标签说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/20/Wtzw3n.png\" alt=\"T\"></li>\n</ul>\n<p>6，超融合会使用的对应接口功能：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>管理通信口用于主机间信息同步，集群管理，虚拟机操作等</li>\n<li>业务口是虚拟机对应的出口</li>\n<li>VXLAN 口是集群内虚拟机之间数据通信口</li>\n<li>存储私网口是集群内主机虚拟存储之间数据通信口</li>\n<li>(2) 注：</li>\n<li>物理出口选择业务口，用于虚拟网络跟实际的办公网络通信。</li>\n<li>VXLAN 口是数据通信口，是用于虚拟机内部通信，即运行在 aCloud 上的虚拟机之间通信使用的口。</li>\n</ul>\n<p>7，外置存储的问题：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>如果虚拟机在虚拟存储，虚拟机运行的主机异常故障后是会被 HA 拉起来的</li>\n<li>如果虚拟机是在外置存储，要看两台主机是否都有访问外置存储的权限，如果有一台主机没有访问外置存储的权限那么故障后是无法 HA 的，如果两台主机都有，是可以自动 HA 的</li>\n<li>注意虚拟机的运行位置一定要是自动运行的。</li>\n</ul>\n<p>8，EDS 与 HCI 组网最佳实践 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>HCI 挂载 EDS 存储时，必须使用万兆网络作为存储网络，若在 HCI 网口足够的情况下，使用单独的万兆口跟 EDS 的存储外网口对接，若网口不够，推荐使用 HCI 的存储私网跟 EDS 的存储外网做对接，如果运行在 HCI 集群中的虚拟机也需要挂载 EDS 存储，则需要将 HCI 的业务口与 EDS 的存储外网打通，HCI 平台挂载 EDS 存储，根据 HCI 存储私网的部署模式，可以分为以下两种场景：</li>\n<li>HCI 存储私网采用单交换机链路聚合时，按照以下网络进行部署：</li>\n<li>将两个交换机配置为 M-LAG 组，并将 HCI 的聚合口分别接到跨交换机上，EDS 的存储外网配置为主备和链路均衡模式的聚合模式，分别接到跨交换机的 M-LAG 端口组上，建议 HCI 和 EDS 全新部署时采用此方式部署。</li>\n<li>HCI 存储私网采用双交换机链路聚合时，按照以下网络进行部署：</li>\n<li>建议将 HCI 存储私网调整为单交换机链路聚合模式，然后对接 EDS。</li>\n<li>(2) 注：</li>\n<li>如果即使用高性能存储池，又使用通用型容量存储池，推荐在 EDS 上配置不同的万兆口承载不同的存储业务。</li>\n<li>HCI 平台挂载 EDS 存储时，如果使用 HCI 的存储私网与 EDS 的存储外网对接，需要将 EDS 的存储外网跟 HCI 的存储私网规划在同一个网段。</li>\n<li>在 HCI 集群页面调整 HCI 存储私网需要中断业务，调整前务必提前确认停机时间。</li>\n</ul>\n<p>9，EDS 一体机：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>EDS 一体机出厂时已经安装了 EDS 的系统，上架前仅需要修改服务器的默认 IP 地址即可。</li>\n<li>EDS 一体机修改默认 IP 地址，默认 ETH0 为管理口，默认 IP 地址为 10.252.252.1。</li>\n<li>使用网线链接 PC 的物理网口和一体机的 Eth0 口，设置和一体机同网段的 IP 地址，在浏览器中输入 https://10.252.252.1 登录。默认账号密码为 admin。</li>\n<li>(2) 集群初始化：</li>\n<li>EDS 集群默认选择第一台操作主机作为集群控制器，以下所有操作均在这台集群控制器上进行。</li>\n<li>(3) EDS 组建集群：</li>\n<li>按照拓扑图连接交换机和 EDS 主机。</li>\n<li>所有 EDS 主机管理口 IP 地址为同网段 IP 地址，且接到同一交换机上。</li>\n<li>按照规划，如 EDS 网口为聚合口，对端交换机对应端口需提前配置好对应的聚合模式。</li>\n<li>存储私网地址不支持修改。</li>\n<li>在一个正常的已经创建好的集群中加入网卡时，暂时不支持识别新网卡，需要在创建集群前插好新网卡。</li>\n</ul>\n<p>10，存储池创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>EDS 集群创建完毕后，需要创建虚拟存储池才可以使用，存储池分为高性能块存储和容量型通用存储两种，容量型通用存储池提供文件存储和对象存储服务，高性能块存储池提供块存储服务。</li>\n<li>(2) 注：</li>\n<li>一个集群只允许创建一个高性能块存储池和一个容量型通用存储池。</li>\n<li>(3) 创建容量型通用存储池：</li>\n<li>在提供文件存储和对象存储服务前，需先创建容量型通用存储池。</li>\n<li>创建容量型通用存储池，所有缓存盘大小需要保持一致。</li>\n<li>必须采用三台及以上的 EDS 组建集群才能部署通用型容量存储池，根据加入存储池的主机的磁盘及主机中磁盘的用途，部署通用型容量存储池分为三种模式，通用模式，性能模式，经济模式。</li>\n<li>通用模式：每个主机 SSD 与 HDD 数量比列大于 1：5，每台主机需配置 2 块以上 SSD，适用于文件存储场景，默认推荐通用模式。</li>\n<li>性能模式：每台主机 SSD 与 HDD 数量比列大于等于 1：5，每台主机需配置 2 块以上 SSD 和一块高性能 PCIE SSD，适用于高性能的文件存储场景。</li>\n<li>经济模式：每台主机需配置 1 块 SSD，HDD 数据不限，经济模式仅用于大容量视频监控。</li>\n<li>(4) 创建高性能块存储：</li>\n<li>在提供块存储前，需先创建高性能块存储。</li>\n<li>创建高性能块存储池最少选择 3 台主机，单台主机内磁盘数量选择需满足磁盘组的限制：每主机至少配置一个磁盘组 (单磁盘组至少 1 块 SSD+2 块 HDD)，高性能块存储最大支持配置 1000 块磁盘。</li>\n<li>在部署上，如果有强性能要求，建议独立部署块存储集群。</li>\n<li>注：</li>\n<li>加入到块存储的主机之间，数据盘的容量不能超过主机容量总和的 50%，例如，A 主机 10T，B 主机 16T，是绝对不允许的。</li>\n<li>加入到块存储池的主机之间，数据盘的个数之差不能超过 3 个，例如，A 主机有 5 块 2T 的，B 主机有 9 块 2T 的，是绝对不允许的。</li>\n<li>加入到块存储池的主机，缓存盘跟数据盘的个数比应该在 1:7 以内，例如 A 主机有 1 块缓存盘，有 11 个数据盘，是不允许的。</li>\n</ul>\n<p>11，云桌面整体的实施过程：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>\n<p>1、前提：</p>\n</li>\n<li>\n<p>USB 授权 KEY 一张。注意：桌面云没有 key 授权也可以使用，刚开始安装 VMP 不插 key，可以试用 60 天。</p>\n</li>\n<li>\n<p>标准版：不使用 KEY 的场景，可以使用的虚拟机数量最多 35 台，虚拟机内存最大 4G，虚拟机核数最大 2 核，VDC 试用 60 天，VDC 上支持 30 个用户。</p>\n</li>\n<li>\n<p>企业版：需要 KEY 的场景，虚拟机数量受序列号限制，最大 65535 台，虚拟机内存受序列号限制，最大 8G（4.8 开始 32G），虚拟机核数最大 8 核，使用 VDC，需要开 VDC 的授权。</p>\n</li>\n<li>\n<p>服务器 1 台（此案例是 2 台后续做集群和虚拟存储）。</p>\n</li>\n<li>\n<p>注意区分 key：红色：测试 KEY，黄色：正式 KEY，白色：备用 KEY.</p>\n</li>\n<li>\n<p>2、第三方服务器安装 VMP 的硬件配置要求：</p>\n</li>\n<li>\n<p>CPU：64 位 CPU，必须支持 Intel® Virtualization Technology (VT-x)。</p>\n</li>\n<li>\n<p>内存：大于 4GB，4G 为系统保留，其余内存才能用于虚拟机。</p>\n</li>\n<li>\n<p>磁盘：大于 60GB，60G 为系统占用，其余空间用于虚拟机，且系统盘不能用于虚拟存储。</p>\n</li>\n<li>\n<p>其他：千兆 / 万兆有线网卡，至少 1 张，推荐 3 张以上。</p>\n</li>\n<li>\n<p>注意：第三方服务器安装 VDI5.2 要求主机内存大于 3.5G 即可.</p>\n</li>\n<li>\n<p>3、第三方服务器安装 VMP 的注意事项：</p>\n</li>\n<li>\n<p>目前只支持 Intel 的 CPU 安装 VMP，服务器支持并且需要开启 CPU 虚拟化 VT-x/VT-d（否则：无法安装 VMP）。</p>\n</li>\n<li>\n<p>关闭 CPU 节能模式（因为：节能模式会通过动态降低 CPU 主频以达到节能目的，会导致主机无法充分发挥 CPU 性能，虚拟机运行会非常卡）。</p>\n</li>\n<li>\n<p>校对 BIOS 时间（因为：BIOS 时间会影响授权计算，可能导致序列号无效）。</p>\n</li>\n<li>\n<p>启用加电自动开机（目的：比如服务器异常断电了，来电后会自动加电开机）。</p>\n</li>\n<li>\n<p>切换启动方式 UEFI/Legacy：推荐使用 Legacy 方式启动，兼容性较好。（注意：1，仅当 Legacy 启动模式安装不上，尝试使用 UEFI 启动模式。2，当系统盘超过 2TB 时才使用 UEFI）。</p>\n</li>\n<li>\n<p>有多块磁盘时要注意设置启动顺序，优先从安装 VMP 系统那块硬盘启动，否则会起不来。</p>\n</li>\n</ul>\n<h1 id=\"2021-07-21\"><a class=\"anchor\" href=\"#2021-07-21\">#</a> 2021-07-21</h1>\n<p>1，云计算的价值：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>云计算是新技术 + IT 业务模式的创新。</li>\n<li>按需，自助。</li>\n<li>广阔的网络访问。</li>\n<li>可度量的服务。</li>\n<li>快速灵活。</li>\n<li>(2) 分类：</li>\n<li>按服务模型分类：基础架构即服务 (IaaS)，平台即服务 (PaaS)，软件即服务 (SaaS)。</li>\n<li>按部署模型分类：公有云，私有云，混合云。</li>\n<li>公有云：</li>\n<li>提供 Internet 为外部客户提供服务的云，云服务提供商提供客户资源使用情况 (vGPU 数，磁盘空间大小，时长等) 进行收费。</li>\n<li>优点：</li>\n<li>所有的应用，服务，数据都存放在公有云提供商处，客户无需硬件投资与建设管理。</li>\n<li>缺点：</li>\n<li>数据没有存放在自己的数据中心，安全性存在很大的风险。</li>\n<li>公有云的可用性不受使用者控制，存在不确定性。</li>\n<li>私有云：</li>\n<li>由企业或机构独享使用和掌握的云，仅供自己内部人员或分支机构使用，一般在企业或机构的数据中心部署，适用于有众多分支机构的大型企业，政府网等。</li>\n<li>优点：</li>\n<li>数据安全性和系统可用性可控。</li>\n<li>对现有 IT 流程管理影响较小，IT 资源利用率较高。</li>\n<li>缺点：</li>\n<li>投资较大。</li>\n<li>混合云：</li>\n<li>对于同一份数据，同一套应用，同时采用了私有云技术构建了自己的 IT 服务平台。同时有采购了公有云服务商提供的 IT 服务，一般是需要具备可控的前提下，具备一定的弹性或者可靠性，典型的应用场景有：潮汐应用，混合云灾备。</li>\n<li>优点：</li>\n<li>对现有的业务，进行合理的区分，对不可预见的访问规模的业务，通过混合云保障业务的弹性，私有云的资源不够，调用公有云资源，具备弹性，并且可以保障可控性的同时，兼顾建设成本。</li>\n<li>缺点：</li>\n<li>IT 业务管理的界面不统一，需要投入相应的混合云的管理成本。</li>\n</ul>\n<p>2，桌面云方案整体架构：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/21/Waegeg.png\" alt=\"T\"></li>\n</ul>\n<p>3，VMP 功能介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>VMP (虚拟化管理平台：Virtualization Management Platform)：为桌面云提供了可靠的运行平台和完善的管理功能，用于虚拟机快速部署，资源管理及监控，集群高可用，动态迁移，数据备份及恢复等功能。</li>\n<li>虚拟机搭建：搭建模板虚拟机，跟虚拟机相关配置和管理。</li>\n<li>虚拟网络桥接：虚拟机跟外部网络通信的所需要的桥接。</li>\n<li>实体机管理：用于 VMP 的集群，实体主机和存储相关配置和管理。</li>\n<li>平台管理：可配置序列号，日期与时间，用户，告警设置，用户体验计划，日志与警告，虚拟机备份与恢复，系统配置备份与恢复，设备升级，VMP 平台访问参数。</li>\n</ul>\n<p>4，VDC 功能介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>VDC (虚拟桌面接入管理系统：Virtual Desktop Controller)：提供用户认证管理，细粒度的策略控制，桌面 / 云终端统一监控及管理等功能，实现更安全，更可靠地交付云桌面。</li>\n<li>用户接入认证管理：用户接入端认证的控制，有多种认证方式。</li>\n<li>策略控制：虚拟机内部策略控制。</li>\n<li>接入终端统一监控及管理：接入终端策略控制及管理。</li>\n<li>资源派生：虚拟机的批量派生。</li>\n</ul>\n<p>5，桌面云一体机 (VDS)：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>桌面云一体机，指的是预装了深信服全套桌面云组件的服务器，桌面虚拟化 (VDC)，服务器虚拟化 (VMS)，存储虚拟化 (VS)。</li>\n<li>深信服可为客户提供涵盖瘦终端，桌面云控制平台及服务器的一站式桌面云解决方案，实现云桌面的快速部署。</li>\n<li>桌面虚拟化 (VDC)：提供用户认证管理，细粒度策略控制，桌面 / 云终端统一监控及管理等功能，实现更安全，更可靠地交付云桌面。</li>\n<li>服务器虚拟化 (VMS)：裸金属架构，可为云桌面提供高性能负载平台和先进管理功能，包括虚拟机快速部署，资源管理及监控，集群高可用，动态迁移，数据备份及恢复等功能。</li>\n<li>存储虚拟化 (VS)：将服务器直连硬盘形成分布式共享数据存储，通过内置冗余机制可透明存储多个数据副本，以确保磁盘和服务器故障时，数据不会丢失，并且依然可用。</li>\n</ul>\n<p>6，VMP 集群创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>VMP 集群：将安装了 VMP 软件的物理主机统一加入到同一个管理平台进行维护，方便业务部署，也可以提高资源的有效利用率。</li>\n<li>一台 VMP 主机只能加入到一个集群，加入后除网络配置外，其余配置均会从集群控制器上同步。</li>\n<li>(2) 配置步骤：</li>\n<li>将需要组建集群的主机配置好 IP。</li>\n<li>将全部主机连接到同一个二层交换机上。</li>\n<li>选择一台 VMP 主机作为 “集群控制器”，登录控制台并添加其他主机。</li>\n<li>配置集群 IP 地址。</li>\n</ul>\n<p>7，桌面云网络配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 桌面云需要连接 3 类网络：</li>\n<li>集群管理网络：集群间心跳，管理，虚拟机克隆，迁移，备份都是通过集群管理网络来传输数据。</li>\n<li>存储通信网络：这里特指 aSAN 的数据通信，全部的写磁盘数据及部分读磁盘数据要通过此网络传输，存储通信网络不稳定，可能会导致存储脑裂。</li>\n<li>业务通信网络：南北向流量传输，作为物理出口，连接核心交换或路由，承载外部访问及主机之间虚拟机互访的业务流量。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/21/WaGQxJ.png\" alt=\"T\"></li>\n<li>集群管理网络配置：</li>\n<li>管理网口一般在 VMP 安装过程中设置，后续如需修改，可以通过在主菜单中的【实体机】-- 物理主机 -- 设置主机间通信网口进行修改。也可以点击进入实体机详情 ——— 网络中对主机的管理网口进行配置修改。</li>\n<li>存储通信网络配置：</li>\n<li>存储通信网络是用于桌面云虚拟存储进行数据交互的网络，为确保存储网络稳定性，建议将存储口连接到专用交换机上，并通过 VLAN 隔离。</li>\n<li>配置修改存储网络可以在虚拟存储的高级配置中进行配置维护。</li>\n<li>业务通信网络配置：</li>\n<li>业务通信网络是承载虚拟机外部访问及主机之间虚拟机互访的业务流量的网络，通过在虚拟网络中给虚拟交换机连接物理出口配置。</li>\n<li>配置修改业务通信网络可以在虚拟网络中进行配置维护，默认情况下已存在四台虚拟交换机并连接到四个物理出口。</li>\n</ul>\n<p>8，虚拟存储配置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>aSAN 虚拟存储：是基于分布式文件系统开发的面对存储虚拟化趋势的一款产品，当前 aSAN 集成在虚拟化管理平台 aCloud 上面，通过物理网络整合管理 aCloud 集群内所有服务器的硬盘 (系统盘除外)。</li>\n<li>aSAN 属于企业云方案中专门为云计算环境而设计，面向一体化市场应用的新一代产品，融合分布式缓存，SSD 缓存加速，全局应用交付以及多重数据保护等诸多存储技术，能够满足关键业务的需求，保障客户业务高效稳定运行。</li>\n<li>(2) 配置步骤：</li>\n<li>1，配置存储通信网口</li>\n<li>注：选择存储通信的部署方式有两个基本原则：</li>\n<li>保证主机间带宽足够。</li>\n<li>保证主机间通信稳定。</li>\n<li>2，初始化虚拟存储</li>\n<li>初始化虚拟存储。</li>\n<li>配置数据拷贝。</li>\n<li>磁盘用途规划。</li>\n<li>磁盘详细配置。</li>\n<li>确认配置。</li>\n<li>3，配置探测 IP</li>\n</ul>\n<p>9，VDC 安装部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>VDC：即桌面接入管理系统，提供用户认证管理，细粒度的策略控制，桌面 / 云终端统一监控及管理等功能，实现更安全，更可靠地交付云桌面。</li>\n<li>(2) VDC 分为硬件 VDC 和软件 VDC：</li>\n<li>硬件 VDC 为一台物理设备，直接接入桌面云网络即可与 VMP 联动使用。</li>\n<li>软件 VDC 为 VMP 平台上创建的一台虚拟机，可以通过创建虚拟机时选择操作系统为虚拟桌面管理系统 (VDC) 进行创建。</li>\n<li>完成软件 VDC 创建后，将该虚拟机开机，然后使用创建虚拟机时配置的 IP 地址登录 VDC 控制台进行管理（VDC 默认 IP 为 10.254.254.254）。</li>\n<li>VDC 控制台登录方式为 https://vdc_ip:4430，默认登录账号和密码均为 admin。</li>\n<li>(3) VDC 部署模式：</li>\n<li>单臂部署：</li>\n<li>无需配置公网 IP，通过前端设备连接上网。</li>\n<li>配置 VDC 的接口 IP，掩码，网关和 DNS。</li>\n<li>网关模式：</li>\n<li>需要配置设备公网 IP 和内网 IP，作为连接企业内网和公网的接口。</li>\n<li>需配置内网接口和外网接口。</li>\n<li>(4) VDC 与 VMP 联动：</li>\n<li>在 VDC 上添加虚拟化平台控制器</li>\n<li>控制器地址：https://vmp_ip:4433</li>\n</ul>\n<p>10，模板创建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>虚拟机模板是虚拟机的一个副本，用于便捷的创建和配置多台新的虚拟机，由虚拟机操作系统镜像文件和配置文件两部分组成，在桌面云主要用于 VDC 派生用户虚拟机。</li>\n<li>(2) 模板创建步骤：</li>\n<li>上传虚拟机系统 ISO 镜像。</li>\n<li>新建虚拟机安装虚拟机操作系统。</li>\n<li>在模板虚拟机系统中安装 agent 及其他基础软件。</li>\n<li>将虚拟机转换为模板。</li>\n<li>(3) 桌面云 Agent 工具安装：</li>\n<li>Agent 软件安装在虚拟机中，能够对虚拟机的软硬件状态进行上报，并且与 VDC 联动下发 VDC 对虚拟机的策略和动作。</li>\n<li>虚拟机内可以通过登录到 VDC 管理页面下载 agent 软件。</li>\n<li>下载至虚拟机内部之后直接安装即可，安装完成之后需要重启虚拟机 1-2 次。</li>\n<li>Agent 安装完成之后再给虚拟机安装客户端所需软件，安装完成之后即可将虚拟机关闭，将其转换为模板，完成模板的创建。</li>\n<li>(4) 资源发布：</li>\n<li>虚拟机模板创建完成之后即可在 VDC 上进行桌面资源发布，以下以独享桌面为例。</li>\n<li>独享桌面：基于虚拟化技术，在同一个物理主机上虚拟出多个 Windows 操作系统，且各自独立运行，每个用户拥有自己的桌面环境，用户在该桌面下操作自由，也可以通过策略进行灵活控制。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/21/Wa745n.png\" alt=\"T\"></li>\n<li>(5) 独享资源配置步骤：</li>\n<li>新建配置独享桌面资源</li>\n<li>配置角色授权</li>\n<li>配置桌面策略组</li>\n<li>配置接入用户与资源关联</li>\n<li>(6) 独享桌面资源虚拟机配置：</li>\n<li>发布类型：</li>\n<li>专用模式：将保留用户所有修改的数据。</li>\n<li>还原模式：重启后将还原到初始状态，个人磁盘数据不还原。</li>\n<li>(7) 角色授权：</li>\n<li>是 “用户 / 用户组” 和 “资源” 的中介，SANGFOR VDC 正是通过【角色授权】把 VDI 登录用户 / 用户组和 VDI 资源 “关联” 起来的。通过角色可以把多个 “用户 / 用户组”，多个资源进行关联，更加有效管理资源和用户组的权限。</li>\n</ul>\n<p>11，3D 部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 显卡共享：</li>\n<li>显卡共享方案是通过 SGAX 技术把一块显卡资源共享给多台虚拟机使用，从而实现虚拟机内部可以进行图形加速，由于一块显卡被多台虚拟机争抢使用，单台虚拟机使用到的资源有限，另外在技术实现上存在一定的性能损耗，因此显卡共享只适合中载或轻载的 3D 场景，这种方案的优势是成本低，显卡利用率高。</li>\n<li>(2) 显卡直通：</li>\n<li>显卡直通方案是通过 vfio 技术把一块显卡的某个 GPU 核透传给单个虚拟机使用，从而达到虚拟机独享显卡 GPU 核心并实现图形加速，由于一个显卡核心只被一台虚拟机使用，所以不存在资源争抢，另外直通损耗率相对比较低，虚拟机使用显卡可以达到最佳的性能，因此显卡直通比较适合中载或者重载的 3D 场景，这种方案成本比较高，但是性能最好。</li>\n<li>(3)vGPU：</li>\n<li>显卡 vGPU 方案是深信服与 NVIDIA 进行深度合作开发，通过在虚拟化层内置 NVIDIA 提供的 vGPU 管理组件，负责将物理显卡的 GPU 核心切分成多个虚拟 GPU 硬件，再由平台调度给虚拟机使用，vGPU 方案将 GPU 资源池化，能够支持不同的显卡切分模式，硬件复用灵活，可适应客户不同需求场景，提高 GPU 核心的利用率，并且可以动态监控显卡资源，为后续硬件扩容提供参考，促进合理化投资。</li>\n</ul>\n<p>12，链路聚合：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 链路聚合的产生：</li>\n<li>链路聚合是把多条物理链路聚合在一起，形成一条逻辑链路。</li>\n<li>采用链路聚合既可以提供链路冗余性，又可以提高链路的带宽。</li>\n<li>(2) 概念：</li>\n<li>聚合接口是一个手工配置的逻辑接口，链路聚合组是随着聚合接口的创建而自动生成的。</li>\n<li>操作 key 是在链路聚合时，聚合控制根据成员端口的某些配置自动生成的一个配置组合。</li>\n<li>(3) 链路聚合的模式：</li>\n<li>静态聚合模式：</li>\n<li>端口不与对端设备交互信息。</li>\n<li>根据本端设备信息选择参考端口。</li>\n<li>用户命令创建和删除静态聚合组。</li>\n<li>动态聚合模式：</li>\n<li>端口的 LACP 协议自动使能，与对端设备交互 LACP 报文。</li>\n<li>根据本端设备与对端设备交互信息选择参考端口。</li>\n<li>用户命令创建和删除动态聚合组。</li>\n<li>(4) 端口聚合的类型：</li>\n<li>二层链路聚合：</li>\n<li>成员端口全部为二层以太网端口。</li>\n<li>需要创建 VLAN 虚接口使聚合接口能够支持收发三层 IP 报文。</li>\n<li>聚合接口支持收发携带 VLAN TAG 的报文。</li>\n<li>三层链路聚合：</li>\n<li>成员端口全部为三层以太网端口。</li>\n<li>聚合接口支持收发三层 IP 报文。</li>\n<li>需创建聚合接口的子接口使聚合接口支持收发携带 VALN Tag 的报文。</li>\n</ul>\n<p>13，虚拟机克隆，派生。</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 虚拟机克隆：</li>\n<li>虚拟机克隆是原虚拟机的一个精确副本，是部署虚拟机的另一种方式。</li>\n<li>与原虚拟机有相同的操作系统，应用系统和数据。</li>\n<li>生成新的虚拟网卡 MAC 和 UUID。</li>\n<li>克隆虚拟机和原虚拟机有相同的 IP 地址，需要关注 IP 地址冲突的问题。</li>\n<li>配置虚拟机克隆，VMP 需要虚拟机在关闭状态下才可以进行克隆。</li>\n<li>(2) 虚拟机派生：</li>\n<li>也称为快速克隆，该功能是桌面云的重要功能，由虚拟机 (模板) 创建新的虚拟机，增量创建，新的虚拟机继承模板的属性和内容。</li>\n<li>该操作可以在 VMP 上或者 VDC 上操作，派生之前需要将作为派生模板的虚拟机转换为模板，负责 VDC 上无法派生，VMP 上能够派生虚拟机但是无法将其导入到 VDC 上供桌面云用户关联使用。</li>\n<li>VDC 上配置虚拟机派生：</li>\n<li>在资源管理中，新建或者编辑现有的独享桌面资源进行虚拟机派生。</li>\n<li>也可以根据虚拟机名称，模板，以及启用个人数据盘的参数导入 VMP 上派生的虚拟机。</li>\n</ul>\n<h1 id=\"2021-07-22\"><a class=\"anchor\" href=\"#2021-07-22\">#</a> 2021-07-22</h1>\n<p>1，AD 前置调度 虚拟服务 端口映射的优先级顺序是：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>前置调度 &gt; 虚拟服务 &gt; 端口映射</li>\n</ul>\n<p>2，DNS 代理权重值：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>DNS 代理是有优先级的，且权值大，优先级高。</li>\n<li>有时没有体现出权值大，优先级高的原因：</li>\n<li>是因为 DNS 代理基本配置里面，有一项是选择策略分别有：</li>\n<li>【轮询】轮流选择 DNS 服务器列表中的 DNS 服务器，机会均等</li>\n<li>【加权轮询】按照 DNS 服务器的权值比例选择 DNS 服务器列表中的 DNS 服务器。</li>\n<li>【加权最小流量】从流量最小的链路里根据权值选择 DNS 服务器。                     - 【优先级】始终选择权值最高的服务器，只有在权值较高的 DNS 离线或繁忙时才会选择权值较低的 DNS 服务器</li>\n<li>因此，建议选择加权轮询或者优先级才能保证权值大生效。</li>\n</ul>\n<p>3，AD：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>AD (应用交付设备)：能够为用户的应用发布提供包括多数据中心负载均衡，多链路负载均衡，服务器负载均衡的全方位解决方案，配合性能优化，单边加速以及多重智能管理等技术，实现对各个数据中心，链路以及服务器状态的实时监控，同时根据预设规则将用户的访问请求分配给相应的数据中心，链路以及服务器，进而实现数据流的合理分配，使所有的数据中心，链路和服务器都得到充分的利用。</li>\n<li>能拓展应用系统的整体处理能力，提高其稳定性，更可切实改善用户的访问体验，降低组织的 IT 投资成本。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/W01efO.png\" alt=\"T\"></li>\n<li>(2) 产品简介：</li>\n<li>传统的负载均衡技术，通过拓展网络设备和服务器的带宽及吞吐量，进而提升网络数据处理的稳定性。</li>\n<li>(3) 深信服应用交付与负载均衡相比：</li>\n<li>在强调稳定性的基础上，增加了智能优化的功能特性，以帮助用户应对来自于复杂应用环境中部署与交付服务的挑战。</li>\n<li>(4) 负载均衡：，通过分析入站的应用请求，将这些请求动态地映射到可用的服务器。</li>\n<li>(5) 功能：</li>\n<li>应用交付产品能够帮助减少所需部署的服务器数量，提供实时的控制机制助力于数据中心虚拟化，降低数据中心的供电和冷却方面的要求，使用户的业务更好地顺应紧凑、节能、环保的趋势。</li>\n</ul>\n<p>4，AD 关键特性 —— 多链路负载均衡  ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>深信服 AD 应用交付设备集成智能路由、DNS 透明代理和智能 DNS 解析等技术，通过轮询、加权轮询、静态就近性、动态就近性等算法，解决多链路网络环境中流量分担的问题，充分提高多链路的带宽利用率，节约企事业单位对通信链路的投资；并且通过为用户分配最佳的通信线路，使用户获得绝佳的访问体验。</li>\n<li>(2) 出站流量负载均衡：</li>\n<li>内网的用户访问互联网资源时，深信服 AD 接收到用户的访问流量后，通过预先设定链路负载策略将用户访问流量分配到不同的互联网链路之上，实现出站流量负载均衡，提升互联网链路带宽利用率。</li>\n<li>(3) 入站流量负载均衡：</li>\n<li>当外部用户访问内部资源时，深信服 AD 通过智能 DNS 解析技术将一个域名绑定多个运营商的公网地址，负责解析来自不同运营商用户的域名解析请求；深信服 AD 根据不同负载均衡策略为不同运营商的用户返回最佳的访问地址，实现用户入站流量的负载均衡。</li>\n<li>(4) 链路负载算法：</li>\n<li>1，应用引流：</li>\n<li>实现机制－根据数据包特征、端口号和 IP 地址等条件，对用户的上网流量进行应用识别，并根据应用类型进行数据分流（如将视频流量分流至线路 1，游戏流量分流至线路 2），实现带宽资源的合理利用。</li>\n<li>适用场景－拥有多条互联网链路，各条链路的带宽和质量不同。</li>\n<li>2，海外域名引流：</li>\n<li>实现机制－内置海外域名信息库，根据用户访问的目标域名进行匹配，可将访问海外域名的数据流量引流至指定线路，提高用户对海外资源的访问成功率和访问质量。</li>\n<li>适用场景－拥有多条互联网链路，其中一条用于对海外资源的访问。</li>\n<li>3，轮询（Round Robin）：</li>\n<li>实现机制－将所有网络链路放在一个队列当中，按顺序依次返回给用户队列中下一个网络链路的 IP 地址。</li>\n<li>适用场景－拥有多条同一运营商的互联网链路，各条链路的带宽也相近。</li>\n<li>4，加权最小流量：</li>\n<li>实现机制－根据事先为各条链路设定的权值，在调度新连接时尽可能的使各条链路的实时流量与权值成比例，把新的连接请求分配到当前比例最小的链路上。</li>\n<li>适用场景－拥有多条互联网链路，并且各链路之间的带宽差异较大。</li>\n<li>5，静态就近性：</li>\n<li>实现机制－按照预先为某个目标定义的静态最佳路径来选择链路，或者根据设备内置的全球 IP 地址库来判断目标 IP 属于哪个互联网运营商，进而选择相应的 ISP 链路。</li>\n<li>适用场景－拥有多条不同运营商的互联网链路，业务流量多为入站访问流量。</li>\n<li>6，动态就近性：</li>\n<li>实现机制－在选择链路时，通过综合考虑数据传输的延迟和链路的实时负载，准确计算出最佳路径。</li>\n<li>适用场景－拥有多条不同运营商的互联网链路，业务流量多为出站访问流量。</li>\n<li>7，带宽比例：</li>\n<li>实现机制－由于各条互联网链路的吞吐量可能不一，因此将为各条链路的带宽大小作为权值；根据这个比例（每条链路带宽大小的比值），把数据流量分配到每条链路上。</li>\n<li>适用场景－拥有多条同一运营商的互联网链路，但链路之间的带宽差异较大。</li>\n<li>8，哈希：</li>\n<li>实现机制－基于 LOCAL DNS IP 地址的哈希算法，将不同的用户访问调度到不同的链路之上。</li>\n<li>适用场景－拥有多条互联网链路，需要保证来自同一个用户的请求分发到同一条链路。</li>\n<li>9，主备：</li>\n<li>实现机制－即可以为网络设定主备链路，当主链路出现故障时，用户的访问请求才会被调度备用链路之上。</li>\n<li>适用场景－拥有多条互联网链路，对业务访问的持久性要求较高。</li>\n<li>10，首个有效：</li>\n<li>实现机制－即，将用户的请求全部都调度到第一条有效无故障的链路之上。</li>\n<li>适用场景－拥有多条互联网链路，对业务访问的响应时延比较敏感。</li>\n</ul>\n<p>5，链路健康检查 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>AD 通过对多个网络站点的访问可达性，来共同判断一条链路的状况，通过对多网站的访问，并对检查结果做 “或” 运算，如此，只要其中一个站点可达，即可表明链路状态良好。该方法即避免了 ICMP 检查的局限性，也避免了单一站点检查带来的单点失误。</li>\n</ul>\n<p>6，服务器负载均衡 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>AD 应用交付设备能将所有真实服务器业务配置成虚拟服务来实现负载均衡，对外直接发布一个虚拟服务 IP。当用户请求到达应用交付设备的时候，根据预先设定的基于多重四、七层负载均衡算法的调度策略，能够合理的将每个链接快速的分配到相应的服务器，从而合理利用服务器资源。</li>\n<li>同时通过对服务器健康状况的全面监控，深信服 AD 应用交付设备能实时地发现故障服务器，并及时将用户的访问请求切换到其他正常服务器，实现多台服务器之间冗余。</li>\n</ul>\n<p>7，NAT 方式 L4 服务器负载均衡 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/W0vnPO.png\" alt=\"T\"></li>\n<li>(2) 步骤：</li>\n<li>1，客户端发送服务访问请求，此时的源 IP 为客户端 IP、目的 IP 为虚拟服务 IP (ADiP)。</li>\n<li>2，AD 设备接收到访问请求后，根据预先定义的负载均衡调度算法判断出应该将访问请求分发给哪台服务器。</li>\n<li>3，AD 设备使用 DNAT 技术分发访问数据，此时的源 IP 为客户端 IP，目的 IP 为服务器 IP。</li>\n<li>4，服务器处理接收到的访问请求，并回复响应数据，此时的源 IP 为服务器 IP、目的 IP 为客户端 IP。</li>\n<li>5，AD 设备接收响应数据，转换源 IP 后再转发给客户端，此时的源 IP 为虚拟服务 IP、目的 IP 为客户端 IP。</li>\n</ul>\n<p>8，DR 方式 L4 服务器负载均衡 ：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>DR 方式又称为三角传输模式，该模式下实现服务器负载均衡，需要后台服务器在环回接口上配置虚拟服务 IP。AD 设备在分发访问请求时不改变目的 IP 地址，而是将目的 MAC 替换为服务器的 MAC 后，再将访问请求转发给后端的服务器，服务器的回复会直接通过交换机返回给用户。由于服务器的响应回复无需经过 AD 设备转发，从而减少了 AD 设备的吞吐压力，有效的避免了整个业务系统的性能瓶颈。</li>\n<li>(2) 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/WBC6oR.png\" alt=\"T\"></li>\n<li>(3) 步骤：</li>\n<li>1，客户端发送服务访问请求，此时的源 IP 为客户端 IP、目的 IP 为虚拟服务 IP。</li>\n<li>2，交换机将访问请求转发给深信服 AD 设备。</li>\n<li>3，深信服 AD 设备接收到访问请求后，根据预先定义的负载均衡调度算法判断出应该将访问请求分发给哪台服务器。</li>\n<li>4，深信服 AD 设备向服务器分发访问数据，此时的源 IP 为客户端 IP，目的 IP 为虚拟服务 IP，目的 MAC 为服务器 MAC。</li>\n<li>5，服务器处理接收到的访问请求，并回复响应数据，此时的源 IP 为虚拟服务 IP、目的 IP 为客户端 IP。</li>\n<li>6，交换机接收响应数据，直接转发给客户端。</li>\n</ul>\n<p>9，L7</p>\n<p>10，源地址转换（SNAT）与 目的地址转换（DNAT）：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 场景：</li>\n<li>需要将进入 AD 的数据的源地址转换成其他的地址，比如：网关部署，需要将内网 IP 地址转换成公网 IP 地址进行上网，此时就需要用到源地址转换。</li>\n<li>(2) 说明：</li>\n<li>转换策略：一般选择源 IP 和目的 IP 哈希即可，</li>\n<li>源 IP 和目的 IP 哈希：根据此访问的源 IP 及目的 IP 进行哈希计算选择转换的目的 IP，一般情况下都使用此转换策略即可。</li>\n<li>源 IP 哈希：根据此访问的源 IP 进行哈希计算选择转换的目的 IP，这种场景一般用于访问网银的业务，用户访问网银可能涉及多个目的 IP，此时使用源 IP 哈希，来保证转换的 IP 地址不变。</li>\n<li>(1) 场景：</li>\n<li>一般用于将内网的服务器（私有地址）发布到公网（公网地址），让外网用户通过公网地址访问到业务。</li>\n</ul>\n<p>11，AD 单台网关部署步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>这种部署环境下：一般 AD 下接核心交换机，上接运营商；核心交换机可以跑静态路由或者动态路由，AD 设备与核心交换机相连的接口可以普通网口、聚合口、端口桥接或者 VLAN 子接口；本案例主要以静态路由以及普通网口为例。</li>\n<li>(2) 拓扑：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/WBnHRH.png\" alt=\"T\"></li>\n<li>(3) 需求：</li>\n<li>使用 AD 实现外网链路负载，并对两台 WEB 服务器进行应用负载。</li>\n<li>(4) 步骤：</li>\n<li>1，配置一条内网口线路以及两条外网口地址（电信，网通），都是静态 IP 地址。</li>\n<li>2，配置源地址转换，由 AD 代理内网上网 (此步骤可以在新增外网接口的时候进行配置)。</li>\n<li>3，配置静态路由，到内网网段 (192.168.0.0)，确保 AD 与内网互通。</li>\n<li>4，如果需要单独设置管理口，可再给管理口设置管理 IP 地址，一般都是使用 MANAGE 口。</li>\n<li>注：</li>\n<li>一般网关部署，不需要开启 WAN 口入站路由转发，但是需要外网访问设备时，需要开启。</li>\n</ul>\n<p>12，AD 单台单臂部署步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>一般情况需要做应用负载时建议使用单臂部署。</li>\n<li>优点：无需更改原网络拓扑结构，只需要单臂挂在核心交换机，进行配置即可。</li>\n<li>缺点：没办法实现链路负载，其不过 AD 其他的功能都能满足。</li>\n<li>这种部署环境下：一般 AD 业务口核心交换机；核心交换机可以跑静态路由或者动态路由，AD 设备与核心交换机相连的接口可以普通网口、聚合口、端口桥接或者 VLAN 子接口；本案例主要以静态路由以及普通网口为例。</li>\n<li>(2) 拓扑：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/WBlpBn.png\" alt=\"T\"></li>\n<li>(3) 需求：</li>\n<li>使用 AD 对两台 WEB 服务器进行应用负载。</li>\n<li>(4) 配置步骤：</li>\n<li>1，新建 WAN 属性接口，并配置静态 IP 地址，如果有多个网段的 IP 地址，一个接口上可以配置的或者配置多个 WAN 口。</li>\n<li>2，开启 WAN 口入站转发。</li>\n<li>3，配置应用负载。</li>\n<li>4，如果需要单独设置管理口，可再给管理口设置管理口 IP 地址，一般都是使用 MANAGE 口。</li>\n<li>5，如果需要外网访问业务，需要把 AD 的 VIP 以及业务端口映射到公网（出口设备做端口映射）。</li>\n<li>注：</li>\n<li>旁路模式部署只需要保证 WAN 口能与内网服务器通信即可，WAN 口与服务器不在一个网段也可以。</li>\n<li>如果客户单臂做全局负载 - 本地 DNS 映射，需要外网映射 DNS 服务器监听地址的 53 端口。</li>\n</ul>\n<p>13，AD 主备部署步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>一般用于对网络稳定性要求较高的网络环境中，主机与备机的配置是实施同步的，除去管理地址与 HA 口地址不一样外，其他完全一致，所以主备部署可以在主设备出现问题，自动切换到备机，以保证业务稳定连续的运行。网关、单臂均支持主备部署。</li>\n<li>以下主要以网关模式为例，旁路部署为例，单臂部署也是一样的配置，在于没有内网口与外网口的区分。</li>\n<li>(2) 拓扑：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/22/WBUr8I.png\" alt=\"T\"></li>\n<li>(3) 步骤：</li>\n<li>1，主机 / 双机界面上所有的功能都需要按照以下说明在主机上设置完成；一般情况下需要设置：设备名称、运行角色、主心跳口、备心跳口、心跳口故障检测、启用故障切换等完成主机的配置。</li>\n<li>2，备机 / 主机名称 / 状态 / 动作 / 主备心跳口设置，只需要设置这几项即可；其他信息会全部从主机同步过去。</li>\n<li>注：</li>\n<li>在初始状态下，设备高可用性默认为主备模式，如之前没有动过，可无需再选择。</li>\n<li>3，心跳口设置：</li>\n<li>建议选择网口作为心跳口（不包括管理口），两台设备的 HA 口直连（不经过交换机），配置同网段的 IP 地址（跟内网网段不冲突）。</li>\n<li>4，备份心跳口:</li>\n<li>建议选择管理口作为备份心跳口，需要设置合理的 IP 地址（可直接通过下拉框选择管理口上已有的地址）。</li>\n<li>注：</li>\n<li>心跳口的 IP 地址需要新增 IP，跟接口上的 IP 地址既不能相同也不能同网段。</li>\n<li>备份心跳口支持同步连接跟踪和会话保持，且要求必须要配置。需要注意，当备份心跳口使用管理口时仍然不同步连接跟踪和会话保持。</li>\n<li>(4) 备机配置：</li>\n<li>主心跳口选择网口作为心跳口（不包括管理口），两台设备的 HA 口直连（不经过交换机），配置同网段的 IP 地址（跟内网网段不冲突）。备心跳口选择管理口作为备份心跳口，需要设置合理的 IP 地址。</li>\n</ul>\n<p>14，AD 集群部署步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>一般用于内网业务比较多，而客户非常重视业务系统的稳定性和可靠性，想让不同的业务跑在不同的设备上并且设备之间又互为备份，同时需要满足后续扩容能平滑过渡；进而购买了 2 台或者以上的 AD，此时建议使用集群部署；集群与主备部署对比如下：</li>\n<li>集群：冗余性高、资源利用率高、扩展性好。</li>\n<li>双机：逻辑简单、配置简单、需要地址与一台设备一致、易于维护。</li>\n<li>(2) 步骤：</li>\n<li>主控：选择模式 - 创建集群 - 主备心跳口信息。</li>\n<li>备控或成员：选择模式 - 加入集群 - 主控的主心跳 IP 及账号密码 - 备控的主备心跳口信息。</li>\n<li>(3) 主控：</li>\n<li>一般是创建集群的设备会成为主控，</li>\n<li>(4) 备控或成员:</li>\n<li>一般选择加入集群的设备，会成为备控或成员。</li>\n</ul>\n<p>15，网络安全：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>ACL 配置</li>\n<li>(1) 说明：</li>\n<li>一般用于配置链路级别的访问控制，与安全设备的防火墙规律类似，此功能可以根据链路、协议、源 IP、目的 IP 进行访问控制设置。比如：想要拒绝某个源 IP 访问某个目的 IP 的某个端口，就可用此功能；可针对全部链路也可选择指定的链路。</li>\n<li>(2) 注：</li>\n<li>ACL 配置是从上往下匹配的。</li>\n<li>内网 DDOS 防护 ：</li>\n<li>一般用于防护来自内网（LAN 口）的攻击，防止因内网某台或几台电脑中病毒导致业务异常的情况；主要是防 DDOS，如果内网有专门的安全设备，可不启用。</li>\n<li>外网 DDOS 防护 ：</li>\n<li>一般用于防护来自内网（WAN 口）的攻击，防止外网某台或几台电脑对业务发起攻击从而导致业务异常的情况；主要是防 DDOS，如果内网有专门的安全设备，可不启用。</li>\n<li>ARP/ND 防护 ：</li>\n<li>一般用于设置静态的 ARP 条目，通常用于绑定重要设备与服务器的 ARP 信息，防止内网有 ARP 欺骗时，影响 AD 设备与其他设备的正常通信。</li>\n<li>ARP 代理 ：</li>\n<li>一般用于设备代理内网设备发送 ARP 请求；比如：发布虚拟服务 VIP 不在设备接口上，此时如果对端没有明确的路由指到 AD，AD 是不会响应此 IP 的数据包，但是如果 AD 上启用 ARP 代理是可以响应的。</li>\n</ul>\n<p>16，AD 网络参数：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) WAN 口入站路由转发：</li>\n<li>如果 WAN 网卡的入站路由转发功能为禁用状态，则 WAN 口与 LAN 口无法进行除虚拟服务、DNS、源地址转换、端口映射、远程登录、匹配智能路由或静态路由之外的数据传输，启用后才可以进行数据传输；需要通过 WAN 属性的接 xz 口地址登录设备控制台的时候才需要启用。</li>\n<li>(2) 对称路由模式：</li>\n<li>启用对称路由，仅原始方向查找路由表；禁用对称路由，同一连接两个方向独立查找路由并转发数据。一般建议启用，保证来回数据路径一致。</li>\n</ul>\n<h1 id=\"2021-07-23\"><a class=\"anchor\" href=\"#2021-07-23\">#</a> 2021-07-23</h1>\n<p>1，双向转换具体介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 拓扑：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/26/WRe3Gt.png\" alt=\"T\"></li>\n<li>(2) 需求：</li>\n<li>PC（1.1.1.1）访问服务器（1.1.1.2）的映射的公网地址（2.2.2.2）可以正常打开服务器页面，同时互联网也可正常访问服务器。</li>\n<li>(3) 实现方式:</li>\n<li>路由设备添加目的地址转换（DNAT）策略，使 1.1.1.1——&gt;2.2.2.2 转换为 1.1.1.1——&gt;1.1.1.2。同时添加源地址转换（SNAT），使 1.1.1.1——&gt;1.1.1.2 转换为 1.1.1.3——&gt;1.1.1.2。</li>\n<li>(4) 数据包访问简单解析:</li>\n<li>PCServer</li>\n<li>访问节点\t源地址\t目的地址</li>\n<li>PC\t1.1.1.1\t2.2.2.2</li>\n<li>LAN - 入\t1.1.1.1\t1.1.1.2</li>\n<li>LAN - 出\t1.1.1.3\t1.1.1.2</li>\n<li>Server\t1.1.1.3\t1.1.1.2</li>\n<li>Server 回包</li>\n<li>访问节点\t源地址\t目的地址</li>\n<li>Server\t1.1.1.2\t1.1.1.3</li>\n<li>LAN - 入\t1.1.1.2\t1.1.1.3</li>\n<li>LAN - 出\t2.2.2.2\t1.1.1.1</li>\n<li>PC\t2.2.2.2\t1.1.1.1</li>\n<li>(5) 访问逻辑：</li>\n<li>当 1.1.1.1——&gt;2.2.2.2 时，数据包进入 LAN 口，匹配 DNAT 策略将 1.1.1.1——&gt;2.2.2.2 转换为 1.1.1.1——&gt;1.1.1.2，然后查询设备路由表，1.1.1.2 为直连路由从 LAN 口转发，当数据包离开 LAN 口时，匹配 SNAT 策略，将 1.1.1.1——&gt;1.1.1.2 转换为 1.1.1.3——&gt;1.1.1.2。此时服务器收到数据包为 1.1.1.3——&gt;1.1.1.2，回包给 1.1.1.3。</li>\n<li>当 1.1.1.2——&gt;1.1.1.3 的数据包进入 LAN 口时，还原 SNAT 记录为 1.1.1.2——&gt;1.1.1.1，然后查询设备路由表，1.1.1.1 为直连路由从 LAN 口转发，数据包离开 LAN 口时，还原 DNAT 会话为 2.2.2.2——&gt;1.1.1.1。</li>\n</ul>\n<h1 id=\"2021-07-26\"><a class=\"anchor\" href=\"#2021-07-26\">#</a> 2021-07-26</h1>\n<p>1，常见的虚拟化类型：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 网络虚拟化：</li>\n<li>网络设备：N：1 虚拟化技术 IRF 可以实现将多台物理网络设备虚拟成一台网络设备。</li>\n<li>网络设备：1：N 虚拟化技术 MDC 可以实现在单台网络设备上虚拟多台逻辑设备。</li>\n<li>(2) 存储虚拟化：</li>\n<li>基于主机的存储虚拟化。</li>\n<li>基于网络设备的存储虚拟化。</li>\n<li>基于网络的存储虚拟化。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/26/WW97o6.png\" alt=\"T\"></li>\n</ul>\n<p>2，SCSI 介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>SCSI (小型计算机系统接口) 是一种高性能计算机外部接口，用于主机与外部设备之间的连接，主要功能是在存储设备和主机之间传输命令，状态和块数据。</li>\n<li>SCSI 总线：连接计算机系统的各个部分，使得它们可以互相通讯</li>\n<li>SCSI 指令：实现点到点的连接</li>\n<li>SCSI 终结器：位于 SCSI 总线的末端，用来减小相互影响的信号，维持 SCSI 链上的电压恒定</li>\n<li>SCSI ID：SCSI 设备的编号，系统中每个 SCSI 设备都必须有自己唯一的 SCSI ID</li>\n<li>(2) 基于网络的 SCSI：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/26/WW2Z0x.png\" alt=\"T\"></li>\n<li>iSCSI（ internet SCSI ）协议通过 TCP/IP 协议来封装 SCSI 命令，并在 IP 网络上传输。</li>\n<li>FC（Fiber Channel）在逻辑上是一个双向的、点对点的、为实现高性能而构架的串行数据通道，FC 可以通过构建帧来传输 SCSI 的指令、数据和状态信息单元，光纤信道协议实际上可以看成是 SCSI over FC。</li>\n</ul>\n<p>3，RAID 介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>RAID (独立磁盘冗余阵列)：RAID 技术将多个单独的物理硬盘以不同的方式组合成一个逻辑硬盘，从而提高了硬盘的读写性能和数据安全性，根据不同的组合方式可以分为不同的 RAID 级别。</li>\n<li>(2) RAID 优势 —— 提高容量：</li>\n<li>RAID 有效容量计算公式：</li>\n<li>RAID 0 容量≈n×c</li>\n<li>RAID 1 容量≈c</li>\n<li>RAID 5 容量≈（n－1）×c</li>\n<li>RAID 6 容量≈（n－2）×c</li>\n<li>RAID 10 容量≈（n/2）×c</li>\n<li>说明：</li>\n<li>其中 n 为硬盘数，表示校验数据存放空间 (相当于 1 个硬盘空间)，c 为硬盘格式化后的可用容量。</li>\n<li>(3) RAID 级别：</li>\n<li>RAID 0 ：</li>\n<li>RAID 0 即没有容错设计的条带硬盘阵列，以条带形式将 RAID 组的数据均匀分布在各个硬盘中。</li>\n<li>RAID 1 ：</li>\n<li>RAID 1 又称为镜像 (Mirror)，数据同时一致写到主硬盘和镜像硬盘。</li>\n<li>RAID 5 ：</li>\n<li>RAID 5 是把数据和与其相对应的奇偶校验信息存储到组成 RAID5 的各个磁盘上，并且奇偶校验信息和相对应的数据分别存储于不同的磁盘上。当 RAID5 的一个磁盘数据损坏后，利用剩下的数据和相应的奇偶校验信息去恢复被损坏的数据。</li>\n<li>RAID 6 ：</li>\n<li>RAID 6 是带有两个独立分布式奇偶校验硬盘的阵列，能够允许两个硬盘同时失效。</li>\n<li>RAID 10：</li>\n<li>RAID 10 是将镜像和条带进行两级组合的 RAID 级别，第一级是 RAID1 镜像对，第二级为 RAID 0。RAID10 也是一种应用比较广泛的 RAID 级别。</li>\n</ul>\n<p>4，传统存储的限制：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 本地存储：</li>\n<li>需要通过 RAID 才能增加冗余以提升数据的可靠性。</li>\n<li>主机之间磁盘不共享，无法跨主机访问。</li>\n<li>IO 和容量瓶颈，无法平滑扩容。</li>\n<li>虚拟机 HA 受限。</li>\n<li>(2) 外置存储：</li>\n<li>需要购买第三方存储设备，成本非常高。</li>\n<li>存储部署复杂，维护困难。</li>\n<li>存在兼容性问题。</li>\n</ul>\n<p>5，分布式文件系统：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>分布式存储，是将数据分散存储在多台独立的设备上。分布式网络存储系统采用可扩展的系统结构，利用多台存储服务器分担存储负荷，利用位置服务器定位存储信息，它不但提高了系统的可靠性、可用性和存取效率，还易于扩展。</li>\n<li>(2) 分布式存储特性:</li>\n<li>透明性：物理存储位置和底层操作过程对用户透明</li>\n<li>开放性：提供标准访问接口，可操作，可移植</li>\n<li>可扩展性：基于分布式设计，可平滑扩容</li>\n<li>可用性：有数据冗余保障</li>\n<li>一致性：防止通信故障导致存储系统脑裂</li>\n<li>分布式存储使用的分布式文件系统将同一网络中的不同计算机管理的物理存储资源（本地存储）通过网络组织起来，形成一个统一的共享文件系统。</li>\n<li>分布式文件系统的设计基于 C/S 架构模式。客户端在访问文件时不需要知道它们的实际物理存储位置，即分布在多个计算机上的文件在用户面前就像使用本地存储一样。</li>\n</ul>\n<p>6，\tSangfor 虚拟存储介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>Sangfor 虚拟存储（简称 aSAN）当前 aSAN 集成在企业云 aCloud 和桌面云 aDesk 上，通过网络整合管理集群内所有服务器的本地硬盘。</li>\n<li>(2) 特点：</li>\n<li>aSAN 采用了多种性能优化技术，包括 SSD 读写缓存、SSD 分层技术、IO 本地化、链路聚合等，为 aSAN 提供了极好的性能表现。读、写缓存、数据分层采用了不同的实现原理，其作用都是利用 SSD 缓存盘对读写进行加速，提升虚拟存储的性能。</li>\n<li>(3) 优势：</li>\n<li>aSAN 虚拟存储是基于网络的分布式存储，需要将所有主机通过 IP 网络（二层、组播）进行连接，组建存储通信网络。</li>\n<li>基本要求：</li>\n<li>通信稳定：延时不超过 5ms，无丢包</li>\n<li>带宽足够：千兆或万兆局域网连接</li>\n<li>存储私网有 3 种选择 ，分别为无链路聚合、单交换机链路聚合、双交换机链路聚合。</li>\n<li>无链路聚合：</li>\n<li>每台主机使用一个单独的网口互联，组建存储私网。</li>\n<li>优点：业务数据和存储数据隔离。</li>\n<li>缺点：存储私网没有冗余，出现链路故障会导致对应主机存储无法使用。</li>\n<li>单交换机链路聚合：</li>\n<li>每台主机使用两个单独的网口组建存储私网，存储通信网口全部接入到同一个二层交换机 (千兆以上)，aDesk/aCloud 主机间自动进行聚合，无需在交换机上配置聚合。</li>\n<li>优点：双倍带宽，且具有链路冗余。</li>\n<li>缺点：存在交换机单点故障风险 (建议交换机做堆叠)</li>\n<li>双交换机链路聚合：</li>\n<li>每台主机使用两个单独的网口组建存储私网，存储通信网口分别接入到两个二层交换机 (千兆以上)，aDesk/aCloud 主机间自动进行聚合，无需在交换机上配置聚合。</li>\n<li>优点：双倍带宽，且链路和交换机都有冗余。</li>\n<li>缺点：需要的网口和交换机设备增多。</li>\n</ul>\n<p>7，虚拟磁盘的分配方式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>Sangfor 虚拟化平台为虚拟机创建新磁盘时，有两种磁盘分配方式可选，一种为预分配，一种为精简分配。</li>\n<li>预分配：</li>\n<li>设置预分配的磁盘，在磁盘初始化时就占用了配置的全部空间，这样可以大幅提升该虚拟机的 IOPS 和吞吐量，但是虚拟机未使用的磁盘空间无法被其他虚机使用。</li>\n<li>精简分配：</li>\n<li>虚拟机写磁盘时按需分配，虚拟未使用的空间还能够给其他虚拟机使用，可以节省存储空间，但是虚拟机写磁盘时要先申请存储空间，这个过程对写性能有一定影响，相比来说磁盘性能不如预分配。</li>\n</ul>\n<p>8，第三方服务器安装 aDeks 时 BIOS 设置：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>启用 Intel VT-x：启用 CPU 的硬件辅助虚拟化。</li>\n<li>关闭节能模式：节能模式会通过动态降低 CPU 主频以达到节能目的，会导致无法充分发挥 CPU 性能，虚拟机运行会非常卡。</li>\n<li>同步 BIOS 时间：BIOS 时间对后续的维护有很大的帮助。</li>\n<li>启用加电自动开机：遭遇供电故障后，可以在电源恢复时自动开启主机。</li>\n<li>切换启动方式 UEFI/Legacy：一般使用 Legacy 方式启动，兼容性较好，当系统盘超过 2TB 时才能使用 UEFI。</li>\n</ul>\n<p>9，注：企业云平台没有更新模板虚拟机的功能，以防更新模板虚拟机导致派生的虚拟机数据丢失，</p>\n<p>10，虚拟机迁移：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 迁移类型：</li>\n<li>集群内迁移。</li>\n<li>跨集群迁移。</li>\n<li>p2v，v2v 迁移。</li>\n<li>(2) 集群内热迁移：</li>\n<li>集群内迁移可以选择迁移虚拟机运行位置和存储位置，可以在虚拟机开机情况下进行热迁移，虚拟机可以照常运行，不会影响到虚拟机业务。也可以在关机状态下迁移。</li>\n<li>(3) 跨集群迁移：</li>\n<li>虚拟机跨集群迁移是在两个集群版本相同，网络可达的情况下，可以将一个集群内的虚拟机通过网络迁移到另外一个集群中去。</li>\n<li>选择跨集群迁移之后配置目的企业云集群的集群 IP 和 admin 管理员密码。</li>\n<li>设置集群信息之后下一步是设置迁移位置，设置迁移到目标集群之后的存储位置和运行位置，并且可以设置迁移完成之后自动开机，还可以限制最大迁移速率，以免影响正常管理业务。</li>\n<li>设置迁移到目的集群之后的虚拟网络配置以及 MAC 地址配置，默认迁移之后网卡 MAC 地址会变化，如果需要保持原来的 MAC 地址，需要手工输入原虚拟机网卡 MAC 地址。</li>\n<li>配置完成之后开始跨集群迁移，迁移完成之后在目的集群能够找到迁移过来的虚拟机。</li>\n<li>(4) P2V 迁移：</li>\n<li>P2V 即 Physical to virtual ，物理到虚拟简称。它是指将操作系统、应用程序或者数据从计算机的物理硬盘中迁移到一个虚拟环境中或是磁盘分区中。在企业云中的应用为将安装在物理环境上的系统迁移到企业云的虚拟化环境中。</li>\n</ul>\n<p>11，虚拟机 HA：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>高可靠性（High Availability，简称 HA）功能可以为集群中所有虚拟机上运行的应用程序提供简单易用、经济高效的高可用性。</li>\n<li>开启 HA 功能之后，aCloud 会持续对集群内所有的服务器主机与虚拟机运行状况进行监测。主机或者虚拟机发生故障时，aCloud 将立即响应并在集群内其它可用的主机上重启所有受影响的虚拟机。</li>\n</ul>\n<p>12，虚拟网络节点：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 物理出口：</li>\n<li>物理出口用来连接虚拟网络和物理网络，物理出口对内可以连接虚拟路由器，虚拟网络设备或虚拟机，对外需要连接到主机的物理网络。</li>\n<li>(2) 虚拟交换机：</li>\n<li>用于在虚拟网络内部进行数据交换转发。</li>\n<li>aCloud 集群中的虚拟交换机是分布式运行的，即一个虚拟交换机在各台主机上均有实例。分布式虚拟交换机可以保证运行在不同主机上、但连接到同一个虚拟交换机的虚拟机之间能相互通信。同一个虚拟交换机上的虚拟机，在跨主机转发流量时，流量会经过各主机的 VXLAN 数据通信口进行封装转发。</li>\n</ul>\n<h1 id=\"2021-07-27\"><a class=\"anchor\" href=\"#2021-07-27\">#</a> 2021-07-27</h1>\n<p>1，vGPU 管理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>用户有大规模的显卡支持的应用，在 GPU 资源的使用会遇到闲置浪费，分配不灵活的情况，希望能够做到 GPU 使用灵活，按需分配，资源共享。</li>\n<li>(2) 注：</li>\n<li>使用 vGPU 需获取 NVIDIA 的授权。</li>\n<li>使用 vGPU 的虚拟机必须安装和 HCI 平台对应版本的英伟达显卡驱动。</li>\n<li>HCI 的 vGPU 授权分为两种：vDWS 和 vCS，vDWS 用于专业图形和计算场景，vCS 用于面向计算常见进行优化，如：人工智能，深度学习，科研场景等。</li>\n<li>vCS 不支持 Windows 虚拟机，最小切割粒度为 4GB，最大为 32GB。</li>\n<li>不是所有的显卡都支持 vGPU 的，支持 vGPU 的显卡才能使用 vGPU，不支持的可以使用直通模式。</li>\n</ul>\n<p>2，部署英伟达授权服务器：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>部署英伟达 vGPU 授权服务器，为 3DvGPU 虚拟机提供授权，使用 vGPU，需要授权英伟达的授权序列号，否则 vGPU 的性能发挥不出来，授权服务器是一个虚拟机模板，装在 HCI 平台作为一个虚拟机使用，把申请来的 vGPU 测试序列号填在授权服务器上，再把授权服务器的 IP 填在需要使用 vGPU 的虚拟机的显卡驱动上，虚拟机才可以正常使用 vGPU。</li>\n</ul>\n<p>3，EDS 企业级分布式存储系统介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>EDS，采用分布式架构，解决存储系统的灵活拓展，高性能 (IOPS + 吞吐) 支撑，通过分布式存储系统构建统一分布式存储资源池，同时提供块，文件，对象三种类型存储服务，满足多业务平台所带来的结构化，非结构化数据存储请求，同时，通过云存储管理平台实现整个数据中心或多中心的统一管理，简化运维。</li>\n<li>(2) 应用于：</li>\n<li>EDS 以大规模横向扩展能力及超大统一命名空间的文件系统为企业用户提供非结构化数据共享存储资源，具有高吞吐特性，主要应用于视频 / 音频、高性能计算、视频监控、数据备份等多业务场景。</li>\n<li>(3) 产品特性：</li>\n<li>极简，高可靠，高性能。</li>\n</ul>\n<p>4，EDS IP 地址规划要求：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>每台存储节点至少需要四个网口，规划三组不同网段 IP 地址：管理网络，存储外网， 存储私网，同时需要规划一个集群 IP，这个 IP 需要和管理网络在同一个网段。</li>\n<li>(2) 虚拟 IP 池：</li>\n<li>对外存储服务访问 IP，业务服务器通过接入 EDS 集群的虚拟 IP 池，从而接入 EDS 集群的存储服务，虚拟 IP 池必须与客户业务服务器网口 IP 网络互通，支持与接入网口地址（推荐存储外网网口）在相同或不同网段，且虚拟 IP 池的 IP 地址数量不少于 EDS 集群节点数量。</li>\n</ul>\n<p>5，EDS 与 HCI 组网最佳实践：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>HCI 平台挂载 EDS 存储时，必须使用万兆网络作为存储网络，建议在 HCI 网口足够的情况下，使用单独的万兆口跟 EDS 的存储外网口对接，若网口不够，推荐使用 HCI 的存储私网跟 EDS 的存储外网口对接。如果运行在 HCI 集群中的虚拟机也需要挂载 EDS 存储，则需要将 HCI 的业务口与 EDS 的存储外网打通。</li>\n<li>(2) HCI 平台挂载 EDS 存储，根据 HCI 存储私网的部署方式，可分为以下两种情景：</li>\n<li>HCI 存储私网采用单交换机链路聚合时：</li>\n<li>将两个交换机配置为 M-LAG 组，并将 HCI 的聚合口分别接到跨交换机上。EDS 的存储外网配置为主备和链路均衡模式的聚合模式，分别接到跨交换机的 M-LAG 端口组上。建议 HCI 和 EDS 全新部署时采用此方式部署。</li>\n<li>HCI 存储私网采用双交换机链路聚合时，</li>\n<li>HCI 的存储私网配置为双交换机链路聚合模式，建议将 HCI 存储私网调整为单交换机链路聚合模式，然后对接 EDS。<br>\n6，EDS 一体机：</li>\n</ul>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>EDS 一体机修改默认 IP。EDS 一体机出厂时已经安装了 EDS 的系统。默认 ETH0 口为管理口，IP 地址为 10.252.252.1。（也可在一体机上外接显示器和键盘，修改管理口 IP，重启后生效）</li>\n<li>使用网线连接 PC 的物理网口和一体机的 Eth0 口，一般将 PC 的网卡配置为跟 ETH0 口同网段的 IP 地址如 10.252.252.2, 默认密码为 admin。</li>\n</ul>\n<p>7，AD 单臂部署介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>单臂部署不需要改动原有网络结构，单臂环境下 AD 设备可以实现服务器负载和入站链路负载，不支持出站链路负载。</li>\n<li>AD 设备单臂部署时，必须连接 WAN 口到交换机，WAN 口可以和服务器在同一个网段，如果不在同网段，则需要保证 AD 和服务器路由可达。</li>\n<li>若\t服务需要发布到公网，需要在边界出口设备上做端口映射给 AD 设备 (全映射或者服务器相关应用端口)。</li>\n<li>(2) 具体配置：</li>\n<li>1）用户需求：</li>\n<li>希望不改变网络环境，内网多台服务器需要做服务器负载。</li>\n<li>2）网络环境：</li>\n<li>网络出口是防火墙设备，外网只有一条公网线路。</li>\n<li>3）配置思路：</li>\n<li>通过 Manage 口 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly8xMC4yNTIuMjUyLnhuLS0yNTIxMC16bTZqLjI1NC4yNTQuMjU0\">https://10.252.252.252 或 10.254.254.254</span>) 登录设备，做基本的网口设置。</li>\n<li>配置 AD WAN 口信息，【网络配置】-【网络接口】，配置设备网口 (WAN 口) 地址。</li>\n<li>若需要通过 WAN 口的 IP 地址登录设备控制台，则需要启用远程维护，在【系统配置】-【设备管理】-【管理网口】- 启用远程维护。</li>\n<li>AD 上启用源地址转换功能 (使服务器看到的源 IP 是 AD，服务器回包会回给 AD，保证来回数据都经过 AD)。</li>\n<li>若服务需要发布到公网，需要在边界出口设备上做端口映射给 AD 设备 (全映射或者服务器相关应用端口)。</li>\n<li>WAN 口配置 —— 远程维护和 WAN 口入站路由转发 —— 源地址转换 / 虚拟访问自动 SNAT—— 端口映射。</li>\n<li>(3) 注：</li>\n<li>单臂 (旁路) 部署创建网口必须选择 WAN 属性。</li>\n<li>AD 单臂部署接核心交换机，AD 接口与服务器不同网段，AD WAN 接口有配置网关指向核心，则 AD 无需配置静态路由，只需保障核心有去往服务器的路由即可。</li>\n<li>若服务需要发布到公网，需要在边界出口设备上做的端口映射给 AD 设备。</li>\n<li>若需要通过 WAN 口的 IP 地址登录设备控制台，则需要启用远程维护。</li>\n</ul>\n<p>8，AD 网关部署介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>常见的部署模式，把 AD 设备作为一个路由设备使用，一般是把 AD 设备放在网关出口的位置，或者放在前置路由器后面，设备直接接入网络边界，启用 NAT 代理上网等功能，防火墙做透明模式。适合新建网络或者替代原有出口路由器或者防火墙，部署改动大，需内网规划 IP 段和添加相应的路由。</li>\n<li>网关模式下可以实现入站链路负载，出站链路负载，服务器负载。</li>\n<li>(2) 具体配置：</li>\n<li>1）用户需求：</li>\n<li>客户有电信和联通两条 100M 的线路，需求内网访问电信走电信，联通走联通。</li>\n<li>2）网络环境：</li>\n<li>两条外网线路，内网有用户和服务器群，防火墙透明部署。</li>\n<li>3）配置思路：</li>\n<li>通过 Manage 口 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly8xMC4yNTIuMjUyLnhuLS0yNTIxMC16bTZqLjI1NC4yNTQuMjU0\">https://10.252.252.252 或 10.254.254.254</span>) 登录设备，做基本的网口设置。</li>\n<li>配置设备外网口 (WAN 口) 和内网口 (LAN 口) 地址。</li>\n<li>内网若有多网段环境，添加静态路由回指给设备下接的核心交换机。</li>\n<li>配置代理上网 (源地址转换)</li>\n<li>配置智能路由。</li>\n<li>配置 LAN 口地址 —— 配置 WAN 口接口地址和网关 (配置链路带宽，健康检查机制等)—— 配置静态路由 (保障 AD 能够和用户网段通信)—— 配置代理上网 (源地址转换)—— 智能路由。</li>\n<li>(3) 注：</li>\n<li>如果内网二层环境，则不需要添加静态路由将内网设备的网关指向 AD 设备的 LAN 口 IP 即可，若为三层环境则需要配置静态路由以保障 AD 与用户网段能够进行通信。</li>\n</ul>\n<p>9，AD 端口聚合说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>端口聚合可以将多个物理接口当作一个单一的逻辑接口来处理，它允许两台设备之间通过多个接口并行连接同时传输数据以提供更高的带宽，更大的吞吐量和可恢复性技术，有以下优点：</li>\n<li>增加带宽：带宽相当于组成组的接口的带宽总和。</li>\n<li>增加冗余：只要组内不是所有的接口都故障，两个设备之间仍然可以继续通信。</li>\n<li>负载均衡：可以在组内的接口上配置，使流量可以在这些接口上按照对应的算法自动进行负载均衡。</li>\n<li>(2) 具体情况：</li>\n<li>选择想要聚合的网口，只能选择物理口将多个物理口做聚合，成为一个逻辑口。</li>\n<li>绑定策略：</li>\n<li>哈希 (静态)，轮询 (静态)，802.3ad (动态 LACP)，冗余双网卡 (静态)。</li>\n<li>(3) 注：</li>\n<li>电口与电口聚合，光口与光口聚合，千兆与千兆聚合，万兆与万兆聚合。</li>\n</ul>\n<p>10，AD 端口桥接介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>在一些较复杂的网络结构中，需要 AD 设备能将两个口划分到一个广播域内，相当于将 AD 设备的多个口组合成一个二层交换机。此时需要使用到桥接网口功能。</li>\n<li>(2) 具体情况：</li>\n<li>客户两台防火墙做双机热备，两台防火墙一主一备，为了满足高可靠性与高可用性的要求，此时 AD 如果部署在网络出口，则要求 NET2 与 NET3 接口 IP 地址一样，相当于 NET2 与 NET3 属于同一个 VLAN，且防火墙发送的数据通过 NET2 与 NET3 均能与该 VLAN IP 通信。</li>\n</ul>\n<h1 id=\"2021-07-28\"><a class=\"anchor\" href=\"#2021-07-28\">#</a> 2021-07-28</h1>\n<p>1，交换机接口使用 ACCESS 接口时，AD 设备该如何对接？TRUNK 接口呢？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>如果对端使用 ACCESS 接口，AD 设备直接使用普通的物理网口对接即可；如果对端是 TRUNK 那么需要在 AD 上启用 vlan 子接口进行对接；</li>\n</ul>\n<p>2，客户出口有 1 条 2G 带宽的线路，AD 没有万兆口的情况下该如何部署如何配置才能将所有带宽使用起来？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>将 2 个千兆网口口进行聚合使用（聚合策略需要与对端对接的设备保持一致）；</li>\n</ul>\n<p>3，如果发现两台设备之间直连同网段地址互 ping 时丢包很严重，网线也尝试更换过但是没有效果，此时可以尝试的做法是？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>查看是否网口模式协商的有问题，尝试故障网口模式或尝试更换网口测试；</li>\n</ul>\n<p>4，如果客户没有条件在内网测试链路负载是否正常，希望直接拿台测试 PC 接在 AD 的 LAN 口上去测试上网是否正常；但是 AD 设备上内网口是聚合口，请问该如何最小的调整配置可以让测试 PC 直接接 AD 设备的 LAN 口进行测试？</p>\n<p>5，AD 集群模式原理简介：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>将多台设备组建成集群模式，实现多主功能，一个服务只运行于一台设备之上，即为主机，集群会另外选择一台设备作为该服务的备机，当主机故障时，备机切换为主机，继续提供该服务，多个服务可以分别运行在不同的设备之上，并互相作为备份。</li>\n<li>(2) 具体情况：</li>\n<li>两台 AD 旁路部署在内网，做集群对 WEB 服务器和 FTP 服务器进行负载。WEG 服务接入地址 1.1.1.1（浮动 IP），FTP 服务接入 1.1.1.3（浮动 IP）。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/28/WIoTzR.png\" alt=\"T\"></li>\n<li>(3) HA 口：</li>\n<li>用于各设备之间同步配置，定时进行心跳检测，要求各设备上作为 HA 口的网口顺序一致 (如：都用 eth2)。</li>\n<li>(4) 浮动 IP：</li>\n<li>虚拟服务或其他业务想要访问的 IP，相当于单台设备时的 IP 组，可根据情况浮动在不同的设备之间，一个浮动 IP 同时只在一台设备上生效。</li>\n<li>(5) 静态 IP：</li>\n<li>对服务器 / 链路做健康检查时用到的 IP，每台设备在业务口都必须配置最少一个静态 IP（如果没有静态 IP，此时还有浮动 IP 在此设备上生效，会使用浮动 IP 去进行探测）。</li>\n<li>(6) 虚拟 MAC：</li>\n<li>对应链路上使用虚拟 MAC 供该链路所有 IP 与其他设备通讯。</li>\n<li>(7) 虚拟服务关联组：</li>\n<li>所有引用了相同 VIP 的虚拟服务。</li>\n<li>(8) 应用组：</li>\n<li>即集群的最小切换单元，包括浮动 IP，虚拟服务关联组，NAT 单元 (DNAT,SNAT)，这些配置使用该应用组具有发布服务的能力。</li>\n</ul>\n<p>6，AD 集群组建：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 准备：</li>\n<li>硬件平台一致 (网口数量顺序一致)，授权一致 (线路数授权)，软件版本信息必须一致 (appversion 完全一致)</li>\n<li>HA 口 IP：两台设备的 HA 口都要配置一个 IP，要求同网段能通信，可随意配置一个网段 (与内网不冲突)。</li>\n<li>浮动 IP 和静态 IP：相当于单台设备时业务口配置的 IP，要求能与服务器通讯，能与外网通讯，二者的区别在于浮动 IP 可能会在不同的设备上生效，而静态 IP 永远只在一台设备上生效，浮动 IP 用于虚拟服务接入，静态 IP 用于健康检查。</li>\n<li>(2) 步骤：</li>\n<li>1）创建集群：</li>\n<li>主备心跳口 (原理与双机心跳口类似)：集群设备之间的状态维护和会话同步等功能都依赖主心跳口完成，主备心跳口可以选择各种类型的网口。</li>\n<li>IP 地址：用于心跳口通信的地址，与内网网段不要冲突，如果集群设备的心跳口在同一个网络为二层直连，则【路由网关】可以不用填。</li>\n<li>注：</li>\n<li>主备心跳选择的端口不能冲突，业务口也可以用作心跳口。</li>\n<li>如果主心跳口为管理口，则无法进行会话同步。</li>\n<li>心跳间隔和超时时间有默认值，一般保持默认即可。</li>\n<li>2）加入集群：</li>\n<li>集群主心跳口 IP：填写集群的主心跳 IP，通过此地址与主控通信。</li>\n<li>主备心跳口：选择与主控一样的网口，并设置可通信的 IP 地址。(跨三层时想要设置网关)</li>\n<li>3）配置链路 IP 地址：</li>\n<li>静态 IP：固定在某一台设备生效的 IP，一般用于监视器监视链路节点，若不配置的话，有可能会导致当前设备网口因没配置 IP 导致监视失败。</li>\n<li>浮动 IP：与应用组关联，随着应用组切换而切换到其他设备上生效，一般作为虚拟服务的 VIP 或者 SNAT 之后的 IP 地址。</li>\n<li>注：只需要配置一台设备即可，其他设备会同步过去。</li>\n<li>(4) 配置集群注意事项：</li>\n<li>删除或者退出集群以后，设备上面的相关配置没有被清除或者还原，保留了部分配置，如，网络链路和原集群的配置是一致的，会引起 IP 冲突，想要手动清一下。</li>\n<li>加入集群后设备的全局负载 (多站点) 功能将失效。</li>\n<li>为避免影响在线的业务，修改应用组的设备优先级并不会改变设备的生效设备，需要自己手动切换过来。</li>\n</ul>\n<p>7，客户内网有一个 WEB 应用，用 AD 做了虚拟服务，之前一直使用双机来保证可靠性，现在客户听<br>\n说有了集群功能，希望使用集群。是否建议使用？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>此场景可以做集群但没有意义。目前的集群只能承载多个虚拟服务，无法在不同设备上承载同一虚拟服务。</li>\n</ul>\n<p>8，静态 IP 的作用是？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>健康检查。</li>\n</ul>\n<p>9，最小故障切换单元为何要包括 DNAT 和 SNAT 组？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<pre><code>- 当虚拟服务切换后，浮动IP会跟着飘去其他设备，如果不切换DNAT和SNAT，可能会造成其他功能使用不正常。\n</code></pre>\n<p>10，AD 集群配置思路如下：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>组建集群，一台创建一台加入集群 (注意先接心跳口的线再加入集群)</li>\n<li>划分 IP 地址 (静态 IP，HAIP，浮动 IP)，并配置其中一台设备。</li>\n<li>创建 WEB，FTP 虚拟服务。</li>\n<li>创建应用组，WEB，FTP 分别属于不同的应用组，在不同的设备上生效。</li>\n</ul>\n<p>11，双机部署简介：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>两台 AD 双机部署，一台设备处于工作状态，另外一台处于冷备状态，两台设备通过心跳口检测对端是否存在并同步配置及会话，当主设备出现问题触发切换条件时，设备会自动把业务切换到备设备，并通过会话同步等机制，保障业务不断，从而实现业务稳定运行。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/28/WolXFI.png\" alt=\"T\"></li>\n<li>注：AD 设备各种部署模式均支持双机热备。</li>\n</ul>\n<p>12，HCI 虚拟机的精简分配和预分配的区别：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1、预分配：根据虚拟机磁盘配置的大小，预先在物理存储上分配相同大小的空间，这部分空间只有该虚拟机能够读写使用。因此所有虚拟机分配的磁盘大小总和不超过物理存储的总容量</li>\n<li>2、精简分配：创建虚拟机磁盘时不占用物理存储的空间，当虚拟机写入数据时，根据写入数据量动态分配物理存储空间。因此理论上虚拟机分配的磁盘大小总和不受物理存储总容量的限制，即虚拟机磁盘容量可以超配。但是虚拟机运行过程中会持续写入数据，当虚拟机动态分配的存储空间接近物理存储的实际容量时，虚拟机无法继续分配到存储空间从而导致运行异常。所以配置虚拟机的磁盘大小总和不建议超配太多，一般为物理存储总容量的 120%。</li>\n</ul>\n<p>13，大页内存功能主要应用于哪种类型的系统上？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>内存密集型业务系统</li>\n</ul>\n<h1 id=\"2021-07-29\"><a class=\"anchor\" href=\"#2021-07-29\">#</a> 2021-07-29</h1>\n<p>1，acloud 巡检步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 下载巡检工具 aDeploy，地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYnMuc2FuZ2Zvci5jb20uY24vcGx1Z2luLnBocD9pZD1zZXJ2aWNlOmRvd25sb2FkJmFtcDthY3Rpb249dG9vbA==\">https://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=tool</span></li>\n<li>(2) 输入集群 IP，账号密码，端口。</li>\n<li>(3) 开启远程协助，默认情况下，ssh 端口是不会打开的，需要手动打开，步骤：【管理】——【服务与下载】——【服务与支持】——【开启远程协助】</li>\n<li>(4) 巡检开始，之后查看巡检报告。</li>\n</ul>\n<p>2，桌面云虚拟机开机迁移的注意事项：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>虚拟机可以在关机和开机的状态下进行迁移，但开机迁移会有短暂的卡顿 (约 2s)。</li>\n<li>开机迁移只能临时迁移虚拟机的运行位置，不能迁移存储位置。</li>\n<li>开机迁移时会让外设断开重连，并且不支持，3D 虚拟机，非共享存储虚拟机，非 HA 虚拟机等</li>\n</ul>\n<p>3，EDS 功能说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) EDS 分为两个版本，单节点版本和集群版本，单节点版本通常用于做外置存储备份，集群版本用于对外提供存储服务。</li>\n<li>(2) EDS 目前支持对外提供三种存储服务：块存储，文件存储，对象存储。</li>\n<li>(3) 快存储即通过 iscsi 协议挂载的裸磁盘存储，文件存储即通过 NFS 或 CIFS 对外提供共享的 NAS 存储，对象存储即通过 S3 对象接口通过网络形式访问的存储。</li>\n<li>注：S3 对象接口：</li>\n<li>S3 提供了一个简单 Web 服务接口，可用于随时在 Web 上的任何位置存储和检索任何数量的数据。</li>\n</ul>\n<p>4，EDS 巡检步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>首先下载 aDeploy 工具，地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYnMuc2FuZ2Zvci5jb20uY24vcGx1Z2luLnBocD9pZD1zZXJ2aWNlOmRvd25sb2FkJmFtcDthY3Rpb249dG9vbA==\">https://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=tool</span></li>\n<li>打开巡检工具，选择自定义检测或全面检测，但需要在打开之前确定打开了 22 号端口。</li>\n<li>输入集群的 IP 和密码，开始检测。</li>\n<li>注：</li>\n<li>当输入 IP 的节点未启用系统调试或密码错误时，会出现以下提示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/29/WHNVk8.png\" alt=\"T\"></li>\n<li>解决方法：</li>\n<li>登录该 IP 对应的 EDS，【系统管理】——【系统维护】——【系统调试】选择开启后台登录。</li>\n</ul>\n<p>5，EDS 配置虚拟 IP 池步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>虚拟 IP 池用于块，文件和对象存储服务的高可用配置，业务服务器通过虚拟 IP 池中的其中一个 IP 接入，进行存储业务访问，当一台 EDS 服务器故障后，此 EDS 服务器上的虚拟 IP 会随机漂移到另一台 EDS 服务器上的存储外网物理口，来保证业务服务器的存储服务不中断。</li>\n<li>(2) 步骤：</li>\n<li>登录 EDS 控制台，打开【资源管理】——【文件存储】——【虚拟 IP 池配置】</li>\n<li>其次选择接入的网口，填写虚拟 IP 池掩码和虚拟 IP 池 IP 地址。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/29/WbzeHO.png\" alt=\"T\"></li>\n<li>(3) 参数说明：</li>\n<li>接入网口：用于与虚拟 IP 池进行通信的物理网口，推荐选择存储外网的业务口，</li>\n<li>掩码：虚拟 IP 池的子网掩码。</li>\n<li>虚拟 IP 池：用于调度的 IP 地址，IP 地址的数量要求要大于或等于存储主机的数量。</li>\n<li>注：</li>\n<li>文件存储和对象存储可公用同一个虚拟 IP 池，也可分别配置单独的虚拟 IP 池。</li>\n</ul>\n<p>6，EDS 最佳部署和实践 —— 集群网络：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 管理网络：</li>\n<li>管理网络承载的数据：</li>\n<li>集群各主机间的心跳通信，集群管理。如果采用将存储外网与管理口复用，读写数据也通过管理网络。每台服务器推荐 2*GE 网口作为管理，并做网口聚合绑定。</li>\n<li>聚合支持：轮询模式、主备模式以及主备和链路均衡模式，推荐选择使用主备和链路均衡模式。当主备和链路均衡模式时，对应交换机应选择手工聚合方式。</li>\n<li>(2) 存储私网：</li>\n<li>EDS 的多副本写磁盘是要通过存储私网完成，存储私网的速度、时延、可靠性对 EDS 的性能有影响。</li>\n<li>存储私网必须使用 2 个万兆网口，配置为链路聚合，建议存储私网配置两台交换机，交换机之间做堆叠或者 MLAG，禁止存储私网采用千兆网口。</li>\n<li>(3) 存储外网：</li>\n<li>用于对外连接客户端提供存储业务，用 2*10GE 网口做链路聚合的方式连接。</li>\n<li>注：网口资源不足的情况下，也可以直接复用存储私网（不推荐）。</li>\n<li>(4) 高可用虚拟 IP：</li>\n<li>在某节点出现意外掉线时，该节点虚拟 IP 会漂移至其他节点，通过该节点虚拟 IP 访问的业务不会导致中断。</li>\n</ul>\n<p>7，EDS—— 通用型容量存储池介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>必须采用 3 台及以上的 EDS 组建集群才能部署通用型容量存储池。</li>\n<li>部署通用型容量存储池分为三种模式，通用模式、性能模式和经济模式。</li>\n<li>通用模式：每个主机 SSD 与 HDD 数量比大于 1：5，每台主机需配置 2 块以上 SSD，适用于文件存储场景，默认使用通用模式。</li>\n<li>性能模式：每个主机 SSD 与 HDD 数量比大于等于 1：5，每主机需配置 2 块以上 SSD 和 1 块高性能 PCIE SSD，适用于高性能的文件存储场景。</li>\n<li>经济模式：每台主机需配置 1 块 SSD，HDD 数量不限，经济模式仅用于大容量视频监控、对象归档场景。</li>\n</ul>\n<p>8，EDS 存储技术架构：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>EDS 通过底层硬件资源，如 SSD、HDD 等，将这些硬件存储资源统一抽象为存储池.</li>\n<li>(2) 两种存储池：</li>\n<li>一种是专门提供高性能的高性能块存储池，一般应用于块存储场景，为超融合 HCI 等虚拟化产品提供高性能的底层块存储，</li>\n<li>另外一种是容量型通用存储池。一般用于 NFS/CIFS 共享及对象存储场景。</li>\n</ul>\n<p>9，HCI 部署最佳方案：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 网口：</li>\n<li>2 个做集群管理口（双交换机需要支持堆叠）</li>\n<li>2 个万兆口做存储通信口。</li>\n<li>2 个做业务口（根据南北向业务量大小考虑千兆、万兆，双交换机需要支持堆叠）</li>\n<li>2 个做 vxlan 通信口。</li>\n<li>注：</li>\n<li>存储口必须做聚合。</li>\n<li>若管理网、业务网、vxlan 网存在共用交换机，必须划分 vlan 进行网络隔离。</li>\n<li>(2)IP：</li>\n<li>每个物理主机一个管理 IP，集群 IP。</li>\n<li>虚拟存储、vxlan 口都需要配置私有网络，并给一个独立的 IP 段。</li>\n<li>(3) 交换机：</li>\n<li>管理口、vxLAN 口所连接的交换机关闭 STP，防止环路。</li>\n<li>管理口、vxLAN 口所连接的交换机需要开启 IGMP Snooping v2 版本，保证网络稳定性。</li>\n<li>支持端口汇聚。</li>\n<li>(4) 存储副本:</li>\n<li>最佳实践推荐 2 副本。</li>\n<li>(5) 组建集群与初始化虚拟存储：</li>\n<li>先组好集群，再初始化虚拟存储。</li>\n<li>不能用一台主机初始化集群后再添加主机。</li>\n<li>每次添加的主机数，要和虚拟存储的副本数一致。</li>\n<li>(6) aSAN 扩容：</li>\n<li>扩容时，每次添加的主机数，要与虚拟存储副本数一致，或者是它的倍数。</li>\n<li>(7) 端口聚合：</li>\n<li>管理口、业务口、vxlan 口配置聚合，不仅要在 HCI 管理平台上配置，还要在交换机上配置端口汇聚。</li>\n<li>双交换机时，两台交换机需要配置成堆叠。</li>\n<li>虚拟存储在设置存储通信网口连接模式时，选择 “双交换机链路聚合” 或者 “单交换机链路聚合” 即可。</li>\n<li>虚拟存储若采用双交换机的方案：若交换机配置了堆叠，则必须选择 “单交换机链路聚合”；若未配置堆叠，须选择 “双交换机链路聚合”</li>\n</ul>\n<p>10，HCI 的克隆和派生说明：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 克隆：</li>\n<li>克隆是把原虚拟机完整拷贝一份，支持持链接克隆、快速全量克隆和全量克隆三种虚拟机克隆方式。</li>\n<li>链接克隆：原理是通过虚拟机快照进行镜像分发实现。进行链接克隆操作后源虚拟机产生两个快照，分别用于写源虚拟机的新增数据和克隆生成的虚拟机的新增数据，两台虚拟机的镜像保持持续链接。</li>\n<li>链接克隆虚拟机与源虚拟机同时对原镜像进行引用，性能不如全量克隆。</li>\n<li>快速全量克隆：原理是在生成一个链接克隆虚拟机后，后台将原虚拟机镜像异步全量复制到该链接克隆虚拟机，链接克隆虚拟机将不再与原镜像持续链接，使克隆虚拟机成为独立的虚拟机。</li>\n<li>全量克隆：会对原虚拟机数据进行一份完整的复制，数据复制完成后虚拟机才可以成功开机。</li>\n<li>注：</li>\n<li>链接克隆和快速全量克隆基于虚拟存储的快照方式实现，只有在 HCI 集群使用了虚拟存储的情况下才支持。</li>\n<li>只使用了外置存储的 HCI 集群不支持采用链接克隆和快速全量克隆部署虚拟机。2 主机场景也不支持链接克隆和快速全量克隆功能。</li>\n<li>(2) 派生：</li>\n<li>以原虚拟机为模板做一个链接克隆，系统盘跟原虚拟机是共用的。新建虚拟机时不推荐用派生。</li>\n</ul>\n<p>11，HCI 管理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 性能扩容：</li>\n<li>以下情况需要扩容增加资源，维持集群高性能运行：</li>\n<li>集群 CPU 使用率达到 65%，推荐启动集群扩容计划。</li>\n<li>集群内存使用率达到 70% 启动虚拟机失败，或报告可配置内存不足时。</li>\n<li>aSAN 使用率达到 80%，推荐添加主机扩容。如果主机还有硬盘插槽，也可以再插入 SSD 和数据盘来扩容，</li>\n<li>(2) 管理网络：</li>\n<li>管理网络承载的数据有：集群各主机间心跳通信，集群管理，虚拟机克隆，虚拟机迁移，虚拟机导入导出。</li>\n<li>服务器推荐配置 2*GE 网口做为管理，并做网口聚合绑定，增加网络冗余性和传输带宽。</li>\n<li>管理口对应交换机端口建议只配置管理网段的 VLAN，端口设置为 access。</li>\n<li>注：</li>\n<li>关闭 IGMP Snooping，关闭 STP 协议，用 VLAN 对各个网络平面的通信进行隔离。</li>\n<li>管理通信口不要与物理出口、隧道通信口、存储通信口混用。’‘</li>\n</ul>\n<h1 id=\"2021-07-30\"><a class=\"anchor\" href=\"#2021-07-30\">#</a> 2021-07-30</h1>\n<p>1，AD—— 单站点基本原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) DNS 工作原理：</li>\n<li>LDNS：开通线路时，运营商告诉客户的 DNS 服务器。</li>\n<li>A 记录：用来指定主机名 / 域名对应的 IP 地址。</li>\n<li>NS 记录：域名服务器记录，用来指定该域名由哪个 DNS 服务器来进行解析。</li>\n<li>(2) 原理：</li>\n<li>AD 设备充当 DNS 服务器，收到外网域名请求时，设备通过调度算法计算出最优链路并返回 IP。</li>\n<li>(3) DNS 映射：</li>\n<li>DNS 映射就是将域名和对应的虚拟 IP 池对应起来。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/30/WXNOwd.png\" alt=\"T\"></li>\n<li>(4) 虚拟 IP 池：</li>\n<li>一般是一个域名解析的对应 IP 地址的逻辑分组（一个或者多个 IP 地址），并且有自己的调度策略。DNS 映射将域名与虚拟 IP 池对应起来，调度到虚拟 IP 池后，再根据虚拟 IP 池的策略返回相应 IP。</li>\n<li>(5) 调度策略：</li>\n<li>1) 静态就近性:</li>\n<li>DNS 映射和虚拟 IP 池中均可选择静态就近性算法。</li>\n<li>静态就近性算法规定根据 LDNS IP 归属来选择某个虚拟 IP 池（由 DNS 映射级别决定）或虚拟 IP 池中某个 IP 地址（由虚拟 IP 池级别决定）。</li>\n<li>2）轮询：</li>\n<li>轮流调度某个虚拟 IP 池或者虚拟 IP 池中某个 IP，机会均等。</li>\n<li>3）加权轮询：</li>\n<li>通过权重加权计算结果并调度某个虚拟 IP 池或虚拟 IP 池中某个 IP 。</li>\n<li>4）首个可用：</li>\n<li>首个 IP 地址通过监视器检测可用，则始终返回到这一个 IP 地址给 Local DNS，当此 IP 地址不可用时，调度到其他 IP。</li>\n<li>5）哈希：</li>\n<li>根据 Local DNS 的 IP 地址做哈希运算，不同的 Local DNS 请求均衡返回链路 IP 地址。</li>\n<li>6）动态就近性：</li>\n<li>AD 设备接收到客户端 DNS 的域名请求时，设备从所有链路向该 DNS 发起反向探测请求，最快收到回应 / 拒绝的链路认为最优，返回最优的链路的 IP 给 DNS 。</li>\n<li>7）加权最小连接：</li>\n<li>根据当前有效链路的一个动态比值（链路的连接数 / 链路的权重），该比值越小，优先级越高。</li>\n<li>8）加权最小流量：</li>\n<li>，根据当前有效链路的一个动态比值（链路的流量 / 链路的权重），该比值越小，优先级越高</li>\n<li>9）推荐使用算法：</li>\n<li>拥有多条同一个运营商的链路，考虑使用轮询或加权轮询或哈希。</li>\n<li>拥有不同运营商的链路，考虑使用静态就近性算法。</li>\n<li>入站流量不大且源 IP 范围大多是国外，考虑使用动态就近性。</li>\n<li>链路之间的带宽差异比较大，考虑使用加权最小连接或加权轮询。</li>\n<li>注：</li>\n<li>虚拟 IP 的监视器是复用应用负载的。</li>\n<li>虚拟 IP 如果是 WAN 口上的 IP，配置监视器后，虚拟 IP 是否参与调度取决于此 WAN 口链路是否在线；</li>\n<li>虚拟 IP 跟虚拟服务联动，配置监视器后，虚拟 IP 是否参与调度取决于虚拟服务是否可用。</li>\n</ul>\n<p>2，AD——DNS 记录：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1），DNS 的映射 1 只是针对 A 记录 / AAAA 记录，当 AD 做 DNS 服务器时，需要使用其他的 DNS 记录，可以在 AD 上配置相关的 DNS 记录。</li>\n<li>注：</li>\n<li>同一域名配置了 DNS 映射和 DNS 记录 A 记录，DNS 映射会优先于 DNS 记录中 A 记录。</li>\n<li>2）配置步骤简介：</li>\n<li>在域名提供商处设置域名的 NS 记录指向 AD 的 IP。</li>\n<li>配置 DNS 服务器。</li>\n<li>域名发布，配置 DNS 映射以及虚拟 IP 池。</li>\n<li>配置 LDNS 集合。</li>\n<li>完成静态就近性的配置（映射级别）。</li>\n</ul>\n<p>3，AD 以单臂模式部署连到三层交换机，DNS 服务器中监听地址需要填写？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>DNS 服务器中监听地址需要填写 AD 设备 WAN 口 IP，一般为客户环境的私网 IP。且要注意出口防火墙两条线路需要做相应的端口映射到内网 AD 的 WAN 口。</li>\n</ul>\n<p>4，SSL 证书链合成方法：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1）识别出服务器证书、一级根及二级根等，用记事本打开，然后该后缀名为.crt 或.cer 的证书。</li>\n<li>2）合成证书链，按照服务器证书、二级根、一级根的顺序整理成一个文件，同时后缀名.crt 或.crt</li>\n<li>注：</li>\n<li>按照服务器证书、二级根、一级根的顺序排列。</li>\n<li>3）将上一步的证书链和私钥文件一起导入到设备 SSL 证书处即可。</li>\n</ul>\n<p>5，AD—— 前置调度策略：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1) 原理：</li>\n<li>可根据源 IP、目的 IP，TCP 流，HTTP 请求头部 / 请求行、证书变量等进行调度、改写调度、关闭连接、返回指定内容等。</li>\n<li>具体能使用何种进行调度与服务相关。</li>\n<li>常用：源 IP、HTTP 请求头部 / 请求行、证书变量进行调度、改写、返回指定内容等。</li>\n<li>注：</li>\n<li>前置调度策略优先于虚拟服务关联的节点池调度策略。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/30/WXBzfs.png\" alt=\"T\"></li>\n<li>2）匹配条件：</li>\n<li>前置调度策略和改写策略共用同样的高级匹配条件。</li>\n<li>匹配条件：</li>\n<li>HOST: 根据不同 Host 调度不同节点池</li>\n<li>URI: 根据 URI 调度不同节点池。例如各种 OA 系统发布同一个域名，但访问路径不同。或者访问某个 URI 时返回 302 跳转到另外一个路径。</li>\n<li>注：调度顺序：</li>\n<li>前置调度 &gt; 会话保持 &gt; 节点调度。</li>\n</ul>\n<p>6，HTTP 改写原理：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>数据经过 AD 之后，根据业务需求对请求数据 / 应答数据进行相应的改写在发送到服务器端 / 客户端，以达到正常业务访问的需求。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/30/WXr4xI.png\" alt=\"T\"></li>\n<li>前置策略与改写策略的关系：</li>\n<li>改写策略是在前置策略中引用，要先匹配上前置策略，才有机会再匹配改写策略。</li>\n<li>改写不成功，原因：</li>\n<li>虚拟服务配置了按连接调度</li>\n<li>匹配条件写的不正确，需要再加一个反斜杠转移</li>\n<li>不支持 HTTP/1.0</li>\n<li>服务器返回的实体是压缩格式，需要在请求方向删掉 Accept-Encoding</li>\n<li>改完配置没有清理浏览器缓存，实际已经能够改写成功</li>\n<li>总结：</li>\n<li>请求改写：发生在 AD 收到客户端的请求后，发给服务器之前，AD 已经改写了请求头部，但对于客户端来说是透明的。</li>\n<li>应答改写：发生在 AD 收到服务器的回应之后，发送给客户端之前，所以客户端一定可以看出效果。</li>\n<li>HTTP 改 HTTPS 要点：</li>\n<li>应答 302 跳转，Location 中 http 要改为 https</li>\n<li>应答实体中 http 改为 https</li>\n<li>应答中 URL 带了 80 等端口，需要去掉</li>\n</ul>\n<p>7，</p>\n<div class=\"note infoHTTP优化策略：\">\n<p>如下</p>\n</div>\n<ul>\n<li>1）AD 解决方法：</li>\n<li>减轻服务器的压力，服务器是 HTTP 应用，可以考虑启用 HTTP 连接池、HTTP 缓存和 HTTP 压缩来实现需求。</li>\n<li>服务器需要统计真实的源 IP 地址，由于旁路部署，AD 做了 SNAT，因此可以通过 “传输客户端 IP 至服务器” 功能来满足客户要求</li>\n<li>2）AD 配置思路：</li>\n<li>求配置好 IP 组，节点池，虚拟服务等基础信息。、</li>\n<li>【应用负载】-【优化策略】-【HTTP 优化】，新建一条优化策略，设置 HTTP 缓存、HTTP 压缩、传输客户端 IP 至后台服务器。</li>\n<li>虚拟服务启用优化策略，并且选择新建的策略。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/30/WXyFnP.png\" alt=\"T\"></li>\n</ul>\n<p>8，三角传输概念：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) AD 旁路部署有 2 个关键设置：</li>\n<li>1）服务器的默认路由是否指向负载均衡设备的接口地址。</li>\n<li>2）负载均衡在分发请求的时候是否改变请求的源 IP 地址也就是做 SNAT 转换；这两个设置是互斥的，设置了一个就不需要设置另一个.</li>\n<li>(2) 概念：</li>\n<li>三角传输是负载均衡设备在分发请求到真实服务器上的时候，不改变请求的目标 IP 和源 IP，直接通过 2 层的 mac 地址将请求转发到服务器上，</li>\n<li>服务器上启用 loopback 地址，该地址和负载均衡设备上虚拟 IP 一样。</li>\n<li>目的在于：让服务器能够接受从负载均衡设备转发来的目标 ip 为虚拟 IP 的请求包。</li>\n<li>注：</li>\n<li>只有 4 层的服务才支持三角传输，7 层的服务不支持。</li>\n<li>AD 上需要禁用网络攻击防护和开启 wan 口的入站路由转发</li>\n<li>旁路模式部署需要 WAN 口设置多 IP，第一个 IP 不能是虚拟服务发布的 IP，否则节点监视器无法监视节点。</li>\n<li>虚拟服务发布的端口必须要求与节点的端口一致。</li>\n</ul>\n<h1 id=\"2021-08-02\"><a class=\"anchor\" href=\"#2021-08-02\">#</a> 2021-08-02</h1>\n<p>1，虚拟化部署步骤：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>说明：</li>\n<li>VMP：虚拟化管理平台。</li>\n<li>VDC：桌面接入管理系统。</li>\n<li>1）安装 VMP：</li>\n<li>将 VMP 光盘放入主机的 CD/DVD 驱动器中，开机从 CD/DVD 中启动。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/08/02/fpOkes.png\" alt=\"T\"></li>\n<li>配置默认 IP 为 10.254.254.10。</li>\n<li>电脑配置同网段的一个 IP 地址，浏览器中输入 https://10.254.254.10 登录 VMP 控制台。</li>\n<li>2）VDC 安装：</li>\n<li>默认 VMP 文件中已经存在 VDC 了，直接安装即可。</li>\n<li>步骤：【虚拟机】——【新增】——【操作系统选 VDC】</li>\n<li>电脑配置同网段的一个 IP，浏览器输入 VDC 的默认 IP：<span class=\"exturl\" data-url=\"aHR0cDovLzEwLjI1NC4yNTQuMjU0OjQ0MzA=\">http://10.254.254.254:4430</span>。之后可该 IP。</li>\n<li>3）创建虚拟机模板：</li>\n<li>【创建虚拟机】导入优化过的系统模板。</li>\n<li>两种上传 ISO 文件的方法：</li>\n<li>①：通过共享上传：</li>\n<li>【实体机】——【存储】——【点击对应的存储】——【点击管理存储空间】勾选 “开启共享目录管理服务” 就可以访问 VMP 的共享目录。</li>\n<li>②：通过浏览器上传：</li>\n<li>浏览器上传仅支持拓展名为.iso，.qcow2，和.ova 的文件。因此先将压缩包转换成这个模式。</li>\n<li>安装优化工具，安装步骤即可。</li>\n<li>注：</li>\n<li>重启后，Administrator 这个用户默认是禁用的，建议启用，把其他用户删除。</li>\n<li>因为：</li>\n<li>在 VDC 上新建资源自动登录选项默认用的 Administrator。</li>\n<li>有些软件的安装需要超级管理员的权限。</li>\n<li>最后安装 agent 插件。</li>\n<li>注：</li>\n<li>Agent 安装完后，建议把之前地址改为自动获取，因为，固定的转换为模板派生出来的虚拟机都是相同的 IP 会导致 IP 冲突。</li>\n<li>模板建立完成之后，就可以在 VDC 上按照这个模板派生虚拟机了。</li>\n<li>4）VDC&amp;VMP 部署虚拟化：</li>\n<li>注：VDC 是一个独立的软件产品，用于将虚拟机桌面发布给终端用户的设备。虚拟机是运行在 VMP 上的，所以 VDC 需要先连接到 VMP 才能对虚拟机进行分配和发布。</li>\n<li>【虚拟化平台控制器】——【新建】</li>\n<li>填写 VMP 的信息：名称，地址，用户名，密码。</li>\n<li>之后，打开【资源管理】——【新建独享桌面资源】选择刚创建的模板部署即可。</li>\n<li>新建用户和角色：</li>\n<li>在用户管理里新建对应的组和用户。用户创建完成创建一个角色，把创建的独享桌面和用户关联起来即可。</li>\n<li>注：</li>\n<li>若内网没有 DHCP 服务器，把虚拟机的 IP 改成 VDC 能通信后，一定要从 VDC 上开启虚拟机。</li>\n</ul>\n<p>2，双网隔离概述：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 概念：</li>\n<li>用户可以通过桌面云访问互相隔离的两个网络，即满足使用桌面云的同时，又提高了内网的安全性。</li>\n<li>用户可以使用 aDesk 瘦终端上的开关进行两个桌面之间的切换，两个桌面处于相互隔离的网络中，从而访问不同网络的资源。</li>\n<li>分为：逻辑隔离和物理隔离。</li>\n<li>逻辑隔离：</li>\n<li>实际上没有将两个网络在物理上完全隔离开，只是通过相关的路由，VLAN，ACL 等策略等使得两个网段之间不能互访。</li>\n<li>当用户需要使用内网资源时，登录内网桌面，当用户需要使用外网资源时，登录外网桌面。</li>\n<li>物理隔离：</li>\n<li>两个网段完全隔离，物理上无法互访，可用通过 aDesk 瘦终端上配置两个网卡地址，从而分别访问到不同主机的 VDC，实现两个主机的桌面连接。</li>\n<li>注：</li>\n<li>需要两套桌面云环境 VMP，VDC。而且，aDesk 瘦终端上需要配置两套 IP 地址。</li>\n<li>VDC，VMP 属于两个物理上相互隔离的网段。</li>\n<li>不论是物理隔离还是逻辑隔离，本质上都是通过 aDesk 访问虚拟机。</li>\n<li>(2) 物理隔离配置步骤：</li>\n<li>准备两套桌面云环境，在 aDesk 瘦终端上勾选启用双网，配置两个 IP 地址，及对应的接入 VDC 地址。</li>\n<li>分别配置 “以太网 1” 和 “以太网 2”</li>\n<li>注：</li>\n<li>网络是否启用是由 aDesk 瘦终端上的开关来决定相应的网口是否启用。</li>\n</ul>\n<p>3，远程应用和共享桌面部署：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 远程应用：</li>\n<li>指通过 VDI 客户端来访问位于服务器虚拟机上的应用程序。</li>\n<li>主要用于内网安全性较高的场景，内网的应用程序不能部署在个人桌面上，需要通过 VDI 客户端进行远程使用。</li>\n<li>(2) 资源服务器：</li>\n<li>指承载远程应用程序的服务器。</li>\n<li>步骤：</li>\n<li>1）搭建资源服务器：</li>\n<li>在 Win Server 主机上安装终端服务器及授权，（在 Win 组件向导内安装）。</li>\n<li>登录 VDC，【VDI 设置】——【服务器管理】——【下载终端服务器程序】</li>\n<li>2）新建服务器：</li>\n<li>【VDI 设置】——【服务器管理】中新建远程应用服务器。</li>\n<li>注：目的是使 VDC 可用管理刚搭建的资源服务器。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/08/02/f9gRTH.png\" alt=\"T\"></li>\n<li>填写服务器名称，Win ServerIP 地址，用户名密码。</li>\n<li>配置远程应用程序列表，添加要发布的应用程序的路径。</li>\n<li>3）新建远程应用资源：</li>\n<li>【VDI 设置】——【资源管理】中新建远程应用资源。</li>\n<li>选择要对外发布的应用程序。</li>\n<li>新建用户，角色，策略组，并把远程应用资源添加到角色配置中。</li>\n<li>注：</li>\n<li>当用户使用远程应用资源时，使用的 Windows 账户为 VDI 账户，适用于远程应用服务器加入 AD 域环境下，使用域账号登录 VDI 的场景，同时需要配置登录到的 AD 域。</li>\n<li>(3) 共享桌面：</li>\n<li>指多个用户可同时使用一台服务器上的桌面资源。需要为每个登录用户建立不同的 Windows 账户。</li>\n<li>适用于多个用户接入一个桌面进行使用的场景。</li>\n<li>(4) 资源服务器：</li>\n<li>指承载共享桌面的服务器，支持的有：Win Server2003/2008/2012。</li>\n<li>步骤：</li>\n<li>1）新建共享桌面服务器：</li>\n<li>在 VDC 上选择新建的仍是远程应用服务器。</li>\n<li>配置，服务器 IP 地址，用户名和密码。</li>\n<li>2）新建共享桌面资源：</li>\n<li>【VDI 设置】——【资源管理】新建共享桌面。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/08/02/fCePMQ.png\" alt=\"T\"></li>\n<li>选中刚创建的共享桌面服务器。</li>\n<li>注：一个共享桌面服务器只能被一个共享桌面资源所使用。</li>\n<li>之后和远程应用一样关联用户。</li>\n<li>需要注意的有：</li>\n<li>VDC 与服务器使用 TCP 7170，7171，7172 端口进行通信，需要 Win 防火墙和中间网络设备放通这些端口。</li>\n</ul>\n<p>4，aCenter 功能介绍：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>(1) 说明：</li>\n<li>aCenter 是虚拟化集中管理平台，适用于 VMP 集群分布式部署场景，aCenter 通常部署于企业总部，通过公网，专线或企业内网对各分支机构的 VMP 集群进行集中监控，升级 (较慢，建议本地升级)，管理和统一授权。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/08/02/fCmh9K.png\" alt=\"T\"></li>\n<li>(2) 安装步骤：</li>\n<li>1）安装在物理主机上：</li>\n<li>与安装 VMP 步骤大致相同。</li>\n<li>2）安装在 VMP 平台的虚拟机上：</li>\n<li>与在 VMP 上安装 VDC 的过程大致相同。</li>\n<li>3）aCenter 初始化：</li>\n<li>浏览器输入 https://aCenter IP 登录控制台，按步骤进行配置。</li>\n<li>4）aCenter 授权：</li>\n<li>在 VMP【管理】——【统一授权】——【导入序列号】，导入 aCenter 授权信息。</li>\n<li>5）配置端口映射：</li>\n<li>在 VMP 的【管理】——【端口映射】配置。</li>\n<li>aCenter 一般部署于公司总部的内网环境中，总部的网关必须配置端口映射，将 aCenter 映射到公网，这样分支的 VDC/VMP 服务器才能接入到 aCenter 中。</li>\n<li>注：单点登录端口和 SSH 端口用于 aCenter 的自身服务 (默认为 9000 和 22)，需要被分支机构的 VDC/VMP 访问到，如果需要分支能够登录到 aCerter 控制台，也需要把 443 端口映射出去。</li>\n<li>6）集群节点加入 aCenter：</li>\n<li>在 VDC【系统设置】——【系统配置】——【aCenter 管理】里，添加 aCenter 信息。</li>\n<li>注：如果 VDC 部署于总部，直接填写 aCenter 的 Lan 口地址和 443 端口，如果位于分支，则需要填写 aCenter 映射后的出口 IP 和端口。</li>\n</ul>\n<h1 id=\"07-07补充\"><a class=\"anchor\" href=\"#07-07补充\">#</a> 07-07 补充</h1>\n<ul>\n<li>转载于：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzZG4xMDA4NjExMC9hcnRpY2xlL2RldGFpbHMvOTAzMTQwNzA=\">https://blog.csdn.net/csdn10086110/article/details/90314070</span></li>\n</ul>\n<h1 id=\"广域网加速\"><a class=\"anchor\" href=\"#广域网加速\">#</a> 广域网加速</h1>\n<h2 id=\"广域网加速的应用背景\"><a class=\"anchor\" href=\"#广域网加速的应用背景\">#</a> 广域网加速的应用背景</h2>\n<p>1，大型企业的发展特征：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1. 多层组织结构，组织庞大， 人员众多</li>\n<li>2. 业务经营范围广，整合 行业内上下游多个产业</li>\n<li>3. 组织分布跨区域或跨国， 呈现异地分布</li>\n</ul>\n<p>2，WOC 的应用背景：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>广域网中有大量的路由和网关，跨区域、跨运营商情况普遍。</li>\n<li>丢包和延迟导致应用系统的使用效果大打折扣。</li>\n<li>一些应用系统的交互过多、协议固有缺陷导致交互效果差。</li>\n</ul>\n<h2 id=\"广域网加速技术分类\"><a class=\"anchor\" href=\"#广域网加速技术分类\">#</a> 广域网加速技术分类</h2>\n<p>1，传输协议优化</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>提高传输有效率，改进传统传输协议 (快速 TCP 和 HTP)</li>\n<li>1，快速 TCP：</li>\n<li>普通 TCP 协议在高宽带，高延时，及一定丢包率情况下不理想 (TCP 滑动窗口慢上升，快下降的机制)。</li>\n<li>采用快速 TCP 优化传输控制机制，可减少时延和丢包率的影响 (改进 TCP 滑动窗口机制快上升，慢下降，提高传输速率)。</li>\n<li>2，快速 HTP：</li>\n<li>HTP 协议：是 SANGFOR 的专利技术，它分为 HTP (tcp packet) 和 HTP (UDP packer)。</li>\n<li>HTP (tcp packet)：是一种基于 TCP 协议的拥塞控制算法，主要应用于高时延，高丢包的网络环境。</li>\n<li>HTP (udp packet)：是一种基于 UDP 协议的通信协议，适用于高丢包的网络环境并可设置其工作模式以及 UDP 的数据包大小。</li>\n<li>注：使用 HTP 方式加速时，sangforVPN 必须采用 UDP 方式连接，如有丢包环境，优先使用 HTP (UDP) 其次再使用 HTP (TCP)，如果没有丢包环境，使用 HTP (TCP) 这个传输协议最稳定。</li>\n</ul>\n<h2 id=\"协议代理减少交互\"><a class=\"anchor\" href=\"#协议代理减少交互\">#</a> 协议代理 (减少交互)</h2>\n<p>1，TCP 代理技术详解：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHI4SK.png\" alt=\"T\"></li>\n</ul>\n<p>2，HTTP 代理 - WEb Push 技术</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHo0AA.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHo6c8.png\" alt=\"T\"></li>\n</ul>\n<p>3，WEB Cache 与流缓存最大的区别在于：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>WEB Cache 是直接存放整个文件，只要 URL 相同就可以，且只对 HTTP 协议数据有效。</li>\n<li>流缓存是存放二进制，只要二进制内容相同就可以，且对所有数据有效。</li>\n</ul>\n<h2 id=\"广域网加速的部署方案\"><a class=\"anchor\" href=\"#广域网加速的部署方案\">#</a> 广域网加速的部署方案</h2>\n<p>1，网关 VPN 加速模式</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，应用场景：</li>\n<li>WOC 直接接 Internet 线路做网关部署在网络出口，总部分支设备连通 VPN 后再建立加速连接，开启流量管理功能对不同的应用流量使用不同的流量策略。</li>\n<li>一机多用，为中小企业节省成本，既能解决总部分支的安全连通，同时，可以对上网流量做管控，从而提升了总部分支间的访问速度，实现安全，快速的访问需求。</li>\n</ul>\n<p>2，单臂 VPN 加速模式</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，应用场景</li>\n<li>WOC 单臂部署在核心交换机上，即不用改动总部的网络结构又能实现总部分支安全快速访问。</li>\n<li>开启流量管理功能对总部分支不同的应用流量使用不同的流量策略。</li>\n<li>在不改变总部网络的前提下，即解决总部分支的安全连通，又能优化总部分支间的访问速度，实现安全快速的访问。</li>\n</ul>\n<p>3，单网桥纯加速模式：<br>\n:::innfo<br>\n 如下<br>\n:::</p>\n<ul>\n<li>1，应用场景：</li>\n<li>WOC 网桥部署在专线路由器和核心交换机之间，在不改变原有网络结构的同时，即能对专线上的应用配置优先级不同的流量策略，又消减了总部分支之间大量的重复流量，不但保障了重要业务的流量优先，而且优化了总部分支的访问体验，使有限的带宽发挥更大的价值。</li>\n<li>注：此部署模式可以使用 bypass 功能，保障设备故障时快速恢复网络。</li>\n</ul>\n<p>4，单臂纯加速模式：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，应用场景：</li>\n<li>WOC 单臂部署在核心交换机中，通过 PBR 或者 WCCP 把要加速的流量引到加速设备上来进行加速，不但消减了重复流量，而且优化业务访问速度。</li>\n<li>注：此部署模式需要控制好数据流向，避免环路，并且，可以使用 PBR+CDP 或者 WCCP 实现设备故障时自动恢复原有网络。</li>\n</ul>\n<h2 id=\"广域网加速部署案例\"><a class=\"anchor\" href=\"#广域网加速部署案例\">#</a> 广域网加速部署案例</h2>\n<p>1，WOC 综合案例部署环境：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>1，WOC 部署前：</li>\n<li>➢（1）分支机构 A 通过专线访问总部办 公 OA 。</li>\n<li>➢（2）分支机构 B 和移动用户通过端口 映射方式访问办公 OA。而且访问效果都很慢，不理想。</li>\n<li>2，拓扑</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/07/07/RHObGj.png\" alt=\"T\"></li>\n<li>3，部署 WOC 后：</li>\n<li>➢（1）取消办公系统的端口映射，避免 暴露在公网。</li>\n<li>➢（2）远程分支 A 和分支 B 以及移动办公 用户都能访问办公 OA 资源</li>\n<li>➢（3）访问总部的 OA 资源，有明显的加 速效果。</li>\n<li>4，配置思路：</li>\n<li>➢总部 WOC 单臂部署。</li>\n<li>➢分支 A 与总部是专线环境，WOC 网桥模式部署。</li>\n<li>➢分支 B 前面是路由器，使用 WOC 代替路由器做网关部署。</li>\n<li>➢移动用户采用软件加速客户端 pdlan+pacc 融合版或者独立版 PACC 远程访问。</li>\n<li>5，配置要点：</li>\n<li>➢ （1）总部防火墙设备上做 tcp 和 udp 的 4009 的端口映射，映射到 WOC 设 备 192.168.100.205</li>\n<li>➢ （2）总部防火墙设备上设置路由，到分支 A 和分支 B 内网网段， 下一跳 指向加速设备 192.168.100.205</li>\n<li>➢ （3）总部 WOC 上配置分支 A，分支 B，和移动用户的加速策略以及加速 帐号</li>\n<li>➢ （4）分部 B 和移动用户，需要先建立 VPN 连接，再配置加速连接</li>\n</ul>\n<h1 id=\"07-08补充\"><a class=\"anchor\" href=\"#07-08补充\">#</a> 07-08 补充</h1>\n<h2 id=\"ac\"><a class=\"anchor\" href=\"#ac\">#</a> AC</h2>\n<p>1，三层环境中，AC 设备的默认网关如何配置，是否还需要配置静态路由？</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>配置默认网关指向出口方向的三层设备的内网口，这时 AC 会自动生成一条默认路由，下一跳指向网关地址。</li>\n<li>非 trunk 环境，当 AC 的内网口连接的是三层设备时，要配置静态路由指向内网不同的网段，下一跳指向三层设备的上行口。</li>\n</ul>\n<p>2，负载均衡：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>在企业网服务器群中部署负载均衡设备，主要可以达到以下效果：</li>\n<li>(1) 解决用户并发访问时的网络拥塞；</li>\n<li>(2) 抵御来自内外部的 DoS 攻击，保证服务器安全；</li>\n<li>(3) 避免了网络关键服务出现单点失效；</li>\n<li>(4) 提高服务器及其他资源的利用效率；</li>\n<li>(5) 提高服务器响应速度，为用户提供更好的服务质量</li>\n</ul>\n<h1 id=\"07-09补充\"><a class=\"anchor\" href=\"#07-09补充\">#</a> 07-09 补充</h1>\n<p>1，SNMP 协议：<br>\nSNMP 是基于 TCP/IP 协议族的网络管理标准，是一种在 IP 网络中管理网络 节点（如服务器、工作站、路由器、交换机等）的标准协议。SNMP 能够使网 络管理员提高网络管理效能，及时发现并解决网络问题以及规划网络的增长。 网络管理员还可以通过 SNMP 接收网络节点的通知消息以及告警事件报告等来 获知网络出现的问题。<br>\n2，特点：<br>\n1. 支持分布式网络管理<br>\n 2. 扩展了数据类型<br>\n 3. 可以实现大量数据的同时传输，提高了效率和性能<br>\n 4. 丰富了故障处理能力<br>\n 5. 增加了集合处理功能<br>\n 6. 加强了数据定义语言<br>\n 3，协议数据单元有：</p>\n<ul>\n<li>get-request 操作：从代理进程处提取一个或多个参数值。</li>\n<li>get-next-request 操作：从代理进程处提取紧跟当前参数值的下一个参数值。</li>\n<li>set-request 操作：设置代理进程的一个或多个参数值。</li>\n<li>get-response 操作：返回的一个或多个参数值。</li>\n<li>trap 操作：代理进程主动发出的报文，通知管理进程有某些事情发生。</li>\n</ul>\n",
            "tags": [
                "实习",
                "实习"
            ]
        },
        {
            "id": "https://manshan.top/2021/06/18/TCP_IP%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "https://manshan.top/2021/06/18/TCP_IP%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "数据通信与计算机网络",
            "date_published": "2021-06-17T16:30:41.356Z",
            "content_html": "<h1 id=\"第一部分-路由选择的基本知识\"><a class=\"anchor\" href=\"#第一部分-路由选择的基本知识\">#</a> 第一部分 路由选择的基本知识</h1>\n<h2 id=\"tcpip回顾\"><a class=\"anchor\" href=\"#tcpip回顾\">#</a> TCP/IP 回顾</h2>\n<p class=\"red\">1，TCP/IP 协议层：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》OSI: 应用层，表示层，会话层，传输层，网络层，数据链路层，物理层。</li>\n<li>2》TCP/IP: 应用层，传输层（主机到主机层），网络层（Internet 层），物理层（网络接口层）。</li>\n<li>3》物理层包含了多种与物理介质相关的协议，这些物理介质用以支撑 TCP/IP 通信。物理层的协议按照正式的分类可以分为 4 类，这 4 类涵盖了物理介质的所有方面：</li>\n<li>电子 / 光学协议 —— 描述了信号的各种特性。例如，电压或光强度、位定时、编码和信号波形。</li>\n<li>机械协议 —— 规定了连接器的尺寸或导线的金属成分。</li>\n<li>功能性协议 —— 描述了做什么。</li>\n<li>程序性协议 —— 描述了如何做。</li>\n<li>4》数据链路层包含了控制物理层的协议：如何访问和共享介质、怎样标识介质上的设备，以及在介质上发送数据之前如何完成数据成帧。典型的数据链路协议有 IEEE 802.3 / 以太网、帧中继、ATM 以及 SONET。</li>\n<li>5》Internet 层与 OSI 的网络层相对应，主要负责定义数据包格式和地址格式，为经过逻辑网络路径的数据进行路由选择。</li>\n<li>6》与 OSI 传输层相对应的是主机到主机层，它指定了控制 Internet 层的协议，这就像数据链路层控制物理层一样。主机到主机层和数据链路层都定义了流控和差错控制机制。二者不同之处在于，数据链路层协议强调控制数据链路上的流量，即连接两台设备的物理介质上的流量；而传输层控制逻辑链路上的流量，即两台设备的端到端连接，这种逻辑连接可能跨越一连串数据链路。</li>\n<li>7》应用层与 OSI 的会话层、表示层、应用层相对应。虽然一些路由选择协议使用这一层，例如边界网关协议（BGP）、路由选择信息协议（RIP）等 ，但是应用层最常用的服务是向用户应用提供访问网络的接口。</li>\n<li>注：BGP 是一个应用层的协议，因为它使用 TCP 端口传送它的消息。而 RIP 协议也是应用层协议的原因是因为使用 UDP 接口传递它的消息。其他的路由选择协议如 OSPF，称为 Internet 层的协议是因为它们直接在 IP 数据包中封装它们的消息。</li>\n</ul>\n<p class=\"red\">2，IP 包头：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/06/18/2zHDjf.png\" alt=\"图片\"></li>\n<li>2》版本（Version）—— 标识了数据包的 IP 版本号。0100 表示 IP 版本 4（IPv4）。0110 表示 IP 版本 6（IPv6）。</li>\n<li>3》报头长度（header length）—— 字段长度为 4 位，设计报头长度字段是因为数据包的可选项字段的大小会发生变化。IP 报头最小长度为 20 个八位组，最大可以扩展到 60 个八位组 —— 通过这个字段也可以描述 32 位字的最大长度。</li>\n<li>4》服务类型（Type of Service，ToS）—— 字段长度为 8 位，它用来指定特殊的数据包处理方式。</li>\n<li>5》标识符（Identifier）—— 字段长度为 16 位，通常与标记字段和分段偏移字段一起用于数据包的分段。如果数据包原始长度超过数据包所要经过的数据链路的最大传输单元（MTU），那么必须将数据包分段为更小的数据包。当超过 MTU 时，路由器需要在数据成帧之前将数据包分段成多个数据包，其中每个数据包长度不得超过 MTU；然后路由器在每片数据包的标识字段上打上相同的标记，以便接收设备可以识别出属于一个数据包的分段。</li>\n<li>注：被分段的数据包不会在数据链路的另一端被重组，而是一直保持分段状态，直至到达最终目的地时才会被重组。</li>\n<li>6》标记字段（Flag）—— 长度为 3 位，其中第 1 位没有使用。第 2 位是不分段（DF）位。当 DF 位被设置为 1 时，表示路由器不能对数据包进行分段处理。</li>\n<li>7》生存时间（Time To Live，TTL）—— 字段长度为 8 位，当数据包逐个沿路由器被传输时，每台路由器都会降低 TTL 减一。当 TTL 值减为 0 时，路由器将会丢弃该数据包并向源点发送错误信息。这种方法可以防止数据包在网络上无休止地被传输。</li>\n</ul>\n<p class=\"red\">3，IPV4 地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》IPv4 地址长度为 32 位。像所有其他网络层地址一样，IPv4 地址也包括网络号和主机号两部分。网络号部分唯一地标识了一条物理链路或逻辑链路，对于与该链路相连的所有设备来说网络号部分是共同的。而主机号部分惟一地标识了该链路上连接的具体设备。</li>\n<li>注：点分十进制表示法只用于 IPv4 地址。</li>\n<li>2》A 类地址 —— 用于大型网络，第 1 个八位组是网络号，后 3 个八位组是主机号。8 位的网络号最多可以表示 256 个网络，而每个网络地址的主机号可以提供的主机数量为 224 或 16 777 216。</li>\n<li>3》B 类地址 —— 用于中型网络。前 2 个八位组表示网络号，后 2 个八位组表示主机号。网络号和主机号的数量均为 216 或 65 536 个。</li>\n<li>4》C 类地址 —— 对应于 A 类 IP 地址。前 3 个八位组表示网络号，最后 1 个八位组表示主机号。</li>\n<li>5》如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/06/18/2zbF5d.png\" alt=\"图片\"></li>\n<li>6》私有的保留地址：</li>\n<li>10.0.0.0-10.255.255.255。</li>\n<li>172.16.0.0-172.31.255.255 。</li>\n<li>192.168.0.0-192.168.255.255。</li>\n<li>7》如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/06/18/2zbyxx.png\" alt=\"图片\"></li>\n<li>上图：地址掩码并不是标准的 16 位 B 类地址掩码；而是被扩展了 8 位，以便 IP 地址的前 24 位都被解释为网络位。现在，IPv4 地址包括 3 个部分：网络部分、子网部分和主机部分。在单一 B 类地址下最多可以有 256 个子网（2 的八次方）。</li>\n<li>注：通过向主机位借位用作子网位，子网掩码使一个单一的网络地址可以用于多个数据链路。</li>\n<li>注：无类别路由选择协议，这种路由选择协议才可以真正地使用全 0 或全 1 子网。</li>\n</ul>\n<p class=\"red\">4，地址解析协议（ARP）：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》路由器可以沿逻辑路径传送数据包，其中逻辑路径包括多个数据链路。沿独立的数据链路传送数据包时，需要把数据包封装在帧中，并且使用数据链路标识（如 MAC 地址）让帧可以从链路的源点到达目的地。</li>\n<li>2》当一台设备需要发现另一台设备的数据链路标识符时，它将建立一个 ARP 请求数据包。这个请求数据包中包括目标设备的 IPv4 地址以及请求设备（发送者）的源点 IPv4 地址和数据链路标识符（MAC 地址）。然后 ARP 请求数据包被封装在数据帧中，其中带有作为源的发送者的 MAC 地址和作为目标的广播地址。</li>\n<li>3》广播地址意味着数据链路上的所有设备都将收到该帧，并且要检查帧内封装的数据包。除了目标机可以识别此数据包外，其他所有设备都会丢弃此数据包。目标机将向源地址发送 ARP 响应数据包，提供它的 MAC 地址。</li>\n<li>注：类似于 IP 的广播地址，MAC 的广播地址也是所有位全部为 1：ffff.ffff.ffff。</li>\n<li>4》查看 ARP 表：</li>\n<li>show arp。</li>\n<li>Cisco 路由器保存 ARP 表项的时间为 4 个小时，这个缺省值可以修改。</li>\n<li>命令：</li>\n<li>Martha(config)# interface Ethernet 0</li>\n<li>Martha(config-if)# arp timeout 1800</li>\n<li>ARP 表项还可以永久地保存在表中。</li>\n<li>命令：</li>\n<li>Martha(config)# arp 172.21.5.131 0000.00a4.b74c snap</li>\n<li>为了实现地址 172.21.5.131 到硬件地址 0000.00a4.b74c 的静态映射，并且采用 SNAP（Subnetwork Access Protocol）封装类型。</li>\n<li>5》命令 clear arp-cache 可以从 ARP 表中强制删除所有动态表项。并且此命令也可以清除快速交换高速缓冲区和 IP 路由高速缓冲区中的内容。</li>\n</ul>\n<p class=\"red\">5，代理 ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<details><summary>primary</summary><div>\n<ul>\n<li>例如，主机 192.168.12.5/24 需要向主机 192.168.20.101/24 发送数据包，但是它没有配置缺省网关信息，因而也就不知道如何到达路由器。这时它可以向 192.168.20.101 发送一个 ARP 请求；本地路由器收到这一请求，并且路由器知道如何到达网络 192.168.20.0，因此路由器将回复以上请求，其中把自己的数据链路标识符作为 ARP 回复数据包中的硬件地址。事实上，路由器欺骗了本地的主机，让它认为路由器的接口就是 192.168.20.101 的接口。最终所有发向 192.168.20.101 的数据包都被送往路由器。</li>\n</ul>\n</div></details>\n<ul>\n<li>1》关闭代理 ARP 命令：</li>\n<li>no ip proxy-arp 关闭此功能。</li>\n</ul>\n<p class=\"red\">6，无敌 ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》主机偶尔也会使用自己的 IPv4 地址作为目标地址发送 ARP 请求。这种 ARP 请求称为无故 ARP，主要有两个用途：</li>\n<li>无故 ARP 可以用于检查重复地址。一台设备可以向自己的 IPv4 地址发送 ARP 请求，如果收到 ARP 响应则表明存在重复地址。</li>\n<li>无故 ARP 还可以用于通告一个新的数据链路标识符。当一台设备收到一个 ARP 请求，如果 ARP 高速缓冲中已有发送者的 IPv4 地址，那么与此 IPv4 地址相对应的硬件地址将会被发送者新的硬件地址所更新。这种无故 ARP 用途正是基于此事实。</li>\n<li>某个子网内运行热备份路由器协议（HSRP 协议）的路由器如果从其他路由器变成了主路由器，它就会发出一个无故 ARP 来更新该子网上主机的 ARP 缓存。</li>\n</ul>\n<p class=\"red\">7，反向 ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》反向 ARP（RARP）可以实现 IPv4 地址到已知硬件地址的映射。</li>\n<li>2》某些设备，如无盘工作站在启动时可能不知道自己启动时的 IPv4 地址。嵌入这些设备固件中的 RARP 程序可以允许它们发送 ARP 请求，其中硬件地址为设备的硬件编入地址。RARP 服务器将会向这些设备回复相应的 IPv4 地址。</li>\n</ul>\n<p class=\"red\">8，ICMP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1》Internet 消息控制协议（ICMP）指定了多种消息类型，这些消息的共同目的就是管理网络。</li>\n<li>2》ICMP 的消息可以分为错误消息、请求消息和响应消息。</li>\n</ul>\n<h2 id=\"ipv6概述\"><a class=\"anchor\" href=\"#ipv6概述\">#</a> IPv6 概述</h2>\n<h2 id=\"静态路由\"><a class=\"anchor\" href=\"#静态路由\">#</a> 静态路由</h2>\n<h2 id=\"动态路由选择协议\"><a class=\"anchor\" href=\"#动态路由选择协议\">#</a> 动态路由选择协议</h2>\n",
            "tags": [
                "技术",
                "数通"
            ]
        },
        {
            "id": "https://manshan.top/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8B)/",
            "url": "https://manshan.top/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8B)/",
            "title": "数据通信与计算机网络",
            "date_published": "2021-06-14T09:29:08.713Z",
            "content_html": "<h1 id=\"01ospf协议特征\"><a class=\"anchor\" href=\"#01ospf协议特征\">#</a> 01【OSPF 协议特征】</h1>\n<h1 id=\"02bgp基本原理\"><a class=\"anchor\" href=\"#02bgp基本原理\">#</a> 02【BGP—— 基本原理】</h1>\n<h1 id=\"03bgp路径属性上\"><a class=\"anchor\" href=\"#03bgp路径属性上\">#</a> 03【BGP—— 路径属性（上）】</h1>\n<h1 id=\"04bgp路径属性下\"><a class=\"anchor\" href=\"#04bgp路径属性下\">#</a> 04【BGP—— 路径属性（下）】</h1>\n<h1 id=\"05bgp路由策略技术上\"><a class=\"anchor\" href=\"#05bgp路由策略技术上\">#</a> 05【BGP—— 路由策略技术（上）】</h1>\n<h1 id=\"06bgp路由策略技术下\"><a class=\"anchor\" href=\"#06bgp路由策略技术下\">#</a> 06【BGP—— 路由策略技术（下）】</h1>\n<h1 id=\"07bgprr和联邦\"><a class=\"anchor\" href=\"#07bgprr和联邦\">#</a> 07【BGP——RR 和联邦】</h1>\n<h1 id=\"08bgp选路规则上\"><a class=\"anchor\" href=\"#08bgp选路规则上\">#</a> 08【BGP—— 选路规则（上）】</h1>\n<h1 id=\"09bgp选路规则下\"><a class=\"anchor\" href=\"#09bgp选路规则下\">#</a> 09【BGP—— 选路规则（下）】</h1>\n<h1 id=\"10icmp原理\"><a class=\"anchor\" href=\"#10icmp原理\">#</a> 10【ICMP 原理】</h1>\n<h1 id=\"11pim原理上\"><a class=\"anchor\" href=\"#11pim原理上\">#</a> 11【PIM 原理（上）】</h1>\n<h1 id=\"12pim原理下\"><a class=\"anchor\" href=\"#12pim原理下\">#</a> 12【PIM 原理（下）】</h1>\n<h1 id=\"13acl原理\"><a class=\"anchor\" href=\"#13acl原理\">#</a> 13【ACL 原理】</h1>\n<h1 id=\"14nat原理\"><a class=\"anchor\" href=\"#14nat原理\">#</a> 14【NAT 原理】</h1>\n<h1 id=\"15v实列\"><a class=\"anchor\" href=\"#15v实列\">#</a> 15【V 实列】</h1>\n<h1 id=\"16vrrp原理上\"><a class=\"anchor\" href=\"#16vrrp原理上\">#</a> 16【VRRP 原理（上）】</h1>\n<h1 id=\"17vrrp原理下\"><a class=\"anchor\" href=\"#17vrrp原理下\">#</a> 17【VRRP 原理（下）】</h1>\n<h1 id=\"18mpls概述与静态lsp\"><a class=\"anchor\" href=\"#18mpls概述与静态lsp\">#</a> 18【MPLS 概述与静态 LSP】</h1>\n<h1 id=\"19mpls静态lsp的配置及mpls转发过程\"><a class=\"anchor\" href=\"#19mpls静态lsp的配置及mpls转发过程\">#</a> 19【MPLS 静态 LSP 的配置及 MPLS 转发过程】</h1>\n<h1 id=\"20ldp标签分发协议\"><a class=\"anchor\" href=\"#20ldp标签分发协议\">#</a> 20【LDP 标签分发协议】</h1>\n",
            "tags": [
                "技术",
                "数通"
            ]
        },
        {
            "id": "https://manshan.top/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8A)/",
            "url": "https://manshan.top/2021/06/14/%E6%95%B0%E9%80%9A%E5%9F%BA%E7%A1%80(%E4%B8%8A)/",
            "title": "数据通信与计算机网络",
            "date_published": "2021-06-14T09:17:45.028Z",
            "content_html": "<h1 id=\"01网络基础知识\"><a class=\"anchor\" href=\"#01网络基础知识\">#</a> 01【网络基础知识】</h1>\n<p class=\"red\">1. 概念：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>交换：Switching</li>\n<li>单播：Unicast</li>\n<li>组播：Multicast</li>\n<li>广播：Broadcast</li>\n<li>广播域：Broadcast Domain</li>\n</ul>\n<p class=\"red\">2，交换机：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>交换机的每一个接口是一个冲突域。</li>\n<li>交换机的整机是一个广播域（也就是说连接到交换机上的所有节点是一个广播域 [LAN]）。</li>\n<li>广播是一个负担（所以要减小广播域的大小）。</li>\n<li>交换机的基本功能：</li>\n<li>数据帧的交换。</li>\n<li>终端用户设备的接入。</li>\n<li>基本的接入安全功能。</li>\n<li>广播域的隔离（VLAN）。</li>\n<li>二层链路的冗余，防环及负载均衡。</li>\n</ul>\n<p class=\"red\">3，路由器：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>路由器的基本功能：</li>\n<li>隔离广播，实现跨三层的数据互访。</li>\n<li>路由协议的支持，维护路由表。</li>\n<li>路径选择及数据转发。</li>\n<li>广域网接入，地址转换及特定的安全功能。</li>\n<li>流量管理</li>\n</ul>\n<p class=\"red\">4，OSI 参考模型 (写了好多遍了 ——_——！！！)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>OSI 模型的目的：</li>\n<li>规范不同系统的互联标准，使两个不同的系统能够较容易的通信，而不需要改变底层的硬件或软件的逻辑。</li>\n<li>OSI 模型分为七层：</li>\n<li>由上到下分别为物理层，数据链路层，网络层，传输层，会话层，表示出，应用层。</li>\n<li>高层（7-5）：负责主机之间的数据传输。</li>\n<li>底层（4-1）：负责网络数据传输。</li>\n<li>①：应用层：</li>\n<li>各种应用程序，协议。</li>\n<li>详解：为应用软件提供接口，使应用程序能够使用网络服务。</li>\n<li>常见的应用层协议：</li>\n<li>http (80)，ftp (20/21)，smtp (25)，pop3 (110)，telnet (23)，dns (53) 等。</li>\n<li>②：表示层：</li>\n<li>数据和信息的语法转换内码，数据压缩解压，加密解密。</li>\n<li>详解：</li>\n<li>常见的标准如：</li>\n<li>ASCII</li>\n<li>JPEG</li>\n<li>....</li>\n<li>③：会话层：</li>\n<li>为通信双方定制通信方式，并创建，注销会话。</li>\n<li>详解：</li>\n<li>在设备或节点之间提供会话控制。</li>\n<li>它在系统之间协调通信过程。</li>\n<li>④：传输层：</li>\n<li>提高可靠或者不可靠的端到端传输。</li>\n<li>详解：</li>\n<li>负责将来自上层应用程序的数据进行分段或者重组，并将他们组合为同样的数据流形式。</li>\n<li>提供端到端的数据传输服务。</li>\n<li>传输层协议：TCP&amp;UDP。</li>\n<li>⑤：网络层：</li>\n<li>逻辑寻址，路由选择。</li>\n<li>详解：</li>\n<li>定义了逻辑地址 (三层地址)</li>\n<li>分组寻址，负责将分组数据从源端传输到目的端。</li>\n<li>路由选择，维护路由表。</li>\n<li>⑥：数据链路层：</li>\n<li>将分组数据封装成帧，提供节点到节点方式的传输，差错校验。</li>\n<li>详解：</li>\n<li>在不可靠的物理链路上，提供可靠的数据传输服务，把帧从一跳（节点）移动到另一跳（节点）。</li>\n<li>局域网的数据链路层协议有以太网，令牌环网等。</li>\n<li>广域网数据链路层协议有：PPP，HDLC，Frame Relay 等。</li>\n<li>⑦：物理层：</li>\n<li>在媒介上传输比特流，提供机器的和电气的规约。</li>\n</ul>\n<h1 id=\"02tcpip参考模型\"><a class=\"anchor\" href=\"#02tcpip参考模型\">#</a> 02【TCP/IP 参考模型】</h1>\n<p class=\"red\">1，TCP&amp;UDP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>TCP (传输控制协议)：</li>\n<li>属于面向连接的网络协议。</li>\n<li>可靠传输。</li>\n<li>流控及窗口机制。</li>\n<li>UDP (用户报文协议)：</li>\n<li>属于无连接的网络协议。</li>\n<li>不可靠传输。</li>\n<li>尽力而为的传输。</li>\n</ul>\n<p class=\"red\">2，TCP&amp;UDP 端口号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>源端口随机分配，目标端口使用知名端口。</li>\n<li>应用客户端使用的源端口号一般为系统中未使用的且大于 1023。</li>\n<li>目标端口号为服务器端应用服务的进程，如 telnet 为 23.</li>\n</ul>\n<p class=\"red\">3，窗口大小：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>决定了在收到确认前可以发送的字节数 (win=?)。</li>\n</ul>\n<p class=\"red\">4，ARP 协议：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>通告广播请求（增加网络负载）。</li>\n<li>不可靠，不安全。</li>\n<li>将 IPV4 地址解析为 MAC 地址。</li>\n<li>维护 ARP 映射的缓存。</li>\n<li>查看 ARP 表：arp -a</li>\n<li>查看路由路径：tracert</li>\n</ul>\n<h1 id=\"03ip子网划分\"><a class=\"anchor\" href=\"#03ip子网划分\">#</a> 03【IP 子网划分】</h1>\n<p class=\"red\">1，VLAM：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>为什么要划分子网？</li>\n<li>一个 B 类地址用于一个广播域，地址浪费。</li>\n<li>广播域太庞大，一旦发生广播，内网不堪重负。</li>\n<li>将一个网络号划分成多个子网，每个子网分配一个独立的广播域。</li>\n<li>广播域缩小，网络规划更加合理。</li>\n<li>IP 地址得到了合理利用。</li>\n</ul>\n<p class=\"red\">2，子网：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>新加子网数为：2 的 M 次方（M 为借的主机数量）</li>\n</ul>\n<p class=\"red\">3，IP 地址类别：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>私有地址：</li>\n<li>10.0.0.0——10.255.255.255</li>\n<li>172.16.0.0——172.31.255.255</li>\n<li>192.168.0.0——192.168.255.255</li>\n<li>如果私有 IP 地址用户想要访问公网，则需要使用 NAT 网络地址转换技术。</li>\n</ul>\n<h1 id=\"04网络设备管理\"><a class=\"anchor\" href=\"#04网络设备管理\">#</a> 04【网络设备管理】</h1>\n<h1 id=\"05二层交换原理\"><a class=\"anchor\" href=\"#05二层交换原理\">#</a> 05【二层交换原理】</h1>\n<h1 id=\"06stp原理上\"><a class=\"anchor\" href=\"#06stp原理上\">#</a> 06【STP 原理（上）】</h1>\n<h1 id=\"07stp原理下\"><a class=\"anchor\" href=\"#07stp原理下\">#</a> 07【STP 原理（下）】</h1>\n<h1 id=\"08vlan间路由互通\"><a class=\"anchor\" href=\"#08vlan间路由互通\">#</a> 08【VLAN 间路由互通】</h1>\n<h1 id=\"09端口镜像与链路聚合\"><a class=\"anchor\" href=\"#09端口镜像与链路聚合\">#</a> 09【端口镜像与链路聚合】</h1>\n<h1 id=\"10ip路由选择原理上\"><a class=\"anchor\" href=\"#10ip路由选择原理上\">#</a> 10【IP 路由选择原理（上）】</h1>\n<h1 id=\"11ip路由选择原理下\"><a class=\"anchor\" href=\"#11ip路由选择原理下\">#</a> 11【IP 路由选择原理（下）】</h1>\n<h1 id=\"12rip原理\"><a class=\"anchor\" href=\"#12rip原理\">#</a> 12【RIP 原理】</h1>\n<h1 id=\"13ospf原理\"><a class=\"anchor\" href=\"#13ospf原理\">#</a> 13【OSPF 原理】</h1>\n<h1 id=\"14smart-link-monitor-link\"><a class=\"anchor\" href=\"#14smart-link-monitor-link\">#</a> 14【Smart Link &amp; Monitor Link】</h1>\n<h1 id=\"15路由重发布\"><a class=\"anchor\" href=\"#15路由重发布\">#</a> 15【路由重发布】</h1>\n<h1 id=\"16路由策略上\"><a class=\"anchor\" href=\"#16路由策略上\">#</a> 16【路由策略（上）】</h1>\n<h1 id=\"17路由策略下\"><a class=\"anchor\" href=\"#17路由策略下\">#</a> 17【路由策略（下）】</h1>\n<h1 id=\"18ospf-lsa\"><a class=\"anchor\" href=\"#18ospf-lsa\">#</a> 18【OSPF LSA】</h1>\n<h1 id=\"19ospf-区域\"><a class=\"anchor\" href=\"#19ospf-区域\">#</a> 19【OSPF 区域】</h1>\n<h1 id=\"20mpls-ldp的配置实现\"><a class=\"anchor\" href=\"#20mpls-ldp的配置实现\">#</a> 20【MPLS LDP 的配置实现】</h1>\n<h1 id=\"21ldp标签分发控制模式通告模式及保留模式\"><a class=\"anchor\" href=\"#21ldp标签分发控制模式通告模式及保留模式\">#</a> 21【LDP 标签分发控制模式，通告模式及保留模式】</h1>\n",
            "tags": [
                "技术",
                "数通"
            ]
        },
        {
            "id": "https://manshan.top/2021/05/23/%E5%8D%8E%E4%B8%BAHCIA%E6%95%B0%E9%80%9A/",
            "url": "https://manshan.top/2021/05/23/%E5%8D%8E%E4%B8%BAHCIA%E6%95%B0%E9%80%9A/",
            "title": "华为HCIA数通",
            "date_published": "2021-05-23T15:49:39.211Z",
            "content_html": "<h1 id=\"第一次课\"><a class=\"anchor\" href=\"#第一次课\">#</a> 第一次课</h1>\n<h2 id=\"传输层介质\"><a class=\"anchor\" href=\"#传输层介质\">#</a> 传输层介质</h2>\n<h1 id=\"第二次课\"><a class=\"anchor\" href=\"#第二次课\">#</a> 第二次课</h1>\n",
            "tags": [
                "技术",
                "华为"
            ]
        },
        {
            "id": "https://manshan.top/2021/05/23/%E6%9D%82/",
            "url": "https://manshan.top/2021/05/23/%E6%9D%82/",
            "title": "杂",
            "date_published": "2021-05-23T15:21:22.787Z",
            "content_html": "<h1 id=\"千里眼\"><a class=\"anchor\" href=\"#千里眼\">#</a> 千里眼：</h1>\n<p>在线演示地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hc2subGxrLm1lL0tLSy9BU0tMTS9zYy5waHA=\">https://ask.llk.me/KKK/ASKLM/sc.php</span></p>\n",
            "tags": [
                "杂",
                "杂"
            ]
        },
        {
            "id": "https://manshan.top/2021/04/11/SCSA%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86/",
            "url": "https://manshan.top/2021/04/11/SCSA%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%86/",
            "title": "深信服SCSA实验部分",
            "date_published": "2021-04-11T01:55:32.802Z",
            "content_html": "<h1 id=\"写在前面\"><a class=\"anchor\" href=\"#写在前面\">#</a> 写在前面</h1>\n<div class=\"note info\">\n<p>注意注意</p>\n</div>\n<ul>\n<li><ins class=\"wavy\">实验截图多，缓存慢。</ins></li>\n</ul>\n<h1 id=\"第一篇ipsec-vpn解决方案\"><a class=\"anchor\" href=\"#第一篇ipsec-vpn解决方案\">#</a> 第一篇【IPsec VPN 解决方案】</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司 / 单位在不同城市分布有分支机构，基于网络安全和访问便捷的需求，希望实现机构之间内网互联，在公网之间数据传输进行加密。</li>\n<li>②：实验目标</li>\n<li>某公司深圳部内部单臂部署一台深信服 SSL VPN 设备 (支持 IPsec VPN) 出口有公网 IP，也有内网段。</li>\n<li>该公司长沙出口有 AC 设备，出口有固定的公网 IP 地址，有内网网段。</li>\n<li>客户要求需要做标准的 IPsec VPN 对接，使用深圳 SSL VPN 设备和长沙 AC 进行对接。实现深圳内部网段与长沙内部网段互访。</li>\n<li><ins class=\"wavy\">注：本实验通过深圳 SSL VPN 设备 (支持 IPSEC VPN) 和长沙 AC 设备（支持 IPSEC VPN）建立 IPsec VPN 隧道。</ins></li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"图片\"></li>\n<li>④：实验步骤</li>\n<li><ins class=\"wavy\">注：上图，此环境中有 NAT 环境，双方有固定的公网 IP，此环境下，选择野蛮模式进行对接。注：不能用主模式。</ins></li>\n<li>【1】配置长沙 AC 设备进行 IKE 协商的参数等信息。</li>\n<li>【2】第一阶段配置：</li>\n<li>打开【网络】——&gt;【IPsec VPN】——&gt;【第三方对接】——&gt;【第一阶段】</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw1ekn.png\" alt=\"T\"></li>\n<li><ins class=\"wavy\">注：在长沙设备中勾选【启用主动连接】长沙 AC 设备会自动发起 IPSEC VPN 的连接，主动和对端进行协商，深圳 SSL VPN 作为被访设备，无需进行主动发起连接，因此不需要勾选主动连接。</ins></li>\n<li>【3】第二阶段配置：</li>\n<li>打开【网络】——&gt;【IPsec VPN】——&gt;【第三方对接】——&gt;【第二阶段】</li>\n<li>入站策略：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw3F9x.png\" alt=\"T\"></li>\n<li>出站策略：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw3lCt.png\" alt=\"T\"></li>\n<li>【4】深圳端 SSL VPN 设备与长沙 AC 设备配置参数保持一致。</li>\n<li>【IPsec VPN】——&gt;【第三方对接】——&gt;【第一阶段】</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw3IxK.png\" alt=\"T\"></li>\n<li>【IPsec VPN】——&gt;【第三方对接】——&gt;【第二阶段】</li>\n<li>入站策略：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw3xRP.png\" alt=\"T\"></li>\n<li>出站策略：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw8QZ4.png\" alt=\"T\"></li>\n<li><ins class=\"wavy\">注：以上两步是实现长沙 AC 和深圳 SSL VPN 设备上的 IPSec VPN 的第一，第二阶段的协商。</ins></li>\n<li>⑤：标准 IPSEC VPN 采用 UDP 500 端口进行 IKE 参数协商等过程，在 NAT 环境中用 UDP4500 端口进行协商并提供服务。</li>\n<li>由于长沙 AC 和深圳 SSL VPN 设备都使用内网地址，不能在公网路由，因此要实验上网需求，需要在深圳出口 AF 设备上配置源地址转换 (NAT 代理上网)，在深圳出口 AF 上配置 NAT 代理上网。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwGSYR.png\" alt=\"T\"></li>\n<li>⑥：其次，要实现长沙 AC 访问深圳的 SSL VPN 设备的 UDP 500 和 4500 端口服务 (IPSEC VPN 服务)，需要在深圳总部出口 AF 上做 UDP 500 和 4500 端口映射 (DNAT)</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwGG7Q.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwGfc6.png\" alt=\"T\"></li>\n<li>⑦：此时，VPN 隧道已建立，但深圳 PC 并不能访问长沙 PC，因为路由还不通，没给 AF 配置路由，AF 不会将去往 172.172.10.0/24 网段的数据包转发给 SSL VPN，所以需要在 AF 上添加一条去往 172.172.10.0/24 网段的路由下一跳走 SSL VPN 设备建立的 IPsec VPN 线路。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwJlCR.png\" alt=\"T\"></li>\n<li>⑧：验证结果</li>\n<li>【IPsec VPN 设置】——&gt;【运行状态】</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwtIBT.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cw7OTf.png\" alt=\"T\"></li>\n<li>⑧：排错</li>\n<li>第一次实验隧道没有建立成功时，查看日志原因。是否是因为第一阶段 SA 没有协商成功，因此需要见检查 SA 参数是否两边配置一致。【IPSec VPN 设置】——&gt;【第三方对接】——&gt;【安全选项】</li>\n<li><ins class=\"wavy\">注意：即使在野蛮模式下，开启 IPsec VPN 多线路选路，会导致 IKE 第一阶段协商失败。</ins></li>\n<li>⑨：思考总结</li>\n<li>【1】标准 IPSEC VPN 中出，入站 (感兴趣流) 的作用是什么？</li>\n<li>用来触发 IPSEC VPN</li>\n</ul>\n<h1 id=\"第二篇sangfor-vpn解决方案\"><a class=\"anchor\" href=\"#第二篇sangfor-vpn解决方案\">#</a> 第二篇【SANGFOR VPN 解决方案】</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司 / 单位在不同城市分布有分支机构，基于网络安全和访问便捷的需求，希望实现机构之间内网互联，在公网之间数据传输进行加密。</li>\n<li>②：实验目标</li>\n<li>客户要求需要做标准 Sangfor VPN 对接，使用深圳 SSL VPN 设备和长沙 AC 进行对接，实现深圳内部网段和长沙内部网段互访。</li>\n<li><ins class=\"wavy\">注：通过深圳 SSL VPN 设备和长沙 AC 设备建立 Sangfor VPN 隧道，实现分支机构内网网段访问总部网段。</ins></li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"T\"></li>\n<li>④：实验步骤</li>\n<li>【1】深圳部配置：【IPsec VPN 设置】——&gt;【用户管理】中创建 sangfor VPN 用户。</li>\n<li><ins class=\"wavy\">注：作为总部，只需要创建分支用户，让分支可以使用该用户访问总部，不需要设置 VPN 连接。</ins></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwjucD.png\" alt=\"T\"></li>\n<li>++ 注意：类型有分支和移动两种，【分支】类型是连接硬件设备【移动】类型是用来连接 PDLAN 软件。</li>\n<li>【2】宣告 SSL VPN 本地子网。【系统设置】——&gt;【网络配置】——&gt;【本地子网】</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwjHC6.png\" alt=\"T\"></li>\n<li>【3】深圳部做端口映射：【策略】——&gt;【地址转换】——&gt;【新增服务器映射】</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwvdG6.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwvoLQ.png\" alt=\"T\"></li>\n<li>【4】长沙分支：【系统管理】——&gt;【VPN 配置】——&gt;【连接管理】点击【新增】。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwxspV.png\" alt=\"T\"></li>\n<li>至此，隧道建立完毕。</li>\n<li>【5】回包：数据包到达深圳总部后，开始回包，也需要从 SSL VPN 设备走 SANGFOR VPN 隧道，因此 AF 上要配置回给长沙网段的 SSL VPN 专线，【网络】——&gt;【路由】——&gt;【新建】。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwzfKS.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"第三篇上网行为组网方案\"><a class=\"anchor\" href=\"#第三篇上网行为组网方案\">#</a> 第三篇【上网行为组网方案】</h1>\n<h2 id=\"一网关模式组网\"><a class=\"anchor\" href=\"#一网关模式组网\">#</a> 一：网关模式组网</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司需要在企业的长沙分公司网络出口使用上网行为管理设备，以审计管理局域网的所有设备，同时，局域网内的所有设备都将通过上网行为代理上网。</li>\n<li>②：实验目标</li>\n<li>将上网行为管理部署在长沙分公司的网络出口，以网关模式部署。</li>\n<li>配置代理上网。</li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"T\"></li>\n<li>④：实验步骤</li>\n<li>【1】进入 AC 控制台：【系统管理】-【网络配置】-【部署模式】：选择路由模式，点击下一步，逐步配置。</li>\n<li><ins class=\"wavy\">注：在网关模式配置的过程中，会默认要求配置代理上网。</ins></li>\n<li>⑤：验证结果</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/cr9hTO.png\" alt=\"T\"></li>\n</ul>\n<h2 id=\"二wanlan端口映射\"><a class=\"anchor\" href=\"#二wanlan端口映射\">#</a> 二：WAN——&gt;LAN 端口映射</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司在企业的长沙分公司网络出口使用上网行为管理设备，现在长沙分公司内网电脑 (只有私网地址)，企业希望外网能够访问到该电脑的远程桌面。</li>\n<li>②：实验目标</li>\n<li>将 PC 会被外网访问到的端口 (3389 端口) 端口映射到上网行为管理设备上任意一个空闲的端口。</li>\n<li>外网通过访问 AC-IP：指定端口，从而访问到 PC-IP：443</li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"T\"></li>\n<li>④：实验步骤</li>\n<li>首先长沙 AC：【系统管理】-【防火墙】-【端口映射】，新建一条目的端口映射。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/crCfvn.png\" alt=\"T\"></li>\n<li>⑤：验证结果</li>\n<li>从深圳总部通过访问 PC_IP：指定端口。输入用户名密码，会访问远程桌面成功页面：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/crPpVK.png\" alt=\"T\"></li>\n</ul>\n<h2 id=\"三lanlan端口映射\"><a class=\"anchor\" href=\"#三lanlan端口映射\">#</a> 三：LAN——LAN 端口映射</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司在企业的长沙分公司网络出口使用上网行为管理设备，现在长沙分公司内网有一台 PC (只有私网地址)，企业希望内网也通过公司地址访问到该 PC 的远程桌面。</li>\n<li>②：实验目标</li>\n<li>将测试 PC 会被外网访问到的端口 (3389 端口) 映射到上网行为管理设备上任意一个空闲的端口。</li>\n<li>长沙分公司内网电脑通过访问 AC_IP: 指定端口，从而访问到测试 PC-IP:3389。</li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"T\"></li>\n<li>④：实验步骤</li>\n<li>方法一：</li>\n<li>先做一条端口映射（将 PC 的私网地址转换成 AC 的外网口的公网地址），再做一条代理上网规则 (将内网的源地址转换成 AC 内网口的地址)。</li>\n<li>【系统管理】-【防火墙】-【端口映射】中新建高级规则：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/crP7Lt.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/crPbeP.png\" alt=\"T\"></li>\n<li>【系统管理】-【防火墙】-【NAT 代理上网】中新建规则：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/crPXFS.png\" alt=\"T\"></li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/cri9Lq.png\" alt=\"T\"></li>\n<li>方法二：</li>\n<li>直接做一条高级映射规则，勾选【发布服务器】选项 (相当于做了 SNAT)：</li>\n<li>将源 IP 转换成了 AC 内网口的 IP。</li>\n<li>【系统管理】-【防火墙】-【端口映射】中新建高级规则如下：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/13/criEYF.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"第四篇用户认证技术\"><a class=\"anchor\" href=\"#第四篇用户认证技术\">#</a> 第四篇【用户认证技术】</h1>\n<h2 id=\"不需要认证\"><a class=\"anchor\" href=\"#不需要认证\">#</a> 不需要认证</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：需求背景</li>\n<li>某公司 IT 部员工都是固定 IP 地址上网，可以根据 IP 地址确定员工身份，IP 网段是 172.172.4.0/24，新部署一台 AC，IT 部员工不想改变上网习惯，无感知的上网，并能实现 AC 管控需求。</li>\n<li>IT 部：172.172.4.0/24</li>\n<li>办公区：172.172.2.0/24</li>\n<li>公共上网区：172.172.3.0/24</li>\n<li>②：实验目标</li>\n<li>IT 部用户使用不需要认证方式上网，认证过程对用户透明无感知。</li>\n<li>IT 部用户以 IP 地址作为用户名认证上线。</li>\n<li>③：实验拓扑图</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/11/cwlpMF.jpg\" alt=\"T\"></li>\n<li>④：实验步骤</li>\n<li></li>\n</ul>\n<h1 id=\"第五篇应用控制技术\"><a class=\"anchor\" href=\"#第五篇应用控制技术\">#</a> 第五篇【应用控制技术】</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<h1 id=\"第六篇终端识别和管理技术\"><a class=\"anchor\" href=\"#第六篇终端识别和管理技术\">#</a> 第六篇【终端识别和管理技术】</h1>\n<h1 id=\"第七篇流量管理技术\"><a class=\"anchor\" href=\"#第七篇流量管理技术\">#</a> 第七篇【流量管理技术】</h1>\n<h1 id=\"第八章内容审计技术\"><a class=\"anchor\" href=\"#第八章内容审计技术\">#</a> 第八章【内容审计技术】</h1>\n<h1 id=\"第九章数据价值解决方案\"><a class=\"anchor\" href=\"#第九章数据价值解决方案\">#</a> 第九章【数据价值解决方案】</h1>\n<h1 id=\"第十章全网行为管理\"><a class=\"anchor\" href=\"#第十章全网行为管理\">#</a> 第十章【全网行为管理】</h1>\n<h1 id=\"第十一章下一代防火墙组网方案\"><a class=\"anchor\" href=\"#第十一章下一代防火墙组网方案\">#</a> 第十一章【下一代防火墙组网方案】</h1>\n<h1 id=\"第十二章终端安全检测和防御技术\"><a class=\"anchor\" href=\"#第十二章终端安全检测和防御技术\">#</a> 第十二章【终端安全检测和防御技术】</h1>\n<h1 id=\"第十三章服务器安全检测和防御技术\"><a class=\"anchor\" href=\"#第十三章服务器安全检测和防御技术\">#</a> 第十三章【服务器安全检测和防御技术】</h1>\n<h1 id=\"第十四章安全评估与动态检测技术\"><a class=\"anchor\" href=\"#第十四章安全评估与动态检测技术\">#</a> 第十四章【安全评估与动态检测技术】</h1>\n<h1 id=\"第十五章移动接入方案\"><a class=\"anchor\" href=\"#第十五章移动接入方案\">#</a> 第十五章【移动接入方案】</h1>\n<h1 id=\"第十六章移动接入身份认证技术\"><a class=\"anchor\" href=\"#第十六章移动接入身份认证技术\">#</a> 第十六章【移动接入身份认证技术】</h1>\n<h1 id=\"第十七章移动接入资源发布技术\"><a class=\"anchor\" href=\"#第十七章移动接入资源发布技术\">#</a> 第十七章【移动接入资源发布技术】</h1>\n<h1 id=\"第十八章移动接安全接入\"><a class=\"anchor\" href=\"#第十八章移动接安全接入\">#</a> 第十八章【移动接安全接入】</h1>\n<h1 id=\"第十九章edr安全部署\"><a class=\"anchor\" href=\"#第十九章edr安全部署\">#</a> 第十九章【EDR 安全部署】</h1>\n<h1 id=\"第二十章edr终端发现\"><a class=\"anchor\" href=\"#第二十章edr终端发现\">#</a> 第二十章【EDR 终端发现】</h1>\n<h1 id=\"第二十一章edr终端基线检查\"><a class=\"anchor\" href=\"#第二十一章edr终端基线检查\">#</a> 第二十一章【EDR 终端基线检查】</h1>\n<h1 id=\"第二十二章edr文件实时监控\"><a class=\"anchor\" href=\"#第二十二章edr文件实时监控\">#</a> 第二十二章【EDR 文件实时监控】</h1>\n<h1 id=\"第二十三章edr暴力破解检测\"><a class=\"anchor\" href=\"#第二十三章edr暴力破解检测\">#</a> 第二十三章【EDR 暴力破解检测】</h1>\n<h1 id=\"第二十四章edr服务器安全加固\"><a class=\"anchor\" href=\"#第二十四章edr服务器安全加固\">#</a> 第二十四章【EDR 服务器安全加固】</h1>\n<h1 id=\"第二十五章edr漏洞修复\"><a class=\"anchor\" href=\"#第二十五章edr漏洞修复\">#</a> 第二十五章【EDR 漏洞修复】</h1>\n<h1 id=\"第二十六章微隔离\"><a class=\"anchor\" href=\"#第二十六章微隔离\">#</a> 第二十六章【微隔离】</h1>\n<h1 id=\"第二十七章edr与af联动\"><a class=\"anchor\" href=\"#第二十七章edr与af联动\">#</a> 第二十七章【EDR 与 AF 联动】</h1>\n<h1 id=\"第二十八章sip的上架配置实验手册\"><a class=\"anchor\" href=\"#第二十八章sip的上架配置实验手册\">#</a> 第二十八章【SIP 的上架配置实验手册】</h1>\n<h1 id=\"第二十九章设备接入\"><a class=\"anchor\" href=\"#第二十九章设备接入\">#</a> 第二十九章【设备接入】</h1>\n<h1 id=\"第三十章处置中心\"><a class=\"anchor\" href=\"#第三十章处置中心\">#</a> 第三十章【处置中心】</h1>\n<h1 id=\"第三十一章联动处置\"><a class=\"anchor\" href=\"#第三十一章联动处置\">#</a> 第三十一章【联动处置】</h1>\n<h1 id=\"第三十二章通报预警\"><a class=\"anchor\" href=\"#第三十二章通报预警\">#</a> 第三十二章【通报预警】</h1>\n",
            "tags": [
                "技术",
                "SANGFOR"
            ]
        },
        {
            "id": "https://manshan.top/2021/04/05/Kali%E6%B8%97%E9%80%8F%E6%95%99%E7%A8%8B&%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/",
            "url": "https://manshan.top/2021/04/05/Kali%E6%B8%97%E9%80%8F%E6%95%99%E7%A8%8B&%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/",
            "title": "Kali渗透教程/网络安全",
            "date_published": "2021-04-05T08:30:10.159Z",
            "content_html": "<h1 id=\"配置kali的apt命令在线安装包的源为国内源\"><a class=\"anchor\" href=\"#配置kali的apt命令在线安装包的源为国内源\">#</a> 配置 KALI 的 APT 命令在线安装包的源为国内源</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：配置 apt 国内源：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#中科大</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#阿里云</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#清华大学</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</pre></td></tr></table></figure><ul>\n<li>②：具体步骤</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>输入：leafpad /etc/apt/sources.list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>用<span class=\"token comment\">#号注释其他的源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>复制要使用的源</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>之后执行apt update——<span class=\"token operator\">></span>升级清单</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>最后执行apt upgrade——<span class=\"token operator\">></span>真正的升级</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>说明：deb代表软件的位置，deb-src代表软件源代码的位置。</pre></td></tr></table></figure><ul>\n<li>③：apt upgrade 和 dist-upgrade 的差别：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>upgrade：升级时，如果软件包有相互依赖性的问题，此软件包就不会被升级。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dist-upgrade：升级时，如果软件包有相互依赖性问题，会移除旧版本，</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>直接安装新的版本<span class=\"token punctuation\">(</span>所以通常dist-upgrade会被认为是有风险的升级<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>注意：每回更新之前，我们需要先运行update，然后</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>才能运行upgrade和dist-upgrade。</pre></td></tr></table></figure><ul>\n<li>④：apt 命令</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">install</span> - 安装软件包 <span class=\"token function\">apt</span> <span class=\"token function\">install</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>remove - 移除软件包 <span class=\"token function\">apt</span> remove</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>update - 更新可用软件包列表 <span class=\"token function\">apt</span> update</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>upgrade - 通过 安装/升级 软件来更新系统 <span class=\"token function\">apt</span> upgrade</pre></td></tr></table></figure><h1 id=\"kali本地网络配置\"><a class=\"anchor\" href=\"#kali本地网络配置\">#</a> KALI 本地网络配置</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：步骤</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>临时配置IP地址</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>查看IP地址：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">ifconfig</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>临时配置IP地址：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ifconfig</span> eth0<span class=\"token punctuation\">(</span>eth0网卡<span class=\"token punctuation\">)</span>  + IP地址/子网</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>添加默认网关：</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>route <span class=\"token function\">add</span> default gw + 网关</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>配置DNS：</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span>，vim /etc/resolv.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>在nameserver处输入DNS地址</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">2</span>，直接输入：echo namserver <span class=\"token number\">8.8</span>.8.8 <span class=\"token operator\">></span> /etc/resolv.conf</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>永久配置IP地址</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>打开 <span class=\"token function\">vim</span> /etc/network/interfaces进行配置</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>iface eth0 inet static <span class=\"token comment\">#配置 eth0 使用静态地址</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>address + IP地址 <span class=\"token comment\">#配置 eth0 的固定 IP 地址</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>netmask + 子网 <span class=\"token comment\">#配置子网掩码</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>gateway + IP地址 <span class=\"token comment\">#配置网关</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>systemctl restart networking <span class=\"token comment\">#重启网络服务</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>或 /etc/init.d/networking restart</pre></td></tr></table></figure><ul>\n<li>②：配置 sshd 服务并使用 xshell 连接</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>允许root用户登录sshd服务</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>打开：vim /etc/ssh/sshd_config</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>输入：set nu显示行号</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>修改：</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">32</span>行：PermitRootLogin <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">37</span>行：PubkeyAuthentication <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>启动服务：</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>/etc/init.d/ssh restart</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>systemctl restart <span class=\"token function\">ssh</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>允许开机启动：</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>update-rc.d <span class=\"token function\">ssh</span> <span class=\"token builtin class-name\">enable</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>或</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> sshd</pre></td></tr></table></figure>",
            "tags": [
                "技术",
                "KALI"
            ]
        },
        {
            "id": "https://manshan.top/2021/04/02/NISP/",
            "url": "https://manshan.top/2021/04/02/NISP/",
            "title": "NISP",
            "date_published": "2021-04-02T14:48:06.164Z",
            "content_html": "<h1 id=\"信息安全概述\"><a class=\"anchor\" href=\"#信息安全概述\">#</a> 信息安全概述</h1>\n<h2 id=\"信息安全概述上\"><a class=\"anchor\" href=\"#信息安全概述上\">#</a> 信息安全概述 (上)</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：信息与信息安全</li>\n<li>信息奠基人香农 (C.E.Shannon) 认为：信息是用来消除随机不确定的东西。</li>\n<li>信息是事物运动状态或存在方式的不确定性的描述。</li>\n<li>信息是具体的，并且可以被人 (生物，机器等) 所感知，提取，识别，可以被传递，存储，变换，处理，显示检索和利用。</li>\n<li>信息来源于物质，又不是物质本身，它从物质的运动中产生出来，又可以脱离源物质而寄生于媒体物质，相对独立地存在。</li>\n<li>信息的功能：反应事物内部属性，状态结构，相互联系以及与外部环境的互动关系，减少事物的不确定性。</li>\n<li>信息的表达：信息本身是无形的，借助于信息媒体以多种形式存在或传播，它可以存储在计算机，磁带，纸张等介质中，也可以记忆在人的大脑里，还可以通过网络等方式进行传播。</li>\n<li>②：信息的基本属性:</li>\n<li>信息具有普遍性和客观性。</li>\n<li>信息具有实质性和传递性。</li>\n<li>信息具有可扩散性和可扩充性。</li>\n<li>信息具有中介性和共享性。</li>\n<li>信息具有差异性和转换性。</li>\n<li>信息具有时效性和增值性。</li>\n<li>信息具有可压缩性。</li>\n<li><ins class=\"wavy\">注意：信息不同于消息，消息是信息的外壳，信息则是消息的内核，也可以说：消息是信息的笼统概念，信息则是消息的精神概念。</ins></li>\n<li><ins class=\"wavy\">信息不同于数据，数据是信息的符号表示，或称为载体，信息是数据的内涵，是数据的语义解释，数据是信息存在的一种形式，只有通过解释或处理才能成为有用的信息，数据可用不同的形式表示，而信息不会随数据不同的形式而改变。</ins></li>\n<li>③：信息技术 (Information Technology,IT) 是用于管理和处理信息所采用的各种技术的总称。</li>\n<li>它重要是利用计算机科学和通信技术来设计，开发，安装和实施信息系统及应用软件，其中，信息处理是获取信息并对它进行变换，使之成为有用的信息并发布出去的过程，主要包括信息的获取，存储，加工，发布和表示等几个环节，目前，信息收集和处理已经成为人们社会工作的一个重要的组成部分。</li>\n</ul>\n<h2 id=\"信息安全概述下\"><a class=\"anchor\" href=\"#信息安全概述下\">#</a> 信息安全概述 (下)</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：信息技术包括生产和应用两个方面。</li>\n<li>信息技术生产主要体现在信息技术产业本身，包括计算机软件，计算机硬件，设备制造，微电子电路等。</li>\n<li>信息技术应用主要体现在信息技术的扩散上，包括信息服务，信息管理系统等。</li>\n<li>②：微电子，通信，计算机和网络是信息系统的核心技术，其发展进程大致可分为以下四个阶段：</li>\n<li>第一阶段：电讯技术的发明：</li>\n<li>信息技术的起源可用追溯到 19 实际 30 年代，其标志性事件是随着电磁技术的发展，出现了电话电报，人类远程通信手段有了飞跃，开始进入新时代。</li>\n<li>第二阶段：计算机技术的发展：</li>\n<li>第三阶段：互联网的使用：</li>\n<li>20 世纪 60 年代末，美国出现了第一个用于军事目的的计算机网络 ARPANET，ARPANET 的重要意义在于它使连接到网络上的计算机能够相互交流信息。20 世纪 90 年代，计算机网络发展成为全球性网络 —— 因特网 (Internat)，网络技术和网络应用迅猛发展。</li>\n<li>第四阶段：网络社会：</li>\n<li>20 世纪末，以 Internet 为核心的信息技术进一步发展，人们的工作，生活和学习越来越离不开网络，国家的经济，社会治理也与网络密不可分。</li>\n<li>③：信息安全：</li>\n<li>所谓信息安全就是关注信息本身的安全，而不管是否应用了计算机作为信息处理的手段。</li>\n<li>信息安全的任务是保护信息财产，以防止偶然的或未授权者对信息的恶意泄露，修改和破坏，从而导致信息的不可靠或无法处理等，这样可以使得我们在最大限度地利用信息为我们服务的同时而不招致损失或使损失最小。</li>\n<li>信息安全问题目前已经涉及到人们日常生活中的各个方面。</li>\n<li>建立在网络基础之上的现代信息系统，信息安全定义较为明确，那就是：保护信息系统的硬件，软件及相关数据，使之不因为偶然或者恶意侵犯而遭受破坏，更改及泄露，保证信息系统能够连续，可靠，正常地运行。</li>\n<li>在商业和经济领域，信息安全主要强调的是消减并控制风险，保持业务操作的连续性，并将风险造成的损失和影响降低到最低程度。</li>\n<li>④：信息安全包括：</li>\n<li>消息安全：消息的完整性，消息的保密性，消息的不可否认性。</li>\n<li>网络安全：网络的可用性，网络的可控性。</li>\n<li>⑤：信息系统安全的四个层面：</li>\n<li>设备安全，数据安全，内容安全，行为安全。</li>\n<li>[1] 设备安全：</li>\n<li>信息设备的安全是信息系统安全的首要问题。</li>\n<li>设备的稳定性。</li>\n<li>设备的可靠性。</li>\n<li>设备的可用性。</li>\n<li>设备：硬设备，软设备。</li>\n<li>[2] 数据安全：</li>\n<li>数据的秘密性。</li>\n<li>数据的真实性。</li>\n<li>数据的完整性。</li>\n<li>IBM 公司的定义：采取措施确保数据免受未授权的泄露，篡改和摧毁。</li>\n<li>[3] 内容安全：</li>\n<li>内容安全是信息安全在法律，政治，道德层次上的要求。</li>\n<li>政治上健康。</li>\n<li>符合国家法律法规。</li>\n<li>符合中华民族道德规范。</li>\n<li>[4] 行为安全：</li>\n<li>行为安全是信息安全的终极目的。</li>\n<li>行为的秘密性。</li>\n<li>行为的完整性。</li>\n<li>行为的可控性。</li>\n<li>符合哲学上，实践是检验真理的唯一标准的原理。</li>\n<li>⑥：我国面临的信息安全威胁有：</li>\n<li>国家威胁：</li>\n<li>发布恐怖信息。</li>\n<li>邪教组织通过网络宣扬种族歧视。</li>\n<li>西方势力通过网络传播他们的意识形态。</li>\n<li>组织威胁：</li>\n<li>主要针对企业或组织受保护的财产，专有技术</li>\n<li>个人威胁：</li>\n<li>一是对知识产权的威胁。</li>\n<li>二是侵犯，破坏个人计算机系统中的信息。影响人们正常的工作，学习和生活。</li>\n<li>⑦：信息系统安全问题产生的根本原因：</li>\n<li>内因：</li>\n<li>系统自身的脆弱性。</li>\n<li>外因：</li>\n<li>来自恶意攻击者的破坏。</li>\n<li>来自自然灾害的破坏。</li>\n<li>⑧：信息安全发展阶段：</li>\n<li>[1] 通信安全：</li>\n<li>20 世纪 40-70 年代。</li>\n<li>核心思想：</li>\n<li>通过密码技术解决通信保密，保障数据的保密性和完整性</li>\n<li>主要关注传输过程中的数据保护。</li>\n<li>安全威胁：</li>\n<li>搭线窃听，密码学分析。</li>\n<li>安全措施：</li>\n<li>加密。</li>\n<li>[2] 计算机安全：</li>\n<li>20 世纪 70-90 年代</li>\n<li>核心思想：</li>\n<li>确保信息系统的保密性，完整性和可用性。</li>\n<li>安全威胁：</li>\n<li>非法访问，恶意代码，脆弱口令等。</li>\n<li>安全措施：</li>\n<li>安全操作系统设计技术 (TCB)</li>\n<li>[3] 信息系统安全：</li>\n<li>20 世纪 90 年代后</li>\n<li>核心思想：</li>\n<li>确保信息在存储，处理和传输过程中免受偶然或恶意的泄密，非法访问或破坏。</li>\n<li>安全威胁：</li>\n<li>网络入侵，病毒破坏，信息对抗等。</li>\n<li>安全措施：</li>\n<li>防火墙，防病毒，漏洞扫描，入侵检测，PKI，VPN 等。</li>\n<li>[4] 信息安全保障：</li>\n<li>今天和将来。。。。</li>\n<li>核心思想：</li>\n<li>动态安全，保障信息系统的业务正常，稳定的运行</li>\n<li>综合技术，管理，过程，人员</li>\n<li>安全威胁：</li>\n<li>黑客，恐怖分子，信息战，自然灾害，电力中断等。</li>\n<li>安全措施：</li>\n<li>技术安全保障体系，安全管理体系，人员意识 / 培训 / 教育。</li>\n<li>⑨：信息安全保障定义：</li>\n<li>【1】信息安全保障是指采用技术，管理等综合手段，保护信息和信息系统能够安全运行的防护性行为。</li>\n<li>它通过保证信息和信息系统的可用性，完整性，机密性和不可否认性来保护并防御信息和信息系统的操作，包括通过综合保护，检测和响应等能力为信息系统提供修复。</li>\n<li>【2】防护行为包含：</li>\n<li>防止信息泄露，修改和破坏。</li>\n<li>检测入侵行为，计划和部署针对入侵行为的防御措施。</li>\n<li>采用安全措施和容错机制在遭受攻击的情况下保证机密性，私密性，完整性，抗抵赖性，真实性，可用性和可靠性。</li>\n<li>修复信息和信息系统所遭受的破坏。</li>\n<li>【3】信息安全保障是一种立体保障</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/c6wjRx.png\" alt=\"T\"></li>\n<li>【4】与信息安全，信息系统安全的区别：</li>\n<li>信息安全保障的概念更加广泛。</li>\n<li>信息安全的重点是保护和防御，而安全保障的重点是保护，检测和响应综合。</li>\n<li>信息安全不太关注检测和响应，但是信息安全保障非常关注这两点。</li>\n<li>攻击后的修复不在传统信息安全概念的范围之内，但是它是信息安全保障的重要组成部分。</li>\n<li>信息安全的目的是为了防止攻击的发生，而信息安全保障的目的是为了保证信息系统始终能保证维持特定水平的可用性，完整性，真实性，机密性和抗抵赖性。</li>\n<li>⑩：信息安全保障模型</li>\n<li>【1】信息安全保障模型能准确描述安全的重要方面与系统行为的关系，提高对成功实现关键安全需求的理解层次，计划 - 执行 - 检查 - 改进（Plan Do Check Act，PDCA）模型和信息保障技术框架是信息安全管理和信息安全保障技术实施过程遵循的方法和思想。</li>\n<li>防护 - 检测 - 响应（Protection Detection Re\tsponse ，PDR）模型。</li>\n<li>策略 - 防护 - 检测 - 响应（Policy Protection Detection Response，P2DR/PPDR）模型。</li>\n<li>【2】防护 - 检测 - 响应（Protection Detection Response ，PDR）模型的基本思想是承认信息系统中存在漏洞，正视系统面临的威胁，通过适度防护并加强检测，落实安全事件响应，建立威胁源威慑，保障系统安全，该模型认为，任何安全防护措施都是基于时间的，超过该时间段，这种防护措施就可能被攻破，PDR 模型直观，实用，但对系统的安全隐患和安全措施采取相对固定的假设前提，难以适应网络安全环境的快速变化。</li>\n<li>【3】P2DR/PPDR。即策略 - 防护 - 检测 - 响应。该模型的核心是信息系统所有防护，检测和响应都是依据安全策略实施的。</li>\n<li>十一：信息安全保障的作用</li>\n<li>由于网络信息传播的开放性，跨界性，即时性，交互性等特点，互联网在为广大民众提高越来越多有益信息及其他信息服务的同时，也存在着一些虚假和错误导向的信息，以及危害民众利益，民族团结，国家统一，社会稳定和国家安全的违法与有害信息及活动，构建更加安全可靠。更加有用，更加可信的互联网，服务于建设小康社会和构建和谐社会，是我国加强信息安全保障的一个重要任务。</li>\n<li>十二：信息系统：</li>\n<li>信息系统是具有集成性的系统，每一个组织中信息流动的总和构成一个信息系统，信息系统是根据一定的需要进行输入，系统控制，数据处理，数据存储与输出等活动而涉及到的所有因素的综合体。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/c6j0fJ.png\" alt=\"T\"></li>\n<li>十三：信息系统安全保障：</li>\n<li>信息系统安全保障是在信息系统的整个生命周期中，从技术，管理，工程和人员等方面提出的安全保障要求，确保信息系统的保密性，完整性和可用性，降低安全风险到可接受的程度，从而保障系统实现组织机构的使命。</li>\n<li>十四：信息系统安全保障相关概念和关系：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/c6vgvn.png\" alt=\"T\"></li>\n<li>十五：信息系统安全保障模型：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/c6xkrt.png\" alt=\"T\"></li>\n</ul>\n<h1 id=\"信息安全基础技术\"><a class=\"anchor\" href=\"#信息安全基础技术\">#</a> 信息安全基础技术</h1>\n<h2 id=\"信息安全基础技术上\"><a class=\"anchor\" href=\"#信息安全基础技术上\">#</a> 信息安全基础技术 (上)</h2>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：密码学</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/c6xvyn.png\" alt=\"T\"></li>\n<li><ins class=\"wavy\">注：威胁，安全属性与密码学技术的相互关系。</ins></li>\n<li>【1】加密与解密</li>\n<li>数据加密是指将明文信息采取教学方法进行函数转换成密文，只有特定接收方才能将其解密还原成明文的过程。</li>\n<li>数据加密主要涉及三要素：明文，密钥，密文。</li>\n<li>【2】对称密码与非对称密码</li>\n<li>对称密码：</li>\n<li>分组密码：DES，AES。SM4</li>\n<li>序列密码：祖冲之序列密码，RC4</li>\n<li>非对称密码：</li>\n<li>RSA，ECC，SM2，SM3</li>\n<li>【3】哈希函数</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/14/ccCiH1.png\" alt=\"T\"></li>\n<li>对称密码和非对称密码算法主要解决的是信息的机密性问题，而实际系统和网络还可能受到信息篡改等攻击，如何确保信息的完整性，密码学的解决发发之一是哈希函数。</li>\n<li>我们可以通过哈希值来判断信息是否被篡改。</li>\n<li>【4】数字签名</li>\n<li>数字签名具备防止伪造，否认的功能。</li>\n<li>②：身份认证</li>\n<li>【1】身份认证是在计算机网络中确认操作者身份的过程</li>\n<li>在分布式系统中有两类主要认证：</li>\n<li>用户与主机间的认证。</li>\n<li>主机与主机之间的认证。</li>\n<li>身份认证技术不可避免低会用到加密技术，可分为：</li>\n<li>基于对称密钥技术的身份认证 (如：Kerberos)</li>\n<li>基于公共开密钥的身份认证（如：CA）</li>\n</ul>\n<h2 id=\"信息安全基础技术下\"><a class=\"anchor\" href=\"#信息安全基础技术下\">#</a> 信息安全基础技术 (下)</h2>\n<h1 id=\"网络安全攻防技术\"><a class=\"anchor\" href=\"#网络安全攻防技术\">#</a> 网络安全攻防技术</h1>\n<h2 id=\"网络安全攻防技术上\"><a class=\"anchor\" href=\"#网络安全攻防技术上\">#</a> 网络安全攻防技术 (上)</h2>\n<h2 id=\"网络安全攻防技术下\"><a class=\"anchor\" href=\"#网络安全攻防技术下\">#</a> 网络安全攻防技术 (下)</h2>\n<h1 id=\"操作系统安全防护技术\"><a class=\"anchor\" href=\"#操作系统安全防护技术\">#</a> 操作系统安全防护技术</h1>\n<h2 id=\"操作系统安全防护技术上\"><a class=\"anchor\" href=\"#操作系统安全防护技术上\">#</a> 操作系统安全防护技术 (上)</h2>\n<h2 id=\"操作系统安全防护技术中\"><a class=\"anchor\" href=\"#操作系统安全防护技术中\">#</a> 操作系统安全防护技术 (中)</h2>\n<h2 id=\"操作系统安全防护技术下\"><a class=\"anchor\" href=\"#操作系统安全防护技术下\">#</a> 操作系统安全防护技术 (下)</h2>\n<h1 id=\"应用安全\"><a class=\"anchor\" href=\"#应用安全\">#</a> 应用安全</h1>\n<h2 id=\"应用安全上\"><a class=\"anchor\" href=\"#应用安全上\">#</a> 应用安全 (上)</h2>\n<h2 id=\"应用安全下\"><a class=\"anchor\" href=\"#应用安全下\">#</a> 应用安全 (下)</h2>\n<h1 id=\"移动智能终端安全防护\"><a class=\"anchor\" href=\"#移动智能终端安全防护\">#</a> 移动智能终端安全防护</h1>\n<h2 id=\"移动智能终端安全防护上\"><a class=\"anchor\" href=\"#移动智能终端安全防护上\">#</a> 移动智能终端安全防护 (上)</h2>\n<h2 id=\"移动智能终端安全防护下\"><a class=\"anchor\" href=\"#移动智能终端安全防护下\">#</a> 移动智能终端安全防护 (下)</h2>\n<h1 id=\"信息安全管理\"><a class=\"anchor\" href=\"#信息安全管理\">#</a> 信息安全管理</h1>\n<h2 id=\"信息安全管理上\"><a class=\"anchor\" href=\"#信息安全管理上\">#</a> 信息安全管理 (上)</h2>\n<h2 id=\"信息安全管理下\"><a class=\"anchor\" href=\"#信息安全管理下\">#</a> 信息安全管理 (下)</h2>\n<h1 id=\"信息安全法律法规\"><a class=\"anchor\" href=\"#信息安全法律法规\">#</a> 信息安全法律法规</h1>\n<h2 id=\"信息安全法律法规上\"><a class=\"anchor\" href=\"#信息安全法律法规上\">#</a> 信息安全法律法规 (上)</h2>\n<h2 id=\"信息安全法律法规下\"><a class=\"anchor\" href=\"#信息安全法律法规下\">#</a> 信息安全法律法规 (下)</h2>\n<h1 id=\"实践课程讲解\"><a class=\"anchor\" href=\"#实践课程讲解\">#</a> 实践课程讲解</h1>\n<h2 id=\"个人防火墙基本设置\"><a class=\"anchor\" href=\"#个人防火墙基本设置\">#</a> 个人防火墙基本设置</h2>\n<h2 id=\"无线路由器安全设置\"><a class=\"anchor\" href=\"#无线路由器安全设置\">#</a> 无线路由器安全设置</h2>\n<h2 id=\"个人操作系统用户设置和授权方法\"><a class=\"anchor\" href=\"#个人操作系统用户设置和授权方法\">#</a> 个人操作系统用户设置和授权方法</h2>\n<h2 id=\"个人操作系统备份和恢复方法\"><a class=\"anchor\" href=\"#个人操作系统备份和恢复方法\">#</a> 个人操作系统备份和恢复方法</h2>\n<h2 id=\"个人操作系统关闭服务操作方法\"><a class=\"anchor\" href=\"#个人操作系统关闭服务操作方法\">#</a> 个人操作系统关闭服务操作方法</h2>\n<h2 id=\"个人电脑终端安全防护软件使用方法\"><a class=\"anchor\" href=\"#个人电脑终端安全防护软件使用方法\">#</a> 个人电脑终端安全防护软件使用方法</h2>\n<h2 id=\"web浏览器安全设置\"><a class=\"anchor\" href=\"#web浏览器安全设置\">#</a> WEB 浏览器安全设置</h2>\n<h2 id=\"网上银行安全使用方法\"><a class=\"anchor\" href=\"#网上银行安全使用方法\">#</a> 网上银行安全使用方法</h2>\n<h2 id=\"第三方网上支付安全使用方法\"><a class=\"anchor\" href=\"#第三方网上支付安全使用方法\">#</a> 第三方网上支付安全使用方法</h2>\n<h2 id=\"垃圾邮件分析与过滤\"><a class=\"anchor\" href=\"#垃圾邮件分析与过滤\">#</a> 垃圾邮件分析与过滤</h2>\n<h2 id=\"使用pgp实现电子邮件安全\"><a class=\"anchor\" href=\"#使用pgp实现电子邮件安全\">#</a> 使用 PGP 实现电子邮件安全</h2>\n<h2 id=\"办公软件文件加密和签名操作方法\"><a class=\"anchor\" href=\"#办公软件文件加密和签名操作方法\">#</a> 办公软件文件加密和签名操作方法</h2>\n<h2 id=\"办公软件版权保护操作方法\"><a class=\"anchor\" href=\"#办公软件版权保护操作方法\">#</a> 办公软件版权保护操作方法</h2>\n<h2 id=\"网络打印机安全设置方法\"><a class=\"anchor\" href=\"#网络打印机安全设置方法\">#</a> 网络打印机安全设置方法</h2>\n<h2 id=\"wps文件加密操作方法\"><a class=\"anchor\" href=\"#wps文件加密操作方法\">#</a> WPS 文件加密操作方法</h2>\n<h2 id=\"wps添加水印操作方法\"><a class=\"anchor\" href=\"#wps添加水印操作方法\">#</a> WPS 添加水印操作方法</h2>\n<h2 id=\"压缩工具保护文件操作方法\"><a class=\"anchor\" href=\"#压缩工具保护文件操作方法\">#</a> 压缩工具保护文件操作方法</h2>\n<h2 id=\"数据恢复工具操作方法\"><a class=\"anchor\" href=\"#数据恢复工具操作方法\">#</a> 数据恢复工具操作方法</h2>\n<h2 id=\"口令设置基本规则和注意事项\"><a class=\"anchor\" href=\"#口令设置基本规则和注意事项\">#</a> 口令设置基本规则和注意事项</h2>\n<h2 id=\"手机安全设置技术\"><a class=\"anchor\" href=\"#手机安全设置技术\">#</a> 手机安全设置技术</h2>\n<h2 id=\"手机终端防护软件安全操作方法\"><a class=\"anchor\" href=\"#手机终端防护软件安全操作方法\">#</a> 手机终端防护软件安全操作方法</h2>\n",
            "tags": [
                "技术",
                "网安"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/31/AD/",
            "url": "https://manshan.top/2021/03/31/AD/",
            "title": "深信服——AD",
            "date_published": "2021-03-30T16:27:53.416Z",
            "content_html": "<h1 id=\"第一天\"><a class=\"anchor\" href=\"#第一天\">#</a> 第一天</h1>\n<h2 id=\"ad负载均衡介绍\"><a class=\"anchor\" href=\"#ad负载均衡介绍\">#</a> AD 负载均衡介绍</h2>\n<h3 id=\"发展历史\"><a class=\"anchor\" href=\"#发展历史\">#</a> 发展历史</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 负载均衡 (Load Balance, 简称 LB)，是一种服务器或网络设备的集群技术，负载均衡将特定的业务 (网络服务，网络流量等) 分担给多个服务器或网络设备，从而提高了业务处理功能，保证了业务的高可用性。</li>\n<li>[2] 应用交付 (Application Deliver，简称 AD)，与负载均衡相比，在强调稳定性的基础设上，增加了智能和优化方面的功能特性，以帮助用户应对来自于复杂应用环境中部署并交付服务的挑战。</li>\n</ul>\n<h3 id=\"市场表现\"><a class=\"anchor\" href=\"#市场表现\">#</a> 市场表现</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 国产第一品牌</li>\n<li>[2] 市场占有率 NO.2</li>\n<li>[3] 唯一连续三年入选 Gartner 魔力象限品牌</li>\n</ul>\n<h3 id=\"产品功能价值\"><a class=\"anchor\" href=\"#产品功能价值\">#</a> 产品功能价值</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFI7eP.png\" alt=\"图片\"></li>\n<li>[2] 深信服 AD 应用交付，能够为用户的应用发布提供包括：</li>\n<li>多数据中心负载均衡。</li>\n<li>多链路负载均衡。</li>\n<li>服务器负载均衡的全方位解决方案。</li>\n<li>[3] 深信服 AD 提供数据中心级的负载均衡。</li>\n<li>站点间调度方式：智能 DHS，IP—ANYCAST</li>\n<li>多站点动态切换：全业务实时检测健康</li>\n<li>最佳用户体验：动态最优路径选择</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFo3fe.png\" alt=\"图片\"></li>\n<li>[4] 深信服 AD 提供出站，入站双向链路负载均衡</li>\n<li>入站负载：智能 DNS</li>\n<li>出站负载：智能路由 + DNS 透明代理</li>\n<li>链路健康检测：检测链路可用性，链路故障自动切换</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFotOI.png\" alt=\"图片\"></li>\n<li>[5] 深信服 AD 提供的应用级负载均衡。</li>\n<li>负载算法：多种静态，动态的 L4-L7 负载算法。</li>\n<li>应用级健康检查：基于应用协议和应用内容的健康检测</li>\n<li>Session 级会话保持：IP，COOKIE，HTTP-Header，Radius</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFo7c9.png\" alt=\"图片\"></li>\n</ul>\n<h2 id=\"ad基础运维\"><a class=\"anchor\" href=\"#ad基础运维\">#</a> AD 基础运维</h2>\n<h3 id=\"设备面板\"><a class=\"anchor\" href=\"#设备面板\">#</a> 设备面板</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFoxhD.png\" alt=\"图片\"></li>\n<li>BYPASS，黄色，不用</li>\n<li>STATE，黄色，正常情况下无规律闪烁</li>\n<li>ALAME，红色，开机过程常亮，正常运行灭，双机部署时备机呈有规律慢速闪烁</li>\n<li>POWER，绿色，开机是常亮</li>\n</ul>\n<h3 id=\"设备登录\"><a class=\"anchor\" href=\"#设备登录\">#</a> 设备登录</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] MANAGE 网口默认 IP 地址：</li>\n<li>10.252.252.252/24</li>\n<li>10.254.254.254/24</li>\n<li>电脑配置同网段地址，浏览器输入 https://IP 访问</li>\n</ul>\n<h3 id=\"设备烤机\"><a class=\"anchor\" href=\"#设备烤机\">#</a> 设备烤机</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 设备配置接口地址及 DNS 服务器，确保设备可以上网，正常访问深信服服务器。</li>\n<li>[2] 使用网安产品烤机工具，设备设备信息。</li>\n<li>[3] 输入密码，连接设备。</li>\n<li>[4] 在线平台查看设备是否成功下载烤机脚本，不成功请检查设备是否可以正常上网，或者使用离线烤机脚本 (下图为下载失败提示，烤机平台地址，<span class=\"exturl\" data-url=\"aHR0cDovL3Nhbmdmb3JkaWFnLmdpY3AubmV0OjgwODAvbW9uaXRvci9pbmRleC5waHA=\">http://sangfordiag.gicp.net:8080/monitor/index.php</span>)。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cFT0D1.png\" alt=\"图片\"></li>\n</ul>\n<h3 id=\"设备巡检\"><a class=\"anchor\" href=\"#设备巡检\">#</a> 设备巡检</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用网关升级客户端连接设备</li>\n<li>[2] 按 F10 打开命令交互界面</li>\n<li>[3] 依次点击：命令 - 设备健康状态检测 - 离线检测，上传对应的健康检查脚本文件 (直接上传.zip 格式文件，下载连接 http://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=tool)</li>\n<li>[4] 巡检完成后会提示检测结果已放在 SANGFOR Firmware Updater 的运行目录。巡检多台设备时记得更改检查结果文件的名字后巡检下一台设备。</li>\n</ul>\n<h3 id=\"管理员子账户密码管理与恢复\"><a class=\"anchor\" href=\"#管理员子账户密码管理与恢复\">#</a> 管理员子账户密码管理与恢复</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 系统菜单：系统配置 - 用户，点击新建按钮，新建设备管理员</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/ck0DI0.png\" alt=\"图片\"></li>\n</ul>\n<h3 id=\"设备升级\"><a class=\"anchor\" href=\"#设备升级\">#</a> 设备升级</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用 SANGFOR Update 6.0 连接设备 (升级需要校验升级序列号是否在有效期内，设备或者操作计算机需要能连接公网解析时间)</li>\n<li>[2] 加载对应的升级包，点击升级。(升级包下载地址：<span class=\"exturl\" data-url=\"aHR0cDovL2Jicy5zYW5nZm9yLmNvbS5jbi9wbHVnaW4ucGhwP2lkPXNlcnZpY2U6ZG93bmxvYWQmYW1wO2FjdGlvbj12aWV3JmFtcDtmaWQ9MTAwMDAwMDA0Mzg0Mzg3Iy8xMDAwMDAwMTYyNjkyMTIvYWxs\">http://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=view&amp;fid=100000004384387#/100000016269212/all</span>)</li>\n</ul>\n<h3 id=\"序列号授权\"><a class=\"anchor\" href=\"#序列号授权\">#</a> 序列号授权</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 序列号授权信息：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/ckBf1S.png\" alt=\"图片\"></li>\n</ul>\n<h2 id=\"sangfor_ad_64_conf_07_01_设备管理_序列号_用户配置指导书\"><a class=\"anchor\" href=\"#sangfor_ad_64_conf_07_01_设备管理_序列号_用户配置指导书\">#</a> SANGFOR_AD_6.4_CONF_07_01_设备管理_序列号_用户配置指导书</h2>\n<h3 id=\"应用场景\"><a class=\"anchor\" href=\"#应用场景\">#</a> 应用场景</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 方便现场部署和网络维护人员了解如何登录和管理 AD 设备，掌握设备配置的备份与恢复，在设备界面简单调试 AD，了解设备开通了哪些授权以及可以使用设备具体功能和对应功能的应用场景，如何设置 (除超级管理员 admin) 其他用户查看或修改设备配置权限等。</li>\n</ul>\n<h3 id=\"模块介绍及运用\"><a class=\"anchor\" href=\"#模块介绍及运用\">#</a> 模块介绍及运用</h3>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<h4 id=\"管理网口\"><a class=\"anchor\" href=\"#管理网口\">#</a> 管理网口：</h4>\n<ul>\n<li>WEBUI 路径：【系统配置】——&gt;【设备管理】——&gt;【管理网口】</li>\n<li>【管理网口】：用于设置 AD 设备的管理网口的相关信息，另外还包括主机名，WEBUI 等设置。(如下图所示)</li>\n<li>[2] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/ckIuhF.png\" alt=\"图片\"></li>\n<li>[3] 查看 AD 管理网口界面，我们在部署或管理 AD 时能运用到哪些？</li>\n<li>①：设备默认地址：</li>\n<li>查看管理口界面有地址列表，里面配置的 IP 就是设备 MANAGE 口绑定的 IP 地址，默认是 10.252.252.252/24 或 10.254.254.254/24。可以删除和修改，可配置 16 个 IP</li>\n<li>②：设备登录和使用端口：</li>\n<li>管理网口界面 HTTPS 443 就是设备默认的登录端口，那么电脑配置跟设备管理口同网段比如：10.252.252.100/24 或 10.254.254.100/24 直接设备 MANAGE 口打开浏览器输入 https://10.252.252.252 或 https://10.254.254.254 回车就可以打开 AD 设备控制台界面了。</li>\n<li>默认账号 / 密码是 admin/admin</li>\n<li>HTTP 会话超时时间：是指登录控制台未操作达到设置时间就注销。</li>\n<li>③：公网登录 AD 设备以及 Ping 通 WAN 口 IP：</li>\n<li>管理口界面，勾选远程维护，同时开启 WAN 口入站路由转发。</li>\n<li>WAN 口入站路由转发：如果 WAN 网卡的入站路由转发功能为禁用状态，则 WAN 口与 LAN 口无法进行除虚拟服务，DNS，源地址转换，端口映射，远程登陆，匹配智能路由或静态路由之外的数据传输，启用后才可以进行数据传输，WAN 口入站路由转发就可以 ping 通设备 WAN 口 IP。</li>\n<li>WAN 口入站路由转发开启位置如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/ckbR6e.png\" alt=\"图片\"></li>\n<li>[4] 拓展：</li>\n<li>④：AD 双机部署如何通过 MANAGE 口登录备机？</li>\n<li>首先登录主机打开管理口界面，需要把管理口 IP 修改成跟备机同网段的不同 IP，若是有多个 IP 都需要修改。</li>\n<li>比如 MANAGE 口现在配置的是 10.252.252.252/24 和 10.254.254.254/24，就把主机管理口修改为 10.251.251.251/24 和 10.254.254.253/24。那么就可以拿电脑直接备机 MANAGE 口使用 10.252.252.252 或 10.254.254.254 登录备机。</li>\n<li>⑤：发布的虚拟服务或端口映射要使用 443 端口与设备 HTTPS 默认端口冲突，是否需要修改？</li>\n<li>需要修改，不然在内外网无法登录和管理设备，只能连接设备管理口登录了，同理，若是开启了报表中心默认 85 端口与发布的虚拟服务或端口映射冲突，也需要修改。</li>\n<li>点击上图中的更新不会重启设备和所有服务，只会更新对应修改的服务，若是想对管理口界面详细了解，点击界面右上方 ？ 帮助信息。</li>\n</ul>\n<h4 id=\"日期时间\"><a class=\"anchor\" href=\"#日期时间\">#</a> 日期时间</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>WEBUI 路径：【系统配置】——&gt;【设备管理】——&gt;【日期 / 时间】。</li>\n<li>【日期 / 时间】界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/ckxP91.png\" alt=\"图片\"></li>\n<li>[1] 本模块主要用于设置 AD 设备系统时间，可以获取 PC 当前时间，也可以与时间服务器同步，需要保持通信。</li>\n<li>[2] 如果更新的时间在原时间之后的话，会导致中间一段时间的数据没有记录，如果更新的时间在原时间之前的话，对于报表中的分钟视图，小时视图是以最新的数据显示，对于报表中的天视图和月视图是以数据叠加后的结果显示数据的。</li>\n</ul>\n<h4 id=\"配置备份与恢复\"><a class=\"anchor\" href=\"#配置备份与恢复\">#</a> 配置备份与恢复</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>WEBUI 路径：【系统配置】——&gt;【设备管理】——&gt;【配置备份与恢复】。</li>\n<li>【配置备份与恢复】界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cASB0U.png\" alt=\"图片\"></li>\n<li>[1] 实际运用：</li>\n<li>若是我们需要对 AD 配置修改或者升级等操作会影响当前配置时，需要备份配置或者恢复或者需要把 AD 恢复出厂设置，那么如何操作？</li>\n<li>①：配置备份，导出与恢复：</li>\n<li>点击新建，就可以对当前的配置进行备份，如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cApXG9.png\" alt=\"图片\"></li>\n<li>那么在配置备份与恢复界面就可以查看到当前时间点我们备份的配置。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA9szR.png\" alt=\"图片\"></li>\n<li>在升级操作时或者日常维护时，建议导出配置到本地，后续需要可以点击从文件恢复当前备份配置，点击恢复，即可恢复到所选备份的配置状态如下图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cACVkF.png\" alt=\"图片\"></li>\n<li>②：AD 恢复出厂设置，点击恢复默认配置，恢复出厂配置，如下图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAC21s.png\" alt=\"图片\"></li>\n<li>谨慎操作！！！，恢复默认配置\t所有的配置将会还原成出厂设置。</li>\n<li>③：配置备份与恢复注意事项：</li>\n<li>恢复备份配置会自动重启设备。</li>\n<li>若是备份配置版本与当前版本不一致不能恢复控制台会提示如下图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAPSAO.png\" alt=\"图片\"></li>\n<li>设备加入集群前会自动备份配置。</li>\n<li>增加设备在线升级备份配置，比如 6.3 在线升级 6.4 设备自动备份配置如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAPh2d.png\" alt=\"图片\"></li>\n</ul>\n<h4 id=\"关机重启\"><a class=\"anchor\" href=\"#关机重启\">#</a> 关机 / 重启</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>WEBUI 路径：【系统配置】——&gt;【设备管理】——&gt;【关机 / 重启】。</li>\n<li>【关机 / 重启】：提供界面上的重启按钮，方便客户进行重启操作。界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAPj2j.png\" alt=\"图片\"></li>\n<li>点击【关机】，用于关闭 AD 设备，点击【重启设备】，用于重启 AD 设备。</li>\n<li>点击【重启服务】，用于重启 AD 设备的所有服务，硬件不重启。</li>\n</ul>\n<h4 id=\"webconsole\"><a class=\"anchor\" href=\"#webconsole\">#</a> WebConsole</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>WEBUI 路径：【系统配置】——&gt;【设备管理】——&gt;【WebConsole】。</li>\n<li>【WebConsole】用于让客户能通过 web 页面进行命令行操作，查看后台的一些基本信息。界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAAMd0.png\" alt=\"图片\"></li>\n<li>[1]【命令行帮助列表】列出 Webconsole 所支持的命令\t以及命令的作用，在页面最下方的【Sangfor Webconsole】后面输入命令 help，按键盘【ENTER】键就能查看到系统的相应信息。</li>\n<li>[2] 实际运用：</li>\n<li>通过 wewbconsole 可以查看到 AD 设备的 ARP 表，设备路由，设备接口状态等，以及测试 AD 与内网其他设备通信状态，方便日常维护和排查问题。</li>\n<li>①：查看 AD 设备的 ARP 表，系统路由，设备接口状态：</li>\n<li>arp (设备的 ARP 表) 如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAgteO.png\" alt=\"图片\"></li>\n<li>ip route (设备路由包含配置的静态和动态学到的路由) 如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAgq7F.png\" alt=\"图片\"></li>\n<li>route (查看设备系统路由) 如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA2S6x.png\" alt=\"图片\"></li>\n<li>ifconfig eth0 (查看 eth0 接口 IP 和 MAC 地址) 如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA2QHS.png\" alt=\"图片\"></li>\n<li>ethtool eth0 (查看 eth0 接口速率，工作模式和状态) 如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA2auV.png\" alt=\"图片\"></li>\n<li>②：测试 AD 与内网其他设备通信状态：</li>\n<li>ping（查看设备与其他主机的连接情况同 Linux 下的 ping 命令（注意：不使用 - c 参数默认 ping4 个包，若使用 - c 参数，需要在 &quot;ping&quot; 之后））</li>\n<li>测试与 192.200.121.1 通信结果：正常通信如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cARMx1.png\" alt=\"图片\"></li>\n<li>测试与 192.200.121.153 结果：通信失败如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAR3qK.png\" alt=\"图片\"></li>\n<li>sock（检测连接，检测某个主机的指定端口是否在侦听 sock host port (如：sock 192.168.251.1 443)）</li>\n<li>测试 192.200.121.251 443 端口结果：通信正常如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAROzR.png\" alt=\"图片\"></li>\n<li>测试 192.168.121.251 80 端口结果：通信失败如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAWuTS.png\" alt=\"图片\"></li>\n</ul>\n<h4 id=\"序列号\"><a class=\"anchor\" href=\"#序列号\">#</a> 序列号</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1]【授权信息】包括【设备信息】和【序列号】两部分，【设备信息】用于显示设备的网关序号，授权模块，电话服务有效期，硬件质保服务有效期。【序列号】用于控制链路数量，SSL 卸载授权，TCP 单边加速授权 (即 TCP 加速)，HTTP 缓存授权，智能 DNS 全局授权，应用分析模块，安全分析模块，软件升级授权，不同的序列号对于着不同功能模块。</li>\n<li>WEBUI 路径：【系统配置】——&gt;【授权信息】。界面如下所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAfnj1.png\" alt=\"图片\"></li>\n<li>序列号说明应用场景如下表所示：</li>\n<li>①：基本授权：</li>\n<li>激活基本授权序列号才能使用 AD 设备提供主要功能（如应用负载、链路负载等）新建 WAN 口数量小于或等于链路数量。</li>\n<li>②：TCP 单边加速授权：</li>\n<li>激活 TCP 单边加速授权序列号才能启用虚拟服务的 TCP 单边加速功能。</li>\n<li>通过优化 TCP 协议，解决一些 TCP 协议本身的缺陷，来实现加速的效果。主要</li>\n<li>用于丢包 大的情况下，效果十分明显。该功能仅针对 TCP 协议生效。</li>\n<li>③：HTTP 缓存授权：</li>\n<li>激活 HTTP 缓存授权序列号才能启用虚拟服务优化策略的 HTTP 缓存和 HTTP 压缩功能。</li>\n<li>HTTP 缓存：设备内置 HTTP 缓存，能减轻大量重复请求对服务器的压力。该缓存保存于内存中，重启设备将被清除。</li>\n<li>HTTP 压缩：客户端请求页面，AD 设备返回缓存内容或者服务器返回内容给客户端时，AD 设备对 HTTP 响应进行压缩编码，降低数据量，从而减少数据在网络上的传输时间。</li>\n<li>④：智能 DNS 全局授权：</li>\n<li>激活智能 DNS 全局授权序列号才能启用全局配置还原、数据中心等全局关功能。</li>\n<li>应用于基于地域和 ISP 的分布式部署环境，能有效的解决站点冗余，以及距</li>\n<li>应用发布站点距离较远的用户访问站点速度慢的问题。智能 DNS 全局负载功能，将多台深信服 AD 设备通过同步的方式，以唯一域名的方式将多个数据中心对外发布出去。</li>\n<li>⑤：软件升级授权：</li>\n<li>软件升级授权序列号只在一定时间内有效，超过有效期后将不能进行系统软件升级配置指导文档</li>\n<li>⑥：SSL 卸载授权：</li>\n<li>SSL 卸载技术是通过将应用访问过程中 SSL 的加解密转嫁到深信服 AD 设备之上，由于深信服设备拥有超强的加解密能力能够满足搞并发访问网站的需求，减少服务器的性能压力，提升访问速度。</li>\n<li>注意事项:</li>\n<li>1、AD 的 SSL 卸载功能需要序列号。</li>\n<li>2、添加节点的时候，一定要指定端口，不能留空。</li>\n<li>3、建议管理 IP 和发布 IP 分开</li>\n<li>4、部分 WEB 页面里嵌套的 HTTP 请求无法打开，</li>\n<li>请在配置虚拟服务的时候启用 HTTP 自动跳转到 HTTPS。如 AD 设备是单臂模式部署</li>\n<li>在内网并且需要把服务发布到互联网，为保证 HTTP 到 HTTPS 跳转功能生效，前置防火墙设备还需映射 80 到设备接口 IP。</li>\n<li>⑦：虚拟多租户授权：</li>\n<li>激活虚拟多租户授权序列号才能新建和启动 vAD，可新建的 vAD 数目受序列号中的 vAD 数量限制</li>\n</ul>\n<h4 id=\"应用分析授权\"><a class=\"anchor\" href=\"#应用分析授权\">#</a> 应用分析授权</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 应用分析授权：激活应用分析授权序列号才能启用业务分析中的应用分析功能，进行 WebLogic，ORACLE，SQLServer 服务器的监视。</li>\n<li>如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA4UTf.png\" alt=\"图片\"></li>\n</ul>\n<h4 id=\"安全分析授权\"><a class=\"anchor\" href=\"#安全分析授权\">#</a> 安全分析授权</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 安全分析授权：激活安全分析授权序列号才能启用业务分析中的安全分析功能。进行实时漏洞分析。</li>\n<li>如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAIAq1.png\" alt=\"图片\"></li>\n<li>实时漏洞分析界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAIJdP.png\" alt=\"图片\"></li>\n<li>①：在虚拟 AD 下隐藏授权警告提示以及隐藏掉序列号输入的文本框如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAI5LR.png\" alt=\"图片\"></li>\n<li>②：集群模式下，应用分析和安全分析功能相关业务都不会启动，页面也对用户不可见，不可配。</li>\n</ul>\n<h4 id=\"用户\"><a class=\"anchor\" href=\"#用户\">#</a> 用户</h4>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1]【用户】用来设置能够通过控制台管理 AD 硬件设备的登录用户。</li>\n<li>WEBUI 路径：【系统配置】——&gt;【用户】。</li>\n<li>界面如下图所示：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAoHns.png\" alt=\"图片\"></li>\n<li>[2] 实际运用：</li>\n<li>在实际网络维护中，针对不同管理员设置不同的管理权限。有利于 AD 设备更好的管理和维护。</li>\n<li>首先点击新增用户 sangfor1，角色是 guest 权限，在用户点击新增如下图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA7RW8.png\" alt=\"图片\"></li>\n<li>只允许 sangfor1 使用 192.200.121.33/24 该 IP 登录 AD：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cA7Twn.png\" alt=\"图片\"></li>\n<li>对 AD 控制台只有查看权限，限制 sangfor1 账号对应用负载，智能 DNS，高可用性，业务分析四个模块无查看权限。</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAHmmd.png\" alt=\"图片\"></li>\n<li>使用 sangfor1 登录验证如下截图：</li>\n<li>查看智能 DNS 配置，提示无权限查看：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAHlff.png\" alt=\"图片\"></li>\n<li>配置路由配置 - 静态路由提示无权限配置：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAHU7n.png\" alt=\"图片\"></li>\n<li>若是使用 sangfor1 账号不在允许 IP 范围内会提示被限制登录：截图如下：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/31/cAHTje.png\" alt=\"图片\"></li>\n<li>列表中的 &quot;admin&quot; 角色和用户默认无法删除，此用户管理员，拥有所有权限，默认密码为 &quot;admin&quot;</li>\n<li>Web 控制台支持 &quot;外部认证&quot;，可以选择 Radius，AD 域或禁止三种方式。</li>\n</ul>\n<h2 id=\"sangfor_ad_64_conf_10_03_控制台密码恢复指导书\"><a class=\"anchor\" href=\"#sangfor_ad_64_conf_10_03_控制台密码恢复指导书\">#</a> SANGFOR_AD_6.4_CONF_10_03_控制台密码恢复指导书</h2>\n<h2 id=\"sangfor_ad_65_conf_10_01_备份和恢复配置指导书\"><a class=\"anchor\" href=\"#sangfor_ad_65_conf_10_01_备份和恢复配置指导书\">#</a> SANGFOR_AD_6.5_CONF_10_01_备份和恢复配置指导书</h2>\n<h2 id=\"sangfor_ad_65_conf_10_02_恢复默认配置指导书\"><a class=\"anchor\" href=\"#sangfor_ad_65_conf_10_02_恢复默认配置指导书\">#</a> SANGFOR_AD_6.5_CONF_10_02_恢复默认配置指导书</h2>\n<h1 id=\"第二天\"><a class=\"anchor\" href=\"#第二天\">#</a> 第二天</h1>\n<h1 id=\"第三天\"><a class=\"anchor\" href=\"#第三天\">#</a> 第三天</h1>\n",
            "tags": [
                "技术",
                "SANGFOR"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/",
            "url": "https://manshan.top/2021/03/24/HCIA-Routing%20&%20Switching%E5%AE%9E%E9%AA%8C%E5%85%A5%E9%97%A8/",
            "title": "HCIA-Routing & Switching实验入门",
            "date_published": "2021-03-23T16:16:52.748Z",
            "content_html": "<h1 id=\"写在前面\"><a class=\"anchor\" href=\"#写在前面\">#</a> 写在前面</h1>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li class=\"red\">[1] 常用图标：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6HBzjA.png\" alt=\"图片\"></li>\n<li class=\"red\">[2] 设备名称，型号与版本对应关系如下：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6HD9Bt.png\" alt=\"图片\"></li>\n</ul>\n<h1 id=\"第一章实验ensp搭建基础网络\"><a class=\"anchor\" href=\"#第一章实验ensp搭建基础网络\">#</a> 第一章【实验 eNSP 搭建基础网络】</h1>\n<p class=\"red\">1，启动终端设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qDxG8.png\" alt=\"图片\"></li>\n<li>[2] 选中设备，右击，在弹出的菜单中，选择 “启动” 选项，启动该设备。</li>\n<li>[3] 或，选中准备，点击右上角启动按钮。</li>\n</ul>\n<p class=\"red\">2，捕获接口报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qrTYV.png\" alt=\"图片\"></li>\n<li>[2] 选中设备右击，在菜单中点击 “数据抓包” 选项后，从列表中选择需要监控的接口。</li>\n<li>[3] 接口选择完成后，Wireshark 会自动激活，捕获选中接口所收发的所有报文。</li>\n</ul>\n<p class=\"red\">3，生成接口流量：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qsQ1S.png\" alt=\"图片\"></li>\n<li>[2] 生成的流量会在该界面的回显信息中显示，包含发送的报文和接受的报文。</li>\n<li>[3] 生成流量后，通过 Wireshark 捕获报文并生成抓包结果。</li>\n</ul>\n<p class=\"red\">4，观察捕获的报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qrtzD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Wireshark 的使用方法会在另一篇中介绍。</ins></li>\n<li>[2] Wireshark 界面包含三个面板，分别显示的是数据包列表，每个数据包的内容明细以及数据报对应的十六进制的数据格式。</li>\n<li>[3] 报文内容明细对于理解协议报文格式十分重要，同时也显示了基于 OSI 参考模型的各层协议的详细信息。</li>\n</ul>\n<h1 id=\"第二章设备基础配置\"><a class=\"anchor\" href=\"#第二章设备基础配置\">#</a> 第二章【设备基础配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>您是公司的网络管理员，现在公司购买了两台华为 AR G3 系列路由器，路由器在使用之前，需要先配置路由器的设备名称，系统时间及登陆密码等管理信息。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/24/6qyCEn.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，查看系统信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用 display version 命令，查看路由器的软件版本与硬件信息。</li>\n<li>[2]&lt;Huawei&gt;display version</li>\n<li>Huawei Versatile Routing Platform Software</li>\n<li>VRP (R) software, Version 5.130 (AR200 V200R003C00)</li>\n<li>Copyright (C) 2011-2012 HUAWEI TECH CO., LTD</li>\n<li>Huawei AR201 Router uptime is 0 week, 0 day, 0 hour, 0 minute</li>\n<li>MPU 0(Master) : uptime is 0 week, 0 day, 0 hour, 0 minute</li>\n<li>MPU version information :</li>\n<li>1, PCB      Version  : AR01SRU0A VER.A</li>\n<li>2, MAB      Version  : 0</li>\n<li>3, Board    Type     : AR201</li>\n<li>4, BootROM  Version  : 0</li>\n<li>[3] 命令回显消息中包含了 VRP 版本 (Version 5.130)，设备型号 (AR201) 和启动时间 (uptime is 0 week, 0 day, 0 hour, 0 minute) 等信息。</li>\n</ul>\n<p class=\"red\">3，修改系统时间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] VRP 系统会自动保存时间，但如果时间不正确，可以在用户视图下执行<span class=\"green\"> clock timezone</span> 命令和<span class=\"green\"> clock datatime</span> 命令修改系统时间。</li>\n<li>&lt;Huawei&gt;clock timezone Local add 09:00:00</li>\n<li>&lt;Huawei&gt;clock datetime 12:00:00 2000-07-07</li>\n<li>[2] 你也可以修改 local 字段为当前地区的时区名称，如果当前时区位于 UTC+0 时区的西部，需要把 add 字段修改为 minus。</li>\n<li>[3] 执行 display clock 命令查看生效的新系统时间。</li>\n<li>&lt;Huawei&gt;display clock</li>\n<li>2000-07-07 12:04:49</li>\n<li>Friday</li>\n<li>Time Zone(Local) : UTC+09:00</li>\n</ul>\n<p class=\"red\">4，帮助功能和命令自动补全功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在系统输入命令时，？是通配符，Tab 键是自动补全命令的快捷键。</li>\n<li>&lt;Huawei&gt;display ?</li>\n<li>aaa                       AAA</li>\n<li>access-user               User access</li>\n<li>accounting-scheme         Accounting scheme</li>\n<li>acl                       &lt;Group&gt; acl command group</li>\n<li>actual                    Current actual</li>\n<li>adp-ipv4                  Ipv4 information</li>\n<li>adp-mpls                  Adp-mpls module</li>\n<li>alarm                     Alarm</li>\n<li>[2] 在输入信息后输入 “ ？” 可查看以输入字母开头的命令，如，输入 “dis？ ”，设备将输出以 dis 开头的命令。</li>\n<li>[3] 在输入的信息后增加空格，再输入 “ ？”，这时设备将尝试识别输入的信息所对应的命令，然后输出该命令的其他参数。例如输入 “dis ？”，如果只有 display 命令是以 dis 开头的，那么设备将输出 display 命令的参数，如果以 dis 开头的命令还有其他的，设备将报错。</li>\n<li>[4] 另外可以使用键盘上 Tab 键补全命令，比如键入 “dis” 后，按键盘 “Tab” 键可以将命令补全为 “display”。如果有多个以 “dis” 开头的命令存在，则在多个命令之间循环切换。</li>\n<li>[5] 命令在不发生歧义的情况下可以使用简写，如 “display” 可以简写为 “dis” 或 “disp” 等，“interface” 可以简写为 “int” 或 “inter” 等。</li>\n</ul>\n<p class=\"red\">5，进入系统视图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 使用 system-view 命令可以进入系统视图，这样才可以配置接口，协议等内容。</li>\n<li>&lt;Huawei&gt;system-view</li>\n<li>Enter system view, return user view with Ctrl+Z.</li>\n</ul>\n<p class=\"red\">6，修改设备名称：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置设备时，为了便于区分。往往给设备定义不同的名称。</li>\n<li>[2] 修改 R1 路由器的设备名称为 R1。</li>\n<li>[Huawei]sysname R1</li>\n<li>[R1]</li>\n<li>[3] 修改 R2 路由器的设备名称为 R2。</li>\n<li>[Huawei]sysname R2</li>\n<li>[R2]</li>\n</ul>\n<p class=\"red\">7，配置登录信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置登录标语信息来进行提示或进行登录警告，执行<span class=\"green\"> header shell information</span> 命令配置登录信息。</li>\n<li>[R1]header shell information &quot;Hello !!!&quot;</li>\n<li>[2] 退出路由器命令行界面，再重新登录命令行界面，查看登录信息是否已经修改。</li>\n<li>&lt;R1&gt;quit</li>\n<li>Configuration console exit, please press any key to log on</li>\n<li>Hello !!!</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">8，配置 Console 口参数：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 默认情况下，通过 Console 口登录无密码，任何人都可以直接连接到设备，进行配置。</li>\n<li>[2] 为了避免由此带来的风险，可以将 Console 接口登录方式配置为密码认证方式，密码为密文形式的 “Huawei@123”。</li>\n<li>[3] 空闲时间指的是经过没有任何操作的一定时间后，会自动退出该配置界面，再次登录会根据系统要求，提示输入密码进行验证。</li>\n<li>[4] 空闲时间超时时间为 20 分钟，默认为 10 分钟。</li>\n<li>[R1-ui-console0]user-interface console 0</li>\n<li>[R1-ui-console0]authentication-mode password</li>\n<li>Please configure the login password (maximum length 16):16</li>\n<li>[R1-ui-console0]set authentication password cipher * * * * * *</li>\n<li>[R1-ui-console0]idle-timeout 20 0</li>\n<li>[5] 执行 display this 命令查看配置结果。</li>\n<li>[R1-ui-console0]display this</li>\n<li>[V200R003C00]</li>\n<li>user-interface con 0</li>\n<li>authentication-mode password</li>\n<li>set authentication password cipher %$%7{[8W~(~m1B}=[F=7>&9,'>.bbJS4b>77C8N\\2D:uw%9'>1,%%$</li>\n<li>idle-timeout 20 0</li>\n<li>user-interface vty 0 4</li>\n<li>user-interface vty 16 20</li>\n<li>return</li>\n<li>[6] 退出系统，并使用新配置的密码登陆系统，需要注意的是，在路由器第一次初始化启动时，也需要配置密码。</li>\n<li>&lt;R1&gt;quit</li>\n<li>Configuration console exit, please press any key to log on</li>\n<li>Login authentication</li>\n<li>Password:Huawei@123</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">9，配置接口 IP 地址和描述信息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 配置 R1 G0/0/0 接口的 IP 地址，使用点分十进制格式 (如：255.255.255.0) 或根据子网掩码前缀长度配置子网掩码。</p>\n</li>\n<li>\n<p>[R1]int g0/0/0</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]ip address 172.16.1.1 24</p>\n</li>\n<li>\n<p>Mar 24 2021 23:08:22-08:00 R1 %%01IFNET/4/LINK_STATE(l)[0]:The line protocol IP on the interface GigabitEthernet0/0/0 has entered the UP state.</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]description This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>[2] 在当前接口视图下，执行<span class=\"green\"> display this</span> 命令查看配置结果。</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]display this</p>\n</li>\n<li>\n<p>[V200R003C00]</p>\n</li>\n<li>\n<p>interface GigabitEthernet0/0/0</p>\n</li>\n<li>\n<p>description This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>ip address 172.16.1.1 255.255.255.0</p>\n</li>\n<li>\n<p>return</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]</p>\n</li>\n<li>\n<p>[3] 执行<span class=\"gree\"> display interface</span> 命令查看接口信息。</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/0]display interface G0/0/0</p>\n</li>\n<li>\n<p>GigabitEthernet0/0/0 current state : UP</p>\n</li>\n<li>\n<p>Line protocol current state : UP</p>\n</li>\n<li>\n<p>Last line protocol up time : 2021-03-24 23:08:22 UTC-08:00</p>\n</li>\n<li>\n<p>Description:This interface connects to R2-G0/0/0</p>\n</li>\n<li>\n<p>Route Port,The Maximum Transmit Unit is 1500</p>\n</li>\n<li>\n<p>Internet Address is 172.16.1.1/24</p>\n</li>\n<li>\n<p>IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-fc8e-05ac</p>\n</li>\n<li>\n<p>Last physical up time   : 2021-03-24 23:06:29 UTC-08:00</p>\n</li>\n<li>\n<p>Last physical down time : 2021-03-24 23:06:16 UTC-08:00</p>\n</li>\n<li>\n<p>Current system time: 2021-03-24 23:15:30-08:00</p>\n</li>\n<li>\n<p>Port Mode: COMMON COPPER</p>\n</li>\n<li>\n<p>Speed : 1000,  Loopback: NONE</p>\n</li>\n<li>\n<p>Duplex: FULL,  Negotiation: ENABLE</p>\n</li>\n<li>\n<p>Mdi   : AUTO</p>\n</li>\n<li>\n<p>[3] 从命令回显消息中可以看到，接口的物理状态与协议状态均为 Up，表示对应的物理层与数据链路层均可用。</p>\n</li>\n<li>\n<p>[4] 配置 R2 上 G0/0/0 接口的 IP 地址与描述信息。</p>\n</li>\n<li>\n<p>[R2]int g0/0/0</p>\n</li>\n<li>\n<p>[R2-GigabitEthernet0/0/0]ip address 172.16.1.2 24</p>\n</li>\n<li>\n<p>Mar 24 2021 23:20:19-08:00 R2 %%01IFNET/4/LINK_STATE(l)[0]:The line protocol IP on the interface GigabitEthernet0/0/0 has entered the UP state.</p>\n</li>\n<li>\n<p>[R2-GigabitEthernet0/0/0]description This interface connects to R1-G0/0/0</p>\n</li>\n<li>\n<p>[4] 配置完成后，通过执行 ping 命令测试 R1 和 R2 间的连通性。</p>\n</li>\n<li>\n<p>&lt;R1&gt;ping 172.16.1.2</p>\n</li>\n<li>\n<p>PING 172.16.1.2: 56  data bytes, press CTRL_C to break</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=1 ttl=255 time=120 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=2 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=3 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=4 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>Reply from 172.16.1.2: bytes=56 Sequence=5 ttl=255 time=20 ms</p>\n</li>\n<li>\n<p>--- 172.16.1.2 ping statistics ---</p>\n</li>\n<li>\n<p>5 packet(s) transmitted</p>\n</li>\n<li>\n<p>5 packet(s) received</p>\n</li>\n<li>\n<p>0.00% packet loss</p>\n</li>\n<li>\n<p>round-trip min/avg/max = 20/40/120 ms</p>\n</li>\n</ul>\n<p class=\"red\">10，查看当前设备上存储的文件列表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行<span class=\"green\"> display saved-configuration</span> 命令查看保存的配置文件。</li>\n<li>&lt;R1&gt;display saved-configuration</li>\n<li>There is no correct configuration file in FLASH</li>\n<li>&lt;R1&gt;</li>\n<li>[2] 系统中没有已保存的配置文件，执行<span class=\"green\"> save</span> 命令保存当前的配置文件。</li>\n<li>&lt;R1&gt;save</li>\n<li>The current configuration will be written to the device.</li>\n<li>Are you sure to continue? (y/n)[n]:y</li>\n<li>It will take several minutes to save configuration file, please wait........</li>\n<li>Configuration file had been saved successfully</li>\n<li>Note: The configuration file will take effect after being activated</li>\n<li>&lt;R1&gt;</li>\n<li>[3] 重新执行<span class=\"green\"> display saved-configuration</span> 命令查看已保存的配置信息。</li>\n<li>&lt;R1&gt;display saved-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n<li>[4] 执行<span class=\"green\"> display current-configuration</span> 命令查看当前配置信息。</li>\n<li>&lt;R1&gt;display current-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n<li>[5] 一台路由器可以配置多个配置文件。执行<span class=\"green\"> display startup</span> 命令查看下次启动时使用的配置文件。</li>\n<li>&lt;R1&gt;display startup</li>\n<li>MainBoard:</li>\n<li>Startup system software:                   null</li>\n<li>Next startup system software:              null</li>\n<li>Backup system software for next startup:   null</li>\n<li>Startup saved-configuration file:          flash:/vrpcfg.zip</li>\n<li>Next startup saved-configuration file:     flash:/vrpcfg.zip</li>\n<li>Startup license file:                      null</li>\n<li>Next startup license file:                 null</li>\n<li>Startup patch package:                     null</li>\n<li>Next startup patch package:                null</li>\n<li>Startup voice-files:                       null</li>\n<li>Next startup voice-files:                  null</li>\n<li>&lt;R1&gt;</li>\n<li>[6] 删除闪存中的配置文件。</li>\n<li>&lt;R1&gt;reset saved-configuration</li>\n<li>This will delete the configuration in the flash memory.</li>\n<li>The device configuratio</li>\n<li>ns will be erased to reconfigure.</li>\n<li>Are you sure? (y/n)[n]:y</li>\n<li>Clear the configuration in the device successfully.</li>\n<li>&lt;R1&gt;</li>\n</ul>\n<p class=\"red\">11，重启设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行 reboot 命令重启路由器。</li>\n<li>&lt;R1&gt;reboot</li>\n<li>Info: The system is comparing the configuration, please wait.</li>\n<li>Warning: All the configuration will be saved to the next startup configuration.</li>\n<li>Continue ? [y/n]:y</li>\n<li>[2] 系统提示是否保存当前配置，可根据实验要求决定是否保存当前配置，如果无法确认是否保存，则不保存当前配置。</li>\n<li>[3] 配置文件。</li>\n<li>[R1]display current-configuration</li>\n<li>[V200R003C00]</li>\n<li>sysname R1</li>\n<li>snmp-agent local-engineid 800007DB03000000000000</li>\n<li>snmp-agent</li>\n<li>clock timezone China-Standard-Time minus 08:00:00</li>\n<li>portal local-server load portalpage.zip</li>\n<li>drop illegal-mac alarm</li>\n<li>set cpu-usage threshold 80 restore 75</li>\n<li>aaa</li>\n</ul>\n<h1 id=\"第三章stp和rstp\"><a class=\"anchor\" href=\"#第三章stp和rstp\">#</a> 第三章【STP 和 RSTP】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，为了避免网络中的环路问题，需要在网络中的交换机上配置 STP。本实验中，你还需要通过修改桥优先级来控制 STP 的根桥选举，并通过配置 STP 的一些特性来加快 STP 的收敛速度。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/25/6qO6hV.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，配置 STP 并验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 为了保证实验结果的准确性，必须先关闭无关的端口。确保设备以空配置启动，如果 STP 被禁用，则执行 stp enable 命令启用 STP。</li>\n<li>[2] 本实验中，S1 和 S2 之间有两条链路，在 S1 和 S2 上启用 STP，并把 S1 配置为根桥。</li>\n<li>[S1]stp mode stp</li>\n<li>Info: This operation may take a few seconds. Please wait for a moment...done.</li>\n<li>[S1]stp root primary</li>\n<li>[S2]stp mode stp</li>\n<li>Info: This operation may take a few seconds. Please wait for a moment...done.</li>\n<li>[S2]stp root secondary</li>\n<li>[3] 执行<span class=\"green\"> display stp brief</span> 命令查看 STP 信息。</li>\n<li>[S1]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               DESI  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               DESI  FORWARDING      NONE</li>\n<li>[S1]</li>\n<li>[S2]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ROOT  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               ALTE  DISCARDING      NONE</li>\n<li>[S2]</li>\n<li>[4] 执行<span class=\"green\"> display stp interface</span> 命令查看端口的 STP 状态。</li>\n<li>[S1]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :0    .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 0(root)</li>\n<li>CIST RegRoot/IRPC   :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>[S2]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 200000</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n</ul>\n<p class=\"red\">3，控制根桥的选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行 display stp 命令查看根桥信息，根桥设备的 CIST Bridge 与 CIST Root/ERPC 字段取值相同。</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :0    .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RegRoot/IRPC   :0    .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>CIST Root Type      :Primary root</li>\n<li>[S2]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :0    .4c1f-ccc2-5dc2 / 200000</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>CIST Root Type      :Secondary root</li>\n<li>[2] 通过配置优先级，使 S2 为根桥，S1 为备份桥，桥优先级取值越小，则优先级越高，把 S1 和 S2 的优先级分别设置为 8192 和 4096。</li>\n<li>[S1]undo stp root</li>\n<li>[S1]stp priority 8192</li>\n<li>[S2]undo stp root</li>\n<li>[S2]stp priority 4096</li>\n<li>[3] 执行 display stp 命令查看新的根桥信息。</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[S2]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc51-34f0</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 0(root)</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc51-34f0 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[4] 由上述回显消息中可以看出，S2 已经变成新的根桥。关闭 S2 的 E0/0/1 和 E0/0/2 端口，从而隔离 S1 与 S2，模拟 S2\t发生故障。</li>\n<li>[S2]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]shutdown</li>\n<li>[S2-Ethernet0/0/1]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]shutdown</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-ccc2-5dc2</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc51-34f0 / 200000(root)</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-ccc2-5dc2 / 0</li>\n<li>CIST RootPortId     :128.2</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[5] 在上述回显消息中，表明当 S2 故障时，S1 变成了根桥，然后开启 S2 之前关闭的接口。</li>\n<li>[S2-Ethernet0/0/2]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]undo shutdown</li>\n<li>[S2-Ethernet0/0/1]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]undo shutdown</li>\n<li>[S1]dis stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-cc56-4734</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-cc56-4734 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>&lt;S2&gt;display stp</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc0b-8089</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[6] 在上述\t回显信息中，表明 S2 已经恢复正常，重新变成根桥。</li>\n</ul>\n<p class=\"red\">4，控制根端口选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在 S1 上执行 display stp brief 命令查看端口角色。</li>\n<li>[S1]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ROOT  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               ALTE  DISCARDING      NONE</li>\n<li>[2] 上述回显信息表明 E0/0/1 是根端口，E0/0/2 是 Alternate 端口，通过修改端口优先级，使 E0/0/2 成为根端口，E0/0/1 成为 Alternate。</li>\n<li>[3] 修改 S2 上 E0/0/1 和 E0/0/2 端口的优先级，缺省情况下端口优先级为 128。端口优先级取值越大，则优先级越低，在 S2 上，修改 E0/0/1 的端口优先级值为 32，E0/0/2 的端口优先级值为 16，因此，S1 上的 E0/0/2 端口的优先级取值大于 S2 的 E0/0/2 端口优先级，成为根端口。</li>\n<li>[S2]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]stp port priority 32</li>\n<li>[S2-Ethernet0/0/1]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]stp port priority 16</li>\n<li><ins class=\"wavy\">提示：此处是修改 S2 的端口优先级，而不是修改 S1 的端口优先级。</ins></li>\n<li>[S2-Ethernet0/0/2]display stp interface e0/0/1</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc0b-8089</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>Port Priority       :32</li>\n<li>[S2-Ethernet0/0/2]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :4096 .4c1f-cc0b-8089</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RegRoot/IRPC   :4096 .4c1f-cc0b-8089 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>Port Priority       :16</li>\n<li>[4] 在 S1 上执行 display stp brief 命令查看端口角色。</li>\n<li>&lt;S1&gt;display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ALTE  DISCARDING      NONE</li>\n<li>0    Ethernet0/0/2               ROOT  FORWARDING      NONE</li>\n<li>[5] 在上述回显信息中，表明 S1 的 E0/0/2 端口是根端口，E0/0/1 是 Alternate 端口。关闭 S1 的 E0/0/2 端口，再查看端口角色。</li>\n<li>[S1]int e0/0/2</li>\n<li>[S1-Ethernet0/0/2]shutdown</li>\n<li>[S1-Ethernet0/0/2]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ROOT  FORWARDING      NONE</li>\n<li>[6] 在上述回显消息中可以看出，S1 的 E0/0/1 变成了根端口，在 S2 上恢复 E0/0/1 和 E0/0/2 端口的缺省优先级，并重新开启 S1 上关闭的端口。</li>\n<li>[S2-Ethernet0/0/1]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]undo stp port priority</li>\n<li>[S2]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]undo stp port priority</li>\n<li>[S1-Ethernet0/0/2]int e0/0/2</li>\n<li>[S1-Ethernet0/0/2]undo shutdown</li>\n<li>[7] 在 S1 上执行 display stp brief 命令和 display stp interface 命令查看端口角色。</li>\n<li>[S1-Ethernet0/0/2]display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ROOT  FORWARDING      NONE</li>\n<li>0    Ethernet0/0/2               ALTE  DISCARDING      NONE</li>\n<li>[S1]display stp interface e0/0/1</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-cc56-4734</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-cc56-4734 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[S1]display stp interface e0/0/2</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-cc56-4734</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-cc56-4734 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[8] 在上述回显信息中\t，表明 E0/0/1 和 E0/0/2 的端口开销缺省情况下为 20000。修改 S1 上的 E0/0/1 端口开销值为 200000。</li>\n<li>[S1-Ethernet0/0/1]display stp interface e0/0/1</li>\n<li>-------(CIST Global Info)[Mode STP]-------</li>\n<li>CIST Bridge         :8192 .4c1f-cc56-4734</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :4096 .4c1f-cc0b-8089 / 200000</li>\n<li>CIST RegRoot/IRPC   :8192 .4c1f-cc56-4734 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>Port Cost(Dot1T )   :Config=200000 / Active=200000</li>\n<li>&lt;S1&gt;display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/1               ALTE  DISCARDING      NONE</li>\n<li>0    Ethernet0/0/2               ROOT  FORWARDING      NONE</li>\n<li>[9] 此时，S1 的 E0/0/2 端口变为根端口。</li>\n<li>[10] 配置文件。</li>\n<li>&lt;S1&gt;display current-configuration</li>\n<li>sysname S1</li>\n<li>stp mode stp</li>\n<li>stp instance 0 priority 8192</li>\n<li>cluster enable</li>\n<li>ntdp enable</li>\n<li>ndp enable</li>\n<li>&lt;S2&gt;display current-configuration</li>\n<li>sysname S2</li>\n<li>stp mode stp</li>\n<li>stp instance 0 priority 4096</li>\n<li>cluster enable</li>\n<li>ntdp enable</li>\n<li>ndp enable</li>\n</ul>\n<p class=\"red\">5，配置 RSTP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>公司的网络使用了两层网络结构，核心层和接入层，并采用了冗余设计，你是公司的网络管理员，需要通过使用 RSTP 来避免网络中产生二层环路问题，在本实验中，还将通过配置 RSTP 的一些特性来加快 RSTP 收敛速度，并配置相关保护功能。</li>\n</ul>\n</div></details>\n<p class=\"red\">7，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/25/6LuMjg.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">8，实验环境准备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 为了保证实验的准确性，必须先关闭无关的端口，确保设备空配置启动，如果 STP 被禁用，则需执行 stp enable 命令启动 STP。</li>\n</ul>\n<p class=\"red\">9，清除设备上已有的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 清除 S1 配置的 STP 优先级和开销，清除 S2 上配置的 STP 优先级。</li>\n<li>[S1]undo stp priority</li>\n<li>[S1]int e0/0/1</li>\n<li>[S1-Ethernet0/0/1]undo stp cost</li>\n<li>[S2]undo stp priority</li>\n</ul>\n<p class=\"red\">10，配置 RSTP 并验证 RSTP 配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行<span class=\"green\"> stp mode rstp</span>\t命令配置 S1 和 S2 的 STP 模式为 RSTP。</li>\n<li>[S1]stp mode rstp</li>\n<li>[S2]stp mode rstp</li>\n<li>[2] 执行 display stp 命令查看 RSTP 的简要信息。</li>\n<li>[S1]display stp</li>\n<li>-------(CIST Global Info)[Mode RSTP]-------</li>\n<li>CIST Bridge         :32768.4c1f-cc01-7f49</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :32768.4c1f-cc01-7f49 / 0</li>\n<li>CIST RegRoot/IRPC   :32768.4c1f-cc01-7f49 / 0</li>\n<li>CIST RootPortId     :0.0</li>\n<li>BPDU-Protection     :Disabled</li>\n<li>[S2]display stp</li>\n<li>-------(CIST Global Info)[Mode RSTP]-------</li>\n<li>CIST Bridge         :32768.4c1f-ccb2-1996</li>\n<li>Config Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>Active Times        :Hello 2s MaxAge 20s FwDly 15s MaxHop 20</li>\n<li>CIST Root/ERPC      :32768.4c1f-cc01-7f49 / 200000</li>\n<li>CIST RegRoot/IRPC   :32768.4c1f-ccb2-1996 / 0</li>\n<li>CIST RootPortId     :128.1</li>\n<li>BPDU-Protection     :Disabled</li>\n</ul>\n<p class=\"red\">11，配置边缘端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置连接用户终端的端口为边缘端口，边缘端口可以不通过 RSTP 计算直接由 Discarding 状态转变为 Forwarding 状态，在本列中，S1 和 S2 上的 E0/0/1 端口都连接的是一台路由器，可以配置为边缘端口，以加快 RSTP 收敛速度。</li>\n<li>[S1]int E0/0/1</li>\n<li>[S1-Ethernet0/0/1]undo shutdown</li>\n<li>[S1-Ethernet0/0/1]stp edged-port enable</li>\n<li>[S2]int E0/0/1</li>\n<li>[S2-Ethernet0/0/1]undo shu</li>\n<li>[S2-Ethernet0/0/1]stp edged-port enable</li>\n</ul>\n<p class=\"red\">12，配置 BPDU 保护功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 边缘端口直接与用户终端相连，正常情况下不会收到 BPDU 报文，但如果攻击者向交换机的边缘端口发送伪造的 BPDU 报文，交换机会自动将边缘端口设置为非边缘端口，并重新进行生成树计算，从而引起网络震荡，在交换机上配置 BPDU 保护功能，可以防止该类攻击。</li>\n<li>[2] 执行<span class=\"green\"> stp bpdu-protection</span> 命令，在 S1 和 S2 上配置 BPDU 保护功能。</li>\n<li>[S1]stp bpdu-protection</li>\n<li>[S2]stp bpdu-protection</li>\n<li>[3] 执行<span class=\"green\"> display stp brief</span> 命令查看端口上配置的保护功能。</li>\n<li>&lt;S1&gt;display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/2               DESI  FORWARDING      BPDU</li>\n<li>&lt;S2&gt;display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/2               ROOT  FORWARDING      BPDU</li>\n<li>[3] 配置完成后，从上述回显的信息可以看出，S1 和 S2 上的 E0/0/1 端口已经配置 BPDU 保护功能。</li>\n</ul>\n<p class=\"red\">13，配置环路保护功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在运行 RSTP 协议的网络中，交换机依靠不断接受来自上游设备的 BPDU 报文维持根端口和 Alternate 端口状态，如果由于链路拥塞或者单项链路故障导致交换机收不到来自上游设备的 BPDU 报文，交换机会重新选择根端口，原先的根端口会转变为指定端口，而原先的阻塞端口会迁移到转发状态，从而会引起网络环路，可以在交换机上配置环路保护功能，避免此种情况发生。</li>\n<li>[2] 分别在根端口和 Alternate 端口上配置环路保护功能。</li>\n<li>[S2-Ethernet0/0/1]int e0/0/1</li>\n<li>[S2-Ethernet0/0/1]stp loop-protection</li>\n<li>[S2-Ethernet0/0/1]int e0/0/2</li>\n<li>[S2-Ethernet0/0/2]stp loop-protection</li>\n<li>[3] 执行<span class=\"green\"> display stp brief</span> 命令查看端口上配置的保护功能。</li>\n<li>&lt;S2&gt;display stp brief</li>\n<li>MSTID  Port                        Role  STP State     Protection</li>\n<li>0    Ethernet0/0/2               ROOT  FORWARDING      LOOP</li>\n<li>[4] 因为 S1 是根桥，S1 上的所有端口都是指定端口，无需配置环路保护功能，配置完成后，如果你把 S2 配置为根桥，可以使用相同的步骤在 S1 的根端口和 Alternate 端口上配置环路保护功能。</li>\n</ul>\n<h1 id=\"第四章路由配置\"><a class=\"anchor\" href=\"#第四章路由配置\">#</a> 第四章【路由配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，现在公司有一个总部与两个分支机构，其中 R1 为总部路由器，R2，R3 为分支机构，总部与分支机构间通过以太网实现互联，且当前公司网络中没有配置任何路由协议。</li>\n<li>由于网络的规模比较小，你可以配置通过静态路由和缺省路由来实现网络互通，IP 编址信息如拓扑图所示。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/25/6OzeL8.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，基础配置和 IP 编址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在 R1，R2 和 R3 上配置名称和 IP 地址。</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R1</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]ip address 10.0.13.1 24</li>\n<li>[R1-GigabitEthernet0/0/0]quit</li>\n<li>[R1]int g0/0/1</li>\n<li>[R1-GigabitEthernet0/0/1]ip address 10.0.12.1 24</li>\n<li>[R1-GigabitEthernet0/0/1]quit</li>\n<li>[R1]int LoopBack 0</li>\n<li>[R1-LoopBack0]ip address 10.0.1.1 24</li>\n<li>[2] 执行<span class=\"green\"> display current-configuration</span> 命令，查看配置情况。</li>\n<li>[R1]display ip interface brief</li>\n<li>Interface                         IP Address/Mask      Physical   Protocol</li>\n<li>GigabitEthernet0/0/0              10.0.13.1/24         up         up</li>\n<li>GigabitEthernet0/0/1              10.0.12.1/24         up         up</li>\n<li>LoopBack0                         10.0.1.1/24          up         up(s)</li>\n<li>NULL0                             unassigned           up         up(s)</li>\n<li>&lt;Huawei&gt;system-view</li>\n<li>[Huawei]sysname R2</li>\n<li>[R2]int g0/0/1</li>\n<li>[R2-GigabitEthernet0/0/1]ip address 10.0.12.2 24</li>\n<li>[R2]int g0/0/0</li>\n<li>[R2-GigabitEthernet0/0/0]ip address 10.0.23.2 24</li>\n<li>[R2]int LoopBack 0</li>\n<li>[R2-LoopBack0]ip address 10.0.2.2 24</li>\n<li>[R2]display ip interface brief</li>\n<li>Interface                         IP Address/Mask      Physical   Protocol</li>\n<li>GigabitEthernet0/0/0              10.0.23.2/24         up         up</li>\n<li>GigabitEthernet0/0/1              10.0.12.2/24         up         up</li>\n<li>LoopBack0                         10.0.2.2/24          up         up(s)</li>\n<li>NULL0                             unassigned           up         up(s)</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R3</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]ip address 10.0.13.3 24</li>\n<li>[R3]int g0/0/1</li>\n<li>[R3-GigabitEthernet0/0/1]ip address 10.0.23.3 24</li>\n<li>[R3]int LoopBack 0</li>\n<li>[R3-LoopBack0]ip address 10.0.3.3 24</li>\n<li>[R3]display ip interface brief</li>\n<li>Interface                         IP Address/Mask      Physical   Protocol</li>\n<li>GigabitEthernet0/0/0              10.0.13.3/24         up         up</li>\n<li>GigabitEthernet0/0/1              10.0.23.3/24         up         up</li>\n<li>LoopBack0                         10.0.3.3/24          up         up(s)</li>\n<li>NULL0                             unassigned           up         up(s)</li>\n<li>[3] 执行 Ping 命令，检测 R1 与其他设备间的连通性。</li>\n<li>&lt;R1&gt;ping 10.0.12.2</li>\n<li>PING 10.0.12.2: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.12.2: bytes=56 Sequence=1 ttl=255 time=110 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=2 ttl=255 time=10 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=3 ttl=255 time=20 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=4 ttl=255 time=20 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=5 ttl=255 time=10 ms</li>\n<li>--- 10.0.12.2 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 10/34/110 ms</li>\n<li>&lt;R1&gt;ping 10.0.13.3</li>\n<li>PING 10.0.13.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.13.3: bytes=56 Sequence=1 ttl=255 time=90 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=2 ttl=255 time=20 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=3 ttl=255 time=10 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=4 ttl=255 time=10 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=5 ttl=255 time=10 ms</li>\n<li>--- 10.0.13.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 10/28/90 ms</li>\n<li>[4] 执行 Ping 命令，检测 R2 与其他设备间的连通性。</li>\n<li>&lt;R2&gt;ping 10.0.23.3</li>\n<li>PING 10.0.23.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.23.3: bytes=56 Sequence=1 ttl=255 time=40 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=2 ttl=255 time=30 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=3 ttl=255 time=30 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=4 ttl=255 time=20 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=5 ttl=255 time=30 ms</li>\n<li>--- 10.0.23.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 20/30/40 ms</li>\n</ul>\n<p class=\"red\">2，测试 R2 到目的网络 10.0.13.0/24，10.0.3.0/24 的连通性。</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 执行 Ping 操作。</p>\n</li>\n<li>\n<p>&lt;R2&gt;ping 10.0.13.3</p>\n</li>\n<li>\n<p>PING 10.0.13.3: 56  data bytes, press CTRL_C to break<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out</p>\n</li>\n<li>\n<p>--- 10.0.13.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n0 packet(s) received<br>\n100.00% packet loss</p>\n</li>\n<li>\n<p>&lt;R2&gt;ping 10.0.3.3</p>\n</li>\n<li>\n<p>PING 10.0.3.3: 56  data bytes, press CTRL_C to break<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out</p>\n</li>\n<li>\n<p>--- 10.0.3.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n0 packet(s) received<br>\n100.00% packet loss</p>\n</li>\n<li>\n<p>[2] R2 如果要与 10.0.3.0/24 网络通信，需要 R2 上有去往该网段的路由信息，并且 R3 上也需要有到 R2 相应接口所在 IP 网段的路由信息。</p>\n</li>\n<li>\n<p>[3] 上述检测结果表明，R2 不能与 10.0.3.3 和 10.0.13.3 网络通信。</p>\n</li>\n<li>\n<p>[4] 执行<span class=\"green\"> display ip routing-table</span> 命令，查看 R2 的路由表，可以发现路由表中没有到这两个网段的路由信息。</p>\n</li>\n<li>\n<p>&lt;R2&gt;display ip routing-table</p>\n</li>\n<li>\n<p>Route Flags: R - relay, D - download to fib</p>\n</li>\n<li>\n<p>Routing Tables: Public<br>\nDestinations : 13       Routes : 13</p>\n</li>\n<li>\n<p>Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface</p>\n<pre><code> 10.0.2.0/24  Direct  0    0           D   10.0.2.2        LoopBack0\n 10.0.2.2/32  Direct  0    0           D   127.0.0.1       LoopBack0\n</code></pre>\n<p>10.0.2.255/32  Direct  0    0           D   127.0.0.1       LoopBack0<br>\n10.0.12.0/24  Direct  0    0           D   10.0.12.2       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/1<br>\n10.0.12.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/1<br>\n10.0.12.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/1<br>\n10.0.23.0/24  Direct  0    0           D   10.0.23.2       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/0<br>\n10.0.23.2/32  Direct  0    0           D   127.0.0.1       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/0<br>\n10.0.23.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet</p>\n</li>\n<li>\n<p>0/0/0<br>\n127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0<br>\n127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0</p>\n</li>\n<li>\n<p>127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0</p>\n</li>\n<li>\n<p>255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0</p>\n</li>\n</ul>\n<p class=\"red\">3，在 R2 上配置静态路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 配置目的地址为 10.0.13.0/24 和 10.0.3.0/24 的静态路由，路由的下一跳配置为 R3 的 G0/0/1 接口 IP 地址 10.0.23.3。默认静态路由优先级为 60，无需额外配置路由优先级信息。</li>\n<li>[R2]ip route-static 10.0.13.0 24 10.0.23.3</li>\n<li>[R2]ip route-static 10.0.3.0 24 10.0.23.3</li>\n<li><ins class=\"wavy\">注意：在<span class=\"green\"> ip route-static</span> 命令中，24 代表子网掩码长度，也可以写成完整的掩码形式如：255.255.255.0。</ins></li>\n<li>[R2]display ip routing-table</li>\n<li>10.0.3.0/24  Static  60   0          RD   10.0.23.3       GigabitEthernet</li>\n<li>0/0/0</li>\n<li>10.0.13.0/24  Static  60   0          RD   10.0.23.3       GigabitEthernet</li>\n<li>0/0/0</li>\n</ul>\n<p class=\"red\">4，配置备份静态路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] R2 与网络 10.0.13.3 和 10.0.3.3 之间交互的数据通过 R2 与 R3 间的链路传输，如果 R2 和 R3 间的链路发生故障，R2 将不能与网络 10.0.13.3 和 10.0.3.3 通信。</li>\n<li>[2] 但是根据拓扑图可以看出，当 R2 和 R3 间的链路发生故障时，R2 还可以通过 R1 与 R3 通信，所以可以通过配置一条备份静态路由实现路由的冗余备份，正常情况下，备份静态路由不生效，当 R2 和 R3 间的链路发生故障时，才使用备份静态路由传输数据。</li>\n<li>[3] 配置备份静态路由时，需要修改备份静态路由的优先级，确保只有主链路故障时才使用备份路由，本任务中，需要将备份静态路由的优先级修改为 80\t。</li>\n<li>[R1]ip route-static 10.0.3.0 24 10.0.13.3</li>\n<li>[R2]ip route-static 10.0.13.0 255.255.255.0 10.0.12.1 preference 80</li>\n<li>[R2]ip route-static 10.0.3.0 24 10.0.12.1 preference 80</li>\n<li>[R3]ip route-static 10.0.12.0 24 10.0.13.1</li>\n</ul>\n<p class=\"red\">5，验证静态路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在 R2 的路由表中，查看当前的静态路由配置。</li>\n<li>[R2]display ip routing-table</li>\n<li>10.0.3.0/24  Static  60   0          RD   10.0.23.3       GigabitEthernet</li>\n<li>0/0/0</li>\n<li>10.0.13.0/24  Static  60   0          RD   10.0.23.3       GigabitEthernet</li>\n<li>0/0/0</li>\n<li>[2] 路由表中包含 1 两条静态路由，其中 Protocol 字段的值是 Static，表明该路由是静态路由，Preference 字段的值是 60，表明该路由使用的是默认优先级。</li>\n<li>[3] 当 R2 和 R3 之间的链路正常时，R2 与网络 10.0.13.3 和 10.0.3.3 之间交互的数据通过 R2 与 R3 间的链路传输，执行 tracert 命令，可以查看数据的传输路径。</li>\n<li>&lt;R2&gt;tracert 10.0.13.3</li>\n<li>traceroute to  10.0.13.3(10.0.13.3), max hops: 30 ,packet length: 40,press CTRL</li>\n<li>_C to break</li>\n<li>1 10.0.23.3 30 ms  20 ms  20 ms</li>\n<li>&lt;R2&gt;tracert 10.0.3.3</li>\n<li>traceroute to  10.0.3.3(10.0.3.3), max hops: 30 ,packet length: 40,press CTRL_C</li>\n<li>to break</li>\n<li>1 10.0.23.3 30 ms  20 ms  20 ms</li>\n<li>[4] 命令的回显信息证实 R2 将数据直接发送给 R3，未经过其他设备。</li>\n</ul>\n<p class=\"red\">6，验证备份静态路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 关闭 R2 上的 G0/0/0 接口，模拟 R2 与 R3 间的链路发生故障，然后查看 IP 路由表的变化。</li>\n<li>[R2]int G0/0/0</li>\n<li>[R2-GigabitEthernet0/0/0]shutdown</li>\n<li><ins class=\"wavy\">注意与关闭接口之前的路由表情况做对比。</ins></li>\n<li>[R2]display ip routing-table</li>\n<li>10.0.3.0/24  Static  80   0          RD   10.0.12.1       GigabitEthernet</li>\n<li>0/0/1</li>\n<li>10.0.13.0/24  Static  80   0          RD   10.0.12.1       GigabitEthernet</li>\n<li>0/0/1</li>\n<li>[2] 在 R2 的路由表中，上面两条信息标记了两条路由的下一跳和优先级均已发生变化。</li>\n<li>[3] 检测 R2 到目的地址 10.0.13.3 以及 R3 上的 10.0.3.3 的连通性。</li>\n<li>[R2]ping 10.0.3.3</li>\n<li>PING 10.0.3.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.3.3: bytes=56 Sequence=1 ttl=254 time=60 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=2 ttl=254 time=20 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=3 ttl=254 time=20 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=4 ttl=254 time=20 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=5 ttl=254 time=40 ms</li>\n<li>--- 10.0.3.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 20/32/60 ms</li>\n<li>[R2]ping 10.0.13.3</li>\n<li>PING 10.0.13.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.13.3: bytes=56 Sequence=1 ttl=254 time=20 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=2 ttl=254 time=20 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=3 ttl=254 time=20 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=4 ttl=254 time=30 ms<br>\nReply from 10.0.13.3: bytes=56 Sequence=5 ttl=254 time=30 ms</li>\n<li>--- 10.0.13.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 20/24/30 ms</li>\n<li>[4] 网络并未因为 R2 与 R3 之间的链路被关闭而中断。</li>\n<li>[5] 执行 tracert 命令，查看数据包的转发路径。</li>\n<li>[R2]tracert 10.0.13.3</li>\n<li>traceroute to  10.0.13.3(10.0.13.3), max hops: 30 ,packet length: 40,press CTRL</li>\n<li>_C to break</li>\n<li>1 10.0.12.1 30 ms  20 ms  20 ms</li>\n<li>2 10.0.13.3 30 ms  20 ms  30 ms</li>\n<li>[R2]tracert 10.0.3.3</li>\n<li>traceroute to  10.0.3.3(10.0.3.3), max hops: 30 ,packet length: 40,press CTRL_C</li>\n<li>to break</li>\n<li>1 10.0.12.1 30 ms  20 ms  20 ms</li>\n<li>2 10.0.13.3 30 ms  20 ms  30 ms</li>\n<li>[6] 命令的回显信息表明，R2 发送的数据经过 R1 抵达 R3 设备。</li>\n</ul>\n<p class=\"red\">7，配置缺省路由实现网络的互通：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 打开 R2 上在上面命令中关闭的接口。</li>\n<li>[R2]int g0/0/0</li>\n<li>[R2-GigabitEthernet0/0/0]undo shutdown</li>\n<li>[2] 验证从 R1 到 10.0.23.3 网络的连通性。</li>\n<li>&lt;R1&gt;ping 10.0.23.3</li>\n<li>PING 10.0.23.3: 56  data bytes, press CTRL_C to break<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out<br>\nRequest time out</li>\n<li>--- 10.0.23.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n0 packet(s) received<br>\n100.00% packet loss</li>\n<li>[3] 因为 R1 上没有去往 10.0.23.0 网段的路由信息，所以报文无法达到 R3。</li>\n<li>&lt;R1&gt;display ip routing-table</li>\n<li>[4] 可以在 R1 上配置一条下一跳为 10.0.13.3 的缺省路由来实现网络的连通。</li>\n<li>[R1]ip route-static 0.0.0.0 0.0.0.0 10.0.13.3</li>\n<li>[5] 配置完成后，检测 R1 和 10.0.23.3 网络间的连通性。</li>\n<li>[R1]ping 10.0.23.3</li>\n<li>PING 10.0.23.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.23.3: bytes=56 Sequence=1 ttl=255 time=20 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=2 ttl=255 time=20 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=3 ttl=255 time=30 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=4 ttl=255 time=20 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=5 ttl=255 time=20 ms</li>\n<li>--- 10.0.23.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 20/22/30 ms</li>\n<li>[6] R1 通过缺省路由实现了与网段 10.0.23.0 间的通信。</li>\n</ul>\n<p class=\"red\">8，配置备份缺省路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 当 R1 与 R3 间的链路发生故障时，R1 可以使用备份缺省路由通过 R2 实现与 10.0.23.3 和 10.0.3.3 网络间通信。</li>\n<li>[2] 配置两条备份路由，确保数据来回的双向都有路由。</li>\n<li>[R1]ip route-static 0.0.0.0 0.0.0.0 10.0.12.2 preference 80</li>\n<li>[R3]ip route-static 10.0.12.0 24 10.0.23.2 preference 80</li>\n</ul>\n<p class=\"red\">9，验证备份缺省路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 查看链路正常时 R1 上的路由条目。</li>\n<li>[R1]display ip routing-table</li>\n<li>\n<pre><code>    0.0.0.0/0   Static  60   0          RD   10.0.13.3       GigabitEthernet0/0/0\n</code></pre>\n</li>\n<li>[2] 关闭 R1 与 R3 上的 G0/0/0 接口，模拟链路故障，然后查看 R1 的路由表，比较关闭接口前后的路由表变化情况。</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]shutdown</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]shutdown</li>\n<li>[R1]display ip routing-table</li>\n<li>0.0.0.0/0   Static  80   0          RD   10.0.12.2       GigabitEthernet0/0/1</li>\n<li>[3] 上述路由表中，缺省路由 0.0.0.0 的 Preference 值为 80，表明备用的缺省路由已生效。</li>\n<li>[R1]ping 10.0.23.3</li>\n<li>PING 10.0.23.3: 56  data bytes, press CTRL_C to break<br>\nRequest time out<br>\nReply from 10.0.23.3: bytes=56 Sequence=2 ttl=254 time=30 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=3 ttl=254 time=30 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=4 ttl=254 time=40 ms<br>\nReply from 10.0.23.3: bytes=56 Sequence=5 ttl=254 time=30 ms</li>\n<li>--- 10.0.23.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n4 packet(s) received<br>\n20.00% packet loss<br>\nround-trip min/avg/max = 30/32/40 ms</li>\n<li>[4] 网络并未因为 R1 与 R3 之间的链路被关闭而中断，执行 tracert 命令，查看数据包得到转发路径。</li>\n<li>[R1]tracert 10.0.23.3</li>\n<li>traceroute to  10.0.23.3(10.0.23.3), max hops: 30 ,packet length: 40,press CTRL_C to break</li>\n<li>1 10.0.12.2 50 ms  20 ms  20 ms</li>\n<li>2 10.0.23.3 30 ms  20 ms  20 ms</li>\n<li>[5] 结果显示报文通过 R2 (10.0.12.2) 到达 R3 (10.0.23.3)。</li>\n</ul>\n<p class=\"red\">10，OSPF 单区域配置：</p>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，现在公司网络中需要使用 OSPF 协议来进行路由信息的传递，规划网络中所有路由器属于 OSPF 的区域 0，实际使用中需要向 OSPF 发布默认路由，此外你也希望通过此次部署了解 DR/BDR 选举的机制。</li>\n</ul>\n</div></details>\n<p class=\"red\">11，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/26/6X4CtS.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">12，实验环境准备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 基本配置以及 IP 编址</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R1</li>\n<li>[R1]int g0/0/1</li>\n<li>[R1-GigabitEthernet0/0/1]ip address 10.0.12.1 24</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]ip address 10.0.13.1 24</li>\n<li>[R1]interface LoopBack 0</li>\n<li>[R1-LoopBack0]ip address 10.0.1.1 24</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R2</li>\n<li>[R2]int g0/0/1</li>\n<li>[R2-GigabitEthernet0/0/1]ip address 10.0.12.2 24</li>\n<li>[R2]int LoopBack 0</li>\n<li>[R2-LoopBack0]ip address 10.0.2.2 24</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R3</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]ip address 10.0.13.3 24</li>\n<li>[R3]int LoopBack 0</li>\n<li>[R3-LoopBack0]ip address 10.0.3.3 24</li>\n<li>[R3]int LoopBack 2</li>\n<li>[R3-LoopBack2]ip address 172.16.0.1 24</li>\n</ul>\n<p class=\"red\">13，配置 OSPF：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 将 R1 的 Router ID 配置为 10.0.1.1 (逻辑接口 LoopBack 0 的地址)，开启 OSPF 进程 1 (缺省进程)，并将网段 10.0.1.0/24，10.0.12.0/24 和 10.0.13.0/24 发布到 OSPF 区域 0。</li>\n<li>[R1]ospf 1 router-id 10.0.1.1</li>\n<li>[R1-ospf-1]area 0</li>\n<li>[R1-ospf-1-area-0.0.0.0]network 10.0.1.1 0.0.0.255</li>\n<li>[R1-ospf-1-area-0.0.0.0]network 10.0.13.1 0.0.0.255</li>\n<li>[R1-ospf-1-area-0.0.0.0]network 10.0.12.1 0.0.0.255</li>\n<li>[2] 注意：同一路由器可以开启多个 OSPF 进程，默认进程号为 1，由于进程号只具有本地意义，所以同一路由域的不同路由器可以使用相同或不同的 OSPF 进程号，另外 network 命令后面需要使用反掩码。</li>\n<li>[3] 将 R2 的 Router ID 配置为 10.0.2.2，开启 OSPF 进程 1，并将网段 10.0.12.0/24 和 10.0.2.0/24 发布到 OSPF 区域 0。</li>\n<li>[R2]ospf 1 router-id 10.0.2.2</li>\n<li>[R2-ospf-1]area 0</li>\n<li>[R2-ospf-1-area-0.0.0.0]network 10.0.2.0 0.0.0.255</li>\n<li>[R2-ospf-1-area-0.0.0.0]network 10.0.12.0 0.0.0.255</li>\n<li>[4] 当回显信息中包含 “NeighborCurrentState=Full” 消息时，表明邻接关系已经建立。</li>\n<li>[5] 将 R3 的 Router ID 配置为 10.0.3.3，开启 OSPF 进程 1，并将网段 10.0.3.0/24 和 10.0.13.0/24 发布到 OSPF 区域 0。</li>\n<li>[R3]ospf 1 router-id 10.0.3.3</li>\n<li>[R3-ospf-1]area 0</li>\n<li>[R3-ospf-1-area-0.0.0.0]network 10.0.3.0 0.0.0.255</li>\n<li>[R3-ospf-1-area-0.0.0.0]network 10.0.13.0 0.0.0.255</li>\n</ul>\n<p class=\"red\">14，验证 OSPF 配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 待 OSPF 收敛完成后，查看 R1，R2 和 R3 上的路由表。</li>\n<li>&lt;R1&gt;display ip routing-table</li>\n<li>10.0.2.2/32  OSPF    10   1           D   10.0.12.2       GigabitEthernet0/0/1</li>\n<li>10.0.3.3/32  OSPF    10   1           D   10.0.13.3       GigabitEthernet0/0/0</li>\n<li>&lt;R2&gt;display ip routing-table</li>\n<li>10.0.1.1/32  OSPF    10   1           D   10.0.12.1       GigabitEthernet0/0/1</li>\n<li>10.0.3.3/32  OSPF    10   2           D   10.0.12.1       GigabitEthernet0/0/1</li>\n<li>10.0.13.0/24  OSPF    10   2           D   10.0.12.1       GigabitEthernet0/0/1</li>\n<li>&lt;R3&gt;display ip routing-table</li>\n<li>10.0.1.1/32  OSPF    10   1           D   10.0.13.1       GigabitEthernet0/0/0</li>\n<li>10.0.2.2/32  OSPF    10   2           D   10.0.13.1       GigabitEthernet0/0/0</li>\n<li>10.0.12.0/24  OSPF    10   2           D   10.0.13.1       GigabitEthernet0/0/0</li>\n<li>[2] 检测 R2 和 R1 (10.0.1.1) 以及 R2 和 R3 (10.0.3.3) 间的连通性。</li>\n<li>&lt;R2&gt;ping 10.0.1.1</li>\n<li>PING 10.0.1.1: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.1.1: bytes=56 Sequence=1 ttl=255 time=60 ms<br>\nReply from 10.0.1.1: bytes=56 Sequence=2 ttl=255 time=10 ms<br>\nReply from 10.0.1.1: bytes=56 Sequence=3 ttl=255 time=30 ms<br>\nReply from 10.0.1.1: bytes=56 Sequence=4 ttl=255 time=20 ms<br>\nReply from 10.0.1.1: bytes=56 Sequence=5 ttl=255 time=30 ms</li>\n<li>--- 10.0.1.1 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 10/30/60 ms</li>\n<li>&lt;R2&gt;ping 10.0.3.3</li>\n<li>PING 10.0.3.3: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.3.3: bytes=56 Sequence=1 ttl=254 time=60 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=2 ttl=254 time=20 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=3 ttl=254 time=30 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=4 ttl=254 time=30 ms<br>\nReply from 10.0.3.3: bytes=56 Sequence=5 ttl=254 time=20 ms</li>\n<li>--- 10.0.3.3 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 20/32/60 ms</li>\n<li>[3] 执行 display ospf peer 命令，查看 OSPF 邻居状态。</li>\n<li>&lt;R1&gt;display ospf peer</li>\n<li>Area 0.0.0.0 interface 10.0.12.1(GigabitEthernet0/0/1)'s neighbors</li>\n<li>Router ID: 10.0.2.2         Address: 10.0.12.2</li>\n<li>State: Full  Mode:Nbr is  Master  Priority: 1</li>\n<li>DR: 10.0.12.1  BDR: 10.0.12.2  MTU: 0</li>\n<li>Dead timer due in 31  sec</li>\n<li>Retrans timer interval: 5</li>\n<li>Neighbor is up for 00:13:56</li>\n<li>Authentication Sequence: [ 0 ]</li>\n<li>\n<pre><code>   Neighbors \n</code></pre>\n</li>\n<li>Area 0.0.0.0 interface 10.0.13.1(GigabitEthernet0/0/0)'s neighbors</li>\n<li>Router ID: 10.0.3.3         Address: 10.0.13.3</li>\n<li>State: Full  Mode:Nbr is  Master  Priority: 1</li>\n<li>DR: 10.0.13.1  BDR: 10.0.13.3  MTU: 0</li>\n<li>Dead timer due in 40  sec</li>\n<li>Retrans timer interval: 5</li>\n<li>Neighbor is up for 00:09:19</li>\n<li>Authentication Sequence: [ 0 ]</li>\n<li>[4] display ospf peer 命令显示所有 OSPF 邻居的详细信息，本任务中，在 10.0.13.0 网段上 R1 是 DR，由于 DR 选举是非抢占模式，如果 OSPF 进程不重启，R3 将不会取代 R1 的 DR 角色。</li>\n<li>[5] 执行 display ospf peer brief 命令，可以查看简要的 OSPF 邻居信息。</li>\n<li>&lt;R1&gt;display ospf peer brief</li>\n<li>OSPF Process 1 with Router ID 10.0.1.1<br>\nPeer Statistic Information<br>\nArea Id          Interface                        Neighbor id      State<br>\n0.0.0.0          GigabitEthernet0/0/1             10.0.2.2         Full<br>\n0.0.0.0          GigabitEthernet0/0/0             10.0.3.3         Full</li>\n</ul>\n<p class=\"red\">15，修改 OSPF hello 和 dead 时间参数：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在 R1 上执行 display ospf interface G0/0/0 命令，查看 OSPF 默认的 hello 和 dead 时间。</li>\n<li>&lt;R1&gt;display ospf interface g0/0/0</li>\n<li>OSPF Process 1 with Router ID 10.0.1.1<br>\nInterfaces</li>\n<li>Interface: 10.0.13.1 (GigabitEthernet0/0/0)</li>\n<li>Cost: 1       State: DR        Type: Broadcast    MTU: 1500</li>\n<li>Priority: 1</li>\n<li>Designated Router: 10.0.13.1</li>\n<li>Backup Designated Router: 10.0.13.3</li>\n<li>Timers: Hello 10 , Dead 40 , Poll  120 , Retransmit 5 , Transmit Delay 1</li>\n<li>[2] 在 R1 的 G0/0/0 接口执行 ospf timer 命令，将 OSPF hello 和 dead 时间分别修改为 15 秒的 60 秒。</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]ospf timer hello 15</li>\n<li>[R1-GigabitEthernet0/0/0]ospf timer dead 60</li>\n<li>[R1]display ospf interface g0/0/0</li>\n<li>Timers: Hello 15 , Dead 60 , Poll  120 , Retransmit 5 , Transmit Delay 1</li>\n<li>[3] 在 R1 上查看 OSPF 邻居状态。</li>\n<li>&lt;R1&gt;display ospf peer brief</li>\n<li>OSPF Process 1 with Router ID 10.0.1.1<br>\nPeer Statistic Information</li>\n<li>Area Id          Interface                        Neighbor id      State</li>\n<li>0.0.0.0          GigabitEthernet0/0/1             10.0.2.2         Full</li>\n<li>[4] 上述回显信息表明，R1 只有一个邻居，那就是 R2。因为 R1 和 R3 上的 OSPF hello 和 dead 时间取值不同。所以 R1 无法与 R3 建立 OSPF 邻居关系。</li>\n<li>[5] 在 R3 的 G0/0/0 接口执行 ospf timer 命令，将 OSPF hello 和 dead 时间分别修改为 15 秒和 60 秒。</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]ospf timer hello 15</li>\n<li>[R3-GigabitEthernet0/0/0]ospf timer dead 60</li>\n<li>[R3]display ospf interface g0/0/0</li>\n<li>Timers: Hello 15 , Dead 60 , Poll  120 , Retransmit 5 , Transmit Delay 1</li>\n<li>[6] 再次在 R1 上查看 OSPF 的邻居状态。</li>\n<li>&lt;R1&gt;display ospf peer brief</li>\n<li>Area Id          Interface                        Neighbor id      State</li>\n<li>0.0.0.0          GigabitEthernet0/0/1             10.0.2.2         Full</li>\n<li>0.0.0.0          GigabitEthernet0/0/0             10.0.3.3         Full</li>\n</ul>\n<p class=\"red\">16，OSPF 缺省路由发布及验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 在 R3 上配置缺省路由并发布到 OSPF 域内。</li>\n<li>[R3]ip route-static 0.0.0.0 0.0.0.0 LoopBack 2</li>\n<li>[R3]ospf 1</li>\n<li>[R3-ospf-1]default-route-advertise</li>\n<li>[2] 查看 R1 和 R2 的路由表，可以看到，R1 和 R2 均已经学习到了 R3 发布的缺省路由。</li>\n<li>&lt;R1&gt;display ip routing-table</li>\n<li>0.0.0.0/0   O_ASE   150  1           D   10.0.13.3       GigabitEthernet0/0/0</li>\n<li>&lt;R2&gt;display ip routing-table</li>\n<li>0.0.0.0/0   O_ASE   150  1           D   10.0.12.1       GigabitEthernet0/0/1</li>\n<li>&lt;R3&gt;display ip routing-table</li>\n<li>0.0.0.0/0   Static  60   0           D   172.16.0.1      LoopBack2</li>\n<li>[3] 使用 ping 命令，检测 R2 与 172.16.0.1/24 网段之间的连通性。</li>\n<li>&lt;R2&gt;ping 172.16.0.1</li>\n<li>PING 172.16.0.1: 56  data bytes, press CTRL_C to break<br>\nReply from 172.16.0.1: bytes=56 Sequence=1 ttl=254 time=40 ms<br>\nReply from 172.16.0.1: bytes=56 Sequence=2 ttl=254 time=30 ms<br>\nReply from 172.16.0.1: bytes=56 Sequence=3 ttl=254 time=30 ms<br>\nReply from 172.16.0.1: bytes=56 Sequence=4 ttl=254 time=40 ms<br>\nReply from 172.16.0.1: bytes=56 Sequence=5 ttl=254 time=30 ms</li>\n<li>--- 172.16.0.1 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 30/34/40 ms</li>\n</ul>\n<p class=\"red\">17，控制 OSPF DR/BDR 的选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 执行 display ospf peer 命令，查看 R1 和 R3 的 DR/BDR 角色。</li>\n<li>&lt;R1&gt;display ospf peer 10.0.3.3</li>\n<li>DR: 10.0.13.1  BDR: 10.0.13.3</li>\n<li>[2] 上述回显信息表明，由于默认 OSPF 路由器优先级 (数值为 1) 相同，但 R3 的 Router ID10.0.3.3 大于 R1 的 Router ID 10.0.1.1，所以 R3 为 DR，R1 为 BDR。</li>\n<li>[3] 执行 ospf dr-priority 命令，修改 R1 和 R3 的 DR 优先级。</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]ospf dr-priority 200</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]ospf dr-priority 100</li>\n<li>[4] 默认情况下，DR/BDR 的选举采用的是非抢占模式，路由器优先级修改后，不会自动重新选举 DR，因此，需要重置 R1 和 R3 间的 OSPF 邻居关系。</li>\n<li>[5] 先关闭然后再打开 R1 和 R3 上的 G0/0/0 接口。重置 R1 和 R3 间的 OSPF 邻居关系。</li>\n<li>[R3]int g0/0/0</li>\n<li>[R3-GigabitEthernet0/0/0]shutdown</li>\n<li>[R3-GigabitEthernet0/0/0]undo shutdown</li>\n<li>[R1]int g0/0/0</li>\n<li>[R1-GigabitEthernet0/0/0]shutdown</li>\n<li>[R1-GigabitEthernet0/0/0]undo shutdown</li>\n<li>[6] 执行 display ospf peer 命令，查看 R1 和 R3 的 DR/BDR 角色。</li>\n<li>[R1]display ospf peer 10.0.3.3</li>\n<li>DR: 10.0.13.1  BDR: 10.0.13.3</li>\n<li>[7] 上述信息表明，R1 的 DR 优先级高于 R3，因此 R1 被选举为 DR，而 R3 成为了 BDR。</li>\n</ul>\n<h1 id=\"第五章ftp和dhcp\"><a class=\"anchor\" href=\"#第五章ftp和dhcp\">#</a> 第五章【FTP 和 DHCP】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，需要在公司网络上配置 FTP 业务，你需要把一台路由器配置为 FTP 服务器，客户端可以通过 TCP 连接与 FTP 服务器之间传输文件。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/27/cSuESs.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，实验环境准备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 基本配置。</p>\n</li>\n<li>\n<p>&lt;Huawei&gt;sys</p>\n</li>\n<li>\n<p>[Huawei]sysname R1</p>\n</li>\n<li>\n<p>[R1]int g0/0/1</p>\n</li>\n<li>\n<p>[R1-GigabitEthernet0/0/1]ip address 10.0.12.1 24</p>\n</li>\n<li>\n<p>&lt;Huawei&gt;sys</p>\n</li>\n<li>\n<p>[R]sysname R2</p>\n</li>\n<li>\n<p>[R2]int g0/0/1</p>\n</li>\n<li>\n<p>[R2-GigabitEthernet0/0/1]ip address 10.0.12.2 24</p>\n</li>\n<li>\n<p>[2] 测试 R1 和 R2 之间的连通性。</p>\n</li>\n<li>\n<p>&lt;R1&gt;ping 10.0.12.2</p>\n</li>\n<li>\n<p>PING 10.0.12.2: 56  data bytes, press CTRL_C to break<br>\nReply from 10.0.12.2: bytes=56 Sequence=1 ttl=255 time=90 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=2 ttl=255 time=20 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=3 ttl=255 time=20 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=4 ttl=255 time=10 ms<br>\nReply from 10.0.12.2: bytes=56 Sequence=5 ttl=255 time=30 ms</p>\n</li>\n<li>\n<p>--- 10.0.12.2 ping statistics ---<br>\n5 packet(s) transmitted<br>\n5 packet(s) received<br>\n0.00% packet loss<br>\nround-trip min/avg/max = 10/34/90 ms</p>\n</li>\n</ul>\n<p class=\"red\">3，在路由器上启用 FTP 业务：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 默认情况下，路由器的 FTP 功能并未启用，使用 FTP 业务之前，必须先启用 FTP 功能，配置 R1 为 FTP 服务器，R2 为客户端。</li>\n<li>[R1]ftp server enable</li>\n<li>[R1]set default ftp-directory flash:/</li>\n<li>[2] 通过在 AAA 中设置用户名和密码，授权 FTP 合法用户连接到 FTP 服务器，这样，非法用户就无法连接 FTP 服务器，降低了安全风险。</li>\n<li>[R1]aaa</li>\n<li>[R1-aaa]local-user huawei password cipher huawei123</li>\n<li>Info: Add a new user.</li>\n<li>[R1-aaa]local-user huawei service-type ftp</li>\n<li>[R1-aaa]local-user huawei privilege level 15</li>\n<li>[R1-aaa]local-user huawei ftp-directory flash:</li>\n<li>[R1]display ftp-server</li>\n<li>FTP server is running</li>\n<li>Max user number                 5</li>\n<li>User count                      0</li>\n<li>Timeout value(in minute)        30</li>\n<li>Listening port                  21</li>\n<li>Acl number                      0</li>\n<li>FTP server's source address     0.0.0.0</li>\n<li>[3] 配置完成后，可以看到 R1 为 FTP 服务器，默认情况下监听 TCP 21 号端口。</li>\n</ul>\n<p class=\"red\">4，建立 FTP 客户端与服务器的连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 建立从客户端 (R2) 到 FTP 服务器 (R1) 的连接。</li>\n<li>&lt;R2&gt;ftp 10.0.12.1</li>\n<li>Trying 10.0.12.1 ...</li>\n<li>Press CTRL+K to abort</li>\n<li>Connected to 10.0.12.1.</li>\n<li>220 FTP service ready.</li>\n<li>User(10.0.12.1:(none)):huawei</li>\n<li>331 Password required for huawei.</li>\n<li>Enter password:</li>\n<li>230 User logged in.</li>\n<li>[R2-ftp]</li>\n<li>[2] 输入正确的用户名和密码后，可以成功登录 FTP 服务器。</li>\n<li>[3] 下载文件前或者上传文件后，执行 dir 命令查看文件的详细信息。</li>\n<li>[R2-ftp]dir</li>\n<li>200 Port command okay.</li>\n<li>150 Opening ASCII mode data connection for *.</li>\n<li>drwxrwxrwx   1 noone    nogroup         0 Mar 27 14:25 dhcp</li>\n<li>-rwxrwxrwx   1 noone    nogroup    121802 May 26  2014 portalpage.zip</li>\n<li>-rwxrwxrwx   1 noone    nogroup      2263 Mar 27 14:24 statemach.efs</li>\n<li>-rwxrwxrwx   1 noone    nogroup    828482 May 26  2014 sslvpn.zip</li>\n<li>drwxrwxrwx   1 noone    nogroup         0 Mar 27 14:25 .</li>\n<li>226 Transfer complete.</li>\n<li>FTP: 327 byte(s) received in 0.150 second(s) 2.18Kbyte(s)/sec.</li>\n<li>[4] 配置文件的传输模式。</li>\n<li>[R2-ftp]binary</li>\n<li>200 Type set to I.</li>\n<li>[5] 在 FTP 服务器上下载文件</li>\n<li>[R2-ftp]get sslvpn.zip</li>\n<li>[6] 从 FTP 服务器上下载文件后，执行 bye 命令关闭连接。</li>\n<li>[R2-ftp]bye</li>\n<li>221 Server closing.</li>\n<li>[7] 可以通过 put 命令把一个文件上传到 FTP 服务器，上传的同时也可以为该文件配置新的文件名。</li>\n<li>[R2-ftp]put statemach.efs statemach2.efs</li>\n<li>200 Port command okay.</li>\n<li>150 Opening ASCII mode data connection for statemach2.efs.</li>\n<li>100%</li>\n<li>[8] 上传文件后，执行 dir 命令查看文件是否存在于 FTP 服务器上。</li>\n<li>[9] 分别在 R1 和 R2 上删除创建的 vrpnew.zip 和 vrpnew2.zip 文件。</li>\n<li>&lt;R2&gt;delete flash:/vrpnew.zip</li>\n<li>Error: File can't be found</li>\n<li>&lt;R1&gt;delete flash:/vrpnew2.zip</li>\n<li>Error: File can't be found</li>\n<li>[9] 注意：删除配置文件时，请慎重执行，避免删除 R1 和 R2 上的整个 flash:/ 目录。</li>\n</ul>\n<p class=\"red\">5，配置 DHCP：</p>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>你是公司的网络管理员，公司网络需要配置 DHCP 业务，将网关路由器 R1 和 R3 配置为 DHCP 服务器，并配置全局地址池和接口地址池，为接入层设备分配 IP 地址。</li>\n</ul>\n</div></details>\n<p class=\"red\">6，拓扑图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/27/cSGUFP.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">7，实验环境准备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 按照实验拓扑图进行基础配置以及 IP 编址，暂时关闭 R1 上的 G0/0/2 接口和 R3 上的 G0/0/1 接口。</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R1</li>\n<li>[R1-GigabitEthernet0/0/1]ip address 10.0.12.1 24</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname R3</li>\n<li>[R3]int g0/0/1</li>\n<li>[R3-GigabitEthernet0/0/1]ip address 10.0.12.3 24</li>\n<li>[R3-GigabitEthernet0/0/1]shutdown</li>\n<li>[R3]int g0/0/2</li>\n<li>[R3-GigabitEthernet0/0/2]ip address 10.0.23.3 24</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname S1</li>\n<li>&lt;Huawei&gt;sys</li>\n<li>[Huawei]sysname S2</li>\n</ul>\n<p class=\"red\">8，清除设备上已有的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 重新开启 R3 上的 G0/0/2 接口。</li>\n<li>[R3-GigabitEthernet0/0/2]undo shutdown</li>\n</ul>\n<p class=\"red\">9，进行其他准备配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 关闭 S1 和 S2 上其他无关端口。</li>\n<li>[2] 确认其他端口已经被关闭。</li>\n<li>[3] 确认 R1 上只有 G0/0/2 端口被关闭，R3 上只有 G0/0/1 端口被关闭。</li>\n<li></li>\n</ul>\n",
            "tags": [
                "技术",
                "HUAWEI"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/",
            "url": "https://manshan.top/2021/03/07/IPv6%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E3%80%81%E5%AE%89%E5%85%A8%E3%80%81%E8%BF%87%E6%B8%A1%E4%B8%8E%E9%83%A8%E7%BD%B2/",
            "title": "IPv6网络基础、安全、过渡与部署",
            "date_published": "2021-03-07T11:49:27.621Z",
            "content_html": "<h1 id=\"第一章ipv6基础知识\"><a class=\"anchor\" href=\"#第一章ipv6基础知识\">#</a> 第一章【IPv6 基础知识】</h1>\n<h1 id=\"第二章ipv6协议首部结构\"><a class=\"anchor\" href=\"#第二章ipv6协议首部结构\">#</a> 第二章【IPv6 协议首部结构】</h1>\n<h1 id=\"第三章ipv6地址结构\"><a class=\"anchor\" href=\"#第三章ipv6地址结构\">#</a> 第三章【IPv6 地址结构】</h1>\n<h1 id=\"第四章icmpv6协议和邻居发现协议\"><a class=\"anchor\" href=\"#第四章icmpv6协议和邻居发现协议\">#</a> 第四章【ICMPv6 协议和邻居发现协议】</h1>\n<h1 id=\"第五章ipv6路由协议\"><a class=\"anchor\" href=\"#第五章ipv6路由协议\">#</a> 第五章【IPv6 路由协议】</h1>\n<h1 id=\"第六章ipv6安全机制\"><a class=\"anchor\" href=\"#第六章ipv6安全机制\">#</a> 第六章【IPv6 安全机制】</h1>\n<h1 id=\"第七章移动ipv6技术\"><a class=\"anchor\" href=\"#第七章移动ipv6技术\">#</a> 第七章【移动 IPv6 技术】</h1>\n<h1 id=\"第八章ipv6过渡技术\"><a class=\"anchor\" href=\"#第八章ipv6过渡技术\">#</a> 第八章【IPv6 过渡技术】</h1>\n<h1 id=\"第九章ipv6网络协议栈应用\"><a class=\"anchor\" href=\"#第九章ipv6网络协议栈应用\">#</a> 第九章【IPv6 网络协议栈应用】</h1>\n<h1 id=\"第十章ipv6技术配置实验\"><a class=\"anchor\" href=\"#第十章ipv6技术配置实验\">#</a> 第十章【IPv6 技术配置实验】</h1>\n<h1 id=\"第十一章ipv6部署\"><a class=\"anchor\" href=\"#第十一章ipv6部署\">#</a> 第十一章【IPv6 部署】</h1>\n",
            "tags": [
                "技术",
                "IPV6"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/",
            "url": "https://manshan.top/2021/03/07/HCIA-Routing%20&%20Switching%E7%90%86%E8%AE%BA%E5%85%A5%E9%97%A8/",
            "title": "HCIA-Routing & Switching理论入门",
            "date_published": "2021-03-07T05:52:40.240Z",
            "content_html": "<h1 id=\"第一章传输介质简介\"><a class=\"anchor\" href=\"#第一章传输介质简介\">#</a> 第一章【传输介质简介】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>通信网络除了包含通信设备本身之外，还包含连接这些设备的传输介质，如，同轴电缆，双绞线和光纤等。不同的传输介质具有不同的特性，这些特性直接影响到通信的诸多方面，如，线路编码方式，传输速度和传输距离等。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，简单网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MGv3d.png\" alt=\"图片\"></li>\n<li>上图，两个终端，用一条能够承载数据传输的物理介质 (也称传输介质) 连接起来，就组成了一个简单网络。</li>\n<li>[2] 终端相互传递信息和资源共享的需求是网络产生的主要原因。</li>\n<li>[3] 终端可以产生，发送和接收数据，网络是终端建立通信的媒介，终端通过网络建立连接，用来传输数据的载体称为介质，网络可以使用各种介质进行数据传送，包括物理线缆，无线电波等。</li>\n<li>[4] 网络就是通过介质把终端互联而成的一个规模大，功能强的系统，从而使得众多的终端可以方便地互相传递信息，共享信息资源。</li>\n</ul>\n<p class=\"red\">2，介质 —— 同轴电缆：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 简介如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MYMQA.png\" alt=\"图片\"></li>\n<li>[2] 同轴电缆是一种早期使用的传输介质，同轴电缆的标准分为两种，10BASE2 和 10BASE5. 这两种标准都支持 10Mbps 的传输数据，最长传输距离分别为 184m 和 500m 一般情况下，10BASE2 同轴电缆使用 BNC 接头，10BASE5 使用 N 型接头。</li>\n<li>[3] 10BASE5 和 10BASE2 是早期的两种以太网标准，它们均采用同轴电缆作为传输介质。10BASE5 和 10BASE2 所使用的同轴电缆的直径分别为 9.5mm 和 5mm，所以前者又称为粗电缆，后者又称为细电缆。</li>\n<li>[4] 现在 10Mbps 的传输速率早已不满足目前企业网络的需求，因此同轴电缆在目前企业网络中很少应用。</li>\n</ul>\n<p class=\"red\">3，介质 —— 交叉线：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MsexK.png\" alt=\"图片\"></li>\n<li>[2] 与同轴电缆相比双绞线 (Twisted Pair) 具有更低的制造和部署成本，因此在企业网络中被广泛应用。</li>\n<li>[3] 双绞线可分为屏蔽双绞线 (Shielded Twisted Pair STP) 和非屏蔽双绞线 (Unshielded Twisted Pair UTP)。</li>\n<li>[4] 屏蔽双绞线在双绞线与外层绝缘封套之间有一个金属屏蔽层，可以屏蔽电磁干扰。</li>\n<li>[5] 双绞线有很多种类型，不同类型的双绞线所支持的传输速率一般也不相同，例如，3 类双绞线支持 10Mbps 传输速率，5 类双绞线支持 100Mbps 传输速率，超 5 类双绞线及更高级别的双绞线支持千兆以太网传输。</li>\n<li>[6] 双绞线使用 RJ-45 接头连接网络设备，为了保证终端能够正常收发数据，RJ-45 的针脚必须按照一定的线序排列。</li>\n<li>[7] 排序：</li>\n<li>568A 排线顺序：绿白，绿，橙白，蓝，蓝白，橙，棕白，棕。</li>\n<li>568B 排线顺序：橙白，橙，绿白，蓝，蓝白，绿，棕白，棕。</li>\n</ul>\n<p class=\"red\">4，介质 —— 光纤：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M6hCR.png\" alt=\"图片\"></li>\n<li>[2] 双绞线和同轴电缆传输数据时使用的是电信号，而光纤传输数据时使用的是光信号。</li>\n<li>[3] 光纤支持的传输速率包括：10Mbps，100Mbps，1Gbps，10Gbps 甚至更高。</li>\n<li>[4] 根据光纤传输光信号模式的不同，光纤又可以分为单模光纤和多模光纤。</li>\n<li>[5] 单模光纤只能传输一种模式的光，不存在膜间色散，因此适用于长距离高速传输。</li>\n<li>[6] 多模光纤允许不同模式的光在一根光纤上传输，由于膜间色散较大而导致信号脉冲展宽严重，因此多模光纤主要用于局域网中短距离传输。</li>\n<li>[7] 光纤连接器种类很多，常用的连接器包括 ST，FC，SC，LC 连接器。</li>\n</ul>\n<p class=\"red\">5，介质 —— 串口电缆：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M2cb8.png\" alt=\"图片\"></li>\n<li>[2] 网络通信中常常会用到各种各样的串口电缆，常用的串口电缆标准为 RS-232，同时也是推荐的标准。但是 RS-232 的传输速率有限，传输距离仅为 6m。</li>\n<li>[3] 其他的串口电缆标准可以支持更长的传输距离，例如：RS-422 和 RS-485 的传输距离可达到 1200m，RS-422 和 RS-485 串口电缆通常使用 V.35 接头，这种接头在上世纪 80 年代已被淘汰，但是，现在仍在帧中继，ATM 等传统网络上使用。</li>\n<li>[4] V.24 是 RS-232 标准的欧洲版，RS-232 本身没有定义接头标准，常用的接头类型为 DB-9 和 DB-25.</li>\n<li>[5] 现在，RS-232 已逐渐被 FireWire，USB 等新标准取代，新产品和新设备已普遍使用 USB 标准。</li>\n</ul>\n<p class=\"red\">6，冲突域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>\n<p>[1] 如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/07/6MWFO0.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>注：共享式网络中可能会出现信号冲突现象。</p>\n</li>\n<li>\n<p>[2] 上图是一个 10BASE5 以太网，每个主机都使用同一根同轴电缆来与其他主机进行通信，因此，这里的同轴电缆又被称为共享介质，相应的网络被称为共享介质网络，或称为共享式网络，在共享式网络中，不同的主机同时发送数据时，就会产生信号冲突的问题，解决这一问题的方法一般是采用<ins class=\"wavy\"> CSMA/CD (载波侦听多路访问 / 冲突检测技术)。</ins></p>\n</li>\n<li>\n<p>[3]<ins class=\"wavy success\"> CSMA/CD 的基本工作过程如下：</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备不停地检测共享线路的状态，如果线路空闲，则可以发送数据，如果线路不空闲，则等待一段时间后继续检测 (延时时间由退避算法决定)。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">如果有另一台设备同时发送数据，两个设备发送的数据会产生冲突。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备检测到冲突之后，会马上停止发送自己的数据，并发送特殊阻塞信息，以强化冲突信号，使线路上其他站点能够尽早检测到冲突。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">终端设备检测到冲突后，等一段时间之后再进行数据发送 (延时时间有退避算法决定)。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy success\">CSMA/CD 的工作原理可简单总结为：先听后发，边发边听，冲突停发，随机延迟后重发。</ins></p>\n</li>\n</ul>\n<p class=\"red\">7，双工模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M4Q6s.png\" alt=\"图片\"></li>\n<li>注：两种双工模式都支持双向数据传输。</li>\n<li>[2] 半双工：</li>\n<li>在半双工 (Half-duplex mode) 下，通信双方都能发送和接收数据，但不能同时进行。当一台设备发送时，另一台只能接收，反之亦然。对讲机就是半双工的典型例子。</li>\n<li>[3] 全双工：</li>\n<li>在全双工 (Full-duplex mode) 下，通信双方都能同时接收和发送数据，电话网络是典型的全双工例子。</li>\n<li>[4] 以太网上的通信模式包括全双工和半双工两种。</li>\n<li>[5] 半双工模式下，共享物理介质的通信双方必须采用 CSMA/CD 机制来避免冲突，例如，10BASE5 以太网的通信模式就必须是半双工模式。</li>\n<li>[6] 全双工模式下，通信双方可以同时实现双向通信，这种模式不会产生冲突，因此，不需要使用 CSMA/CD 机制，例如，10BASE-T 以太网的通信模式就可以是全双工模式。</li>\n<li>[7] 同一物理链路上相连的两台设备的双工模式必须保持一致。</li>\n</ul>\n<p class=\"red\">8，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>千兆以太网传输必须使用超 5 类标准及以上的双绞线，或者使用千兆级更高等级的光纤。</li>\n<li>冲突域是一个通过共享物理介质进行双向传输的所有节点的集合，当同一个冲突与域中的主机同时发送数据时，数据到达目的地之前可能会发生冲突。</li>\n<li>CSMA/CD 是一种在共享式网络上检测并避免冲突的机制。</li>\n</ul>\n<h1 id=\"第二章以太网帧结构\"><a class=\"anchor\" href=\"#第二章以太网帧结构\">#</a> 第二章【以太网帧结构】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>网络中传输数据时需要定义并遵循一些标准，以太网是根据 IEEE 802.3 标准来管理和控制数据帧的。了解 IEEE 802.3 标准是充分了解以太网中链路层通信的基础。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，网络通信协议：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MTD2D.png\" alt=\"图片\"></li>\n<li>注：不同的协议栈用于定义和管理不同网络的数据转发规则。</li>\n<li>[2] 网络通信中，“协议” 和 “标准” 这两个词汇常常可以混用，同时，协议或标准本身又常常具有层次的特点。</li>\n<li>[3] 一般地，关注于逻辑数据关系的协议通常被称为上层协议，而关注于物理数据流的协议通常被称为底层协议。</li>\n<li>[4] IEEE 802 就是一套用来管理物理数据流在局域网中传输的标准，包括在局域网中传输物理数据的 802.3 以太网标准。除此之外，还有一些用来管理物理数据流在广域网中传输的标准，如，PPP (Point-To-Point Protocol)，高级数据链路控制 HDLC (High-Level Data Link Control)。</li>\n</ul>\n<p class=\"red\">2，分层模型 ——OSI：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6M7oY6.png\" alt=\"图片\"></li>\n<li>[2] OSI 参考模型具有以下优点：</li>\n<li>简化了相关的网络操作。</li>\n<li>提供了不同厂商之间的兼容性。</li>\n<li>促进了标准化工作。</li>\n<li>结构上进行了分层。</li>\n<li>易于学习和操作。</li>\n<li>[3] OSI 各个层次的基本功能如下：</li>\n<li><ins class=\"dot\">物理层：</ins></li>\n<li>在设备之间传输比特流，规定了电平，速度和电缆针脚。</li>\n<li><ins class=\"dot\">数据链路层：</ins></li>\n<li>将比特组合成字节，再将字节组合成帧，使用链路层地址 (以太网使用 MAC 地址) 来访问介质，并进行差错检测。</li>\n<li><ins class=\"dot\">网络层：</ins></li>\n<li>提供逻辑地址，供路由器确认路径。</li>\n<li><ins class=\"dot\">传输层</ins></li>\n<li>提供面向连接或非面向连接的数据传递以及进行重传前的差错检测。</li>\n<li><ins class=\"dot\">会话层</ins></li>\n<li>负责建立，管理，终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和相应组成。</li>\n<li><ins class=\"dot\">表示层</ins></li>\n<li>提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。</li>\n<li><ins class=\"dot\">应用层</ins></li>\n<li>OSI 参考模型中最靠近用户的一层，为应用程序提供网络服务。</li>\n</ul>\n<p class=\"red\">3，分层模型 ——TCP/IP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6MqezT.png\" alt=\"图片\"></li>\n<li>[2] TCP/IP 模型同样采用了分层结构，层与层相对独立但是相应之间也具备非常密切的协作关系。</li>\n<li>[3] TCP/IP 模型将网络分为四层，TCP/IP 模型不关注底层物理介质，主要关注于终端之间的逻辑数据流转发，</li>\n<li>[4] TCP/IP 模型的核心是网络层和传输层，网络层解决网络之间的逻辑转发问题，传输层保证源端到目的端之间的可靠传输。最上层的应用层通过各种协议向终端用户提供业务应用。</li>\n</ul>\n<p class=\"red\">4，数据封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QC5WQ.png\" alt=\"图片\"></li>\n<li>[2] 应用数据需要经过 TCP/IP 每一层处理之后才能通过网络传输到目的端，每一层上都是用该层的数据单元 PDU (Protocol Data Unit) 彼此交换信息。不同层的 PDU 中包含有不同的信息，因此 PDU 在不同层被赋予了不同的名称。</li>\n<li>[3] 如上层数据在传输层添加 TCP 报头后得到的 PDU 被称为数据段 (Segmet), 数据段被传递给网络层，网络层添加 IP 报头得到的 PDU 被称为数据包 (Packet), 数据包被传递到数据链路层，封装数据链路层报头得到的 PDU 被称为数据帧 (Frame), 最后，帧被转换为比特，通过网络介质传输，这种协议栈逐层向下传递数据，并添加报头和报尾的过程称为封装。</li>\n</ul>\n<p class=\"red\">5，终端之间的通信：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QPkTK.png\" alt=\"图片\"></li>\n<li>注：数据链路层控制数据帧在物理线路上传输。</li>\n<li>[2] 数据包在以太网物理介质传播之前必须封装头部和尾部信息，封装后的数据包被称为数据帧，数据帧中封装的信息决定了数据如何传输，以太网中传输的数据帧有两种格式。选择哪种格式，由 TCP/IP 协议族中的网络层决定。</li>\n</ul>\n<p class=\"red\">6，帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QPQmt.png\" alt=\"图片\"></li>\n<li>[2] 以太网上使用两种标准帧格式，第一种是上世纪八十年代提出的 DIX v2 格式，即 Ethernet II 帧格式，Ethernet II 后来被 IEEE 802 标准接纳，并写进了 IEEE 802.3\tX-1997 的 3.2.6 节。</li>\n<li>[3] 第二种是 1983 年提出的 IEEE 802.3 格式，这两种格式的主要区别在与 Ethernet II 格式中包含一个 Type 字段，标识以太帧处理完成之后将被发送到哪个上层协议进行处理，IEEE 802.3 格式中，同样的位置是长度字段。</li>\n<li>[4] 不同的 Type 字段值可以用来区别这两种帧的类型，当 Type 字段值小于等于 1500 (或者 16 进制的 0x05DC) 时，帧使用的是 IEEE 802.3 格式。当 Type 值大于等于 1536 (或者 16 进制 0x0600) 时，帧使用的是 Ethernet II 格式。<ins class=\"wavy\">以太网中大多数的数据帧使用的是 Ethernet II 格式。</ins></li>\n<li>[5]<ins class=\"wavy\"> 以太帧中还包括源和目的 MAC 地址，分别代表发送者的 MAC 和接收者的 MAC，此外还有帧校验序列字段，用于校验传输过程中帧的完整性。</ins></li>\n</ul>\n<p class=\"red\">7，Ethernet II 帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6QzZoF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Ethernet II 帧类型值大于等于 1536 (0x0600)，以太网数据帧的长度在 64-1518 字节之间。</ins></li>\n<li>[2] Ethernet II 的帧中各种字段说明如下：</li>\n<li><ins class=\"wavy\">DMAC(Destination MAC)：</ins></li>\n<li>是目的 MAC 地址，DMAC 字段长度为 6 个字节，标识帧的接收者。</li>\n<li><ins class=\"wavy\">SMAC(Source MAC)：</ins></li>\n<li>是源 MAC 地址，SMAC 字段长度为 6 个字节，标识帧的发送者。</li>\n<li><ins class=\"wavy\">Type (类型字段)：</ins></li>\n<li>用于标识数据字段中包含的高层协议，该字段长度为 2 个字节，<ins class=\"wavy\">类型字段取值为 0x0800 的帧代表 IP 协议帧。类型字段取值为 0x0806 的帧代表 ARP 协议帧。</ins></li>\n<li><ins class=\"wavy\">Data (数据字段)：</ins></li>\n<li>是网络层数据，最小长度必须为 46 字节以保证帧长至少为 64 字节，数据字段的最大长度为 1500 字节。</li>\n<li><ins class=\"wavy\">FCS (循环冗余检验字段)：</ins></li>\n<li>提供了一种错误检测机制，该字段长度为 4 个字节。</li>\n</ul>\n<p class=\"red\">8，IEEE 802.3 帧格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lFCAP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IEEE 802.3 帧长度字段值小于等于 1500 (0x05DC)。</ins></li>\n<li>[2] IEEE 802.3 帧格式类似于 Ethernet II 帧，只是 Ethernet II 帧的 type 域被 802.3 帧的 Length 域取代，并且占用了 Data 字段的 8 个字节作为 LLC 和 SNAP 字段。</li>\n<li><ins class=\"wavy\">Leagth 字段：</ins></li>\n<li>定义了 Data 字段包含的字节数。</li>\n<li><ins class=\"wavy\">逻辑链路控制 LLC (Logical Link Control)：</ins></li>\n<li>由目的服务访问点 DSAP (Destination Service Access Point)，源服务访问点 SSAP (Source Service Access Point) 和 Control 字段组成。</li>\n<li><ins class=\"wavy\">SNAP(Sub-network Access Point)：</ins></li>\n<li>由机构代码 (Org Code) 和类型 (Type) 字段组成，Org Code 三个字节都为零，Type 字段的含义与 Ethernet II 帧中的 Type 字段相同。</li>\n<li><ins class=\"wavy\">IEEE 802.3 帧根据 DSAP，SSAP 字段的取值又可以分为以下几类：</ins></li>\n<li>1) 当 DSAP 和 SSAP 都取特定值 0xff 时，802.3 帧就变成了 Netware-ETHERNET 帧，用来承载 NetWare 类型的数据。</li>\n<li>2) 当 DSAP 和 SSAP 都取特定值 0xaa 时，802.3 帧就变成了 ETHERNET-SNAP 帧，ETHERNER_SNAP 帧可以用于传输多种协议。</li>\n<li>3)<ins class=\"wavy\"> DSAP 和 SSAP 其他的取值均为纯 IEEE 802.3 帧。</ins></li>\n</ul>\n<p class=\"red\">9，数据帧传输：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lVFVs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据链路层基于 MAC 地址进行帧的传输。</ins></li>\n<li>[2] 以太网在二层链路上通过 MAC 地址来唯一标识网络设备，并且实现局域网上网络设备之间的通信。</li>\n<li>[3] MAC 地址也叫物理地址，大多数网卡厂商把 MAC 地址烧入了网卡的 ROM 中，发送端使用接收端的 MAC 地址作为目的地址，以太帧封装完成之后会通过物理层转换成比特流在物理介质上传输。</li>\n</ul>\n<p class=\"red\">10，以太网的 MAC 地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lek90.png\" alt=\"图片\"></li>\n<li>++ 注：MAC 地址由两部分组成，分别是供应商代码和序列号。其中前 24 位代表该供应商代码，由 IEEE 管理和分配，剩下的 24 位序列号由厂商自己分配。</li>\n<li>[2] 网络设备的 MAC 地址是全球唯一的，MAC 地址长度为 48 比特，通常用 16 进制标识。</li>\n<li>[3] MAC 地址包含两个部分：前 24 比特是组织唯一标识符 (OUI) 由 IEEE 统一分配给设备制造商，例如，华为网络产品的 MAC 地址前 24 比特是 0x00e0fc。后 24 位序列号是厂商厂商分配给每个产品的唯一数值，由各个厂商自行分配。</li>\n</ul>\n<p class=\"red\">11，单播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6ln06f.png\" alt=\"图片\"></li>\n<li>[2] 局域网中的帧可以通过三种方式发送，第一种是单播，指从单一的源端单一的目的端，每个主机接口由一个 MAC 地址唯一标识，<ins class=\"wavy\">MAC 地址的 OUI 中，第一个字节第八个比特标识比特类型。</ins></li>\n<li>[3] 对于主机 MAC 地址，这个比特固定为零，表示目的 MAC 地址为此 MAC 地址的帧都是发送到某个唯一的目的端。</li>\n<li>[4] 在冲突与中，所有主机都能接收到源主机发送的单播帧，都是其他主机发现目的地址与本地 MAC 地址不一致后会丢弃收到的帧，只有真正的目的主机才会接收并处理收到的帧。</li>\n</ul>\n<p class=\"red\">12，广播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lKLy6.png\" alt=\"图片\"></li>\n<li>[2] 第二种方式是广播，表示帧从单一的源发送到共享以太网上的所有主机。广播帧的目的 MAC 地址为十六进制的 FF:FF:FF:FF:FF:FF，所有收到该广播帧的主机都要接收并处理这个帧。</li>\n<li>[3]<ins class=\"wavy\"> 广播方式会产生大量流量，导致带宽利用率降低，进而影响整个网络的性能。</ins></li>\n<li>[4]<ins class=\"wavy\"> 当需要网络中的所有主机都能接收到相同的信息并进行处理的情况下，通常会使用广播方式。</ins></li>\n</ul>\n<p class=\"red\">13，组播：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6lQQ4H.png\" alt=\"图片\"></li>\n<li>[2] 第三种发送方式为组播，组播比广播更加高效，组播转发可以理解为选择性的广播，主机侦听特定组播地址，接收并处理目的 MAC 地址为该组播 MAC 地址的帧。</li>\n<li>[3] 组播 MAC 地址和单播 MAC 地址是通过<ins class=\"wavy\">第一个字节中的第八个比特区分的。组播 MAC 地址的第八个比特为 1，而单播 MAC 地址的第八个比特为 0。</ins></li>\n<li>[4] 当需要网络上的一组主机 (而不是全部主机) 接收相同的信息，并且其他主机不受影响的情况下通常会使用组播方式。</li>\n</ul>\n<p class=\"red\">14，数据帧的发送和接收：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/6l3GvR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当主机接收到数据帧所包含的目的 MAC 地址是自己时，会把以太网封装剥掉后送往上层协议。</ins></li>\n<li>[2] 帧从主机的物理口发送出来后，通过传输介质传输到目的端，共享网络中，这个帧可能到达多个主机，主机检测帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢弃收到的帧。</li>\n<li>[3] 如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检测帧检验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保存了完整性。如果帧的 FCS 值与本机计算的值不同，主机会认为帧已被破坏，并会丢弃该帧。如果该帧通过了 FCS 校验，则主机会根据帧头部的 Type 字段来确定将帧发送给上层哪一个协议处理，本列中，Type 字段的值为 0x0800，表明该帧需要发送到 IP 协议上处理，在发送给 IP 协议之前，帧的头部和尾部会被剥掉。</li>\n</ul>\n<p class=\"red\">15，本章总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 网络设备如何确定以太网数据帧的上层协议？</li>\n<li>以太网帧中包含一个 Type 字段，表示帧中的数据应该发送到上层哪个协议处理，比如，IP 协议对应的 Type 值为 0x0800，ARP 协议对应的 Type 值为 0x0806。</li>\n<li>[2] 终端设备接收到数据帧时，会如何处理？</li>\n<li>主机检查帧头中的目的 MAC 地址，如果目的 MAC 地址不是本机 MAC 地址，也不是本机侦听的组播或广播 MAC 地址，则主机会丢掉收到的帧，如果目的 MAC 地址是本机 MAC 地址，则接收该帧，检查帧校验序列 (FCS) 字段，并于本机计算的值对比来确定帧在传输过程中是否保持了完整性。如果检查通过，就会剥离帧头和帧尾，然后根据帧头中的 Type 字段来决定把数据发送到哪个上层协议进行后续处理。</li>\n</ul>\n<h1 id=\"第三章ip编址\"><a class=\"anchor\" href=\"#第三章ip编址\">#</a> 第三章【IP 编址】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>网络层位于数据链路层与传输层之间，网络层包含了许多协议其中最为重要的就是 IP 协议，网络层提供了 IP 路由功能，理解 IP 路由除了要熟悉 IP 协议的工作机制外，还必须理解 IP 编址以及如何合理地使用 IP 地址来设计网络。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，上层协议类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61SXYF.png\" alt=\"图片\"></li>\n<li>++ 注：以太网帧中的 Type 字段值为 0x0800，表示该帧的网络层协议为 IP 协议。</li>\n<li>[2] 在剥掉帧的头部和尾部之前网络设备需要根据帧头中 Type 字段来确定下一步将帧发送到哪个上层协议进行处理。本列中的帧头部 Type 字段表示该帧需要上送到 IP 协议进行处理，以下将介绍帧的头部和尾部剥离之后，IP 协议将如何处理帧中的数据。</li>\n</ul>\n<p class=\"red\">2，IP 报文头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/619nCF.png\" alt=\"图片\"></li>\n<li>[2] IP 报文头部信息用于指导网络设备对报文进行路由和分片。同一个网段内的数据转发通过数据链路层即可实现，而跨网段的数据转发需要使用网络设备的路由功能。分片是指数据包超过一定长度时，需要被划分成不同的片段使其能够在网络中传输。</li>\n<li>[3] IP 报文头部长度为 20——60 字节，报文头部中的信息可以用来指导网络设备如何将报文从原设备发送到目的设备，其中，版本字段表示当前支持的 IP 协议版本，当前的版本号为 4。DS 字段早期用来表示业务类型，现在用于支持 QoS 中的差分服务模型，实现网络流量优化。</li>\n<li>[4] 源和目的 IP 地址是分配给自己的逻辑地址，用于在网络层标识报文的发送方和接收方，根据源和目的 IP 地址可以判断目的端是否与发送端位于同一网段，如果二者不在同一网段，则需要采用<ins class=\"wavy\">路由机制</ins>进行跨网段转发。</li>\n</ul>\n<p class=\"red\">3，IP 编址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61Pd0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IP 地址分为网络部分和主机部分</ins></li>\n<li><ins class=\"wavy\">注：IP 地址由 32 个二进制位组成，通常用点分十进制来表示</ins></li>\n</ul>\n<p class=\"red\">4，二进制，十进制，十六进制 ———— 略</p>\n<p class=\"red\">5，IP 地址分类：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61iGEq.png\" alt=\"图片\"></li>\n<li>[2] IP 地址被划分为 A,B,C,D,E 五类，每类地址的网络号包含不同的字节数。A，B，C 类地址可以分配 IP 地址。每类地址支持的网络数和主机数不同，例如：A 类地址可支持 126 个网络每个网络支持 2*24 (16777216) 个主机地址，另外每个网段中的网络地址和广播地址不能分配给主机，C 类地址支持 200 多万个网络，每个网络支持 256 个主机地址，其中 254 个地址可以分配给主机使用。</li>\n<li>[3] D 类地址为组播地址，主机收到以 D 类地址为目的地址的报文后，且该主机是该组播组的成员，就会接收并处理该报文。</li>\n</ul>\n<p class=\"red\">6，IP 地址类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/08/61FzlD.png\" alt=\"图片\"></li>\n<li>[2] 默认情况下，网络中的主机无法使用使用私网地址与公网通信，当需要与公网通信时，私网地址必须转换成公网地址。</li>\n<li>[3] 127.0.0.1 网段中的地址为环回地址。用于诊断网络是否正常。</li>\n<li>[4] IPv4 中的第一个地址 0.0.0.0 表示任何网络。IPv4 最后一个地址 255.255.255.255 是 0.0.0.0 网络中的广播地址。</li>\n</ul>\n<p class=\"red\">7，网络通信：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68rxnP.png\" alt=\"图片\"></li>\n<li>[2] 源主机必须知道目的主机的 IP 地址后才能将数据发送到目的地，源主机向其他目的主机发送报文之前，需要检查目的 IP 地址和源 IP 地址是否属于同一网段，如果是则报文将被下发到底层协议进行以太网封装处理。如果目的地址和源地址属于不同网段，则主机需要获取下一跳路由器的 IP 地址，然后将报文下发到底层协议处理。</li>\n</ul>\n<p class=\"red\">8，子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68yZ2d.png\" alt=\"图片\"></li>\n<li>[2] 子网掩码用于区分网络部分和主机部分。</li>\n<li>[3] 子网掩码与 IP 地址的表示方式相同，每个 IP 地址和子网掩码一起可以用来唯一的标识一个网段中的某台网络设备。</li>\n<li>[4] 子网掩码中的 1 表示网络位，0 表示主机位。</li>\n</ul>\n<p class=\"red\">10，默认子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68yjdf.png\" alt=\"图片\"></li>\n<li>[2] 每类 IP 地址有一个缺省子网掩码，A 类地址的为 8 位，即第一个字节表示网络位，其他三个字节表示主机位，B 类 16 位，因此 B 类支持更多的网络，但是主机数也相应减少。C 类 24 位，支持的网络最多，但是也限制了单个网络中主机的数量。</li>\n</ul>\n<p class=\"red\">11，地址规划：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68c8js.png\" alt=\"图片\"></li>\n<li>[2] 通过子网掩码可以判断主机所属的网段，网段上的广播地址以及网段上支持的主机数。</li>\n</ul>\n<p class=\"red\">12，地址规划举例：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68gJRe.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">13，有类 IP 编址的缺陷：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68WYzF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在设计网络时使用有类 IP 地址会造成地址的浪费。</ins></li>\n<li>[2] 使用缺省子网掩码就会存在一定的局限性，网络中划分多个网段后，每个网段中的实际主机数量可能很有限，导致很多地址未被使用，地址使用率低。</li>\n</ul>\n<p class=\"red\">14，变长子网掩码：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src alt=\"图片\"></li>\n<li>[2] 采用可变长子网掩码可解决上述问题\t，缺省子网掩码可以进一步划分，称为变长子网掩码 (VLSM)。</li>\n<li>[3] 通过改变子网掩码，可以将网络划分为多个子网，上图借用了一个主机位作为网络位，借用的主机位变成了子网位。所以有 2*7-2 个主机地址，即 126 个。</li>\n</ul>\n<p class=\"red\">15，无类域间路由 (CIDR)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/6850XD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：CIDR 增强了网络的可拓展性。</ins></li>\n<li>[2] 无类域间路由 CIDR 由 RFC1817 定义，CIDR 突破了传统 IP 地址的分类边界，将路由表中的若干条路由汇总为一条路由，减少了路由表的规模，提高了路由器的可拓展性。</li>\n</ul>\n<p class=\"red\">16，网关：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68IJKS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网关用来转发来自不同网段之间的数据包。</ins></li>\n<li>[2] 报文转发过程中，首先需要确定转发路径以及通往目的网段的接口，然后将报文封装在以太帧中通过指定的物理接口转发出去。如果目的主机与源主机不在同一网段，报文需要先转发到网关，然后通过网关将报文转发到目的网段。</li>\n<li>[3] 网关是指接收并处理本地网段主机发送的报文并转发到目的网段的设备，为实现此功能，网关必须知道目的网段的 IP 地址，网关设备上连接本地网段的接口地址即为该网段的网关地址。</li>\n</ul>\n<p class=\"red\">17，IP 包分片：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/68qjiQ.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> 网络中转发的 IP 报文长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输，将报文分割成多个片段的过程叫做分片。</ins></li>\n<li>[3] 接收端根据分片报文中的<ins class=\"wavy\">标识符 (Identification)，标志 (Flags)，及片偏移 (Fragment Offset) 字段</ins>对分片报文进行重组。</li>\n<li>[4]<ins class=\"wavy\"> 标识符 (Identification): 用于识别属于同一个数据包的分片，以区别于同一主机或其他\t主机发送的其他数据包分片，保证分片被正确的重新组合。</ins></li>\n<li>[5]<ins class=\"wavy\"> 标志字段 (Flags): 用于判断是否已经收到最后一个分片，最后一个分片的标志字段设置为 0，其他分片的标志字段设置为 1. 目的端在收到标志字段为 0 的分片后，开始重组报文。</ins></li>\n<li>[6]<ins class=\"wavy\"> 片偏移字段 (Fragment Offset): 表示每个分片在原始报文中的位置。第一个分片的片偏移为 0，第二个分片的片偏移表示紧跟第一个分片后的第一个比特的位置，比如，如果首片报文包含 1259 比特，那么第二分片报文的片偏移字段值就应该为 1260。</ins></li>\n</ul>\n<p class=\"red\">18，生存时间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/68OO3j.png\" alt=\"图片\"></li>\n<li>[2] 报文在网段间转发时，如果网络设备上的路由规划不合理，就可能会重新环路，导致报文在网络中无限循环，无法到达目的端。环路发生后，所有发往这个目的地的报文的都会被循环转发，随着这种报文逐渐增多，网络将会发送拥塞。</li>\n<li>[3] 为了避免环路导致的网络拥塞，IP 报文头中包含一个生存时间 TTL (Time To Live) 字段，报文每经过一台<ins class=\"wavy\">三层设备，</ins>TTL 值减 1。初始 TTL 值由源端设备设置。当报文中的 TTL 降为 0 时，报文会被丢弃。同时，丢弃报文的设备会根据报文头中的源 IP 地址向源端发送 ICMP 错误消息。</li>\n</ul>\n<p class=\"red\">19，协议号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6Gjy8g.png\" alt=\"图片\"></li>\n<li>[2] 目的端的网络层在接受并处理报文之后，需要决定下一步对报文该做如何的处理。IP 报文头部中的协议字段标识了将会继续处理报文的协议。与以太帧头部中的 Type 字段类似，协议字段也是一个十六进制数，该协议可以标识网络层协议，如，ICMP (因特网控制报文协议)，也可以标识上层协议，如，TCP (传输控制协议，对应值 0x06)，UDP (用户数据包协议，对应值 0x11)</li>\n</ul>\n<p class=\"red\">20，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 子网掩码的专用是什么？</li>\n<li>32 位的 IP 子网掩码用于区分 IP 地址中的网络号和主机号，网络号表示网络或子网，主机号表示网络或子网中的主机。</li>\n<li>[2] IP 报文头部中 TTL 字段的作用是什么？</li>\n<li>如果网络中存在环路，则 IP 报文可能会在网络中循环而无法达到目的端，TTL 字段限定了 IP 报文的生存时间，保证无法到达目的端口的报文最终被丢弃。</li>\n<li>[3] 网关的作用是什么？</li>\n<li>网关是指接收并处理本地网段主机发送出来的报文并转发到目的网段的设备。</li>\n</ul>\n<h1 id=\"第四章icmp协议\"><a class=\"anchor\" href=\"#第四章icmp协议\">#</a> 第四章【ICMP 协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>Internet 控制消息协议 ICMP (Internet Control Message Protocol) 是网络层的一个重要协议。</li>\n<li>ICMP 协议用来在网络设备间传递各种差错和控制信息，并，<ins class=\"wavy\">对于收集各种网络信息，诊断和排除各种网络故障等方面起着至关重要的作用。</ins></li>\n<li>使用基于 ICMP 的应用时，需要对 ICMP 的工作原理非常熟悉。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，ICMP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JCwQO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ICMP 用来传递差错，控制，查询等信息。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP 是 TCP/IP 协议族的核心协议之一，它用于在 IP 网络设备之间发送控制报文，传递差错，控制，查询等消息。</ins></li>\n</ul>\n<p class=\"red\">2，ICMP 重定向：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JPQht.png\" alt=\"图片\"></li>\n<li>[2] ICMP Redirect 重定向消息用于支持路由功能。</li>\n<li>[3]<ins class=\"wavy\"> 上图，主机 A 希望发送报文到服务器 A，于是根据配置的默认网关地址向网关 RTB 发送报文，网关 RTB 收到报文后，检查报文信息，发现报文应该转发到与源主机在同一网段的另一个网关设备 RTA，因为此转发路径是更优的路径，所以 RTB 会向主机发送一个 Redirect 消息，通知主机直接向另一个网关 RTA 发送该报文，主机收到 Redirect 消息后，会向 RTA 发送报文，然后 RTA 会该报文再转发给服务器 A。</ins></li>\n</ul>\n<p class=\"red\">3，ICMP 差错检测：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JENYd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ICMP Echo Requests 和 ICMP Echo Reply 分别用来查询和响应某些消息，进行差错检测。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP Echo 消息常用于诊断源和目的地之间的网络连通性，同时，还可以提供其他信息，如报文往返时间等。</ins></li>\n</ul>\n<p class=\"red\">4，ICMP 错误报告：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JVrg1.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当网络设备无法访问目标网络时，会自动发送 ICMP 目的不可达报文到发送端设备。</ins></li>\n<li>[2]<ins class=\"wavy\"> ICMP 定义了各种错误消息，用于诊断网络连通性问题，根据这些错误消息，源设备可以判断出数据传输失败的原因。</ins></li>\n<li>[3]<ins class=\"wavy\"> 比如，如果网络中发生了环路，导致报文在网络中循环，且最终 TTL 超时，这种情况下网络设备会发送 TTL 超时消息个发送端设备。</ins></li>\n<li>[4]<ins class=\"wavy\"> 又比如，如果目的地址不可达，则中间的网络设备会发送目的不可达的消息给发送端设备。</ins></li>\n<li>[5]<ins class=\"wavy\"> 目的不可达的情况有多种，如果是网络设备无法找到目的网络。则发送目的网络不可达消息，如果是网络设备无法找到目的网络中的目的主机，则发送目的主机不可达消息。</ins></li>\n</ul>\n<p class=\"red\">5，ICMP 数据包格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JKmBq.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同消息。</ins></li>\n<li>[2] ICMP 消息封装在 IP 报文中。<ins class=\"wavy\">ICMP 消息的格式取决于 Type 和 Code 字段。其中 Type 字段为消息类型，Code 字段包含该消息类型的具体参数。</ins></li>\n<li>[3]<ins class=\"wavy\"> 后面的校验和字段用于检测消息是否完整，消息中包含 32 比特的可变参数，这个字段一般不使用，通常设置为 0。在 ICMP Redirect 消息中，这个字段用来指定网关 IP 地址，主机根据这个地址将报文重定向到指定网关。</ins></li>\n<li>[4]<ins class=\"wavy\"> 在 Echo 请求消息中，这个字段包含标识符和序号，源端根据这两个参数将收到的回复消息与本端发送的 Echo 请求消息进行关联，尤其是当源端向目的端发送多个 Echo 请求消息时，需要根据标识符和序号将 Echo 请求和回复消息进行一一对应。</ins></li>\n</ul>\n<p class=\"red\">6，ICMP 消息类型和编码类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6JNBjK.png\" alt=\"图片\"></li>\n<li>[2] ICMP 定义了多种消息类型，并用于不同的场景，这些消息不需要 Code 字段来描述具体的类型参数，仅用 Type 字段表示消息类型，比如，ICMP Echo 回复消息的 Type 字段设置为 0。</li>\n<li>[3]<ins class=\"wavy\"> 有些 ICMP 消息使用 Type 字段定义消息大类，用 Code 字段表示消息的具体类型。比如，类型为三的消息表示目的不可达，不同的 Code 值表示不可达的原因，包括目的网络不可达 (Code=0)，目的主机不可达 (code=1), 协议不可达 (Code=2)，目的 TCP/UDP 端口不可达 (Code=3) 等。</ins></li>\n</ul>\n<p class=\"wavy\">7，ICMP 应用 - Ping (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6YVbwT.png\" alt=\"图片\"></li>\n<li>[2] ICMP 的一个典型应用时 Ping，Ping 是检测网络连通性的常用工具，同时也能收集其他相关信息。</li>\n<li>[3] 用户可以在 Ping 命令中指定不同的参数，如 ICMP 报文长度，发送的 ICMP 报文个数，等待回复相应的超时时间等，设备根据配置的参数来构造并发送 ICMP 报文，进行 Ping 测试。</li>\n<li>[4] Ping 常用的配置参数说明如下：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①：-a source-ip-address指定发送ICMP ECHO—REQUEST报文的源IP地址。如果不指定源IP地址，将采用出接口的IP地址作为ICMP ECHO—REQUEST报文发送的源地址。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②：-c count 指定发送ICMP ECHO—REQUEST报文次数，缺省情况下发送5个ICMP ECHO-REQUEST报文。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③：-h ttl-value指定TTL的值，缺省值是255。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④：-t <span class=\"token function\">time</span> out指定发送完ICMP ECHO-REQUEST后，等待ICMP ECHO-<span class=\"token environment constant\">REPLY</span>的超时时间。</pre></td></tr></table></figure><p class=\"red\">8，ICMP 应用 - Ping (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/10/6Ym0W4.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> Ping 命令的输出信息中包括目的地址，ICMP 报文长度，序号，TTL 值以及往返时间。</ins></li>\n<li>[3]<ins class=\"wavy\"> 序号是包含在 Echo 回复消息 (Type=0) 中的可变参数字段，TTL 和往返时间包含在消息的 IP 头中。</ins></li>\n</ul>\n<p class=\"red\">9，ICMP 应用 - Tracert (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6YDV6s.png\" alt=\"图片\"></li>\n<li>[2] ICMP 的另一个典型的应用是 Tracrt，<ins class=\"wavy\">Traceret 基于报头中的 TTL 值来逐跳跟踪报文的转发路径。</ins></li>\n<li>[3] 为了跟踪到达某特定目的地址的路径，源端首先将报文的 TTL 值设置为 1，该报文到达第一个节点后，TTL 超时，于是该字节向源端发送 TTL 超时消息，消息中携带时间戳。然后源端将报文的 TTL 值设置为 2，报文到达第二个节点超时后，该节点同样返回 TTL 超时消息，以此类推，直到报文到达目的地。这样，源端根据返回的报文中的消息可以跟踪到报文经过的每一个节点，并根据时间戳信息计算往返时间，Tracert 是检测网络丢包及时延的有效手段，同时可以帮助管理员发现网络中的路由环路。</li>\n<li>[4] Tracertc 常用的配置参数说明如下：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①：-a source-ip-address指定Tracert报文的源地址。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②：-f first-ttl指定初始TTL，缺省值是1。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③：-m max-ttl指定最大TTL，缺省值是30。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④：-name使能显示每一跳的主机名。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>⑤：-p port指定目的主机的UDP端口。</pre></td></tr></table></figure><p class=\"red\">10，ICMP 应用 ——Tracert (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6YyqHI.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> 注：Type 表示 ICMP 消息类型，Code 表示同一消息类型中的不同信息。</ins></li>\n<li>[3] 上图，源端 (RTA) 向目的端 (主机 B) 发送一个 UDP 报文，TTL 值为 1，目的 UDP 端口号是大于 30000 的一个数，因此在大多数情况下，大于 30000 的 UDP 端口号是任何一个应用程序都不可能使用的端口号。</li>\n<li>[4] 第一跳 (RTB) 接收到源端发送的 UDP 报文后，判断出报文的目的 IP 地址不是本机 IP 地址，将 TTL 减一后，判断出 TTL 值等于 0，将丢弃报文并向源端发送一个 ICMP 超时 (Time Exceeded) 报文。(该报文中含有第一跳的 IP 地址 10.0.0.2)，这样源端就得到了 RTB 的地址。</li>\n<li>[5] 源端收到 RTB 的 ICMP 超时报文后，再次向目的端发送一个 UDP 报文，TTL 值为 2。</li>\n<li>[6] 第二跳 (RTC) 收到源端发送出的 UDP 报文后，回应一个 ICMP 超时报文，这样源端就得到了 RTC 的地址 (20.0.0.2)</li>\n<li>[7] 以上过程不断进行，直到目的端收到收到源端发送的 UDP 报文，判断出目的 IP 地址是本机 IP 地址，则处理此报文，根据报文中目的 UDP 端口号寻找占用此端口号的上层协议。因目的端没有应用程序使用该 UDP 端口号，则向源端返回一个 ICMP 不可达 (Destination Unreachable) 报文。</li>\n<li>[8] 源端收到 ICMP 端口不可达报文后，判断出 UDP 报文已经到达目的端。则停止 Tracert 程序，从而得到数据报文从源端到目的端所经历的路径 (10.0.0.2,20.0.0.2,30.0.0.2)。</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] Ping 使用的是哪两类 ICMP 消息？</li>\n<li>Ping 利用 ICMP Echo 请求消息 (Type 值为 0) 来发起检测目的可达性，目的端收到 ICMP Echo 请求消息后，根据 IP 报头中的源地址向源端发送 ICMP Echo 回复消息 (Type 值为 0)。</li>\n<li>[2] 当网络设备收到 TTL 值为 0 的报文时，会如何操作？</li>\n<li>如果 IP 数据包在到达目的地之前 TTL 值已经将为 0，则收到 IP 数据包的网络设备会丢弃该数据包，并向源端发送 ICMP 消息通知源端 TTL 超时。</li>\n</ul>\n<h1 id=\"第五章arp协议\"><a class=\"anchor\" href=\"#第五章arp协议\">#</a> 第五章【ARP 协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>当网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址 (即 IP 地址)。</li>\n<li>IP 地址由网络层来提供，但是仅有 IP 地址是不够的，IP 数据报文必须封装成帧才能通过数据链路层进行发送。</li>\n<li>数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址，通过目的 IP 地址来获取目的 MAC 地址的过程是由 ARP (Address Resolution Protocol) 协议来实现的。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NKKYV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据链路层在进行数据封装时，需要目的 MAC 地址。</ins></li>\n<li>[2] 一个网络设备要发送数据给另一个网络设备时，必须要知道对方的 IP 地址，但是仅有 IP 地址是不够的，因为 IP 数据报文必须封装成帧才能通过数据链路层进行发送，而数据帧必须要包含目的 MAC 地址，因此发送端还必须获取到目的 MAC 地址。</li>\n<li>[3] 每一个网络设备在数据封装前都需要获取下一跳的 MAC 地址。</li>\n<li>[4] IP 地址由网络层提供，MAC 地址通过 ARP 协议来获取。</li>\n<li>[5] ARp 协议是 TCP/IP 协议族中的重要组成部分，它能够通过目的 IP 地址获取目标设备的 MAC 地址，从而实现数据链路层的可达性。</li>\n</ul>\n<p class=\"red\">2，ARP 数据包格式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NQV5q.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARP 报文不能穿越路由器，不能被转发到其他广播域。</ins></li>\n<li>[2] 网络设备通过 ARP 报文来发现目的 MAC 地址，ARP 报文中包含以下字段：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Hard Type表示硬件地址类型，一般为以太网。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Protocol Type表示三层协议地址类型，一般为IP。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Hard Length和Protocol Length为MAC地址和IP地址的长度，单位是字节。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Operation Code指定了ARP报文的类型，包括ARP Requested和ARP Reply。</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Source Hardware Address指的是发送ARP报文的设备MAC地址。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Source Protocol Address指的是发送ARP报文的设备IP地址。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Destination Hardware Address指的是接收者MAC地址，在ARP Request报文中，该字段为0。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Destination Protocol Address指的是接收者的IP地址。</pre></td></tr></table></figure><p class=\"red\">3，ARP 工作过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N1s8P.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机 A 发送一个数据包给主机 C 之前，首先要获取主机 C 的 MAC 地址。</ins></li>\n<li>[2] 通过 ARP 协议，网络设备可以建立目标 IP 地址和 MAC 地址之间的映射，网络设备通过网络层获取到目的 IP 地址之后，还要判断目的 MAC 地址是否已知。</li>\n</ul>\n<p class=\"red\">4，ARP 缓存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N3nRP.png\" alt=\"图片\"></li>\n<li>[2] 网络设备一般都有一个 ARP 缓存 (ARP Cache)，<ins class=\"wavy\">ARP 缓存用来存放 IP 地址和 MAC 地址的关联信息。</ins></li>\n<li>[3] 在发送数据之前，设备会先检查 ARP 缓存表，如果缓存表中存在对方设备的 MAC 地址，则直接采用该 MAC 地址来封装帧，然后将帧发送出去，如果缓存表中不存在相应信息，则通过发送<ins class=\"wavy\"> ARP Request</ins> 报文来获取它。</li>\n<li>[4] 学习到的 IP 地址和 MAC 地址的映射关系会被放入 ARP 缓存表中存放一段时间，在有效时间内，设备可以直接从这个表中查找目的 MAC 地址来进行数据封装，而无需进行 ARP 查询，过了这段有效期，ARP 表项会被自动删除。</li>\n<li>[5] 如果目标设备位于其他网络，则源设备会在 ARP 缓存表中查找网关的 MAC 地址，然后将数据发送给网关，网关再把数据转发给目的设备。</li>\n</ul>\n<p class=\"red\">5，ARP 请求：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NGpnO.png\" alt=\"图片\"></li>\n<li>[2] 上图，主机 A 的 ARP 缓存表中不存在主机 C 的 MAC 地址，所以主机 A 会发送 ARP Request 来获取目的 MAC 地址。</li>\n<li>[3] ARP Request 报文封装在以太帧里，帧头中的源 MAC 地址为发送端主机 A 的 MAC 地址，此时，由于主机 A 不知道主机 C 的 MAC 地址，所以目的 MAC 地址为广播地址 FF-FF-FF-FF-FF-FF。</li>\n<li>[4] ARP Request 报文中包含源 IP 地址，目的 IP 地址，源 MAC 地址，目的 MAC 地址，其中目的 MAC 的值为 0，ARP Request 报文会在整个网络上传播，该网络上的所有主机包括网关都会接收到此 ARP Request 报文。</li>\n<li>[5]<ins class=\"wavy\"> 网关将会阻止该报文发送到其他网络上。</ins></li>\n</ul>\n<p class=\"red\">6，ARP 响应 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NYIjP.png\" alt=\"图片\"></li>\n<li>[2] 所有的主机接收到该 ARP Request 报文之后，都会检查它的目的协议地址字段与本身的 IP 地址是否匹配。如果不匹配，则该主机将不会响应该 ARP Request 报文，如果匹配，则该主机会将 ARP 报文中的源 MAC 地址和源 IP 地址信息记录到自己的 ARP 缓存表中，然后通过 ARP Reply 报文进行相应。</li>\n</ul>\n<p class=\"red\">7，ARP 响应 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6Ntk4J.png\" alt=\"图片\"></li>\n<li>[2] 主机 C 会向主机 A 回应 ARP Reply 报文，ARP Reply 报文中的源协议地址是主机 C 自己的 IP 地址，目标协议地址是主机 A 的 IP 地址，目的 MAC 地址是主机 A 的 MAC 地址，源 MAC 地址是自己的 MAC 地址，同时 Operation Code 被设置为 Reply。</li>\n<li>[3] ARP Reply 报文通过单播传输。</li>\n</ul>\n<p class=\"red\">8，ARP 缓存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NNuzn.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 收到 ARP Reply 以后，会检查 ARP 报文中目的 MAC 地址是否与自己的 MAC 匹配，如果匹配，ARP 报文中的源 IP 地址和源 MAC 地址会被记录到主机 A 的 ARP 缓存表中。</li>\n</ul>\n<p class=\"red\">9，ARP 代理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图:</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NUPfJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：同一网段，不同物理网络上的计算机之间，可以通过 ARP 代理实现相互通信。</ins></li>\n<li>[2] 上图组网中，主机 A 需要与主机 B 通信，目的 IP 地址与本机的 IP 地址在同一个网段，所以 A 将会以广播形式发送 ARP Request 报文请求主机 B 的 MAC 地址，但是，广播报文无法被路由器转发，所以主机 B 无法收到主机 A 的 ARP 请求报文，当然也就无法应答。</li>\n<li>[3] 在路由器上启用代理 ARP 功能，就可以解决这个问题，启用代理 ARP 后，路由器收到这样的请求，会查找路由表，如果存在主机 B 的路由表项，路由器将会使用自己的 G0/0/0 接口的 MAC 地址来回应 ARP Request，主机 A 收到 ARP Reply 后，将以路由器的 G0/0/0 接口的 MAC 地址作为目的 MAC 地址进行数据转发。</li>\n</ul>\n<p class=\"red\">10，免费 ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：免费 ARP 可以用来探测 IP 地址是否冲突。</ins></li>\n<li>[2] 主机被分配了 IP 地址或者 IP 地址发生变更后，必须立刻检测其所分配的 IP 地址在网络上是否是唯一的，以避免地址冲突，<ins class=\"wavy\">主机通过发送 ARP Request 报文来进行地址冲突检测。</ins></li>\n<li>[3] 主机 A 将 ARP Request 广播报文中的目的 IP 地址字段设置为自己的 IP 地址，且该网络中所有主机包括网关都会接收到此报文。当目的 IP 地址已经被某一个主机或网关使用时，该主机或者网关就会回应 ARP Reply 报文，通过这种方式，主机 A 就能探测到 IP 地址冲突了。</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 网络设备在什么情况下会发送 ARP Request？</li>\n<li>源设备在发送数据给目的设备前，会首先查看自身的 ARP 缓存，查找 ARP 缓存中是否存在目的设备的 IP 地址和 MAC 地址的映射，如果存在则直接使用，如果不存在则会发送 ARP Request。</li>\n<li>[2] 网络设备什么时候会产生免费 ARP？</li>\n<li>当网络上的一个设备被分配了 IP 地址或者 IP 地址发生变更后，可以通过免费 ARP 来检测 IP 地址是否冲突。</li>\n</ul>\n<h1 id=\"第六章传输层协议\"><a class=\"anchor\" href=\"#第六章传输层协议\">#</a> 第六章【传输层协议】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>传输层定义了主机应用程序之间端到端的连通性，传输层最为常见的两个协议分别是传输控制协议 TCP (Transmission Control Protocol) 和用户数据包协议 UDP (User datagram Protocol)。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，TCP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6N06xJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：TCP 是一种面向连接的传输层协议，可提供可靠的传输服务。</ins></li>\n<li>[2] TCP 位于 TCP/IP 模型的传输层，它是一种面向连接的端到端协议。</li>\n<li>[3] TCP 作为传输控制协议，可以为主机提供可靠的数据传输，上图，在通信之前，需要 TCP 在他们之间建立可靠的传输通道。</li>\n</ul>\n<p class=\"red\">2，TCP 端口号：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NBmJU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：端口号用来区分不同的网络服务。</ins></li>\n<li>[2] TCP 允许一个主机同时运行多个应用进程，m 每台主机可以拥有多个应用端口，每对端口号，源和目标 IP 地址的组合唯一的标识了一个会话。</li>\n<li>[3] 端口分为知名端口和动态端口，<ins class=\"wavy\">有些网络服务会使用固定的端口，这类端口称为知名端口，端口范围为 0-1023。如，FTP，HTTP，Telnet，SNMP 服务均使用知名端口。</ins></li>\n<li>[4]<ins class=\"wavy\"> 动态端口范围从 1024-65535，这些端口号一般不固定分配给某个服务，也就是说许多服务都可以使用这些端口。只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。</ins></li>\n</ul>\n<p class=\"wavy\">3，TCP 头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/11/6NrECT.png\" alt=\"图片\"></li>\n<li>[2] TCP 通常使用 IP 作为网络层协议，这时 TCP 数据段被封装在 IP 数据包内。</li>\n<li>[3] TCP 数据段由 TCP Header (头部)，和 TCP Data (数据) 组成，TCP 最多可以有 60 个字节的头部，如果没有 Options 字段，正常的长度是 20 字节。</li>\n<li>[4] TCP Header 是由上图标识的一些字段组成这里列出几个常用字段：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>①16位源端口号：源主机的应用程序使用的端口号。</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>②16位目的端口号：目的主机的应用程序使用的端口号。每个TCP头部都包含源和目的端的端口号，这两个值加上IP头部中的源IP地址和目的IP地址可以唯一确定一个TCP连接。</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>③32位序列号：用于标识从发送端发出的不同的TCP数据段的序号，数据段在网络中传输时，他们的顺序可能会发生变化，接收端依据此序列号，便可按照正确的顺序重组数据。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>④32位确认序列号：用于标识接收端确认收到的数据段，确认序列号为成功收到的数据数列号加1.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>⑤4位头部长度：表示头部占用32bit字的数目，它能表达的TCP头部最大长度为60字节。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>⑥16位窗口大小：表示接收端期望通过单次确认而收到的数据的大小，由于该字段为16位，所以窗口大小的最大值为65535字节，该字节通常用来进行流量控制。</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>⑦16位校验和：校验整个TCP报文段，包括TCP头部和TCP数据，该值由发送端计算和记录并由接收端进行验证。</pre></td></tr></table></figure><p class=\"red\">4，TCP 建立连接的过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6NsgfK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：TCP 通过三次握手建立可靠连接。</ins></li>\n<li>[2] TCP 是一种可靠的，面向连接的全双工传输层协议。</li>\n<li>[3] TCP 连接的建立是一个三次握手的过程，如图所示：</li>\n<li>[4] 主机 A (通常也称为客户端) 发送一个标识了 SYN 的数据段，表示期望与服务器 A 建立连接，此数据段的序列号 (seq) 为 a。</li>\n<li>[5] 服务器 A 回复了标识了 SYN+ACK 的数据阶段，此数据段的序列号 (seq) 为 b，确认序列号为主机 A 的序列号加 1 (a+1)，以此作为对主机 A 的 SYN 报文确认。</li>\n<li>[6] 主机 A 发送一个标识了 ACK 的数据段，此数据段的序列号 (seq) 为 a+1，确认序列号为服务器 A 的序列号加 1 (b+1)，以此作为对服务器 A 的 SYN 报文的确认。</li>\n</ul>\n<p class=\"red\">5，TCP 的传输过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6aPmi4.png\" alt=\"图片\"></li>\n<li>[2] TCP 的可靠传输还体现在 TCP 使用了确认技术来确保目的设备收到了从源设备而发来的数据。并且是正确无误的。</li>\n<li>[3] 确认技术的工作原理如下：</li>\n<li>目的设备接收到源设备发送的数据段时，会向源端发送确认报文，源设备收到确认报文后，继续发送数据段，如此重复。</li>\n<li>[4] 上图，主机 A 向服务器 A 发送 TCP 数据段，假定每个数据段的长度都是 500 个字节。当服务器 A 成功收到序列号是 M+1499 字节以及之前的所有字节时，会以序列号 M+1499+1=M+1500 进行确认。另外，由于数据段 N+3 传输失败，所以服务器 A 未能收到序列号为 M+1500 的字节，因此服务器 A 还会再次以序列号 M+1500 进行确认。</li>\n</ul>\n<p class=\"red\">6，TCP 流量控制：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6ai1pj.png\" alt=\"图片\"></li>\n<li>[2]<ins class=\"wavy\"> TCP 滑动窗口技术通过动态改变窗口大小来实现对端到端设备之间的数据进行流量控制。</ins></li>\n<li>[3] 上图，主机 A 和服务器 A 之间通过滑动窗口来实现流量控制，为方便理解，上图只考虑主机 A 发送数据给服务器 A 时，服务器 A 通过滑动窗口进行流量控制。</li>\n<li>[4] 主机 A 向服务器发送 4 个长度为 1024 字节的数据段，其中主机的窗口大小为 4096 个字节。服务器 A 收到第三个数据段后，缓存区满。第四个数据段被丢弃，服务器以 ACK 3073 响应，窗口大小调整为 3072，表明服务器的缓冲区只能处理 3072 个字节的数据段，于是主机 A 改变其发送的速率，发送窗口大小为 3072 的数据段。</li>\n</ul>\n<p class=\"red\">7，TCP 关闭连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/12/6aFUKI.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机在关闭连接之前，要确认收到来自对方的 ACK。</ins></li>\n<li>[2] TCP 支持全双工模式传输数据，这意味着同一时刻两个方向都可以进行数据的效数据的传输，在传输数据之前，TCP 通过三次握手建立的实际上是两个方向的连接，因此，在传输完毕之后，两个方向的连接必须都关闭。</li>\n<li>[3]<ins class=\"wavy\"> TCP 的建立是一个三次握手的过程，而 TCP 连接的终止则要经过四次握手。</ins></li>\n<li>[4] 如上图：</li>\n<li><ins class=\"wavy\">主机 A 想要终止连接，于是发送了一个标识了 FIN，ACK 的数据段，序列号为 a，确认序列号为 b。</ins></li>\n<li><ins class=\"wavy\">服务器 A 回应了一个标识了 ACK 的数据段，序列号为 b，确认序号为 a+1，作为对主机 A 的 FIN 报文的确认。</ins></li>\n<li><ins class=\"wavy\">服务器 A 想要终止连接，于是向主机 A 发送了一个标识了 FIN，ACK 的数据段，序列号为 b，确认序列号为 a+1。</ins></li>\n<li><ins class=\"wavy\">主机 A 回应了一个 ACK 的数据段，序列号为 a+1，确认序列号为 b+1，作为对服务器 A 的 FIN 报文的确定。</ins></li>\n<li>[5] 以上四次交互便完成了两个方向连接的关闭。</li>\n</ul>\n<p class=\"red\">8，UDP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a4rK1.png\" alt=\"图片\"></li>\n<li><ins wavy>注：UDP 是一种面向无连接的传输层协议，传输可靠性没有保障。</ins></li>\n<li>[2] 当应用程序对传输的可靠性要求不高时，但是对传输速度和延迟要求较高时，可以用 UDP 协议来代替 TCP 协议在传输层控制数据的转发。</li>\n<li>[3] UDP 将数据从源端发送到目的端时，无需事先建立连接。</li>\n<li>[4] UDP 采用了简单，易操作的机制在应用程序之间传输数据，没有使用 TCP 中的确认技术或滑动窗口机制，因此，UDP 不能保证数据传输的可靠性，也无法避免接收到重复数据的情况。</li>\n</ul>\n<p class=\"red\">9，UDP 头部：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a4TqP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：UDP 头部仅占 8 字节，传输数据时没有确认机制。</ins></li>\n<li>[2] UDP 报文分为 UDP 报文头和 UDP 数据两部分。报头由源端口，目的端口，报文长度以及校验和组成，UDP 适合于实时数据的传输，如语音和视频通信。</li>\n<li>[3] 相比于 TCP，UDP 的传输效率更高，开销更小，但是无法保证数据传输的可靠性。</li>\n<li>[4] UDP 头部的标识如下：</li>\n<li>16 位源端口号：源主机的应用程序使用的端口号。</li>\n<li>16 位目的端口号：目的主机的应用程序使用的端口号。</li>\n<li>16 位 UDP 长度：是指 UDP 头部和 UDP 数据的字节长度，因为 UDP 头部长度为 8 字节，所以该字节的最小值为 8。</li>\n<li>16 位 UDP 校验和：该字节提供了与 TCP 校验字段同样的功能，该字段是可选的。</li>\n</ul>\n<p class=\"red\">10，UDP 的传输过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a5CZV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：使用 UDP 传输数据时，由应用程序根据需要提供报文到达确认，排序，流量控制等功能。</ins></li>\n<li>[2] 主机 A 发送数据包时，这些数据包是以有序的方式发送到网络中的，每个数据包独立地在网络中被发送，所以不同的数据包可能会通过不同的网络路径到达主机 B。</li>\n<li>[3] 这样的情况下，先发的数据包不一定先到达主机 B，因为 UDP 数据包没有序号，主机 B 将无法通过 UDP 协议将数据包按照原来的顺序重新组合，所以此时需要应用程序提供报文的到达确认，排序和流量控制等功能。</li>\n<li>[4] 通常情况下，UDP 采用实时传输机制和时间戳来传输语音和视频数据。</li>\n</ul>\n<p class=\"red\">11，UDP 的传输过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6a58RH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：UDP 不提供重传机制，占用资源小，处理效率高。</ins></li>\n<li><ins class=\"wavy\">注：一些时延敏感的流量，如语音，视频等，通常使用 UDP 作为传输协议。</ins></li>\n<li>[2] UDP 适合传输对时延敏感的流量，如，语音和视频。</li>\n<li>[3] 在使用 TCP 协议传输数据时，如果一个数据段丢失或者接收端对某个数据段没有确认，发送端会重新发送该数据段。</li>\n<li>[4] TCP 重新发送数据会带来延迟和重复数据，降低了用户体验。对于时延敏感的应用，少量的数据丢失一般可以被忽略，这时使用 UDP 传输将能够提升用户的体验。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] TCP 头部中的确认标识位由什么作用？</li>\n<li>TCP 报文头中的 ACK 标志位用于目的端对已收到数据的确认，目的端成功收到序列号为 X 的字节及之前的所有字节后，会以序列号 X+1 进行确认。</li>\n<li>[2] TCP 头部中有哪些标识位参与 TCP 三次握手？</li>\n<li>在 TCP 的三次握手过程中，要使用 SYN 和 ACK 标识位来请求建立连接和确认建立连接。</li>\n</ul>\n<h1 id=\"第七章数据转发过程\"><a class=\"anchor\" href=\"#第七章数据转发过程\">#</a> 第七章【数据转发过程】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>TCP/IP 协议族和底层协议配合，保证了数据能够实现端到端地连接。数据传输过程是一个非常复杂的过程，例如，数据在转发地过程中会进行一系列的封装和解封装。对于网络工程师来说，只有深刻地了解数据在各种不同设备上的转发过程，才能对网络进行正确的分析和检测。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，数据转发过程的概述：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6duWB4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：数据包在相同网段内或不同网段之间转发所依据的原理基本一致。</ins></li>\n<li>[2]<ins class=\"wavy\"> 数据可以在同一网络内或者在不同网络间传输，数据转发过程也分为本地转发和远程转发，但两者的数据转发原理是基本一致的，都是遵循 TCP/IP 协议族。</ins></li>\n<li>上图，主机 A 需要访问服务器 A 的 WEB 服务，并假设两者之间已经建立了 TCP 连接，接下来会以上图来讲解数据在不同网络间的传输过程。</li>\n</ul>\n<p class=\"red\">2，TCP 封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dKyad.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注当主机建立了到达目的地的 TCP 连接后，便开始对应用层数据进行封装。</ins></li>\n<li>[2]<ins class=\"wavy\"> 主机 A 会对待发送的应用数据首先执行加密和压缩等相关操作，之后进行传输层封装。</ins></li>\n<li>[3] Web 应用是基于传输层的 TCP 协议传输数据的，主机 A 使用 TCP 进行报文封装时，必须填充源端口和目的端口字段，初始序列号和确认序列号字段，标识位，窗口字段以及校验和字段。</li>\n<li>[4] 此列中，数据段的源端口号为主机 A 随机的 1027 号端口，目的端口号为服务器 A 的 TCP 知名端口 80。</li>\n</ul>\n<p class=\"wavy\">3，IP 封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dMDS0.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 完成传输层封装后，一般会进行网络层数据封装，在使用 IP 进行封装时，需要明确 IP 报文的源和目的地址，如果报文的大小大于网络的最大传输单元 (MTU)，则该报文有可能在传输过程中被分片。</li>\n<li>[3] 生存时间 (TTL) 字段用来减少网络环路造成的影响。ARG3 系列路由器产生的数据包，默认 TTL 值为 255，路由器转发一个数据包时，该值会被减一，如果路由器发现该值被减为 0，就会丢弃该数据包。这样，即使网络中存在环路，数据包也不会在网络上一直被转发。</li>\n<li>[4] 协议字段标识了传输层所使用的协议，本列中，传输层使用的是 TCP 协议，所以该字段的填充值为 0x06。</li>\n</ul>\n<p class=\"red\">4，查找路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dQ1AJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机 A 必须要拥有到达目的地的路由。</ins></li>\n<li>[2]<ins class=\"wavy\"> 每个主机都会独自维护各自的路由表项，主机 A 在发送数据前需要先检测是否能够到达目的端，这个过程是通过查找路由来完成的。</ins></li>\n<li>[3] 上图，主机 A 拥有一条到达 “任何网络” 的路由。它发往其他网络的数据都会通过 IP 地址为 10.1.1.1 的接口转发到下一跳，即网关 10.1.1.254。</li>\n</ul>\n<p class=\"red\">5，ARP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dlK2t.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：通过 ARP 缓存表找到下一跳的 MAC 地址。</ins></li>\n<li><ins class=\"wavy\">注：如果表项里没有下一跳的 MAC 地址，主机 A 会发送 ARP 请求。</ins></li>\n<li>[2] 接下来，由于数据包要被封装成数据帧，所以主机 A 需要获取下一跳的 MAC 地址，也就是网关的 MAC 地址，主机首先会查询 ARP 缓存表。上图，主机 A 的 ARP 缓存表中存在网关 MAC 地址的表项。</li>\n<li>[3]<ins class=\"wavy\"> 如果没有查找到网关的 MAC 地址表项，主机 A 会通过发送 ARP 请求来获取网关的 MAC 地址。</ins></li>\n</ul>\n<p class=\"red\">6，以太网封装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6d1WkQ.png\" alt=\"图片\"></li>\n<li>[2] 主机 A 在链路层封装数据帧时，会遵循 IEEE 802.3 或 Ethernet II 标准，Ethernet II 帧头中的类型字段填充为 0x0800，以表示网络层使用的是 IP 协议，源 MAC 地址为主机 A 的 MAC 地址，目的 MAC 地址为网关路由器的 E0/0 接口的 MAC 地址。</li>\n</ul>\n<p class=\"red\">7，数据帧转发过程：</p>\n<div class=\"note infojie'fu\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6d80Mt.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：主机工作在半双工模式下，所以会使用 CSMA/CD 来检测链路是否空闲。</ins></li>\n<li><ins class=\"wavy\">注：前导码用于使接收者进入同步状态，定界符用于指示帧的开始。</ins></li>\n<li>[2] 主机 A 工作在半双工模式下，所以会使用 CSMA/CD 里检测链路是否空闲，如果链路空闲，++ 主机 A 会将一个前导码 (Preamble) 和一个帧首定界符 (SFD) 附加到帧头然后进行传输。</li>\n<li>[3]<ins class=\"wavy\"> 前导码的作用是使接收设备进行同步并做好接收数据帧的准备。前导码是包括了 7 个字节的二进制 &quot;1&quot;,&quot;0&quot; 交替的代码，即 1010...10 共 56 位。</ins></li>\n<li>[4]<ins class=\"wavy\"> 帧首定界符是长度为 1 个字节的 10110101 二进制序列，它的作用是使接收端对帧的第一位进行定位。</ins></li>\n</ul>\n<p class=\"red\">8，数据帧转发过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6dRyPH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每个冲突域里的设备都会收到主机 A 发送的数据帧。</ins></li>\n<li><ins class=\"wavy\">注：只有网关 (RTA) 会处理该数据帧，并继续转发。</ins></li>\n<li>[2] 上图，主机 A 发送数据帧到共享以太网，此网络中的所有设备都会收到数据帧。设备收到帧之后，首先会进行 FCS 校验，如果 FCS 未能通过，则帧被立即丢弃。</li>\n<li>[3] 对于通过了 FCS 校验的帧，设备会检察帧中的目的 MAC 地址，如果帧中的目的 MAC 地址与自己的 MAC 地址不同，设备将丢弃帧，如果相同，则会继续处理。</li>\n<li>[4] 在处理过程中，帧头帧尾会被剥去 (也就是解封装)，剩下的数据报文会被根据帧头中的类型字段的值来送到网络层中的对应协议模块去处理。</li>\n</ul>\n<p class=\"red\">9，数据帧转发过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6doKfS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网关检查是否具有到达目的网络的路由条目。</ins></li>\n<li><ins class=\"wavy\">注：如果存在转发路径，则为数据包添加一个新的二层帧头和帧尾，并继续转发。</ins></li>\n<li>[2] RTA 收到此数据报文后，网络层会对该报文进行处理。RTA 首先根据 IP 头部信息中的校验和字段，检查 IP 数据报文头部的完整性，然后根据目的 IP 地址查看路由表，确定是否能够将数据包转发到目的端。RTA 还必须对 TTL 的值进行处理，另外，报文大小不能超过 MTU 值。如果报文大小超过 MTU 值，则报文将被分片。</li>\n<li>[3] 网络层处理完成之后，报文将被收到数据链路层重新进行封装，成为一个新的数据帧，该帧的头部会封装新的源 MAC 地址和目的 MAC 地址，如果当前设备不知道下一跳的 MAC 地址，将会使用 ARP 来获得。</li>\n</ul>\n<p class=\"red\">10，数据包解封装 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wtRIK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：服务器 A 检查数据包的目的 IP 地址，发现目的 IP 与自己的 IP 地址相同。</ins></li>\n<li><ins class=\"wavy\">注：服务器 A 剥掉数据包的 IP 报头后，会往上层协议 TCP 继续进行处理。</ins></li>\n<li>[2] 服务器 A 通过 IP 协议来处理该报文，首先会通过校验和字段来验证报文头的完整性，然后检查 IP 报文头中的目的 IP 地址是否与自己当前的 IP 地址匹配。</li>\n<li>[3] 如果在源和目的之间的数据传输期间数据发生了报文分片，则报文会被目的端重新组合。标识字段用于标识属于同一数据源的分片报文，偏移量标识该分片在源分组中的相对位置。</li>\n<li>[4] 标志字段目前只有两位有意义，标志字段最低位为 1，表示后面还有分片，为 0 表示这已经是最后一个数据片，中间一位为 1 表示不能分片，为 0 表示可以分片。所有的分片报文必须被目的端全部接收到后才能进行重新组合。</li>\n<li>[5] 协议字段表示此数据包携带的上层数据是上层数据的哪种协议的数据，需要注意的是，下一个报头并非总在传输层报头，例如，ICMP 报文也是使用 IP 协议封装，协议字段值为 0x01。</li>\n</ul>\n<p class=\"red\">11，数据段解封装 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wUA0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：服务器 A 检查 TCP 头部的目的端口，然后将数据段发送给应用层的 HTTP 协议进行处理。</ins></li>\n<li>[2] 当 IP 报文头被处理完并剥离后，数据段会被发送到传输层进行处理。</li>\n<li>[3] 上图，传输层协议使用的是 TCP，且发送端和接收端已经通过三次握手建立了连接。</li>\n<li>[4] 传输层收到该数据段后，TCP 协议会查看并处理该数据段头部信息，其中目的端口号为 80，用于表示处理该数据的应用层协议为 HTTP 协议。</li>\n<li>[5] TCP 处理完头部信息后会将此数据段头部进行剥离，然后将剩下的应用数据发送到 HTTP 协议进行处理。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 数据在进行二层和三层封装之前，主机需要了解哪些信息？</li>\n<li>主机在封装数据包之前，必须要知道目的端 IP 地址，在封装数据帧之前，必须要知道去往目的网络的路由以及下一跳的 MAC 地址。</li>\n<li>[2] 当数据帧发送到非目的主机时，非目的主机将会如何处理？</li>\n<li>如果主机接收到一个不是发往自己的数据帧，在检验帧头中的目的 MAC 地址之后会丢弃该帧。</li>\n<li>[3] 传输层如何能够准确的将数据交给特定应用？</li>\n<li>传输层会检查 TCP 或 UDP 报文头中的目的端口号，以此来识别特定应用。</li>\n<li>[4] 当两台主机同时访问服务器的 HTTP 服务，该服务器如何区分数据属于哪个会话？</li>\n<li>服务器可以只通过源 IP 地址识别两台主机的 HTTP 流量，另外 TCP 报文头中包含的源端口也可以被用来区分同一台主机通过不同的浏览器发起的不同的会话。例如，两个来自源 IP 为 10.1.1.1 的 HTTP 流量使用的目的端口号都是 80，但源端口号为 1028 和 1035。</li>\n</ul>\n<h1 id=\"第八章vrp基础\"><a class=\"anchor\" href=\"#第八章vrp基础\">#</a> 第八章【VRP 基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>交换机可以隔离冲突与，路由器可以隔离广播域。这两种设备在企业网络中应用越来越广泛，随着越来越多的终端接入到网络中，网络设备的负担也越来越重，这时网络设备可以通过华为专有的 VRP 系统来提升运行效率。</li>\n<li>通用路由平台 VRP (Versatile Routing Platform) 是华为公司数据通信产品的通用操作系统，它以 IP 业务为核心，采用组件化的体系结构，在实现丰富功能特性的同时，还提供了基于应用的可裁剪和可拓展的功能，使得路由器和交换机的运行效率大大增加，能对 VRP 熟练地进行配置和操作是对网络工程师的一种基本要求。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，交换机的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wwYNt.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：如果使用 Hub，则主机 A 发送数据时，其他主机都不能发送数据，否则会发送冲突。使用交换机时，则不会出现这种现象。</ins></li>\n<li>[2] 由集线器 [HUB] 和中继器组建的以太网，实质上是一种共享式以太网，共享式以太网的主要缺陷有：<ins class=\"wavy\">冲突严重，广播泛滥，安全性差。</ins></li>\n<li>[3] 交换机是工作在数据链路层的设备，交换机可以将一个共享式以太网分割为多个冲突域，链路层流量被隔离在不同的冲突域中进行转发，如此便极大地提升了以太网的性能。</li>\n<li>[4] 更进一步说，通常主机和交换机之间以及交换机与交换机之间都使用全双工技术进行通信，这时冲突现象会被彻底消除。</li>\n<li>[5] 上图，由 HUB 搭建的网络中，所有的主机都处于同一个冲突域，主机 A 在发送数据给主机 B 时，其他主机都将收到此数据，但同时这些主机都不能发送数据。</li>\n<li>[6] 用交换机替代 HUB 后，因为交换机分割了冲突域，所以在主机 A 发送数据给主机 B 时，主机 C 和主机 D 之间也可以同时互相发送数据。</li>\n</ul>\n<p class=\"red\">2，路由器的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wDyEd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器可以分割广播域。</ins></li>\n<li>[2] 交换机虽然可以隔离冲突域，但是当一台设备发送广播帧时，其他设备仍然都会收到该广播帧，随着网络规模的增大，广播会越来越多，这样就会影响网络的效率，路由器可以用来分割广播域，减少广播对网络效率的影响。</li>\n<li>[3]<ins class=\"wavy\"> 一般情况下，广播帧的转发被限制在广播域内，广播域的边缘是路由器，因为，通常路由器不会转发广播帧。</ins></li>\n<li>[4] 路由器负责在网络间转发报文，它能够在自身的路由表里查找到达目的地的下一跳地址，将报文转发给下一跳路由器，如此重复，并最终将报文送达目的地。</li>\n</ul>\n<p class=\"red\">3，VRP 介绍：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w6Ax0.png\" alt=\"图片\"></li>\n<li>[2] VRP 是华为公司具有完全自主知识产权的网络操作系统，可以运行在多种硬件平台上，VRP 拥有一致的网络界面，用户界面和管理界面，为用户提供了灵活丰富的应用解决方案。</li>\n<li>[3] VRP 平台以 TCP/IP 协议族为核心，实现了数据链路层，网络层和应用层的多种协议，在操作系统中集成了路由交换技术，Qos 技术，安全技术和 IP 语音技术等数据通信功能。并以<ins class=\"wavy\"> IP 转发引擎技术为基础。</ins>为网络设备提供了出色的数据转发能力。</li>\n</ul>\n<p class=\"red\">4，VRP 的发展：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w6oQ0.png\" alt=\"图片\"></li>\n<li>[2] 随着网络技术和应用的飞速发展，VRP 平台在处理机制，业务能力，产品支持等方面也在持续演进。到目前为止，VRP 以及开发出了五个版本，分别是 VRP1，VRP2，VRP3，VRP5，VRP8。</li>\n<li>[3] VRP5 是一款分布式网络操作系统，具有高可靠性，高性能，可拓展的架构设计。目前，绝大多数华为设备使用的都是 VRP5 版本。</li>\n<li>[4] VRP8 是新一代网络操作系统，具有分布式，多线程，组件化架构，支持分布式应用和虚拟化技术，能够适应未来的硬件发展趋势和企业急剧膨胀的业务需求。</li>\n</ul>\n<p class=\"red\">5，设备管理接口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6wgDDf.png\" alt=\"图片\"></li>\n<li>[2] AR 系列企业路由器由多个型号，包括 AR150，AR200，AR1200，AR2200，AR3200。它们是华为第三代路由器产品，提供路由，交换，无线，语音和安全等功能，AR 路由器被部署在企业网络和公网之间，作为两个网络间传输数据的入口和接口。在 AR 路由器上部署多种业务能降低企业的网络建设成本和运维成本，根据一个企业的用户数和业务的复杂程度可以选择不同型号的 AR 路由器，来部署到网络中。</li>\n<li>[3] 华为 X7 系列以太网交换机提供数据交换的功能，满足企业网络上多业务的可靠接入和高质量传输的要求，这个系列的交换机位于企业网络的接入层，汇聚层和核心层，提供大容量交换，高密度接口，实现高效的报文转发。X7 系列以太网交换机包括了 S1700，S2700，S3700，S5700，S7700，S9700 等。</li>\n<li>[4] ARG3 系列路由器和 X7 系列交换机都提供了 Console 口作为管理口，AR2200 额外提供了 Mini USB 口作为管理口。</li>\n</ul>\n<p class=\"red\">6，Console 口登录：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w2CIe.png\" alt=\"图片\"></li>\n<li>[2] 使用 Console 线缆来链接交换机或路由器的 Console 口与计算机的 COM 口，这样就可以通过计算机实现本地调试和维护，S5720 和 AR2200E 的 Console 口是一种符合 RS232 串口标准的 RJ-45 接口。目前大多数台式电脑提供的 COM 口都可以与 Console 口连接。笔记本电脑一般不提供 COM 口，需要使用 USB 到 RS232 的转换接口。</li>\n</ul>\n<p class=\"red\">7，参数配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/13/6w2kRA.png\" alt=\"图片\"></li>\n<li>[2] 很多终端模拟程序都能发起 Console 连接，例如，可以使用超级终端程序连接到 VRP 操作系统。</li>\n<li>[3] 上图，使用超级终端连接 VRP 时，必须设置端口参数，上图是端口参数设置的实列，如果对参数值做了修改，需要恢复默认参数值。</li>\n<li>[4] 完成设置以后，点击 &quot;确认&quot; 按钮即可与 VRP 建立连接。</li>\n<li>[5] 在缺少超级终端程序的计算机上，可以使用\tputty 或 Secure CRT 程序发起 Console 连接，并连接到 VRP，配置参数与上图一致。</li>\n</ul>\n<p class=\"red\">8，Mini USB 口登录：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6w2DzR.png\" alt=\"图片\"></li>\n<li>[2] 华为 AR2200 系列路由器还支持 Mini USB 口与主机 USB 口建立连接，实现对设备的调试和维护。</li>\n<li>[3]<ins class=\"wavy\"> 在管理设备时，Console 口和 Mini USB 口互斥，即同一时刻只能使用其中一个接口连接 VRP。</ins></li>\n</ul>\n<p class=\"red\">9，Mini USB 驱动安装：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6w2bef.png\" alt=\"图片\"></li>\n<li>[2] 在使用 Mini USB 口建立连接前，需要在主机上安装驱动程序，可以从华为企业官方支持的网站下载到所需的驱动程序。</li>\n<li>[3]++ 目前，Mini USB 的驱动程序只能安装在 Win XP，Win Vista 和 Win7 操作系统上。</li>\n<li>[4] 华为企业官方网站网址：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS8lRTMlODAlODI=\">http://www.support.huawei.com/enterprise/。</span></li>\n</ul>\n<p class=\"red\">10，参数配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wRVfJ.png\" alt=\"图片\"></li>\n<li>[2] 安装驱动程序后，主机上会增加一个新的虚拟 COM 接口，终端模拟软件可以通过该虚拟 COM 接口连接到 VRP，</li>\n</ul>\n<p class=\"red\">11，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如果路由器收到了网络中主机发送的广播报文，会如何操作？</li>\n<li>当路由器收到该广播报文时，路由器会根据数据包内容尽享处理，可能会对必要广播报文 (如请求路由器 MAC 地址的 ARP 广播) 进行回应，但不会将该数据包转发到其他广播域。</li>\n<li>[2] 华为数通设备目前使用的 VRP 版本是多少？</li>\n<li>目前，大多数华为数通产品，使用的是 VRP5 版本，少数产品如 NE 系列路由器使用的是 VRP8 版本。</li>\n</ul>\n<h1 id=\"第九章命令行基础\"><a class=\"anchor\" href=\"#第九章命令行基础\">#</a> 第九章【命令行基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>熟悉 VRP 命令行并且熟练掌握 VRP 配置是高效管理华为网络设备的必备基础。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，设备初始化启动：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wWBK1.png\" alt=\"图片\"></li>\n<li>[2] 管理员和工程师如果要访问在通用路由平台 VRP 上运行的华为产品，首先要进入启动程序。</li>\n<li>[3] 开机界面信息提供了系统启动的运行程序和正在运行的 VRP 版本及其加载路径。</li>\n<li>[4] 启动完成以后，系统提示目前正在运行的是自动配置模式，用户可以选择继续使用自动配置模式或是进入手动配置模式。</li>\n<li>[5]<ins class=\"wavy\"> 如果选择手动配置模式，在提示符处输入 Y，在没有特别要求的情况下，我们选择手动配置模式。</ins></li>\n</ul>\n<p class=\"red\">2，命令行视图：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6wf6Lq.png\" alt=\"图片\"></li>\n<li>[2] VRP 分层的命令结构定义了很多命令行视图，每条命令只能在特定的视图中执行。</li>\n<li>[3] 上图，介绍了常见的命令行视图，每个命令都注册在一个或多个命令视图下，用户只有先进入这个命令所在的视图，才能运行相应的命令。</li>\n<li>[4]<ins class=\"wavy\"> 进入到 VRP 系统的配置界面后，VRP 上最先出现的视图是用户视图，在该视图下，用户可以查看设备的运行状态和统计信息。</ins></li>\n<li>[5] 若要修改系统参数，用户必须进入系统视图，用户还可以通过系统视图进入其他的功能配置视图，如接口视图和协议视图。</li>\n<li>[6]<ins class=\"wavy\"> 通过提示符可以判断当前所处的视图，例如，&quot;&lt;&gt;&quot; 表示用户视图，&quot;[]&quot; 表示除用户视图以外的其他视图。</ins></li>\n</ul>\n<p class=\"wavy\">3，命令行功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/6whn6s.png\" alt=\"图片\"></li>\n<li>[2] 其他快捷键功能如下：</li>\n<li>CTRL + B 将光标向左移动一个字符。</li>\n<li>CTRL + D 删除当前光标所在位置的字符。</li>\n<li>CTRL + E 将光标移动到当前行的末尾。</li>\n<li>CTRL + F 将光标向右移动一个字符。</li>\n<li>CTRL + H 删除光标左侧的一个字符。</li>\n<li>CTRL + N 显示历史命令缓冲区中的后一条命令。</li>\n<li>CTRL + P 显示历史命令缓冲区中的前一条命令。</li>\n<li>CTRL + W 删除光标左侧的一个字符串。</li>\n<li>CTRL + X 删除光标左侧所有的字符。</li>\n<li>CTRL + Y 删除光标所在位置及其右侧所有的字符。</li>\n<li>ESC + B 将光标向左移动一个字符串。</li>\n<li>ESC + D 删除光标右侧的一个字符串。</li>\n</ul>\n<p class=\"red\">4，命令行功能：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60NT2D.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，命令行在线帮助：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60U9xg.png\" alt=\"图片\"></li>\n<li>[2] VRP 提供两种帮助功能，分别是部分帮助和完全帮助。</li>\n<li>[3] 部分帮助是，当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符。可以使用命令行的部分帮助获取以该字符串开头的所有关键字，如上图所示。</li>\n<li>[4] 完全帮助是，在任一命令视图下，用户可以键入 “ ？” 获取该命令视图下所有的命令及其简单描述，如果建入一条命令关键字，后接以空格分割的 “ ？”，如果该位置为关键字，则列出全部关键字及其描述。</li>\n</ul>\n<p class=\"red\">6，基本配置步骤：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60U6FP.png\" alt=\"图片\"></li>\n<li>[2] 网络上一般都会部署不止一台设备，管理员需要 i 对这些设备进行统一管理，在进行设备调试的时候，首要任务是设置设备名。</li>\n<li>[3] 设备名用来唯一的标识一台设备。</li>\n<li>[4] AR2200E 路由器默认的设备名是 Huawei，而 S5720 交换机默认的设备名是 HUAWEI。</li>\n<li>[5] 设备名称一旦设置，立刻生效。</li>\n</ul>\n<p class=\"red\">7，配置系统时钟：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60adhV.png\" alt=\"图片\"></li>\n<li>[2] 系统时钟是设备上的系统时间戳，由于地域的不同，用户可以根据当地的规定时钟系统时钟，用户必须正确设置系统时钟以确保其与其他设备保持同步。</li>\n</ul>\n<p class=\"red\">8，配置标题消息：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60dQER.png\" alt=\"图片\"></li>\n<li>[2] header 命令用来设置用户登录设备时终端上显示的标题信息。</li>\n<li>[3] Login 参数指定当用户在登录设备认证过程中，激活终端连接 s 时显示的标题信息。</li>\n<li>[4] shell 参数指定当用户成功登录到设备上，已经建立会话时显示的标题信息。</li>\n<li>[5] header 的内容可以是字符串或文件名。当 header 的内容为字符串时，标题信息以第一个英文字符作为起使符号，最后一个相同的英文字符作为结束符，通常情况下，建议使用英文特殊符号，并需要确保在信息正文中没有此符号。</li>\n<li>[6] 上图，header 的内容时字符串，字符串可以包含 1-2000 字符，包含空格。使用 header {login|shell} information text 命令能设置字符串形式的 header。</li>\n<li>[7] 若要设置文件形式的 header，使用 header {login|shell} file file-name 命令。file name 参数 z 指定了标题信息所使用的文件名，登录前后，该文件的内容将以文本的形式显示。</li>\n</ul>\n<p class=\"red\">9，命令等级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60wYiq.png\" alt=\"图片\"></li>\n<li>[2] 缺省情况下命令级别分为 0<sub>3 级，用户级别分为 0</sub>15 级。</li>\n<li>[3]<ins class=\"wavy\"> 用户 0 级为访问级别，对应网络诊断工具命令 (Ping，Tracert)，从设备出发访问外部的命令 (Telnet 客户端)，部分 display 命令等。</ins></li>\n<li>[4]<ins class=\"wavy\"> 用户 1 级为监控级别，对应命令级 0，1 级，包括用于系统维护的命令以及 display 等命令。</ins></li>\n<li>[5]<ins class=\"wavy\"> 用户 2 级是配置级，包括向用户提供直接网络服务，包括路由，各个网络层次的命令。</ins></li>\n<li>[6]<ins class=\"wavy\"> 用户 3-15 级是管理级别，对应命令 3 级，该级别主要用于系统运行的命令，对业务提供支撑作用，包括文件系统，FTP，TFTP 下载，文件交换配置，电源供应配置，备份板控制，用户管理，命令级别设置，系统内部参数配置以及用于业务故障诊断的 debugging 命令。</ins></li>\n<li>[7] 上图，展示了如何修改命令级别，在用户视图下执行 save 命令，需要 3 级权限。</li>\n<li>[8]<ins class=\"wavy\"> 在具体使用中，如果我们有多个管理员账号，但只允许某一个管理员保存系统配置，则可以将 save 命令的级别提高到 4 级，并定义只有该管理员有 4 级权限，这样在不影响其他用户的情况下，可以实现对命令的使用控制。</ins></li>\n</ul>\n<p class=\"red\">10，用户界面：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60DisU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：VTY 接口最大可配置范围为 0-14。</ins></li>\n<li>[2] 每类用户界面都有对应的用户界面视图，用户界面 (User-interface) 视图是系统提供的一种命令行视图，用来配置和管理所有工作在异步交互方式下的物理接口和逻辑接口。从而达到统一管理各种用户界面的目的。</li>\n<li>[3] 在连接设备前，用户要设置用户界面参数，系统支持的用户界面包括 Console 用户界面和 VTY 用户界面。</li>\n<li>[4] 控制口 (Console Port) 是一种通信串行端口，由设备的主控板提供。</li>\n<li>[5] 虚拟类型终端 (Virtual Type Terminal) 是一种虚拟线路端口，用户通过终端与设备建立 Telnet 或 SSH 连接后，也就建立了一条 VTY。即用户可以通过 VTY 方式登录设备。</li>\n<li>[6] 设备一般最多支持 15 个用户同时通过 VTY 方式访问。</li>\n<li>[7] 执行 user-interface maximum-vty number 命令可以配置同时登录到设备的 VTY 类型用户界面的最大个数，如果将最大登录用户数设为 0，则任何用户都不能通过 Telnet 或 SSH 登录到路由器。display user-interface 命令来查看用户界面信息。</li>\n<li>[8]<ins class=\"wavy\"> 不同的设备，或使用不同版本的 VRP 软件系统，具体可以被使用的 VTY 接口的最大数量可能不同。</ins></li>\n</ul>\n<p class=\"red\">11，配置用户界面命令：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/60sNKf.png\" alt=\"图片\"></li>\n<li>[2] 用户可以设置 Console 界面和 VTY 界面属性，以提高系统安全性。如果一个连接上设备的用户一直处于空闲状态而不断开，可能会给系统带来很大的风险，所以在等待一个超时时间后，系统会自动中断连接，这个闲置切断时间又称为超时时间，默认为 10 分钟。</li>\n<li>[3] 当 display 命令输出的信息超过一页时，系统会对输出内容进行分页，使用空格切换下一页。</li>\n<li>[4] 如果一页输出的内容过少或过多，用户可以执行 screen-length 命令修改信息输出时一页的行数，默认行数为 24，最大支持 512 行，不建议将行数设置为 0，因为这样不会显示任何内容。</li>\n<li>[5] 每条命令执行后，执行的记录都保存在历史命令缓存区。历史命令缓存区\t默认能存储 10 条命令，可以通过运行 history-command max-size 改变可存储的命令数，最多可存储 256 条。</li>\n</ul>\n<p class=\"red\">12，配置登录权限：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/14/606zvt.png\" alt=\"图片\"></li>\n<li>[2] 如果没有权限限制，未授权的用户就可以，使用设备获取信息并更改配置，从设备安全角度考虑，限制用户的访问和操作权限是很有必要的，<ins class=\"wavy\">用户权限和用户认证</ins>是提升终端安全的两种方式。用户权限要求规定用户的级别，一定级别的用户只能 z 执行特定级别的命令。</li>\n<li>[3] 配置用户界面的用户认证方式后。用户登录设备时，需要输入密码 j 进行认证，这样就 x 限制了用户访问设备的权限，在通过 VTY 进行 Telnet 连接时，所有接入设备的 y 用户都必须要经过认证。</li>\n<li>[4] 设备提供三种认证模式，AAA 模式，密码认证模式和不认证模式。AAA 认证模式具有很高的安全性，因为登陆时必须输入用户名和密码。密码认证只需要输入登录密码就行，所以所有的用户使用的都是同一个密码，使用不认证模式就是不需要对用户认证直接登录到设备，需要注意的是，Console 界面默认使用不认证模式。</li>\n<li>[5] 对于 Telnet 登录用户，授权是非常必要的，最好设置用户名，密码和指定和账号相关联的权限。</li>\n<li>[6] 注：不同 VRP 版本执行 set authentication password cipher 命令有差异，有些平台需要回车后 s 输入密码，另外一些平台可以直接在命令行后输入密码，故，在操作具体产品时，需要查阅相应的 VRP 版本。</li>\n</ul>\n<p class=\"red\">13，配置接口地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BQdoD.png\" alt=\"图片\"></li>\n<li>[2] 要在接口运行 IP 服务，必须为接口配置一个 IP 地址，一个接口一般只需要一个 IP 地址，在特殊情况下，也有可能为接口配置一个次要的 IP 地址。</li>\n<li>[3] 例如，当路由器 AR2200E 的接口连接到一个物理网络时，该物理网络中的主机属于两个网段，为让两个网段的主机都可以通过路由器 AR2200E 访问其他网络，可以配置一个主 IP 地址和一个次要 IP 地址，一个接口只能有一个主 IP 地址，如果接口配置了新的主 IP 地址，那么新的主 IP 地址就代替了原来的主 IP 地址。</li>\n<li>[4] Lookback 接口是一个逻辑接口，可用来虚拟一个网络或者一个 IP 主机，在运行多种协议的时候，由于 Lookback 接口稳定可靠，所以也可以用来做管理接口。</li>\n<li>[5] 如果接口处于 Down 状态，应使用 undo shuttdown 打开该接口。</li>\n</ul>\n<p class=\"red\">14，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 华为网络设备支持多少个用户同时使用 console 口登录？</li>\n<li>华为网络设备同时只能有一个用户登录 Console 界面，因此 Console 用户的编号固定为 0</li>\n<li>[2] 在使用命令 interface lookback interface 0 之后，lookback 0 接口的状态是什么？</li>\n<li>Lookback 口是一种逻辑接口，在未创建之前，Lookback 接口并不存在，从创建开始，Lookback 口就一直存在，并一直保持 Up 状态，除非被手动关闭。</li>\n</ul>\n<h1 id=\"第十章文件系统基础\"><a class=\"anchor\" href=\"#第十章文件系统基础\">#</a> 第十章【文件系统基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>华为网络设备的配置文件和 VRP 系统文件都保存在物理储存介质中，所以文件系统是 VRP 正常运行的基础。只有掌握了对文件系统的基本操作，网络工程师才能对设备的配置文件和 VRP 系统文件进行高效的管理。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，基本查询命令：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BlvHf.png\" alt=\"图片\"></li>\n<li>[2] 上图，在用户始于中使用 dir 命令，可以查看 flash 中的文件信息。</li>\n</ul>\n<p class=\"red\">2，目录操作：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BGLi8.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，文件操作 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BGjzQ.png\" alt=\"图片\"></li>\n<li>[2] 文件操作包括：复制，移动，重命名，压缩，删除，恢复等。</li>\n</ul>\n<p class=\"red\">4，文件操作 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/15/6BJFiT.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，配置文件管理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTCS1.png\" alt=\"图片\"></li>\n<li>++ 注：设备启动时，会加载保存的配置文件到 RAM，并作为当前配置文件。</li>\n<li>[2] 设备中的配置文件分为两种类型：<ins class=\"wavy\">当前配置文件和保存的配置文件。</ins>。</li>\n<li>[3] 当前配置文件保存在设备的 RAM 中，用户可以通过命令行对设备进行配置，配置完成后使用 save 命令保存当前配置到储存设备中，形成保存的配置文件。</li>\n<li>[4]++ 保存的配置文件都是以 “.cfg” 或 “.zip” 作为扩展名，存放在储存设备的根目录下。</li>\n<li>[5] 在设备启动时，会从默认的储存路径下加载保存的配置文件到 RAM 中，如果默认储存路经中没有保存的配置文件，则设备会使用缺省参数进行初始化配置。</li>\n</ul>\n<p class=\"red\">6，配置文件查询：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTapn.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">7，配置文件保存：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yTHtH.png\" alt=\"图片\"></li>\n<li>[2] SAVE 命令可以用来保存当前配置信息到系统默认的储存路径中。</li>\n</ul>\n<p class=\"red\">8，系统启动文件查询：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6y79Ag.png\" alt=\"图片\"></li>\n<li>[2] display startup 命令用来查看设备本次及下次启动相关的系统软件，备份系统软件，配置文件，License 文件，补丁文件以及语音文件。</li>\n<li>[3] Startup system software 表示的是本次系统启动所使用的 VRP 文件。</li>\n<li>[4] Next startup system software 表示的是下次系统启动所使用的 VRP 文件。</li>\n<li>[5] Startup save-configuration file 表示得是本次系统启动所使用的配置文件。</li>\n<li>[6] Next startup save-configuration file 表示得是下次系统启动所使用的配置文件。</li>\n</ul>\n<p class=\"red\">9，系统启动配置文件修改：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yHVGd.png\" alt=\"图片\"></li>\n<li>[2] 设备启动时，会从储存设备中加载配置文件并进行初始化，如果储存设备中，没有配置文件，设备将会使用默认参数进行初始化。</li>\n<li>[3] configuration-file 参数为系统启动配置文件的名称。</li>\n</ul>\n<p class=\"red\">10，比较当前配置和保存的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/16/6yHldS.png\" alt=\"图片\"></li>\n<li>[2] compare configuration (configuration-file)(current-line-number save-line-number) 命令用来比较当前的配置与下次启动的配置文件内容的区别，configuration-file 指定需要与当前配置进行比较的配置文件名，current-line-number 表示从当前配置的该行号开始比较，save-line-number 表示从指定配置的该行号开始比较。</li>\n<li>[3] 当执行该命令后，系统默认会将保存的配置与当前得到配置从第一行开始逐行比较。</li>\n<li>[4] 系统比较出不同之处后，将从两者有差别的地方开始显示字符，默认显示 120 个字符。如果从该不同之处到文件末尾不足 120 个字符，将显示到文件尾为止。</li>\n</ul>\n<p class=\"red\">11，配置文件重置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybVTU.png\" alt=\"图片\"></li>\n<li>[2] reset saved-configuration 命令用来清除储存设备中启动配置文件的内容。</li>\n<li>[3] 执行该命令后，如果不使用该命令 startup save-configuration 重新指定设备下次启动时使用的配置文件，也不使用 save 命令保存配置文件，则设备下次启动时会采用缺省的配置参数进行初始化。</li>\n</ul>\n<p class=\"red\">12，存储设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybd1A.png\" alt=\"图片\"></li>\n<li>[2] 存储设备包括 SDRAM，Flash，NVRAM，SD 卡，U 盘等。例如，AR2200E 的路由器有内置的闪存，该路由器提供了两个预留的 USB 插槽 (USB0 和 USB1) 和一个 SD 卡插槽 (SD0)。</li>\n<li>[3] S5720 交换机包含了一个内置闪存，该闪存根据型号不同，存储容量也不同，S5720-EI 支持 340M 内存，S5720-HI 支持 400M 闪存。</li>\n<li>[4]++ 执行 display version 命令可以查看华为存储设备的详细信息。</li>\n</ul>\n<p class=\"red\">13，存储设备修复：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6ybbh4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当存储设备的文件系统出现异常时，可以通过 fixdisk 命令进行修复。</ins></li>\n<li>[2] fixdisk 命令用来对文件系统出现异常的存储设备进行修复，当存储设备上的文件系统出现异常时，终端会给出提示信息，此时建议使用此命令进行修复，但不确保修复成功。</li>\n<li>[3]<ins class=\"wavy\"> 执行此命令后，如果仍然收到系统建议修复的信息，则表示物理介质可能已经损坏。</ins></li>\n<li>此命令是问题修复类命令，在系统未出现问题时，建议用户不要执行此命令。</li>\n<li><ins class=\"wavy\">有些 VRP 版本不支持 fixdisk 命令，在操作具体产品时请查阅相应的 VRP 文档。</ins></li>\n</ul>\n<p class=\"red\">14，存储设备格式化：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yqF9H.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：格式化会导致数据丢失。</ins></li>\n<li>[2] 当文件系统出现异常无法修复时，并且确认不在需要存储器上的所有数据时，可格式化存储设备。格式化存储设备会导致设备上的数据丢失，且这些文件不能恢复。</li>\n<li>[3] format (devicename) 命令用来格式化存储器，在执行 format 命令时，需要指定 devicename 参数，表示格式化特定的存储器，在执行此命令后，会清空指定存储器中的所有文件和目录，并且不可恢复，所以谨慎使用 format 命令！</li>\n<li>[4] 有些 VRP 版本不支持 format 命令。</li>\n</ul>\n<p class=\"red\">15，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 设备中的文件属性有 drw，其中 d 代表什么含义？</li>\n<li>d 表明是个目录，r，w，是可读出，可写入的意思。</li>\n<li>[2] 如果设备中有多个配置文件，如何指定下次启动时使用的配置文件？</li>\n<li>配置文件可以不使用默认的文件名 vrp.cfg, 而用其他指定的名称保存到路由器或交换机中，如果需要指定某一个配置文件为下次启动时使用的配置文件，可以执行 startup saved-configuration (configuration-file-name) 命令，这里的配置文件名包括文件名称和拓展名。</li>\n</ul>\n<h1 id=\"第十一章vrp系统管理\"><a class=\"anchor\" href=\"#第十一章vrp系统管理\">#</a> 第十一章【VRP 系统管理】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>为了满足企业业务对网络的需求，网络设备中的系统文件需要不断进行升级，另外，网络设备中的配置文件也需要时常进行备份，以防设备故障或其他灾害个业务带来损害。</li>\n<li>在升级和备份系统文件或配置文件时，经常会使用 FTP 和 TFTP 来传输文件。</li>\n<li>++ 注：使用 FTP，TFTP，SFTPv1 协议存在安全风险，建议使用 SFTPv2 方式进行文件操作。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，升级 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yLnMR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：随着 VRP 版本的更新，VRP 支持的特性也越来越多，可根据需求更新 VRP 版本。</ins></li>\n</ul>\n<p class=\"red\">2，文件传输：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6yOCSH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：网络设备可以从服务器获取 VRP 系统文件，也可以将日志文件，配置文件保存到服务器作为备份。</ins></li>\n<li>[2] 文件传输是指发送文件到远程服务器，或者从远程服务器获取文件的过程。</li>\n<li>[3] 在实际场景中，为满足企业业务的需求。设备的 VRP 文件需要更新，如上图所示，设备在与服务器建立连接之后，可以从服务器获取新的 VRP，完成更新工作。</li>\n<li>[3] 为避免数据丢失对业务造成影响，设备的配置文件和日志文件也通常会进行备份，如上图所示，设备在与服务器建立连接之后，可以将配置文件，日记文件传输到服务器上，完成备份工作，当设备上的文件丢失后，可以恢复之前服务器上备份的配置文件和日志文件。</li>\n</ul>\n<p class=\"red\">3，文件传输协议：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cTK61.png\" alt=\"图片\"></li>\n<li><ins class=\"red\">注：常用的文件传输协议有 FTP 和 TFTP 两种。</ins></li>\n<li>[2] FTP (File Transfer Protocol) 是 TCP/IP 协议族中一种<ins class=\"wavy\">应用层协议</ins>，称为文件传输协议。</li>\n<li>[3] FTP 的主要功能是向用户提供本地和远程主机之间的文件传输。++ 在进行版本升级，日记下载和配置保存等业务操作时，会广泛地使用到 FTP，</li>\n<li>[4] FTP 采用两个 TCP 连接：<ins class=\"wavy\">控制连接和数据连接</ins>。其中控制连接用于连接控制端口，传输控制命令。数据连接用于连接数据端口。传输数据。在控制连接建立后，数据连接通过控制端口的命令建立起连接，进行数据的传输。</li>\n<li>[5] FTP 数据连接的建立有两种：<ins class=\"wavy\">主动模式和被动模式。</ins>两者之间的区别在于数据连接是由服务器发起还是客户端发起。</li>\n<li>[6] ARG3 系列路由器既可以作为 FTP Client 又可以作为 FTP Server。缺省情况下，AR2200 采用主动模式建立数据连接。</li>\n<li>[7] TFTP (Trivial File Transfer Protocol) 是一种简化的文件传输协议，TFTP 协议使用 UDP 协议进行文件的传输，由客户端发起 TFTP 传输请求，实现文件的上传和下载。ARG3 系列路由器只可以作为 TFTP 客户端。</li>\n</ul>\n<p class=\"red\">4，VRP 系统文件更新配置 —— 与 FTP 服务器连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cHERJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在通过 FTP 传输任何数据之前，首先必须保证 FTP 客户端和 FTP 服务器之间可以通信。</ins></li>\n</ul>\n<p class=\"red\">5，VRP 系统文件更新配置 —— 查看剩余存储空间：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cHgLq.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：当剩余存储空间不足时，可以删除无关的 VRP 文件或其他文件以释放空间。</ins></li>\n<li>[2] 在获取 VRP 文件之前，还要确认设备有足够的存储空间来存储新获取的 VRP 文件，可以用 dir 命令来检查当前目录中的文件和可用空间，如果存储空间不足，需要删除无关文件来释放足够的空间，上图，通过 delete 命令删除以存在的无关 VRP 文件来获取了足够的空间。</li>\n</ul>\n<p class=\"red\">6，VRP 系统文件更新配置 - 从 FTP 服务器获取 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cXcVI.png\" alt=\"图片\"></li>\n<li>[2] 如需从 FTP 服务器获取文件，客户端需要使用 ftp [ip address] 命令来发起 FTP 连接请求，其中 ip address 指的是 FTP 服务器的 IP 地址，客户端和 FTP 服务器建立连接之后，客户端需要使用 FTP 服务器中配置的用户名和密码进行认证。认证通过后，客户端可以访问 FTP 服务器，并且能够查看和下载存储在服务器中的文件。</li>\n<li>[3] 上图，客户端使用 ftp 10.1.1.2 和 FTP 服务器建立了连接，使用 get AR2220E-V200R007C00SPC600.cc 命令可以获取位于 FTP 服务器上的 VRP 文件。</li>\n</ul>\n<p class=\"red\">7，VRP 系统文件更新配置 —— 从 TFTP 服务器获取 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6cxMPP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARG3 路由器只需使用上述命令即可从 TFTP 服务器获取 VRP 文件。</ins></li>\n<li>[2] 如果客户端需要从 TFTP 服务器获取 VRP 文件，则不需要首先和 TFTP 服务器建立连接。</li>\n<li>[3]<ins class=\"wavy\"> ARG3 系列路由器和 X7 系列交换机只能作为 TFTP 客户端。</ins></li>\n<li>[4] 上图，客户端通过配置 TFTP 10.1.1.2 get AR2220E-V200R003SPC600.cc 就可以从 TFTP 服务器获取 VRP 文件。</li>\n</ul>\n<p class=\"red\">8，VRP 系统文件更新配置 - 指定下次启动时加载的 VRP：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6czTpV.png\" alt=\"图片\"></li>\n<li>[2] 从服务器成功获取 VRP 文件后，还需要配置此文件为设备下次启动时的系统文件，否则，设备仍会使用旧版本的 VRP 系统文件。</li>\n<li>[3] 在设备上通过使用 startup system-software 命令可以指定下次启动的系统文件。</li>\n<li>[4] VRP 系统文件必须存储在根目录。否则。系统不能正常运行。</li>\n<li>[5] 上图，可以使用 display startup 命令去验证系统启动文件是否已经变更，显示信息中 Startup system software 显示当前系统启动使用的 VRP 文件，Next startup system software 显示下次系统启动使用的 VRP 文件。</li>\n</ul>\n<p class=\"red\">9，VRP 系统文件更新配置 —— 重启设备：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gPyqO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：设备重启后，将会加载新的 VRP 系统。</ins></li>\n<li>[2] 确认系统下次启动软件正确后，需要重启设备，使用 reboot 命令可以重启设备，输入此命令后，系统会提示是否保存配置文件，实际中，可根据需要进行选择，上图选择了不保存配置。</li>\n</ul>\n<p class=\"red\">10，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 设备作为 FTP 客户端时，如何从服务器下载 VRP?</li>\n<li>首先必须保证客户端和服务器之间可以通信，然后客户端需要使用 ftp [IP address] 命令与服务器建立 FTP 连接，建立连接之后需要输入正确的用户名和密码进行验证，验证通过后使用 get 命令即可下载 VRP。</li>\n<li>[2] 在完成 VRP 升级并重启之后，管理员如何确认升级成功？</li>\n<li>管理员可以使用 display startup 命令验证系统启动的 VRP 软件。以此来判断\tVRP 升级是否成功。</li>\n</ul>\n<h1 id=\"第十二章交换网络基础\"><a class=\"anchor\" href=\"#第十二章交换网络基础\">#</a> 第十二章【交换网络基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>常见的以太网设备包括 Hub，交换机等。交换机工作在数据链路层，它有效地隔离了以太网中的冲突域，极大地提升了以太网的性能。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，小型交换网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gi5tJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机工作在数据链路层，转发数据帧。</ins></li>\n<li>[2] 随着企业网络的发展，越来越多的用户需要接入到网络，交换机提供了大量的接入接口能够很好地满足了这种需求，同时，交换机也彻底解决了困扰早期以太网冲突问题，极大地提升了以太网的性能，同时也提供了以太网的安全性。</li>\n<li>[3] 交换机工作在数据链路层，对数据帧进行操作，在收到数据帧后，交换机会根据数据帧的头部信息对数据帧进行转发。</li>\n</ul>\n<p class=\"red\">2，交换机的转发行为：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gFWvt.png\" alt=\"图片\"></li>\n<li>[2] 交换机中有一个 MAC 地址库，里面存放了 MAC 地址与交换机端口的映射关系，MAC 地址表也称为 CAM (Content Addressable Memory) 表。</li>\n<li>[3] 上图，++ 交换机对帧的转发操作行为一共有三种：泛洪 (Flooding)，转发 (Forwarding)，丢弃 (Discarding)。</li>\n<li>[4] 泛洪 (Flooding)：交换机把从某一个端口进来的帧通过所有其他的端口转发出去 (注意，&quot;所有其他的端口&quot; 是指除了这个帧进入交换机的那个端口以外的所有端口)。</li>\n<li>[5] 转发 (Forwarding)：交换机把从某一端口进来的帧通过另一个端口转发出去 (注意，&quot;另一个端口&quot; 是指不是这帧进入交换机得到那个端口).。</li>\n<li>[6] 丢弃 (Discarding)：交换机把从某一端口进来的帧直接丢弃。</li>\n<li>[7] 交换机的基本工作原理可以概括地描述如下：</li>\n<li>①如果进入交换机的是一个单播帧，则交换机会去 MAC 地址表中查找这个帧的目的 MAC 地址。</li>\n<li>如果查不到这个 MAC 地址，则交换机执行泛洪操作。</li>\n<li>如果查到了这个 MAC 地址，则比较这个 MAC 地址在 MAC 地址表中对应的端口是不是这个帧进入交换机的那个端口，如果不是，则交换机执行转发操作，如果是，则交换机执行丢弃操作。</li>\n<li>[8] 如果进入交换机的是一个广播帧，则交换机不会去查 MAC 地址表，而是执行泛洪操作。</li>\n<li>[9] 如果进入交换机的是一个组播组，则交换机的处理行为比较复杂，另外，交换机还具有学习功能，当一个帧进入交换机后，交换机会检查这个帧的源 MAC 地址，并将该源 MAC 地址与这个帧进入交换机的那个端口进行映射，然后将这个映射关系存放进 MAC 地址表。</li>\n</ul>\n<p class=\"red\">3，交换机初始状态：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gACef.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：初始状态下，交换机 MAC 地址表为空。</ins></li>\n<li>[1] 初始状态下，交换机并不知道所连接主机的 MAC 地址，所以 MAC 地址表为空，上图，SWA 为初始状态，在收到主机 A 发送的数据帧之前，MAC 地址表中没有任何表项。</li>\n</ul>\n<p class=\"red\">4，学习 MAC 地址：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gAQTU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机将收到的数据帧的源 MAC 地址和对应接口记录到 MAC 地址表中。</ins></li>\n<li>[2] 主机 A 发送数据给主机 C 时，一般会首先发送 ARP 请求来获取主机 C 的 MAC 地址，此 ARp 请求帧中的目的 MAC 地址是广播地址，源 MAC 地址是自己的 MAC 地址。</li>\n<li>[3] SWA 收到该帧后，会将源 MAC 地址和接收端口的映射关系添加到 MAC 地址表中，缺省情况下，X7 系列交换机学习到的 MAC 地址表项的老化时间为 300 秒。</li>\n<li>[4] 如果在老化时间内再次收到主机 A 发送的数据帧，SWA 中保存的主机 A 的 MAC 地址和 G0/0/1 的映射的老化时间会被刷新。</li>\n<li>[5] 此后，如果交换机收到目标 MAC 地址为 00-01-02-03-04-AA 的数据帧时，都将通过 G0/0/1 端口转发。</li>\n</ul>\n<p class=\"red\">5，转发数据帧：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/17/6gAxNF.png\" alt=\"图片\"></li>\n<li>++ 注：当数据帧的目的 MAC 地址不在 MAC 表中，或者目的 MAC 地址为广播地址时，交换机会泛洪该帧。</li>\n<li>[2] 上图，主机 A 发送的数据帧的目的 MAC 地址为广播地址，所以交换机会将此数据帧通过 G0/0/2 和 G0/0/3 端口广播到主机 B 和主机 C。</li>\n</ul>\n<p class=\"red\">6，目标主机回复：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gEe4e.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机根据 MAC 地址表将目的主机的回复信息单播转发给源主机。</ins></li>\n<li>[2] 主机 B 和主机 C 收到此数据帧后，都会查看该 ARP 数据帧，但是主机 B 不会回复该帧，主机 C 会处理该帧并发送 ARP 回应。此回复数据帧的目的 MAC 地址为主机 A 的 MAC 地址，源 MAC 地址为主机 C 的 MAC 地址。</li>\n<li>[3] SWA 收到回复数据帧时，会将该帧的源 MAC 地址和接口的映射关系添加到 MAC 地址表中。</li>\n<li>[3] 如果此映射关系在 MAC 地址表已经存在，则会被刷新，然后 SWA 查询 MAC 地址表，根据帧的目的 MAC 地址找到对应的转发端口后，从 G0/0/1 转发此数据帧。</li>\n</ul>\n<p class=\"red\">7，基本配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gVpa8.png\" alt=\"图片\"></li>\n<li>[2] 早期的以太网的工作模式都是 10M 半双工的，随着技术的发展，出现了全双工模式，接着又出现了百兆和千兆以太网，采用不同工作模式的设备无法直接相互通信，自协商技术的出现解决了不同以太网工作模式之间的兼容性问题。</li>\n<li>[3]<ins class=\"wavy\"> 自协商的内容主要包括双工模式和运行速率，一旦协商通过，链路两端的设备就具有相同的工作参数。</ins></li>\n<li>[4] negotiation auto 命令用来设置以太网端口的自协商功能，端口是否应该使能自协商模式，要考虑对接双方设备的端口是否都支持自动协商，如果对端设备的以太网端口不支持自协商模式，则需要在本端端口上先使用 undo negotiation\tauto 命令配置为非自协商模式，之后，修改本端端口的速率和双工模式保持与对端一致，确保通信正常。</li>\n<li>[5] duplex 命令用来设置以太网端口的双工模式，GE 电口工作速率为 1000Mbit/s 时，只支持全双工模式，不需要与链路对端的端口共同协商双工模式。</li>\n<li>[6] speed 命令用来设置端口的工作速率，配置端口的速率和双工模式之前需要先配置端口为非自协商模式。</li>\n<li>[7] 因产品型号的不同，华为交换机可能不支持更改端口双工模式。</li>\n</ul>\n<p class=\"red\">8，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gZLnI.png\" alt=\"图片\"></li>\n<li>[2] display interface () interface-type (interface-number (.sumnumber))) 命令用来查看端口当前运行状态和统计信息。</li>\n<li>[3] current state 表示端口的物理状态，如果为 UP，表示端口处于打开状态。</li>\n<li>[4] Line protocol current state 表示端口的链路协议状态，如果为 UP，表示端口的链路协议处于正常的启动状态。</li>\n<li>[5] Speed 表示端口的工作速率，SWA 的 G0/0/1 端口工作速率为 100Mbits/s。</li>\n<li>[6] duplex 表示端口的双工模式，SWA 的 G0/0/1 端口双工模式为全双工。</li>\n</ul>\n<p class=\"red\">9，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 当一台主机从交换机的一个端口移动到另一个端口时，交换机的 MAC 地址表会发生什么变化？</li>\n<li>当一台主机从交换机的一个端口移除时，交换机检测到物理链路 Down 因此会从 MAC 地址表中清除对应主机的 MAC 表项，一旦主机连接到交换机的另一个端口，交换机会检测到新端口对应的物理链路 UP。主机发送报文后，交换机就会学习到主机的 MAC 地址和新端口映射关系，并且添加到 MAC 地址表中。</li>\n</ul>\n<h1 id=\"第十三章stp原理与配置\"><a class=\"anchor\" href=\"#第十三章stp原理与配置\">#</a> 第十三章【STP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>为了提高网络的可靠性，交换网络中通常会使用冗余链路。然而，冗余链路会给交换网络带来环路风险，并导致广播风暴以及 MAC 地址表不稳定等问题，进而会影响到用户的通信质量，生成树协议 STP (Spanning Tree Protocol) 可以在提高可靠性的同时又能避免环路带来的各种问题。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，二层交换网络：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g1NjS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机之间通过多条链路互联时，虽然能够提升网络可靠性，但同时也会带来环路问题。</ins></li>\n<li>[2] 随着局域网规模的不断扩大，越来越多的交换机被用来实现主机之间的互联，如果交换机之间仅使用一条链路互联，则可能会出现单点故障，导致业务中断。为了解决此类问题，交换机在互联时一般都会使用冗余链路来实现备份。</li>\n<li>[3] 冗余链路虽然增强了网络的可靠性，但是也会产生环路，而环路会带来一系列的问题，继而导致通信质量下降和通信业务中断等问题。</li>\n</ul>\n<p class=\"red\">2，广播风暴：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g3FKS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：环路会产生广播风暴。</ins></li>\n<li><ins class=\"wavy\">注：网络中的主机会收到重复数据帧。</ins></li>\n<li>[2] 根据交换机的转发原则，如果交换机从一个端口上接收到的是一个广播帧，或者是一个目的 MAC 地址未知的单播帧，则会将这个帧向除源端口之外的使用其他端口转发。如果交换网络中有环路，则这个帧会被无限转发，此时便会形成广播风暴，网络中也会充斥着重复的数据帧。</li>\n<li>[3] 上图，主机 A 向外发送了一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在。SWB 接收到此帧后，将其转发到 SWA 和 SWC，SWA 和 SWC 也会将此帧转发到除了接收此帧的其他所有的接口，结果此帧又会被再次转发给 SWB，这种循环会一直持续，于是便产生了广播风暴，交换机性能会因此急剧下降，并会导致业务中断。</li>\n</ul>\n<p class=\"red\">3，MAC 地址表震荡：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g3U8x.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：环路会引起 MAC 地址表震荡。</ins></li>\n<li>[2] 交换机是根据所收到的数据帧的源地址和接收端口生成 MAC 地址表项的。</li>\n<li>[3] 主机 A 向外发送一个单播帧，假设此单播帧的目的 MAC 地址在网络中所有交换机的 MAC 地址表中都暂时不存在，SWB 收到此数据帧后，在 MAC 地址表中生成一个 MAC 地址表项，00-01-02-03-04-AA，对应端口为 G0/0/3，并将其从 G0/0/1 和 G0/0/2 端口转发，上图仅以 G0/0/1 转发此帧。</li>\n<li>[4] SWA 收到此帧后，由于 MAC 地址表中没有对应此帧目的 MAC 地址的表项，所以 SWA 会将此帧从 G0/0/2 端口发送出去。</li>\n<li>[5] SWC 接收到此帧后，由于 MAC 地址表中也没有对应此帧的目的 MAC 地址的表项，所以 SWC 会将此帧从 G0/0/2 端口发送回 SWB，也会发给主机 B。</li>\n<li>[6] SWB 从 G0/0/2 接口接收到此数据帧之后，会在 MAC 地址表中删除原有的相关表项，生成一个新的表项，00-01-02-03-04-AA，对应端口为 G0/0/2。此过程会不断重复，从而导致 MAC 地址表震荡。</li>\n</ul>\n<p class=\"red\">4，STP 的作用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6g8Okd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：STP 通过阻塞端口来消除回路，并能够实现链路备份的目的。</ins></li>\n<li>[2] 在以太网中，二层网络的环路会带来广播风暴，MAC 地址表震荡，重复数据帧等问题，为了解决交换网络中的环路问题，提出了 STP。</li>\n<li>[3] STP 的主要作用：</li>\n<li>消除环路：通过阻断冗余链路来消除网络中可能存在的环路。</li>\n<li>链路备份：当活动路径发送故障时，激活备份链路，及时恢复网络连通性。</li>\n</ul>\n<p class=\"red\">5，STP 操作：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gG5Nj.png\" alt=\"图片\"></li>\n<li>[2] STP 通过改造一棵树来消除交换网络中的环路。</li>\n<li>[3] 每个 STP 网络中，都会存在一个根桥，其他交换机为非根桥，根桥或者根交换机位于整个逻辑树的根部，是 STP 网络的逻辑中心，非根桥是根桥的下游设备，当现有根桥产生故障时，非根桥之间会交互信息并重新选举根桥，交互的这种信息被称为 BPDU，BPDU 中包含交换机在参加\t生成树计算时的各种参数信息。</li>\n<li>[4] STP 中定义了三种端口角色：指定端口，根端口和预备端口。</li>\n<li>[5] 指定端口是交换机向所连网段转发配置 BPDU 的端口，每个网段有且只能有一个指定端口。一般情况下，根桥的每一个端口总是指定端口。</li>\n<li>[6] 根端口是非根交换机去往根桥路径最优的端口，在一个运行 STP 的交换机上最多只有一个根端口，但根桥上没有根端口。</li>\n<li>[7] 如果一个端口既不是指定端口也不是根端口，则此端口为预备端口，预备端口将被阻塞。</li>\n</ul>\n<p class=\"red\">6，根桥选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gYxpR.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每一台交换机启动 STP 后，都认为自己是根桥。</ins></li>\n<li>[2]<ins class=\"wavy\"> STP 中根桥的选举依据是桥 ID，</ins>STP 中的每个交换机都会有一个桥 ID (Bridge ID)。桥 ID 由 16 位桥优先级 (Bridge priority) 和 48 位的 MAC 地址构成，在 STP 网络中，桥优先级是可以配置的，取值范围 0~65535，默认值 32768，优先级最高的设备 (数值越小越优先) 会被选举为根桥，如果优先级相同，则会比较 MAC 地址，MAC 地址越小则越优先。</li>\n<li>[3] 交换机启动后就自动进行生成树收敛计算，默认情况下，所有交换机启动时都认为自己是根桥，自己的所有端口都为指定端口，这样 BPDU 报文就可以通过所有端口转发，对在端交换机收到 BPDU 报文后，会比较 BPDU 中的根桥 ID 和自己的桥 ID。如果收到的 BPDU 报文中的桥 ID 优先级最高，则交换机会修改自己的 BPDU 报文的根桥 ID 字段，宣告新的根桥。</li>\n</ul>\n<p class=\"red\">7，根端口选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/18/6gN1r6.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根交换机在选举根端口时分别依据该端口的路径开销，对端 BID，对端 PID 和本端 PIN。</ins></li>\n<li>[2] 非根交换机在选举根端口时分别依据该端口的根路径开销，对端 BID (Bridge ID)，对端 PID (Port ID) 和本端 PID。</li>\n<li>[3] 交换机的每个端口都有一个端口开销 (Port Cost) 参数，此参数表示该端口在 STP 中的开销值。默认情况下端口的开销和端口的带宽有关，带宽越高，开销越低。从一个\t非根桥到达根桥的路径可能有多条，每一条路径都有一个总的开销值，此开销值是该路径上所有接收 BPDU 端口的端口开销总和 (即 BPDU 的入方向端口)，称为路径开销。非根桥通过对比多条路径的 lu 路径开销，选出到达根桥的最短路径，这条最短路径的路径开销被称为 RPC (Root Path Cost，根路径开销)，并生成无环树状网络，根桥的根路径开销是 0。</li>\n<li>[4] 一年情况下，企业网络中会存在多厂商的交换设备，华为 X7 系列交换机支持多种 STP 的路径开销计算标准，提供最大程度的兼容性，缺省情况下，华为 X7 系列交换机使用 IEEE 802.1t 标准来计算路径开销。</li>\n<li>[5] 运行 STP 交换机的每个端口都有一个端口 ID，端口 ID 由端口优先级和端口号构成，端口优先级取值范围是 0~240，步长为 16，即取值必须为 16 的整倍数。缺省情况下，端口优先级是 128，端口 ID (Port ID) 可以用来确定端口角色。</li>\n<li>[6] 每个非根桥都要选举一个根端口，根端口是距离根桥最近的端口，这个最近的衡量标准是靠路径开销来判定的，即路径开销最小的端口就是根端口，端口收到一个 BPDU 报文后，抽取该 BPDU 报文中根路径开销字段的值，加上该端口本身的端口开销即为本端口路径开销，如果有两个或两个以上的端口计算得到的累计路径开销相同，那么选择收到发送者 BID 最小的那个端口作为根端口。</li>\n<li>[7] 如果两个或两个以上的端口连接到同一台交换机上，则选择发送者 PID 最小的那个端口作为根端口。如果两个或两个以上的端口通过 HUB 连接到同一台交换机的同一个接口上，则选择本交换机的这些端口中的 PID 最小的作为根端口。</li>\n</ul>\n<p class=\"red\">8，指定端口选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fEegg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根交换机在选举指定端口时分别依据根路径的开销，BID，PID。</ins></li>\n<li><ins class=\"wavy\">注：未被选举为根端口或指定端口的端口为预备端口，将会被阻塞。</ins></li>\n<li>[2] 在网段上抑制其他端口 (无论是自己的还是其他设备的) 发送 BPDU 报文的端口，就是该网段的指定端口。每个网段都应该有一个指定端口，根桥的所有端口都是指定端口 (除非根桥在物理上存在环路)。</li>\n<li>[3] 指定端口的选举也是首先比较累计路径开销，累计路径开销最小的端口就是指定端口，如果累计路径开销相同，则比较端口所在交换机的桥 ID，所以桥 ID 最小的端口被选举为指定端口。如果通过累计路径开销和所在桥 ID 选举不出来，则比较端口 ID，端口 ID 最小的被选举为指定端口。</li>\n<li>[4] 网络收敛后，只有指定端口和根端口可以转发数据，其他端口为预备端口，被阻塞，不能转发数据，只能够从所连网段的指定交换机接收到 BPDU 报文，并以此来监视链路的状态。</li>\n</ul>\n<p class=\"red\">9，端口状态转换：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fV8eA.png\" alt=\"图片\"></li>\n<li>[2] 上图所示，为 STP 的端口状态迁移机制，运行 STP 协议的设备上端口状态有 5 种。</li>\n<li>[3] Forwarding：转发状态，端口既可以转发用户流量也可以转发 BPDU 报文，只有根端口或指定端口才能进入 Forwarding 状态。</li>\n<li>[4] Learning：学习状态。端口可个根据收到的用户流量构建 MAC 地址表，但不转发用户流量，增加 Learing 状态是为了防止临时环路。</li>\n<li>[5] Listening：倾听状态。端口可以转发 BPDU 报文，但不转发用户流量。</li>\n<li>[6] Blocking：阻塞状态。端口仅仅能接收并处理 BPDU，不能转发 BPDU，也不能转发用户流量，此状态是预备端口的最终状态。</li>\n<li>[7] Disabled：禁用状态。端口既不处理和转发 BPDU 报文，也不转发用户流量。</li>\n</ul>\n<p class=\"red\">10，BPDU：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fZdtx.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：BPDU 包含桥 ID，路径开销，端口 ID，计时器等参数。</ins></li>\n<li>[2] 为了计算生成树，交换机之间需要交换相关的信息和参数，这些信息和参数被封装在 BPDU (Bridge Proticol Data Unit) 中。</li>\n<li>[3] BPDU 有两种类型：配置 BPDU 和 TCN BPDU。</li>\n<li>[4] 配置 BPDU 包含了桥 ID，路径开销和端口 ID 等参数。STP 协议通过在交换机之间传递配置 BPDU 来选举根交换机，以及确定每个交换机端口的角色和状态。在初始化过程中，每个桥都主动发送配置 BPDU，在网络拓扑稳定后，只有根桥主动发送配置 BPDU，其他交换机在收到上游传来的配置 BPDU 后，才会发送自己的配置 BPDU。</li>\n<li>[5] TCN BPDU 是指下游交换机感知到拓扑发生变化时向上游发送的拓扑变化通知。</li>\n<li>[6] 配置 BPDU 中包含了足够的信息来保证设备完成生成树计算，其中包含的重要信息如下：</li>\n<li>根桥 ID：由根桥的优先级和 MAC 地址组成，每个 STP 网络中有且仅有一个根桥。</li>\n<li>根路径开销：到根桥的最短路径开销。</li>\n<li>指定桥 ID：由指定桥的优先级和 MAC 地址组成。</li>\n<li>指定端口 ID：由指定端口的优先级和端口号组成。</li>\n<li>Message Age：配置 BPDU 在网络中传播的生存期。</li>\n<li>MAX Age：配置 BPDU 在设备中能够保存的最大生存期。</li>\n<li>Hello Time：配置 BPDU 发送的周期。</li>\n<li>Foeward Delay：端口状态迁移的延时。</li>\n</ul>\n<p class=\"red\">11，计时器：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fmKzT.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：配置 BPDU 报文每经过一个交换机，Message Age 都加 1。</ins></li>\n<li><ins class=\"wavy\">注：如果 Message Age 大于 MAx age，非根桥会丢弃该配置 BPDU。</ins></li>\n<li>[2] STP 协议包含一些重要的时间参数，如下：</li>\n<li>Hello Time 是指运行 STP 协议的设备发送配置 BPDU 的时间间隔，用于检测链路是否在故障，交换机每隔 Hello Time 时间会向周围的交换机发送配置 BPDU 报文，以确认链路是否存在故障。当网络拓扑稳定后，该值只有在根桥上修改才有效。</li>\n<li>Message Age 是从根桥发送到当前交换机接收到 BPDU 的总时间，包括传输延时等，如果配置 BPDU 是根桥发出的，则 Message Age 为 0，实际现实中，配置 BPDU 报文每经过一个交换机，Message Age 增加 1。</li>\n<li>Max Age 是指 BPDU 报文的老化时间，可在根桥上通过命令人为改动这个值，Max Age 通过配置 BPDU 报文的传递，可以保证 Max Age 在整网中一致。非根桥设备收到配置 BPDU 报文后，会将报文中的 Message Age 和 Max Age 进行比较，如果 Message Age 小于等于 Max Age，则该非根桥设备会继续转发配置 BPDU 报文。如果 Message Age 大于 Max Age，则该配置 BPDU 报文将被老化掉，该非根桥设备将直接丢弃改配置 BPDU，并认为是网络直径过大，导致了根桥连接失败。</li>\n</ul>\n<p class=\"red\">12，根桥故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fu5Is.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根桥会在 BPDU 老化之后开始根桥的重新选举。</ins></li>\n<li>[2] 在稳定的 STP 拓扑中，非根桥会定期收到来自根桥的 BPDU 报文。</li>\n<li>[3] 如果根桥发生了故障，停止发送 BPDU 报文，下游交换机就无法收到来自根桥的 BPDU 报文。</li>\n<li>[4] 如果下游交换机一直接收不到 BPDU 报文，Max Age 定时器就会超时 (Max Age 的默认值为 20 秒)，从而导致已经收到的 BPDU 报文失效，此时，非根交换机会互相发送配置 BPDU 报文，重新选举新的根桥。</li>\n<li>[5] 根桥故障会导致 50 秒左右的恢复时间，恢复时间约等于 Max Age 加上两倍的 Forward Delay 收敛时间。</li>\n</ul>\n<p class=\"red\">13，直连链路故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fKznS.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：SWB 检测到直连链路物理故障后，会将预备端口转换为根端口。</ins></li>\n<li><ins class=\"wavy\">注：SWB 新的根端口会在 30 秒后恢复到转发状态。</ins></li>\n<li>[2] 上图：SWA 和 SWB 使用了两条链路互联，其中一条是主线路，另外一条是备份链路，生成树正常收敛后，如果 SWB 检测到根端口的链路发生物理故障，则其 Alternate 端口会迁移到 Listening，Learning，Forwarding 状态，经过两倍的 Forwarding Delay 后恢复到转发状态。</li>\n</ul>\n<p class=\"red\">14，非直连链路故障：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fQPbD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非直连链路故障后，SWC 的预备端口恢复到转发状态大约需要 50 秒。</ins></li>\n<li>[2] 上图，SWB 和 SWA 之间的链路发生了某种故障 (非物理层故障)，SWB 因此一直收不到来自 SWA 的 BPDU 报文，等待 Max Age 定时器超时后，SWB 会认为根桥 SWA 不再有效，并认为自己是根桥，于是开始发送自己的 BPDU 报文给 SWC，通知 SWC 自己作为新的根桥。</li>\n<li>[3] 在此期间，由于 SWC 的 Alternate 端口再也不能收到包含原根桥 ID 的 BPDU 报文，其 Max Age 定时器超时后，SWC 会切换 Alternate 端口为指定端口并且转发来自其根端口的 BPDU 报文给 SWB，所以，Max Age 定时器超时后，SWB SWC 几乎同时会收到对方发来的 BPDU。</li>\n<li>[4] 经过 STP 重新计算后，SWB 放弃宣称自己是根桥并重新确定端口角色。</li>\n<li>[5] 非直连链路故障后，由于需要等待 Max Age 加上两倍的 Forwarding Delay 时间，端口大约 50 秒才能恢复到转发状态。</li>\n</ul>\n<p class=\"red\">15，拓扑改变导致 MAC 地址表错误 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6flvX6.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：MAC 地址表项的默认老化时间是 300 秒，在这段时间内，SWB 无法将数据从 G0/0/2 端口转发给主机 B。</ins></li>\n<li>[2] 在交换网络中，交换机依赖 MAC 地址表转发数据帧，缺省情况下，MAC 地址表的老化时间是 300 秒，如果生成树拓扑发生变化，交换机转发数据的路径也会随着发生变化，此时 MAC 地址表中未及时老化掉的表项会导致数据转发错误，因此在拓扑发生变化后需要及时更新 MAC 地址表项。</li>\n<li>[3] 上图，SWB 的 MAC 地址表项定义了通过端口 G0/0/3 可以到达主机 A，通过端口 G0/0/1 可以到达主机 B，由于 SWC 的根端口发生故障，导致生成树拓扑重新收敛，在生成树拓扑完成收敛之后，从主机 A 到主机 B 的帧仍然不能到达目的地，这是因为 MAC 地址表项老化时间是 300 秒主机 A 发往主机 B 的帧到达 SWB 后，SWB 会继续通过端口 G0/0/1 转发该数据帧。</li>\n</ul>\n<p class=\"red\">16，拓扑改变导致 MAC 地址表错误 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f1X5Q.png\" alt=\"图片\"></li>\n<li>[2] 拓扑变化过程中，根桥通过 TCN BPDU 报文获知生成树拓扑里发生了故障，根桥生成 TC 以来通知其他交换机加速老化现有的 MAC 地址表项。</li>\n<li>[3] 拓扑变更以及 MAC 地址表项更新的具体过程如下：</li>\n<li>SWC 感知到网络拓扑发生变化后，会不间段地向 SWB 发生 TCN BPDU 报文。</li>\n<li>SWB 收到 SWC 发来的 TCN BPDU 报文后，会把配置 BPDU\t报文中的 Flags 的 TCA 位设置 1，然后发送给 SWC，告知 SWC 停止发送 TCN BPDU 报文。</li>\n<li>SWB 向根桥转发 TCN BPDU 报文。</li>\n<li>SWA 把配置 BPDU 报文中的 Flags 的 TC 位置设置为 1 后发送，通知下游设备把 MAC 地址表项的老化时间由默认的 300 秒修改为 Forward Delay 的时间 (默认为 15 秒)。</li>\n<li>最多等待 15 秒后，SWB 中的错误 MAC 地址表项会被自动清除，此后，SWB 就能重新开始 MAC 表项的学习及转发操作。</li>\n</ul>\n<p class=\"red\">17，STP 模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fGbb6.png\" alt=\"图片\"></li>\n<li>[2] 华为 X7 系列交换机支持三种生成树协议模式。</li>\n<li>[3] stp mode {mstp|stp|rstp} 命令用来配置交换机的生成树协议模式，缺省情况下，华为 X7 系列交换机工作在 MSTP 模式，在使用 STP 前，STP 模式必须重新配置。</li>\n</ul>\n<p class=\"red\">18，配置交换机优先级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fJ2QA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：通过修改交换机的优先级，可以配置交换机为根交换机。</ins></li>\n<li>[2] 基于企业业务对网络的需求，一般建议手动指定网络中配置高，性能好的交换机为根桥。</li>\n<li>[3] 可以通过配置桥优先级来指定网络中的根桥，以确保企业网络里面的数据流量使用的是最优路径转发。</li>\n<li>[4] stp priority 命令用来配置设备优先级值，priority 值为整数，取值范围为 0 到 61440，步长为 4096. 缺省情况下，交换设备的优先级取值是 32768。另外，可以通过 Stp root primary 命令指定生成树里的根桥。</li>\n</ul>\n<p class=\"red\">19，配置路径开销：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fYG0P.png\" alt=\"图片\"></li>\n<li>[2] 华为 X7 系列交换机支持三种路径开销标准，以确保和友商设备保持兼容。缺省情况下，路基开销标准为 IEEE 802.1t。</li>\n<li>[3] stp pathcost-standard {dot1d-1998|dot1t|legacy} 命令用来配置指定交换机上路径开销值的标准。</li>\n<li>[4] 每个端口的路径开销也可以手动指定。此 STP 路径开销控制方法须谨慎使用，手动指定端口的路径开销可能会生成次优生成树拓扑。</li>\n<li>stp cost cost 命令取决于路径开销计算方法：</li>\n<li>使用华为的私有计算方法时，cost 取值范围是 1~200000。</li>\n<li>使用 IEEE 802.1d 标准方法时，cost 取值范围是 1~65535。</li>\n<li>使用 IEEE 802.1t 标准方法时，cost 取值范围是 1~200000000。</li>\n</ul>\n<p class=\"red\">20，配置验证 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6ftdUK.png\" alt=\"图片\"></li>\n<li>[2] display stp 命令用来检查当前交换机的 stp 配置，命令输出中信息介绍如下：</li>\n<li>CIST Bridge 参数标识指定交换机当前桥 ID，包含交换机的优先级和 MAC 地址。</li>\n<li>Bridge Time 参数标识 HEllo 计时器，Forward Delay 计时器，Max Age 计时器</li>\n<li>CIST Root/ERPC 参数标识根桥 ID 以及交换机到根桥的根路径开销。</li>\n</ul>\n<p class=\"red\">21，配置验证 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] display stp 命令显示交换机上所有端口信息。</li>\n<li>[2] display stp interface interface 命令显示交换机上指定端口信息。</li>\n<li>[3] 其他一些信息还包括端口角色，端口状态，以及使用的保护机制等。</li>\n</ul>\n<p class=\"red\">22，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 根桥产生故障后，其他交换机会被选举为根桥，那么原来的根桥恢复正常后，网络又会发生什么变化呢？</li>\n<li>如果生成树网络里面根桥发生了故障，则其他交换机中优先级最高的交换机会被选举为新的根桥。如果原来的根桥再次激活，则网络又会根据 BID 来重新选举新的根桥。</li>\n<li>[2] 端口开销和根路径开销的区别是什么？</li>\n<li>根路径开销是到根桥的路径的总开销，而端口开销指的是交换机某个端口的开销。</li>\n</ul>\n<h1 id=\"第十四章rstp原理与配置\"><a class=\"anchor\" href=\"#第十四章rstp原理与配置\">#</a> 第十四章【RSTP 原理与配置】</h1>\n<p>+++primarily 前言</p>\n<ul>\n<li class=\"red\">STP 协议虽然能够解决环路问题，但是收敛速度慢，影响用户通信质量，如果 STP 网络的拓扑结构频繁变化，网络也会频繁失去连通性，从而导致用户通信频繁中断，IEEE 于 2001 年发布的 802.1w 标准定义了快速生成树协议 RSTP (Rapid Spanning-Tree Protocol)，RSTP 在 STP 的基础上进行了改进，实现了网络拓扑快速收敛。<br>\n+++<br>\n1，STP 不足：</li>\n</ul>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fdvwR.png\" alt=\"图片\"></li>\n<li>[2] STP 能够提供无环网络，但是收敛速度较慢，如果 STP 网络的拓扑结构频繁变化，网络也会随之频繁失去连通性，从而导致用户通信频繁中断。</li>\n<li>[3] RSTP 使用了 Proposal/Agreement 机制保证链路及时协商，从而有效避免收敛计时器在生成树收敛前超时，如上图，在交换网络中，P/A 过程可以从根桥向下游级联传递。</li>\n</ul>\n<p class=\"red\">2，RSTP 端口角色：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fwMp8.png\" alt=\"图片\"></li>\n<li>[2] 运行 RSTP 的交换机使用了两个不同的端口角色来实现冗余备份，当到根桥的当前路径出现故障时，作为根端口的备份端口，Alternate 端口提供了从一个交换机到根桥的另一条可切换路径。</li>\n<li>[3] Backup 端口作为指定端口的备份，提供了另一条从根桥到相应 LAN 网段的备份路径，当一个交换机和一个共享媒介设备，例如 Hub 建立两个或者多个连接时，可以使用 Backup 端口，同样，当交换机上两个或者多个端口和同一个 LAN 网段链连接时，也可以使用 Backup 端口。</li>\n</ul>\n<p class=\"red\">3，RSTP 边缘端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fwoBd.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：边缘端口不接收处理配置 BPDU，不参与 RSTP 运算。</ins></li>\n<li>[2] RSTP 里，位于网络边缘的指定端口被称为边缘端口，边缘端口一般与用户终端设备直接连接，不与任何交换设备连接。</li>\n<li>[3] 边缘端口不接收配置 BPDU 报文，不参与 RSTP 运算，可以由 Disabled 状态直接转到 Forwarding 状态，且不经历时延，就像在端口上将 STP 禁用了一样。</li>\n<li>[4] 但是，一旦边缘端口收到配置 BPDU 报文，就丧失了边缘端口的属性，成为普通 STP 端口，并重新进行生成树计算，从而引起网络震荡。</li>\n</ul>\n<p class=\"red\">4，端口状态：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f0mDJ.png\" alt=\"图片\"></li>\n<li>[2] RSTP 把原来的 STP 的五种端口状态简化成了三种。</li>\n<li>Discarding 状态：端口既不转发用户流量也不学习 MAC 地址。</li>\n<li>Learning 状态：端口不转发用户流量但是学习 MAC 地址。</li>\n<li>Forwarding 状态：端口即转发用户流量又学习 MAC 地址。</li>\n</ul>\n<p class=\"red\">5，RST BPDU(1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6f0gbj.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：STP 的配置 BPDU 中 Flag 字段的中间 6 位在 RSTP 中得到了应用。</ins></li>\n<li>[2] 除了部分参数不同，RSTP 使用了类似 STP 的 BPDU\t报文，即 RST BPDU 报文。BPDU Type 原来区分 STP 的 BPDU 报文和 RST (Rapid Spanning Tree) BPDU 报文。</li>\n<li>[3] STP 的配 BPDU 报文的 BPDU Type 值为 0 (0X00)，TCN BPDU 报文的 BPDU Type 值为 128 (0X80)，RST BPDU 报文的 BPDU Type 值为 2 (\t0X02)。</li>\n<li>[4] STP 的 BPDU 报文的 Flags 字段只定义了拓扑变化 TC (Topology Change) 标志和拓扑变化确认 TCA (Topology Change Acknowledgment) 标志，其他字段保留。</li>\n<li>[5] 在 RST BPDU 报文里的 Flags 字段，还使用了其他字段，包括 P/A 进程字段和定义端口状态的字段。Forward，Learning，与 Port Role 表示发出的 BPDU 的端口的状态和角色。</li>\n</ul>\n<p class=\"red\">6，RST BPDU(2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/19/6fBYWV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：非根桥设备无论是否接收到根桥发送的配置 BPDU，都会按照 Hello Timer 规定的时间间隔发送配置 BPDU。</ins></li>\n<li>[2] STP 中，当网络拓扑稳定后，根桥依据 Hello Timer 规定的时间间隔发送配置 BPDU 报文，其他非根桥设备在收到上游设备发送过来的配置 BPDU 报文后，才会触发发出配置 BPDU 报文。</li>\n<li>[3] 此方式使得 STP 协议计算复杂且缓慢，RSTP 对此进行了改进，即在拓扑稳定后，无论非根桥设备是否接收到根桥传来的配置 BPDU 报文，非根桥设备都会仍然按照 Hello Timer 规定的时间间隔发送配置 BPDU，该行为完全由每台设备自主进行。</li>\n</ul>\n<p class=\"red\">7，RSTP 收敛过程 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/20/6fBql8.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每台交换机启动 RSTP 后，都认为自己是 “根桥”，并且发送 RST BPDU。所有端都为指定端口，处于 Discarding 状态。</ins></li>\n<li>[2] RSTP 收敛遵循 STP 的基本原理，网络初始化时，网络中所有的 RSTP 交换机都认为自己是 &quot;根桥&quot;，并设置每个端口为指定端口。此时，端口为 Discarding 状态。</li>\n</ul>\n<p class=\"red\">8，RSTP 收敛过程 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s4.ax1x.com/2021/03/20/6fD9f0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：交换机互相发送 Proposal 置位的 RST BPDU。</ins></li>\n<li><ins class=\"wavy\">注：SWA 收到 SWB 的 RST BPDU，会忽略。</ins></li>\n<li>[2] 每个认为自己是 “根桥” 的交换机生成一个 RST BPDU 报文来协商指定网段的端口状态，此 RST BPDU 报文的 Flags 字段里面的 Proposal 位需要置位。</li>\n<li>[3] 当一个端口收到 RST BPDU 报文时，此端口会比较收到的 RST BPDU 报文和本地的 RST BPDU 报文，如果本地的 RST BPDU 报文优于接收到的 RST BPDU 报文，则端口会丢弃接收到的 RST BPDU 报文，并发送 Proposal 置位的本地 RST BPDU 报文来回复对端设备。</li>\n</ul>\n<p class=\"red\">9，RSTP 收敛过程 (3)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64QIJJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：SWB 收到了更优的 RST BPDU，于是停止发送 RST BPDU，并开始执行同步。</ins></li>\n<li>[2] 交换机使用同步机制来实现端口角色协商管理，当收到 Proposal 置位并且优先级最高的 BPDU 报文时，接收交换机必须设置所有下游指定端口为 Discarding 状态。</li>\n<li>[3] 如果下游端口是 Alternate 端口或者边缘端口，则端口状态保持不变。</li>\n<li>[4] 上图，说明了下游指定端口暂时迁移到 Discarding 状态的情形，因此，P/A 进程中任何帧转发都将被阻止。</li>\n</ul>\n<p class=\"red\">10，RSTP 收敛过程 (4)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lCQI.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：阻塞所有非边缘端口之后，SWB 将发送一个 Agreement 置位的 RST BPDU。</ins></li>\n<li>[2] 当确认下游指定端口迁移到 Discarding 状态后，设备发送 RST BPDU 报文回复上游交换机发送的 Proposal 消息。</li>\n<li>[3] 上图，端口已经确认为根端口，因此 RST BPDU 报文 Flags 字段里面设置了 Agreement 标记位和根端口角色。</li>\n</ul>\n<p class=\"red\">11，RSTP 收敛过程 (5)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lUp9.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：P/A 进程向下游继续传递，SWB 和 SWC 会继续进行收敛。</ins></li>\n<li>[2] 在 P/A 进程的最后阶段，上游交换机收到 Agreement 置位的 RST BPDU 报文后指定端口立即从 Discarding 状态迁移到 Forwarding 状态，然后，下游网段开始使用同样的 P/A 进程协商端口角色。</li>\n</ul>\n<p class=\"red\">12，链路故障 / 根桥失效：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/20/64lW6I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：链路故障或者根桥失效都会导致交换机收不到邻居发送的 RST BPDU。在 RSTP 中，3 倍的 Hello Timer 内收不到邻居的 BPDU 即认为邻居是失效。</ins></li>\n<li>[2] 在 STP 中，当出现链路故障或者根桥失效导致交换机收不到 BPDU 时，交换机需要等待 Max Age 时间后才能确认出现了故障。</li>\n<li>[3] 而在 RSTP 中，如果交换机的端口在连续 3 次 Hello Timer 规定的时间间隔内没有收到上游交换机发送的 RST BPDU，便会确认本端口和对端端口的通信失败，从而需要重新进行 RSTP 的计算来确定交换机及端口角色。</li>\n</ul>\n<p class=\"red\">13，RSTP 拓扑变化处理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6411gA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：其他交换机收到 TC 置位的 BPDU 后，清空所有其他端口学习到的 MAC 导致，收到 TC BPDU 的端口 b 不清空。</ins></li>\n<li>[2] RSTP 拓扑变化的处理类似 STP 拓扑变化的处理，但也有些细微的差别。</li>\n<li>[3] 上图，SWC 发生链路故障，SWA 和 SWC 立即检测出链路故障并清除连接此链路的端口上的 MAC 地址表项。</li>\n<li>[4] 接下来 SWC 选举出新的根端口并立即进入 Forwarding 状态，因此，触发 SWC 向外发送 TC 置位的 BPDU 报文 (简称 TC 报文)，通知上游交换机清除所有其他端口上的 MAC 地址表项，除了接收到 TC 报文的端口。</li>\n<li>[5] TC 报文周期性的转发给邻居，在此周期内，所有相关接口上 MAC 地址表项将会被清除，重新学习 MAC 地址表项。</li>\n<li>[6] 上图，图形里面红色 X 表示，由于拓扑变化导致端口上的 MAC 地址表项被清除。</li>\n</ul>\n<p class=\"red\">14，STP 兼容：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/643mMn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：运行 RSTP 的交换设备在谋端口上接收到运行 STP 的交换设备发出的配置 BPDU，会把该端口转换到 STP 工作模式。</ins></li>\n<li>[2] RSTP 是可以与 STP 实现后向兼容的，但在实际中，并不推荐这种做法，原因是 RSTP 会失去其快速收敛的优势，而 STP 慢速收敛的缺点会被暴露出来。</li>\n<li>[3] 当同一个网段里既有运行 STP 的交换机又有运行 RSTP 的交换机时，STP 交换机会忽略接收到的 RST BPDU，而 RSTP 交换机在某端口上接收到 STP BPDU 时。会等待两个 Hello Timer 时间之后，把自己的端口转换到 STP 工作模式，此后便发送 STP BPDU，这样就实现了兼容性操作。</li>\n</ul>\n<p class=\"red\">15，配置 STP 模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/643Oe0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：执行命令后，SWA 所有端口都工作在 RSTP 模式。</ins></li>\n<li>[2] 在 Sx7 交换机上，可以使用 stp mode rstp 命令来配置交换机工作在 RSTP 模式。</li>\n<li>[3] stp mode rstp 命令在系统视图下执行，此命令必须在所有参与快速生成树拓扑计算机的交换机上配置。</li>\n</ul>\n<p class=\"red\">16，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64GsKA.png\" alt=\"图片\"></li>\n<li>[2] display stp 命令可以显示 RSTP 配置信息的参数，根据显示信息可以确认交换机是否工作在 RSTP 模式。</li>\n</ul>\n<p class=\"red\">17，配置边缘端口：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64GoKs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：边缘端口可以由 Disable 直接转到 Forwarding 状态，不经历时延。</ins></li>\n<li><ins class=\"wavy\">注：Sx7 系列交换机默认所有端口都工作在非边缘端口。</ins></li>\n<li>[2] 边缘端口完全不参与 STP 或 RSTP 计算，边缘端口的状态要么是 Disabled，要么是 Forwarding，终端上电工作后，他就直接由 Disabled 状态转到 Forwarding 状态，终端下电后，他就直接由 Forwarding 状态转到 Disabled 状态。</li>\n<li>[3] 交换机所有端口默认为非边缘端口。</li>\n<li>[4] stp edged-port enable 命令用来配置交换机的端口为边缘端口，它是一个针对某一具体端口的命令。</li>\n<li>[5] stp edged-port default 命令用来配置交换机的所有端口为边缘端口。</li>\n<li>[6] stp edged-port disable 命令用来将边缘端口的属性去掉，使之成为非边缘端口，他也是一个针对某一具体端口的命令。</li>\n<li>[7] 需要注意的是，华为 Sx7 系列交换机运行 STP 时也可以使用边缘端口设置。</li>\n</ul>\n<p class=\"red\">18，根保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64YR1g.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：根保护功能确保了根桥的指定端口不会因为一些网络问题而改变端口角色。</ins></li>\n<li>[2] 由于错误配置根交换机或网络中的恶意攻击，根交换机有可能会收到优先级更高的 BPDU 报文，使得根交换机变长非根交换机，从而引起网络拓扑结构的变动。</li>\n<li>[3] 这种不合法的拓扑变化，可能会导致原来应该通过高速链路的流量被牵引到低速链路上，造成链路阻塞。</li>\n<li>[4] 交换机提供了根保护功能来解决此问题，根保护功能通过维持指定端口角色从而保护根交换机。</li>\n<li>[5] 一旦启用了根保护功能的指定端口收到了优先级更高的 BPDU 报文时，端口会停止转发报文并进入 Listening 状态，经过一段时间后，如果端口一直没有在收到优先级较高的 BPDU 报文，端口就会自动恢复到原来的状态。</li>\n<li>[6] 根保护功能仅在指定端口生效，不能配置在边缘端口或者使能了环路保护功能的端口上。</li>\n</ul>\n<p class=\"red\">19，BPDU 保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tZDA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：配置 BPDU 保护功能后，如果边缘端口收到 BPDU 报文，边缘端口将会被立即关闭，并通知网管系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</ins></li>\n<li>[2] 正常情况下，边缘端口是不会收到 BPDU 的，但是，如果有人发送 BPDU 来进行恶意攻击时，边缘端口就会收到这些 BPDU，并自动变为非边缘端口，且开始参与网络拓扑计算，从而会增加整个网络的计算工作量，并可能引起网络震荡。</li>\n<li>[3] 为了防止上述情况发生，可以使用 BPDU 保护功能。使能 BPDU 保护功能后的交换机的边缘端口在收到 BPDU 报文时，会立刻关闭该端口，并通知网络管理系统，被关闭的边缘端口可配置成自动恢复或管理员手动恢复。</li>\n<li>[4] 如果使能 BPDU 保护功能，可在系统试图下执行 stp bpdu-protection 命令。</li>\n</ul>\n<p class=\"red\">20，环路保护：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tUU0.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：根端口如果长时间收不到来自上游的 BPDU，则进入 Discarding 状态，避免在网络中形成环路。</ins></li>\n<li>[2] 交换机通过从上游交换机持续收到 BPDU 报文来维护根端口和阻塞端口的状态，当由于链路拥塞或者单项链路故障时，交换机不能收到上游交换机发送的 BPDU 报文，交换机重新选择根端口，最初的根端口会变成指定端口，阻塞端口进入 Forwarding 状态，这就有可能造成网络环路。</li>\n<li>[3] 交换机提供了环路保护功能来避免这种环路的产生，环路保护功能使能后，如果根端口不能收到上游交换机发送的 BPDU 报文，则向网管发出通知信息，根端口会被阻塞，阻塞端口仍然将保持阻塞状态，这样就避免了可能发生的网络环路。</li>\n<li>[4] 如需使能环路保护功能，可以在接口视图下执行 stp loop-protection 命令。</li>\n</ul>\n<p class=\"red\">21，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64tR56.png\" alt=\"图片\"></li>\n<li>[2] display stp interface (接口名) 命令可以显示端口的 RSTP 配置情况，包括端口状态，端口优先级，端口开销，端口角色，是否为边缘端口等待。</li>\n</ul>\n<p class=\"red\">22，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] P/A 机制中同步的作用是什么？</li>\n<li>P/A 机制是 RSTP 网络中的一种拓扑收敛机制，P/A 机制中同步的作用是避免临时环路的产生。</li>\n</ul>\n<h1 id=\"第十五章ip路由基础\"><a class=\"anchor\" href=\"#第十五章ip路由基础\">#</a> 第十五章【IP 路由基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>以太网交换机工作在数据链路层，用于在网络内进行数据的转发，而企业网络的拓扑结构一般会比较复杂，不同的部门，或者总部和分支可能处在不同的网络中，此时就需要使用路由器来连接不同的网络，实现网络之间的是数据转发。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，自治系统：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64NPZn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：自治系统 (AS)：由同一个管理机构管理，使用统一路由策略的路由器的集合。</ins></li>\n<li>[2] 一般情况下，我们可以把一个企业网络认为是一个自治系统 AS (Autonomous System)。根据 RFC1030 的定义，自治系统是由一个单一实体管辖的网络。这个实体可以是一个互联网服务提供商，或一个大型组织机构。</li>\n<li>[3] 自治系统内部遵循一个单一且明确的路由策略，最初，自治系统内部只考虑运行单个路由协议，然而，随着网络的发展，一个自治系统内现在也可以支持同时运行多种路由协议。</li>\n</ul>\n<p class=\"red\">2，LAN 和广播域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64N3i6.png\" alt=\"图片\"></li>\n<li>[2] 一个 AS 通常由多个不同的局域网组成，以企业网络为例，各个部门属于不同的局域网，或者各个分支机构和总部也可以属于不同的局域网。</li>\n<li>[3] 局域网内的主机可以通过交换机来实现通信，不同局域网之间的主机要想相互通信，可以通过路由器来实现。</li>\n<li>[4] 路由器工作在网络层，隔离了广播域，并可以作为每个局域网的网关，发现到达目的网络的最优路径，最终实现报文在不同网络间的转发。</li>\n<li>[5] 上图，RTA 和 RTB 把整个网络分成了三个不同的局域网，每个局域网为一个广播域。</li>\n<li>[6] LAN1 内部的主机直接可以通过交换机实现相互通信，LAN2 内部的主机也是如此，但是 LAN1 内部的主机与 LAN2 内部的主机之间则必须要通过路由器才能实现相互通信。</li>\n</ul>\n<p class=\"red\">3，路由选路：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/645FG8.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器负责为数据包选择一条最优路径，并进行转发。</ins></li>\n<li>[2] 路由器收到数据包后，会根据数据包中的目的 IP 地址选择一条最优路径，并将数据包转发到下一个路由器，路径上最后的路由器负责将数据包送交目的主机。</li>\n<li>[3] 数据包在网络上的传输就好像是体育运动中的接力赛一样，每个路由器负责将数据包按照最优的路径向下一跳路由器进行转发，通过多个路由器一站一站的接力，最终将数据包通过最优路径转发到目的地，当然有时候由于实施了一些特别的路由策略，数据包通过的路径可能并不是最佳的。</li>\n<li>[4] 路由器能够决定数据报文的转发路径，如果由多条路径可以到达目的地，则路由器会通过进行计算来决定最佳下一跳，计算的原则会随实际使用的路由协议不同而不同。</li>\n</ul>\n<p class=\"red\">4，IP 路由表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64ISlF.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由表中包含了路由器可以到达的目的网络，目的网络在路由表中不存在的数据包会被丢弃。</ins></li>\n<li>[2] 路由器转发数据包的关键是路由表，每个路由器都保存着一张路由表，表中每条路由表项都指明了数据包要到达某网络或者某主机应通过路由器的那个物理接口发送，以及可到达该路径的哪个下一跳路由器，或者不再别的路由器而直接可以到达目的地。</li>\n<li>[3] 路由表中包含了下列关键项：</li>\n<li>目的地址 (Destination)：用来标识 IP 数据包的目的地址或目的网络。</li>\n<li>网络掩码 (Mask)：IP 地址与网络掩码进行逻辑与运算便可以得到相应的网段信息，上图，目的地址为 8.0.0.0 255.0.0.0 相与后便可以得到一个 A 类的网段信息 (8.0.0.0/8)。网络掩码的另一个作用还表现在当路由表中由多条目的地址相同的路由信息时，路由器将选择其掩码最长的一项作为匹配项。</li>\n<li>[4] 输出端口 (Interface)：指明 IP 数据包将从该路由器的哪个接口转发出去。</li>\n<li>[5] 下一跳 IP 地址 (NextHop)：指明 IP 数据包所经由的下一跳路由器的接口地址。</li>\n<li>[6] 路由器中的优先级，度量值等其他的字段以后介绍。</li>\n</ul>\n<p class=\"red\">5，路由优先级：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/64oMgU.png\" alt=\"图片\"></li>\n<li>[2] 路由器可以根据多种不同协议学习到去往同一目的网络的路由，当这些路由都符合最长匹配原则时，必须决定哪个路由优先。</li>\n<li>[3] 每个路由协议都由一个协议优先级 (取值最小，优先级越高)。当有多个路由信息时，选择最高优先级的路由作为最佳路由。</li>\n<li>[4] 上图，路由器通过两种路由协议学习到了网段 10.1.1.0 的路由，虽然 RIP 协议提供了一条看起来更加近的路线，但是由于 OSPF 具有更高的优先级，因而成为优选路由，并被加入路由表中。</li>\n</ul>\n<p class=\"red\">6，路由度量：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65p3Af.png\" alt=\"图片\"></li>\n<li>[2] 如果路由器无法用优先级来判断最优路由，则使用度量值 (Metric) 来决定需要加入路由表的路由。</li>\n<li>[3] 一些常用的度量值有：跳数，带宽，时延，代价，负载，可靠性等。</li>\n<li>[4] 跳数是指到达目的地所通过的路由器数目。</li>\n<li>[5] 带宽是指链路的容量，高速链路开销 (度量值) 较小。</li>\n<li>[6] metric 值越小，路由越优先，因此上图中 metric=1+1=2 的路由是到达目的地的最优路由，其表项可以在路由表中找到。</li>\n</ul>\n<p class=\"red\">7，建立路由表：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/659rqI.png\" alt=\"图片\"></li>\n<li>[2] 根据比较 “路由优先级” 和 “路由度量”，设备可以产生最优路径的 IP 路由表。</li>\n<li>[3] 根据来源的不同，路由表中的路由通常可分为以下三类：</li>\n<li>链路层协议发现的路由 (也称为接口路由或直连路由)。</li>\n<li>由网络管理员手工配置的静态路由。</li>\n<li>动态路由协议发现的路由。</li>\n</ul>\n<p class=\"red\">8，最长匹配原则：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/659HoV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由表中如果有多个匹配目的网络的路由条目，则路由器会选择掩码最长的条目。</ins></li>\n<li>[2] 路由器在转发数据时，需要选择路由表中的最优路由，当数据报文到达路由器时，路由器首先提取出报文的目的 IP 地址，然后查找路由表，将报文的目的 IP 地址与路由表中某表项的掩码字段做 “与” 操作，“与” 操作后的结构跟路由表该表项的目的 IP 地址比较，相同则匹配上，否则就没有匹配上，当与所有的路由表项都进行匹配后，路由器会选择一个掩码最长的匹配项。</li>\n<li>[3] 如上图，路由表中有两个表项到达目的网段 10.1.1.0，下一跳地址都是 20.1.1.2。如果要将报文转发至网段 10.1.1.1，则 10.1.1.0/30 符合最长匹配原则。</li>\n</ul>\n<p class=\"red\">9，路由器转发数据包：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Cq0I.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器需要找到下一跳和出接口才能将数据转发出去。</ins></li>\n<li>[2] 路由器收到一个数据包后，会检查其目的 IP 地址，然后查找路由表，查找到匹配的路由表项之后，路由器会根据该表项所指示的出接口信息和下一跳信息将数据包转发出去。</li>\n</ul>\n<p class=\"red\">10，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 路由器选择最优路由的顺序是什么？</li>\n<li>路由器在选择最优路由时，会首先根据路由的优先级选择哪些路由可以放入路由表，如果优先级相等，再比较 metric 数值，决定哪些路由放入路由表，最后在查路由表时根据最长掩码匹配原则选择路由表项指导数据报文转发。</li>\n<li>[2] Preference 字段在路由表中代表什么含义？</li>\n<li>Preference 字段在路由表中代表了路由优先级，设备厂商会在各自的产品中为不同的路由协议规定不同的优先级。</li>\n</ul>\n<h1 id=\"第十六章静态路由基础\"><a class=\"anchor\" href=\"#第十六章静态路由基础\">#</a> 第十六章【静态路由基础】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>静态路由是指由管理员手动配置和维护的路由</li>\n<li>静态路由配置简单，被广泛地应用于网络中，另外，静态路由还可以实现负载均衡和路由备份，因此，学习并掌握好静态路由的应用与配置是非常必要的。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，静态路由应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65F9wn.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：静态路由是指由管理员手动配置和维护的路由。</ins></li>\n<li>[2] 静态路由是指由管理员手动配置和维护的路由，静态路由配置简单，并且无需像动态路由那样占用路由的 CPU 资源来计算和分析路由更新。</li>\n<li>[3] 静态路由的缺点在于，当网络拓扑发生变化时，静态路由不会自动适应拓扑改变，而是需要管理员手动进行调整。</li>\n<li>[4] 静态路由一般适用于结构简单的网络，在复杂网络环境中，一般会使用动态路由协议来生成动态路由。不过，即使在复杂的网络环境中，合理地配置一些静态路由也可以改进网络的性能。</li>\n</ul>\n<p class=\"red\">2，静态路由配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65k6C6.png\" alt=\"图片\"></li>\n<li>[2] ip route-static 命令用来配置静态路由，参数 ip-address 指定了一个网络或者主机的目的地址，参数 mask 指定了一个子网掩码或者前缀长度。</li>\n<li>[3] 如果使用了广播接口如以太网接口作为出接口，则必须要指定下一跳地址，如果使用了串口作为出接口，则可以通过参数 interface-type 和 interface-number (如，Serial1/0/0) 来配置出接口。此时不必指定下一跳地址。</li>\n</ul>\n<p class=\"red\">3，静态路由 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65AAr4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在串行接口上，可以通过指定下一跳地址或者出接口来配置静态路由。</ins></li>\n<li>[2] 静态路由可以应用在串行网络或者以太网中，但静态路由在这两种网络中的配置有所不同。</li>\n<li>[3] 在串行网络中配置静态路由时，可以只指定下一跳地址或只指定出接口。华为 ARG3 下列路由器中，串行接口默认封装 PPP 协议，对于这种类型的接口，静态路由的下一跳地址就是与接口相连的对端接口的地址，所以在串行网络中配置静态路由时可以只配置出接口。</li>\n<li>[4] 以太网是广播类型的网络。和串行网络情况不同，在以太网中配置静态路由，必须指定下一跳地址。</li>\n</ul>\n<p class=\"red\">4，静态路由 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65AxyD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在广播类型的接口 (如以太网接口) 上配置静态路由时，必须要指定下一跳地址。</ins></li>\n<li>[2] 在广播型的接口上配置静态路由时，必须明确指定下一跳地址，以太网中同一网络可能连接了多台路由器，如果在配置静态路由时只指定了出接口，则路由器无法将报文转发到正确的下一跳。</li>\n<li>[3] 上图，RTA 需要将数据转发到 192.168.2.0/24 网络，在配置静态路由时，需要明确指定下一跳地址为 10.0.123.2，否则，RTA 将无法将报文转发到 RTB 所连接的 192.168.2.0/24 网络，因为 RTA 不知道应该通过 RTB 还是 RTC 才能到达目的地。</li>\n</ul>\n<p class=\"red\">5，负载分担：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65VwDg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：静态路由支持到达同一目的地的等价负载分担。</ins></li>\n<li>[2] 当源网络和目的网络之间存在多条链路时，可以通过等价路由来实现流量负载分担。这些等价路由具有相同的目的网络和掩码，优先级和度量值。</li>\n<li>[3] 上图，RTA 和 RTB 之间有两条链路相连，通过使用等价的静态路由来实现流量负载分担。</li>\n<li>[4] 在 RTB 上配置了两条静态路由，他们具有相同的目的 IP 地址和子网掩码，优先级 (都为 60)，路由开销 (都为 0)，但下一跳不同。在 RTB 需要转发数据给 RTA 时，就会使用这两条等价静态路由将数据进行负载分担。</li>\n<li>[5] 在 RTA 上也应该配置对应的两条等价的静态路由。</li>\n</ul>\n<p class=\"red\">6，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Z4Qf.png\" alt=\"图片\"></li>\n<li>[2] 在配置完成静态路由后，可以使用 display ip routing-table 命令来验证配置结果。</li>\n<li>[3] 上图所示，红色高亮的部分代表路由表中的静态路由，这两条路由具有相同的目的地址和掩码，并且有相同的优先级和度量值，但是他们的下一跳地址和出接口不同，此时，RTB 就可以通过这两条等价路由实现负载分担。</li>\n</ul>\n<p class=\"red\">7，路由备份：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65eZ6K.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：浮动静态路由在网络中主路由失效的情况下，会加入到路由表并承担数据转发业务。</ins></li>\n<li>[2] 在配置多条静态路由时，可以修改静态路由的优先级。使一条静态路由的优先级高于其他静态路由，从而实现静态路由的备份，也叫浮动静态路由。</li>\n<li>[3] 如上图所示，RTB 上配置了两条静态路由，正常情况下，这两条静态路由是等价的，通过配置 preference 100，使第二条静态路由的优先级要低于第一条 (值越大优先级越低)。</li>\n<li>[4] 路由器只把优先级最高的静态路由加入到路由表中，当加入到路由表中的静态路由出现故障时，优先级低的静态路由才会加入到路由表并承担数据转发业务。</li>\n</ul>\n<p class=\"red\">8，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65e7jK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在主链路正常情况下，只有主路由会出现在路由表中。</ins></li>\n<li>[2] 从 display ip routing-table 命令的回显消息中可以看出，通过修改静态路由优先级实现了浮动静态路由，</li>\n<li>[3] 正常情况下，路由表中应该显示两条有相同目的地，但不同下一跳和出接口的等价路由。由于修改了优先级，回显中只有一条默认优先级为 60 的静态路由，另一个静态路由的优先级是 100，该路由优先级低，所以不会显示在路由表中。</li>\n</ul>\n<p class=\"red\">9，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65m3E4.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：在主链路出现故障时，浮动静态路由会被激活并加入到路由表中，承担数据转发业务。</ins></li>\n<li>[2] 当主要静态路由出现物理链路故障或者接口故障时，该静态路由不能再提供到达目的地的路径，所以再路由表中会被删除。</li>\n<li>[3] c 此时，浮动静态路由会被加入到路由表，以保证报文能够从备份链路成功转发到目的地。</li>\n<li>[4] 在主用静态路由的物理链路恢复正常后，主用静态路由会重新被加入到路由表，并且数据转发业务会从浮动静态路由切换到主用静态路由，而浮动静态路由会在路由表中再次被隐藏。</li>\n</ul>\n<p class=\"red\">10，缺省路由：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65nSIJ.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省路由是目的地址和掩码全为 0 的特殊路由。</ins></li>\n<li><ins class=\"wavy\">注：如果报文的目的地址无法匹配路由表中的任何一项，路由器将选择依照缺省路由来转发报文。</ins></li>\n<li>[2] 当路由表中没有与报文的目的地址匹配的表项时，设备可以选择缺省路由作为报文的转发路径。</li>\n<li>[3] 在路由表中，缺省路由的目的网络地址为 0.0.0.0 掩码也为 0.0.0.0。如上图所示，RTA 使用缺省路由转发到达未知目的地址的报文，缺省静态路由的默认优先级也是 60。在路由选择过程中，缺省路由会被最后匹配。</li>\n</ul>\n<p class=\"red\">11，验证配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65nx6P.png\" alt=\"图片\"></li>\n<li>[2] 配置缺省路由后，可以使用 display ip routing-table 命令来查看该路由的详细信息。</li>\n<li>[3] 如上图所示，目的地址在路由表中没能匹配的所有报文都将通过 G0/0/0 接口转发到下一跳地址 10.0.12.2。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如何配置能够将静态路由配置为浮动静态路由？</li>\n<li>在配置静态路由时，需要调整其中一条静态路由的优先级，就可将其修改为浮动静态路由。</li>\n<li>[2] 配置缺省路由时，目的网络的地址是什么？</li>\n<li>在配置缺省路由时，目的网络为 0.0.0.0 代表的是任意网络。</li>\n</ul>\n<h1 id=\"第十七章链路状态路由协议ospf\"><a class=\"anchor\" href=\"#第十七章链路状态路由协议ospf\">#</a> 第十七章【链路状态路由协议 ——OSPF】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>开放式最短路径优先 OSPF (Open Shortest Path First) 协议是 IETF 定义的一种基于链路状态的内部网关路由协议。</li>\n<li>RIP 是一种基于距离矢量算法的路由协议，存在着收敛慢，易产生路由环路，可拓展性差等问题，目前已逐渐被 OSPF 取代。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，开放式最短路径优先 (OSPF)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65Tx2V.png\" alt=\"图片\"></li>\n<li>[2] OSPF 是一种基于链路状态的路由协议，它从设计上就保证了无路由环路，OSPF 支持区域的划分，区域内部的路由器使用 SPF 最短路径算法保证了区域内部的无环路。OSPF 还利用区域间的连接规则保证了区域之间无路由环路。</li>\n<li>[3] OSPF 支持触发更新，能够快速检测并通告自治系统内的拓扑变化。</li>\n<li>[4] OSPF 可以解决网络扩容带来的问题，当网络上的路由器越来越多，路由信息流量急剧增长的时候，OSPF 可以将每个自治系统划分为多个区域，并限制每个区域的范围。OSPF 这种分区域的特点，使得 OSPF 特别适合大中型网络，OSPF 可以提供认证功能，OSPF 路由器之间的报文可以配置成必须经过认证才能进行交换。</li>\n</ul>\n<p class=\"red\">2，OSPF 原理介绍：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65q9r8.png\" alt=\"图片\"></li>\n<li>[2] OSPF 要求每台运行 OSPF 的路由器都连接整个网络的链路状态信息，这样才能计算出到达目的地的最优路径。</li>\n<li>[3] OSPF 的收敛过程由链路状态公告 LSA (Link State Advertisement) 泛洪开始，LSA 中包含了路由器已知的接口 IP 地址，掩码，开销和网络类型等信息。</li>\n<li>[4] 收到 LSA 的路由器都可以根据 LSA 提供的信息建立自己的链路状态数据库 LSDB (Link State Database)，并在 LSDB 的基础上使用 SPF 算法进行运算，建立起到达每个网络的最短路径树。</li>\n<li>[5] 最后，通过最短路径树得到到达目的网络的最优路由，并将其加入到 IP 路由表中。</li>\n</ul>\n<p class=\"red\">3，OSPF 报文：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65L6k4.png\" alt=\"图片\"></li>\n<li>[2] OSPF 直接运行在 IP 协议之上，使用 IP 协议号 89。</li>\n<li>[3] OSPF 有五种报文类型，每种报文都使用相同的 OSPF 报文头。</li>\n<li>Hello 报文：最常用的一种报文，用于发现，维护邻居关系。并在广播和 NBMA (None-Broadcast Multi-Access) 类型的网络中选举指定路由器 DR (Designated Router) 和备份指定路由器 BDR (Backup Designated Router)。</li>\n<li>DD 报文：两台路由器进行 LSDB 数据库同步时，用 DD 报文来描述自己的 LSDB。DD 报文的内容包括 LSDB 中每一条 LSA 的头部 (LSA 的头部可以唯一标识一条 LSA)。LSA 头部只占一条 LSA 的整个数据量的一小部分，所以，这样就可以减少路由器之间的协议报文流量。</li>\n<li>LSR 报文：两台路由器相互交换过 DD 报文之后，知道对端的路由器有哪些 LSA 是本地 LSDB 所缺少的，这时需要发送 LSR 报文向对方请求缺少的 LSA，LSR 只包含了所需要的 LSA 的摘要信息。</li>\n<li>LSU 报文：用来向对端路由器发送所需要的 LSA。</li>\n<li>LSACK 报文：用来对接收到的 LSU 报文进行确认。</li>\n</ul>\n<p class=\"red\">4，邻居状态机：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65japd.png\" alt=\"图片\"></li>\n<li>[2] 邻居和邻接关系建立的过程如下：</li>\n<li>Down：这是邻居的初始状态，表示没有在邻居失效时间间隔内收到来自邻居路由器的 Hello 数据包。</li>\n<li>Attempt：此状态只在 NBMA 网络上存在，表示没有收到邻居的任何信息，但是已经周期性的向邻居发送报文，发送间隔为 HelloInterval。如果 RouterDeadInterval 间隔内未收到邻居的 Hello 报文，则转为 Down 状态。</li>\n<li>Init：在此状态下，路由器已经从邻居收到了 Hello 报文，但是自己不在所收到的 Hello 报文的邻居列表中，尚未与邻居建立双向的通信关系。</li>\n<li>2-Way：在此状态下，双向通信已经建立，但是没有与邻居建立邻接关系，这是建立邻接关系以前的最高级状态。</li>\n<li>ExStart：这是形成邻接关系的第一个步骤，邻居状态变成此状态以后，路由器开始向邻居发送 DD 报文，主从关系是在此状态下形成的，初始 DD 序列号也是在此状态下决定的，在此状态下发送的 DD 报文不包含链路状态描述，</li>\n<li>Exchange：此状态下路由器相互发送包含链路状态信息摘要的 DD 报文，描述本地 LSDB 的内容。</li>\n<li>Loading：相互发送 LSR 报文请求 LSA，发送 LSU 报文通告 LSA。</li>\n<li>Full：路由器的 LSDB 已经同步。</li>\n</ul>\n<p class=\"red\">5，Router ID，邻居和邻接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65xyWQ.png\" alt=\"图片\"></li>\n<li>[2] Router ID 是一个 32 位的值，它唯一标识了一个自治系统内的路由器，管理员可以为每台运行 OSPF 的路由器手动配置一个 Router ID。如果未手动指定，设备会按照以下规则自动选举 Router ID：</li>\n<li>[3] 如果设备存在多个逻辑接口地址，则路由器使用逻辑接口中最大的 IP 地址作为 Router ID。</li>\n<li>[4] 如果没有配置逻辑接口，则路由器使用物理接口的最大 IP 地址作为 Router ID。</li>\n<li>[5] 在为一台运行 OSPF 的路由器配置新的 Router ID 后，可以在路由器上通过重置 OSPF 进程来更新 Router ID。通常建议手动配置 Router ID，以防 Router ID 因为接口地址的变化而改变。</li>\n<li>[6] 运行 OSPF 的路由器之间需要交换链路状态信息和路由信息，在交换这些信息之前路由器之间首先需要建立邻接关系。</li>\n<li>[7] 邻居 (Neighbor)：</li>\n<li>OSPF 路由器启动后，便会通过 OSPF 接口向外发送 Hello 报文用于发现邻居，收到 Hello 报文的 OSPF 路由器会检查报文中所定义的以下参数，如果双方的参数一致，就会彼此形成邻居关系，状态到达 2-Way 即可称为建立了邻居关系。</li>\n<li>[8] 邻接 (Adjacency)：</li>\n<li>形成邻居的双方不一定都能形成邻接关系，这要根据网络类型而定。只有当双方成功交换 DD 报文，并同步 LSDB 后，才形成了真正意义上的邻接关系。</li>\n<li>上图所示，RTA 通过以太网连接了三个路由器，所以 RTA 有三个邻居，但不能说 RTA 有三个邻接关系。</li>\n</ul>\n<p class=\"red\">6，邻居发现：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/65zjjs.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Hello 报文用来发现和维持 OSPF 邻居关系。</ins></li>\n<li>[2] OSPF 的邻居发现过程是基于 Hello 报文来实现的，Hello 报文中的主要字段解释如下：</li>\n<li>Network Mask：发送 Hello 报文的接口的网络掩码。</li>\n<li>Hello interval：发送 Hello 报文的时间\t间隔，单位为秒。</li>\n<li>Options：标识发送此报文的 OSPF 路由器所支持的可选功能，具体的可选功能未来解释。</li>\n<li>Router Priority：发送 Hello 报文的接口的 Router Priority，用于选举 DR 和 BDR。</li>\n<li>Router Dead Interval：失效时间，如果在此时间内未收到邻居发来的 Hello 报文，则认为邻居失效，单位为秒，通常为 4 倍 Hello Interval。</li>\n<li>Designated Router：发送 Hello 报文的路由器所选举的 DR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 DR 路由器。</li>\n<li>Backup Designated Router：发送 Hello 报文的路由器所选举出的 BDR 的 IP 地址，如果设置为 0.0.0.0 表示未选举 BDR。</li>\n<li>Neighbor：邻居得到 Router ID 列表，表示本路由器已经从这些邻居收到了合法的 Hello 报文。</li>\n<li>如果路由器发现所接收的合法 Hello 报文的邻居列表中有自己的 Router ID，则认为已经和邻居建立了双向邻接，表示邻居关系已经建立。</li>\n<li>[3] 验证一个接收到的 Hello 报文是否合法包括：</li>\n<li>如果接收端口的网络类型是广播型，点到多点或者 NBMA，所接收的 Hello 报文中 Network Mask 字段必须和接受端口的网络掩码一致，如果接收端口的网络类型为点到点类型或者是虚连接，则不检查 Network Mask 字段。</li>\n<li>所接收的 Hello 报文中 Hello Interval 字段必须和接收端口的配置一致。</li>\n<li>所接收的 Hello 报文中 Router Dead Interval 字段必须和接收端口的配置一致。</li>\n<li>所接收的 Hello 报文中 Options 字段中的 E-bit (表示是否接收外部路由信息) 必须和相关区域的配置一致。</li>\n</ul>\n<p class=\"red\">7，数据库同步：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6I9Xge.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：路由器使用 DD 报文来进行主从路由器的选举和数据库摘要信息的交互。</ins></li>\n<li><ins class=\"wavy\">注：DD 报文包含 LSA 的头部信息，用来描述 LSDB 的摘要信息。</ins></li>\n<li>[2] 如上图所示，路由器在建立完成邻居关系之后，便开始进行数据库同步，具体关系如下：</li>\n<li>[3] 邻居状态变为 ExStart 以后，RTA\t向 RTB 发送第一个 DD 报文，在这个报文中，DD 序列号被设置为 X (假设)，RTA 宣告自己为主路由器。</li>\n<li>[4] RTB 也向 RTA 发送第一个 DD 报文，在这个报文中。DD 序列号被设置为 Y (假设)。RTB 也宣告自己为主路由器，由于 RTB 的 Router ID 比 RTA 的大，所以 RTB 应当为真正的主路由器。</li>\n<li>[5] RTA 发送一个新的 DD 报文，在这个新的报文中包含 LSDB 的摘要信息，序列号设置为 RTB 在步骤 2 里使用的序列号，因此 RTB 将邻居状态改变为 Exchange。</li>\n<li>[6] 邻居状态变为 Exchange 以后，RTB 发送一个新的 DD 报文，该报文中包含 LSDB 的描述信息。DD 序列号设置为 Y+1 (上次使用的序列号加 1)</li>\n<li>[7] 即使 RTA 不需要新的 DD 报文描述自己的 LSDB，但是作为从路由器，RTA 需要对主路由器 RTB 发送的每一个 DD 报文进行确认。所以，RTA 向 RTB 发送一个内容为空的 DD 报文，序列号为 Y+1</li>\n<li>[8] 发送完最后一个 DD 报文之后，RTA 将邻居状态改变为 Loading，RTB\t收到最后一个 DD 报文之后，改变状态为 Full (假设 RTB 的 LSDB 是最新最全的，不需要向 RTA 请求更新)。</li>\n</ul>\n<p class=\"red\">8，建立完全邻接关系：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6IiwcD.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：LSR 用于向对方请求所需的 LSA。</ins></li>\n<li><ins class=\"wavy\">注：LSU 用于向对方发送其所需的 LSA。</ins></li>\n<li><ins class=\"wavy\">注：LSACK 用于向对方发送收到 LSA 的确认。</ins></li>\n<li>[2] 邻居状态变为 Loading 之后，RTA 开始向 RTB 发送 LSR 报文，请求那些在 Exchange 状态下通过 DD 报文发现的，而且在本地 LSDB 中没有的链路状态信息。</li>\n<li>[3] RTB 收到 LSR 报文之后，向 RTA 发送 LSU 报文，在 LSU 报文中，包含了那些被请求的链路状态的详细信息。RTA 收到 LSU 报文后，将邻居状态从 Loading 改变成 Full。</li>\n<li>[4] RTA 向 RTB 发送 LSACK 报文，用于对已接受 LSA 的确认。</li>\n<li>[5] 此时，RTA 和 RTB 之间的邻居状态变为 Full，表示达到完全邻接状态。</li>\n</ul>\n<p class=\"red\">9，OSPF 支持的网络类型 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/21/6IFAgO.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省情况下，OSPF 认为以太网的网络类型是广播类型，PPP，HDLC 的网络类型是点到点类型。</ins></li>\n<li>[2] OSPF 定义了四种网络类型，分别是点到点网络，广播型网络，NBMA 网络和点到多点网络。</li>\n<li>[3] 点到点网络是指只把两台路由器直接相连的网络，一个运行 PPP 的 64k 串行线路就是一个点到点的网络例子。</li>\n<li>[4] 广播型网络是指支持两台以上路由器，并且具有广播功能的网络，一个含有三台路由器的以太网就是一个广播型网络的例子。</li>\n</ul>\n<p class=\"red\">10，OSPF 支持的网络类型 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IFrxU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：缺省情况下，OSPF 认为帧中继，ATM 的网络类型是 NBMA。</ins></li>\n<li>[2] OSPF 可以在不支持广播的多路访问网络上运行，此类网络包括在 hub~spoke 拓扑上运行的帧中继 (FR) 和异步传输模式 (ATM) 网络，这些网络的通信依赖于虚电路，OSPF 定义了两种支持多路访问的网络类型：非广播多路访问网络 (NBMA) 和点到多点网络 (Point To Multi-Points)。</li>\n<li>[3] NBMA：在 NBMA 网络上，OSPF 模拟在广播型网络上的操作，但是每个路由器的邻居需要手动配置，NBMA 方式要求网络中的路由器组成全连接。</li>\n<li>[4] P2MP：将整个网络看成是一组点到点网络，对于不能组成全连接的网络应当使用点到多点方式，例如只使用 PVC 的不完全连接的帧中继网络。</li>\n</ul>\n<p class=\"red\">11，DR&amp;BDR：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IkcSf.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DR 可以减少广播型网络中的邻接关系的数量。</ins></li>\n<li>[2] 每一个含有至少两个路由器的广播型网络和 NBMA 网络都有一个 DR 和 BDR。</li>\n<li>[3] DR 和 BDR 可以减少邻接关系的数量，从而减少链路状态信息以及路由信息的交换次数，这样可以节省带宽，降低对路由器处理能力的压力。</li>\n<li>[4] 一个既不是 DR 也不是 BDR 的路由器只与 DR 和 BDR 形成邻接关系并交换链路状态信息以及路由信息。这样就大大减少了大型广播型网络和 NBMA 网络中的邻接关系数量，在没有 DR 的广播网络上，邻接关系的数量可以根据公式 n (n-1)/2 计算出，n 代表参与 OSPF 的路由器接口的数量。</li>\n<li>[5] 如上图所示，使用路由器之间有 6 个邻接关系，当指定 DR 后，所有的路由器都与 DR 建立起邻接关系，DR 成为该广播网络上的中心点。</li>\n<li>[6] BDR 在 DR 发生故障时接管业务，一个广播网络上所有路由器都必须同 BDR 建立邻接关系，上图使用 DR 和 BDR 将邻接关系从 6 减少到了 5，RTA 和 RTB 都只需要同 DR 和 BDR 建立邻接关系，RTA 和 RTB 之间建立的是邻居关系。</li>\n<li>[7] 上图中，邻接关系数量的减少效果并不明显，但是，当网络上部署了大量路由器时，比如 100 台，那么情况就不一样了。</li>\n</ul>\n<p class=\"red\">12，DR&amp;BDR 选举：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IEUVH.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DR 是基于端口的 DR 优先级的值进行选举的。</ins></li>\n<li>[2] 在邻居发现完成之后，路由器会根据网段类型进行 DR 选举，在广播和 NBMA 网络上，路由器会根据参与选举的每个接口的优先级进行 DR 选举，优先级取值范围为 0-255，值越高越优先，缺省情况下，接口优先级为 1，如果一个接口优先级为 0，那么该端口将不会参与 DR 或者 BDR 的选举，如果优先级相同时，则比较 Router ID，值越大越优先被选举为 DR。</li>\n<li>[3] 为了给 DR 做备份，每个广播和 NBMA 网络上还要选举一个 BDR。BDR 也会与 2 网络上所有的路由器建立邻接关系。</li>\n<li>[4] 为了维护网络上邻接关系的稳定性，如果网络中已经存在 DR 和 BDR，则新添加进该网络的路由器不会成为 DR 和 BDR，不管该路由器的 Router Priority 是否最大，如果当前 DR 发生故障，则当前 BDR 自动成为新的 DR，网络中重新选举 BDR，如果当前 BDR 发生故障，则 DR 不变，重新选举 BDR，这种机制的目的是为了保持邻接关系的稳定，使拓扑结构的改变对邻接关系的影响尽量小。</li>\n</ul>\n<p class=\"red\">13，OSPF 区域：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IVrk9.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：每个区域都维护一个独立的 LSDB。</ins></li>\n<li><ins class=\"wavy\">注：Area 0 是骨干区域，其他区域都必须与此区域相连。</ins></li>\n<li>[2] OSPF 支持将一组网段组合在一起，这样的一个组合称为一个区域。</li>\n<li>[3] 划分 OSPF 区域可以缩小路由器的 LSDB 规模，减少网络流量。</li>\n<li>[4] 区域内的详细拓扑信息不向其他区域发送，区域间传递的是抽象的路由信息，而不是详细的描述拓扑结构的链路状态信息，每个区域都有自己的 LSDB，不同区域的 LSDB 是不同的，路由器会为每一个自己所连接到的区域维护一个单独的 LSDB，由于详细链路状态信息不会被发布到区域以外，因此 LSDB 的规模大大缩小了。</li>\n<li>[5] Area0 为骨干区域，为了避免区域间路由环路，非骨干区域之间不允许直接相互发布路由信息，因此，每个区域都必须连接到骨干区域。</li>\n<li>[6] 运行在区域之间的路由器叫做区域边界路由器 ABR (Ares Boundary Router)，它包含所有相连的区域的 LSDB，自治系统边界路由器 ASBR (Autonomous System Boundary Router) 是指和其他 AS 中的路由器交换路由信息的路由器，这种路由器会向整个 AS 通告 AS 外部路由信息。</li>\n<li>[7] 在规模较小的企业网络中，可以把所有的路由器划分到同一个区域中，同一个 OSPF 区域中的路由器中的 LSDB 是完全一致的，OSPF 区域号可以手动配置，为了便于将来的网络拓展，推荐将该区域设置为 0，即骨干区域。</li>\n</ul>\n<p class=\"red\">14，OSPF 开销：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6IZhvV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：OSPF 的开销计算公式为带宽参考值 / 带宽。</ins></li>\n<li><ins class=\"wavy\">注：可以通过 bandwidth-reference 命令来设置带宽参考值。</ins></li>\n<li>[2] OSPF 基于接口带宽计算开销，计算公式为：接口开销 = 带宽参考值 / 带宽。带宽参考值可配置，缺省为 100Mbit/s。以此，一个 64Kbit/s 串口的开销为 1562，一个 E1 接口 (2.048Mbit/s) 的开销为 48。</li>\n<li>[3] 命令 bandwidth-reference 可以用来调整带宽参考值，从而可以改变接口开销，带宽参考值越大，开销越准确，在支持 10Gbit/s 速率的情况下，推荐将带宽参考值提高到 10000Mbit/s 来分别为 10Gbit/s，1Gbit/s 和 100Mbit/s 的链路提供 1，10，100 的开销。注意，配置带宽参考值时，需要在整个 OSPF 网络中统一进行调整。</li>\n<li>[4] 另外，还可以通过 OSPF cost 命令来手动为一个接口调整开销，开销取值 f 范围是 1~65535，缺省值为 1。</li>\n</ul>\n<p class=\"red\">15，OSPF 配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TnY4g.png\" alt=\"图片\"></li>\n<li>[2] 在配置 OSPF 时。需要首先使能 OSPF 进程。</li>\n<li>[3] 命令 OSPF (process id ) 用来使能 OSPF，在该命令中可以配置进程 ID，如果没有配置进程 ID。则使用 1 作为缺省进程 ID。</li>\n<li>[4] 命令 OSPF (process id) (Router-id\t) 即可以使能 OSPF 进程，还同时可以用于配置 Router ID，在该命令中，Router -ID 代表路由器 ID。</li>\n<li>[5] 命令 network 用于指定运行 OSPF 协议的接口，在该命令中需要指定一个反掩码。反掩码中，“0” 代表此位必须严格匹配，“1” 表示该地址可以为任意值。</li>\n</ul>\n<p class=\"red\">16，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TnxqP.png\" alt=\"图片\"></li>\n<li>[2] 命令 display ospf peer 可以用来查看邻居相关的属性，包括区域，邻居的状态，邻接协商的主从状态以及 DR 和 BDR 情况。</li>\n</ul>\n<p class=\"red\">17，OSPF 认证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TuwJe.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：华为 ARG3 系列路由器运行 OSPF 时，支持两种认证方式：区域认证和接口认证。</ins></li>\n<li>[2] OSPF 支持简单认证及加密认证功能，加密认证对潜在的攻击行为有更强的防范行。OSPF 认证可以配置在接口上或者区域上，配置接口认证方式的优先级高于区域认证方式。</li>\n<li>[3] 接口或区域上都可以运行 OSPF authentication-mode 命令来配置简单认证，参数 simple 表示使用明文传输密码，参数 plain 表示密码以明文形式存放在设备中，参数 cipher 表示密码以密文形式存放在设备中，参数 Null 表示不认证。</li>\n<li>[4] 命令 OSPF authentication-mode 用于配置加密认证，MD5 是一种保证链路认证安全的加密算法，参数 key-id 表示接口加密认证中的认证密钥 ID，它必须与对端的 key-id 一致。</li>\n</ul>\n<p class=\"red\">18，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TKBkT.png\" alt=\"图片\"></li>\n<li>[2] 在启用认证功能后，可以在终端上进行调试来查看认证过程。</li>\n<li>[3] debugging ospf packet 命令用来指定调试 OSPF 报文，然后便可以查看认证过程，以确定认证配置是否成功。</li>\n</ul>\n<p class=\"red\">19，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] OSPF Hello 报文中 Router Dead Interval 字段的作用是什么？</li>\n<li>Hello 报文中的 Router Dead Interval 字段代表死亡间隔，如果在此时间内未收到邻居发送来的 Hello 报文，则认为邻居失效，死亡间隔时 Hello 间隔的四倍，在广播网络上缺省为 40 秒 (因为 Hello 间隔缺省为 10 秒)</li>\n<li>[2] 在广播网络中，DR 和 BDR 用来接收链路状态更新报文的目的地址是什么？</li>\n<li>在广播网络上，DR 和 BDR 都使用组播地址 224.0.0.6 来接收链路状态更新报文。</li>\n</ul>\n<h1 id=\"第十八章dhcp原理与配置\"><a class=\"anchor\" href=\"#第十八章dhcp原理与配置\">#</a> 第十八章【DHCP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>在大型企业网络中，会有大量的主机或设备需要获取 IP 地址等网络参数，如果采用手工配置，工作量大且不好管理，如果有用户擅自修改网络参数，还可能会造成\tIP 地址冲突等问题，使用动态主机配置协议 DHCP (Dynamic Host Configuration Protocol) 来分配 IP 地址等网络参数，可以减少管理员的工作量，避免用户手动配置网络参数时造成的地址冲突。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，DHCP 应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TQndP.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DHCP 服务器能够为大量主机分配 IP 地址，并能集中管理。</ins></li>\n<li>[2] 在大型企业网络中，一般会有大量的主机等终端设备，每个终端设备都需要配置 IP 地址等网络参数才能接入网络。</li>\n<li>[3] 在小型网络中，终端数量小，可以手动配置 IP 地址，但是在大中型网络中，终端数量很多，手动配置 IP 地址工作量大，而且配置时容易导致 IP 地址冲突等错误。</li>\n<li>[4] DHCP 可以为网络终端动态分配 IP 地址，解决了手动配置 IP 地址时的各种问题。</li>\n</ul>\n<p class=\"red\">2，DHCP 报文类型：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/22/6TQ0WF.png\" alt=\"图片\"></li>\n<li>[2] DHCP 客户端初次接入网络时，会发送 DHCP 发现报文 (DHCP Discover)，用于查找和定位 DHCP 服务器。</li>\n<li>[3] DHCP 服务器在接收到 DHCP 发现报文后，发送 DHCP 提供报文 (DHCP Offer)，此报文中包含 IP 地址等配置信息。</li>\n<li>[4] 在 DHCP 客户端收到服务器发送的 DHCP 提供报文后，会发送 DHCP 请求报文 (DHCP Request)，另外在 DHCP 客户端获取 IP 地址并重启之后，同样也会发送 DHCP 请求报文，用于确认分配的 IP 地址等配置信息。DHCP 客户端获取的 IP 地址租期快要到期时，也发送 DHCP 请求报文向服务器申请延长 IP 地址租期。</li>\n<li>[5] 收到 DHCP 客户端发送的 DHCP 请求报文后，DHCP 服务器会回复 DHCP 确认报文 (DHCP ACK)。客户端收到 DHCP 确认报文后，会将获取的 IP 地址等信息进行配置和使用。</li>\n<li>[6] 如果 DHCP 服务器收到 DHCP-REQUEST 报文后，没有找到相应的租约记录，则发送 DHCP-NAK 报文作为回应，告知 DHCP 客户端无法分配合适的 IP 地址。</li>\n<li>[7] DHCP 客户端通过发送 DHCP 释放报文 (DHCP Release) 来释放 IP 地址，收到 DHCP 释放报文后，DHCP 服务器可以把该 IP 地址分配给其他 DHCP 客户端。</li>\n</ul>\n<p class=\"red\">3，地址池：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TlT9U.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：ARG3 系列路由器支持两种地址池：全局地址池和接口地址池。</ins></li>\n<li>[2] ARG3 系列路由器和 X7 系列交换机都可以作为 DHCP 服务器，为主机等设备分配 IP 地址。DHCP 服务器的地址池是用来定义分配给主机的 IP 地址范围，有两种形式。</li>\n<li>[3] 接口地址池为连接到同一网段的主机或终端分配 IP 地址。可以在服务器的接口下执行 dhcp select interface 命令，配置 DHCP 服务器采用接口地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li>\n<li>[4] 全局地址池为所有连接到 DHCP 服务器的终端分配 IP 地址，可以在服务器的接口下执行 dhcp select global 命令，配置 DHCP 服务器采用全局地址池的 DHCP 服务器模式为客户端分配 IP 地址。</li>\n<li>[5] 接口地址池的优先级比全局地址池高，配置了全局地址池后，如果又在接口上配置了地址池，客户端将会从接口地址池中获取 IP 地址，在 X7 系列交换机上，只能在 VLAN IF 逻辑接口上配置接口地址池。</li>\n</ul>\n<p class=\"red\">4，DHCP 工作原理：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T1MvQ.png\" alt=\"图片\"></li>\n<li>[2] 为了获取 IP 地址等配置信息，DHCP 客户端需要和 DHCP 服务器进行报文交互。</li>\n<li>[3] 首先。DHCP 客户端发送 DHCP 发现报文来发现 DHCP 服务器，DHCP 服务器会选取一个未分配的 IP 地址，向 DHCP 客户端发送 DHCP 提供报文，此报文中包含分配给客户端的 IP 地址和其他配置信息。如果存在多个 DHCP 服务器，每个 DHCP 服务器都会响应。</li>\n<li>[4] 如果有多个 DHCP 服务器向 DHCP 客户端发送 DHCP 提供报文，DHCP 客户端会选择收到的第一个 DHCP 提供报文，然后发送 DHCP 请求报文，报文中包含请求的 IP 地址，收到 DHCP 请求报文后，提供该 IP 地址的 DHCP 服务器会向 DHCP 客户端发送一个 DHCP 确认报文，包含提供的 IP 地址和其他配置信息。</li>\n<li>[5] DHCP 客户端收到 DHCP 确认报文后，会发送免费 ARP 报文，检查网络中是否有其他主机使用分配的 IP 地址，如果指定时间内没有收到 ARP 应答，DHCP 客户端会使用这个 IP 地址，如果有主机使用该 IP 地址，DHCP 客户端会向 DHCP 服务器发送 DHCP 拒绝报文，通知服务器该 IP 地址已被占用，然后 DHCP 客户端会向服务器重新申请一个 IP 地址。</li>\n</ul>\n<p class=\"red\">5，DHCP 租期更新：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T1Tat.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：IP 租约期限到达 50% 时，DHCP 客户端会请求更新 IP 地址租约。</ins></li>\n<li>[2] 申请到 IP 地址后，DHCP 客户端中会保存三个定时器，分别用来控制租约更新，租期重绑定和租期失效。</li>\n<li>[3] DHCP 服务器为 DHCP 客户端分配 IP 地址时会指定三个定时器的值，如果，DHCP 服务器没有指定定时器的值，DHCP 客户端会使用缺省值，缺省租期为 1 天。</li>\n<li>[4] 默认情况下，还剩下 50% 的租期时，DHCP 客户端开始租约更新过程，DHCP 客户端向分配 IP 地址的服务器发送 DHCP 请求报文来申请延迟 IP 地址的租期，DHCP 服务器向客户端发送 DHCP 确认报文，给予 DHCP 客户端一个新的租期。</li>\n</ul>\n<p class=\"red\">6，DHCP 重绑定：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3FRU.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：DHCP 客户端在租约期限到达 87.5% 时，还没有收到服务器响应，会申请重绑定 IP。</ins></li>\n<li>[2] DHCP 客户端发送 DHCP 请求报文续租时，如果 DHCP 客户端没有收到 DHCP 服务器的 DHCP 应答报文，默认情况下，重绑定定时器在租期剩余 12.5% 的时候超时，超时后，DHCP 客户端就会认为原 DHCP 服务器不可用，开始重新发送 DHCP 请求报文，网络上任何一台 DHCP 服务器都可以应答 DHCP 确认或 DHCP 非确认报文。</li>\n<li>[3] 如果收到 DHCP 确认报文，DHCP 客户端重新进入绑定状态，复位租期更新计时器和重绑定计时器，如果收到 DHCP 非确认报文，DHCP 客户端进入初始化状态，此时，DHCP 客户端必须立即停止使用现有 IP 地址，重新申请 IP 地址。</li>\n</ul>\n<p class=\"red\">7，IP 地址释放：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3QJK.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：如果 IP 租约到期前都没有收到服务器响应，客户端停止使用此 IP 地址。</ins></li>\n<li>++ 注：如果 DHCP 客户端不再使用分配的 IP 地址，也可以主动向 DHCP 服务器发送 DHCP Release 报文，释放该 IP 地址。</li>\n<li>[2] 租期计时器是地址失效进程中的最后一个定时器，超时时间为 IP 地址的租期时间，如果 DHCP 客户端在租期失效定时器超时前没有收到服务器的任何回应，DHCP 客户端必须立刻停止使用现有 IP 地址，发送 DHCP Release 报文，并进入初始化状态，然后，DHCP 客户端重新发送 DHCP 发现报文，申请 IP 地址。</li>\n</ul>\n<p class=\"red\">8，DHCP 接口地址池的配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T3TOJ.png\" alt=\"图片\"></li>\n<li>[2] DHCP 支持配置两种地址池，包括全局地址池和接口地址池。</li>\n<li>[3] DHCP enable 命令用来使能 DHCP 功能，在配置 DHCP 服务器时，必须先执行 dhcp enable 命令，才能配置 DHCP 的其他功能并生效。</li>\n<li>[4] dhcp select interface 命令用来关联接口和接口地址池，为连接到接口的主机提供配置信息，上图所示，接口 G0/0/0 被加入到接口地址池中。</li>\n<li>[5] dhcp server dns-list 命令用来指定接口地址池下的 DNS 服务器地址。</li>\n<li>[6] dhcp server excluded-ip-address 命令用来配置接口地址池中不参与自动分配的 IP 地址范围</li>\n<li>[7] dhcp server lease 命令用来配置 DHCP 服务器接口地址池中 IP 地址的租用有效期限功能。缺省情况下，接口地址池中 IP 地址的租用有效期限为 1 天。</li>\n</ul>\n<p class=\"red\">9，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T8NX4.png\" alt=\"图片\"></li>\n<li>[2] 每个 DHCP 服务器可以定义一个或多个全局地址池和接口地址池，上图中执行 display ip pool 命令查看接口地址池的属性。</li>\n<li>[3] display 信息中包含地址池的 IP 地址范围，还包括 IP 网关\t，子网掩码等信息。</li>\n</ul>\n<p class=\"red\">10，DHCP 全局地址池配置：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T8z40.png\" alt=\"图片\"></li>\n<li>[2] 上图所示，配置了一个 DHCP 全局地址池。</li>\n<li>ip pool 命令用来创建全局地址池。</li>\n<li>network 命令用来配置全局地址池下可分配的网段。</li>\n<li>gateway-list 命令用来配置 DHCP 服务器全局地址池的出口网关地址。</li>\n<li>lease 命令用来配置 DHCP 全局地址池下的地址租期，缺省情况下，IP 地址租期是 1 天。</li>\n<li>dhcp select global 命令用来使能接口的 DHCP 服务器功能。</li>\n</ul>\n<p class=\"red\">11，配置验证：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TGlKe.png\" alt=\"图片\"></li>\n<li>[2] display ip pool 命令可以查看全局 IP 地址池信息，管理员可以查看地址池的网关，子网掩码，IP 地址统计信息等内容，监控地址池的使用情况，了解已分配的 IP 地址数量，以及其他使用统计信息。</li>\n</ul>\n<p class=\"red\">12，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 地址池中的那些 IP 地址一般会被保留？</li>\n<li>在 IP 地址池中，应该排除分配给 DNS 等服务器的 IP 地址，DHCP 服务器接口的 IP 地址等，避免 IP 地址冲突。</li>\n<li>[2] DHCP 服务器的 IP 地址租期默认是多久？</li>\n<li>默认的 IP 地址租期是 86400 秒。即一天。</li>\n</ul>\n<h1 id=\"第十九章ftp原理与配置\"><a class=\"anchor\" href=\"#第十九章ftp原理与配置\">#</a> 第十九章【FTP 原理与配置】</h1>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>FTP 是用来传输文件的协议\t，使用 FTP 实现远程文件传输的同时，也可以保证数据传输的可靠性和高效性。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，FTP 的应用：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TG0Kg.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：FTP 提供了一种在服务器和客户机之间上传和下载文件的有效方式。</ins></li>\n<li>[2] 在企业网络中部署一台 FTP 服务器，将网络设备配置为 FTP 客户端，则可以使用 FTP 来备份或更新 VRP 文件和配置文件。也可以把网络设备配置为 FTP 服务器，将设备的日志文件保存到某台主机上方便查看。</li>\n</ul>\n<p class=\"red\">2，FTP 传输文件的过程：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TanPA.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：使用 FTP 传输数据时，需要在服务器和客户机之间建立控制连接和数据连接。</ins></li>\n<li>[2] 使用 FTP 进行文件传输时，会使用两个 TCP 连接，第一个连接是 FTP 客户端和 FTP 服务器间的控制连接，FTP 服务器开启 21 号端口，等待 FTP 客户端发送链接请求，FTP 客户端随机开启端口，向服务器发送建立连接的请求，控制连接用于在服务器和客户端之间传输控制命令。</li>\n<li>[3] 第二个连接是 FTP 客户端和 FTP 服务器间的数据连接，服务器使用 TCP 的 20 号端口与客户端建立数据连接，通常情况下，服务器主动建立或中断数据连接。</li>\n</ul>\n<p class=\"red\">3，FTP 传输模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6Ta0MV.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：传输模式定义了数据在客户端和服务器之间传输时的格式。</ins></li>\n<li>[2] FTP 传输数据时支持两种传输模式：ASCII 模式和二进制模式。</li>\n<li>[3] ASCII 模式用于传输文本，发送端的字符在发送前被转换成 ASCII 码格式之后进行传输，接收端收到之后再将其转换成字符。</li>\n<li>[4] 二进制模式常用于发送图片文件和程序文件，发送端在发送这些文件时无需转换格式，即可传输。</li>\n</ul>\n<p class=\"red\">4，FTP 配置 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6Ta7IH.png\" alt=\"图片\"></li>\n<li>[2] ARG3 系列路由器和 X7 系列路由器均可提供 FTP 功能。</li>\n<li>[3] 执行 ftp server enable 命令使能 FTP 功能。</li>\n<li>[4] 执行 set default ftp-directory 命令设置 FTP 用户的默认工作目录。</li>\n</ul>\n<p class=\"red\">5，FTP 配置 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TdGy6.png\" alt=\"图片\"></li>\n<li>[2] 在配置 FTP 服务器时，可以使用 AAA 为每个用户分别配置登录账号和访问权限。</li>\n<li>[3] aaa 命令用来进入 AAA 视图。</li>\n<li>[4] local-user user-name 命令用来创建本地用户，并配置本地用户的各项参数。</li>\n<li>[5] user-name 指定用户名。</li>\n<li>[6] local-user huawei service-type ftp 命令用来配置本地用户的接入类型为 ftp。</li>\n<li>[7] ftp-directory 指定 FTP 用户可访问的目录，如果不配置 FTP 用户可访问的目录，则 FTP 用户无法登录设备。</li>\n<li>[8] access-limit 指定用户可以建立的最大连接数目。</li>\n<li>[9] idle-timeout 指定用户的闲置超时时间。</li>\n<li>[10] privilege level 指定用户的优先级。</li>\n</ul>\n<p class=\"red\">6，FTP 配置 (3)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TwkAe.png\" alt=\"图片\"></li>\n<li>[2] ftp 用户用来与远程 FTP 服务器建立控制连接，并进入 FTP 客户端视图。</li>\n<li>[3] binary 命令用来在设备作为 FTP 客户端时设置文件传输方式为 Binary 模式，又称为二进制模式。</li>\n<li>[4] 缺省情况下，文件传输模式为 ASCII 模式。</li>\n<li>[5] get 命令用来从远程 FTP 服务器下载文件并保存在本地。</li>\n</ul>\n<p class=\"red\">7，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] FTP 服务默认使用服务器哪些端口？</li>\n<li>FTP 服务器需要开启 TCP 的 21 号端口来建立控制连接，20 号端口来建立数据连接。</li>\n<li>[2] 用户反馈没有权限去访问 FTP 服务器上的目录，应该如何解决？</li>\n<li>如果用户无法访问任何工作目录，则需要定义一个默认的 FTP 目录，执行 set default ftp-direcory 命令建立默认目录。</li>\n</ul>\n<h1 id=\"第二十章telnet原理与配置\"><a class=\"anchor\" href=\"#第二十章telnet原理与配置\">#</a> 第二十章【Telnet 原理与配置】</h1>\n<p>1.4 1-11 机器人  1-12</p>\n<details class=\"primary\"><summary>前言</summary><div>\n<ul>\n<li>如果企业网络中有一台或多台网络设备需要远程进行配置和管理，管理员可以使用 Telnet 远程连接到每一台设备上，对这些网络设备进行集中的管理和维护。</li>\n</ul>\n</div></details>\n<p class=\"red\">1，Telnet 应用场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TgE4K.png\" alt=\"图片\"></li>\n<li><ins class=\"wavy\">注：Telnet 可以通过终端对本地和远程的网络设备进行集中管理。</ins></li>\n<li>[2] Telnet 提供了一个交互式操作页面，允许终端远程登录到任何可以充当 Telnet 服务器的设备，Telnet 用户可以像通过 Console 口本地登录一样对设备进行操作。</li>\n<li>[3] 远端 Telnet 服务器和终端之间无需直连，只需保证两者之间可以相互通信即可，通过使用 Telnet，用户可以方便地实现对设备进行远程管理和维护。</li>\n</ul>\n<p class=\"red\">2，Telnet 连接：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6T2hQg.png\" alt=\"图片\"></li>\n<li><ins ,wavy>注：Telnet 客户端和服务器基于 TCP 连接来传输命令。</ins></li>\n<li>[2] Telnet 以客户端 / 服务器模式运行，Telnet 基于 TCP 协议，服务器端口默认是 23，服务器通过该端口与客户端建立 Telnet 连接。</li>\n</ul>\n<p class=\"red\">3，认证模式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TRpwR.png\" alt=\"图片\"></li>\n<li>[2] 在配置 Telnet 登录用户界面时，必须配置认证方式，否则用户无法成功登录设备。</li>\n<li>[3] Telnet 认证有两种模式：AAA 认证，密码认证。</li>\n<li>当配置用户界面的认证方式为 AAA 时，用户登录设备时需要首先输入登录用户名和密码才能登录。</li>\n<li>当配置用户界面的认证方式为 password 时，用户登录设备时需要先输入登陆密码才能登录。</li>\n</ul>\n<p class=\"red\">4，Telnet 配置 (1)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TRgB9.png\" alt=\"图片\"></li>\n<li>[2] 网络设备作为 Telnet 服务器，通常使用密码认证机制来认证连接到 VTY 接口的用户。</li>\n<li>[3] VTY (Virtual Type Terminal) 是网络设备用来管理和监控通过 Telnet 方式登录的用户的界面，网络设备为每个 Telnet 用户分配一个 VTY 界面。缺省情况下，ARG3 系列路由器支持的 Telnet 用户最大数目为 5 个，VTY 0 4 的含义是 VTY0 VTY1 VTY2 VTY3 VTY4。如果需要增加 Telnet 用户的登录数量，可以使用 user-interface maximum-vty 命令来调整 VTY 界面的数量。</li>\n<li>[4] 执行 authentication-mode password 命令，可以配置 VTY 通过密码对用户进性认证。</li>\n<li>[5] 注：不同的 VRP 版本执行 set authentication password cipher 命令有差异：有些平台需要回车后输入密码，另外一些平台可以直接在命令后输入密码，故，在操作具体产品时需要查阅相应的 VRP 产品文档。</li>\n</ul>\n<p class=\"red\">5，Telnet 配置 (2)：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/03/23/6TfaWV.png\" alt=\"图片\"></li>\n<li>[2] 远程设备配置为 Telnet 服务器之后，可以在客户端上执行 telnet 命令来与服务器建立 Telnet 连接，客户端会收到需要认证相关的提示信息，用户输入的认证密码需要匹配 Telnet 服务器上保存的密码，认证通过之后，用户就可以通过 Telnet 远程连接到 Telnet 服务器上，在本地对远端的设备进行配置和管理。</li>\n</ul>\n<p class=\"red\">6，总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如果网络设备已经配置完成 Telnet 服务，但是用户仍然不能实现远程访问，原因可能是什么？</li>\n<li>如果无法建立 Telnet 连接，首先验证设备是否可达，如果设备可达，再检查用户输入的密码是否正确，如果密码正确，再查看当前通过 Telnet 访问设备的用户量是否到达最大限制。如需增加用户数量，可以执行 user-\tinterface maximum-vty&lt;0-15&gt; 命令，0-15 表示支持的用户数。</li>\n</ul>\n",
            "tags": [
                "技术",
                "HUAWEI"
            ]
        },
        {
            "id": "https://manshan.top/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/",
            "url": "https://manshan.top/2021/03/06/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/",
            "title": "数据通信与计算机网络",
            "date_published": "2021-03-06T15:39:28.474Z",
            "content_html": "<h1 id=\"第一章-概述\"><a class=\"anchor\" href=\"#第一章-概述\">#</a> 第一章 【概述】</h1>\n<h2 id=\"数据通信概述\"><a class=\"anchor\" href=\"#数据通信概述\">#</a> 数据通信概述</h2>\n<p class=\"red\">1，通信 (Communication)</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<details class=\"primary\"><summary>通信简介</summary><div>\n<ul>\n<li>[1] 通信是指人与人或人与自然之间，通过某种行为或媒体进行的信息交流与传递。不同的环境对通信有着不同的解释，在出现电波传递信息后，通信被单一解释为信息的传递，是指一地向另一地进行信息的传输与交换的过程。其目的是传递消息 (messgae) 中包含的信息 (Information)。</li>\n<li>[2] 通信传递的消息有多种形式，如，符号，文字，数据，语音，图形，图像等。他们大致可以归纳为两种类型：连续消息和离散消息。</li>\n<li>[3] 连续消息是指：消息的状态是随时间 l 连续变化的，如强弱变化的语音。</li>\n<li>[4] 离散消息是指：消息的状态是可数的或离散的，如，文字，符号和数据等。</li>\n<li>[5] 通常，我们把连续消息和离散消息分别称为模拟消息和数字消息。</li>\n<li>[6] 模拟信号：其信号的波形可以表示为时间的连续函数，通常，以模拟信号来传送消息的通信方式称为模拟通信，而传输模拟信号的通信系统称为模拟通信系统，</li>\n<li>[7] 数字信号：其特征是幅度不随时间连续变化，只能取有限个离散值。通常以两个离散值 (0,1) 来表示二进制数字信号。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6K7OKJ.png\" alt=\"图片\"></li>\n<li>[8] 注意：模拟信号和数字信号虽然是两种不同形式的信号，但他们在传输过程中可以相互变换的，模拟信号可以采用模数转换技术变换为离散的数字信号，而数字信号可以通过数模转换技术变换为连续的模拟信号。</li>\n<li>[9] 与模拟通信相比，数字信号具有以下优点：抗干扰性强，保密性好，设备易于集成化和便于使用计算技术对其进行处理等。缺点是占用的信道频带比模拟通信宽的多，降低了信道的使用率。但随着信道技术的改善，这一问题将会得到解决。</li>\n<li>[10] 数据通信是通信技术和计算机技术相结合而产生的一种新的通信方式。从某种意义上来说，数据通信可看成是数字通信的案例，具有数字通信的一切优点，</li>\n<li>[11] 数据通信主要是 “人 (通过终端)—— 机 (计算机)” 通信或 “机 —— 机” 通信。它以数据传输为基础，包括数据传输和数据交换，以及在数据传输前后的数据处理过程。由于数据通信离不开计算机，因此人们常把数据通信与计算机通信这两个名词混用。</li>\n</ul>\n</div></details>\n<h2 id=\"数据通信系统\"><a class=\"anchor\" href=\"#数据通信系统\">#</a> 数据通信系统</h2>\n<p class=\"red\">1，数据通信系统的模型</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>下面以两台 PC 通过电话线，在经公用电话网进行通信的简单例子，来说明任何一个通信系统都可以用一个简单的通信模型来抽象地描述其内在含义。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/07/6KXUv8.png\" alt=\"图片\"></li>\n<li>该模型包括：源系统，传输系统和目的系统三个部分，有以下五个组成要素。</li>\n<li>[1] 源点：它是生成传输数据的设备，如，PC。</li>\n<li>[2] 发送器：通常，源点生成的数据要通过发送器编码后才能成为在传输系统中进行传输的电信号，如，调制解调器从相连的 PC 获得数字比特流，并变换成能在电话网上传输的模拟信号。</li>\n<li>[3] 传输系统：它是简单的传输线或复杂的网络系统。</li>\n<li>[4] 接收器：接收来自传输系统的信号并转换为终点能处理的信息，如，调制解调器接收来自传输系统的模拟信号，并将其转换成数字比特流。</li>\n<li>[5] 终点：它是获取来自接收器数据的设备。</li>\n</ul>\n<p class=\"red\">2，数据通信系统的组成</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>如前所述，数据通信主要是 “人 —— 机” 通信或 “机 —— 机” 通信，而，数据传输又是实现数据通信的基础。</li>\n<li>因此：凡是将终端设备与计算机经由模拟或数字传输系统连接起来，并以收集，传输，分配和处理数据为目的的系统都称为数据通信系统。它是实现数据通信的功能性物理实体。</li>\n</ul>\n<details class=\"primary\"><summary>具体组成</summary><div>\n<ul>\n<li>数据通信系统的具体组成可以从不同的角度给予不同的描述，从该系统设备级的构成，可认为数据通信系统由以下三个子系统组成。</li>\n</ul>\n<h1 id=\"第二章-数据通信基础知识\"><a class=\"anchor\" href=\"#第二章-数据通信基础知识\">#</a> 第二章 【数据通信基础知识】</h1>\n<h1 id=\"第三章-数据传输信道\"><a class=\"anchor\" href=\"#第三章-数据传输信道\">#</a> 第三章 【数据传输信道】</h1>\n<h1 id=\"第四章-数据传输技术\"><a class=\"anchor\" href=\"#第四章-数据传输技术\">#</a> 第四章 【数据传输技术】</h1>\n<h1 id=\"第五章-物理层\"><a class=\"anchor\" href=\"#第五章-物理层\">#</a> 第五章 【物理层】</h1>\n<h1 id=\"第六章-数据链路层\"><a class=\"anchor\" href=\"#第六章-数据链路层\">#</a> 第六章 【数据链路层】</h1>\n<h1 id=\"第七章-网络层\"><a class=\"anchor\" href=\"#第七章-网络层\">#</a> 第七章 【网络层】</h1>\n<h1 id=\"第八章-传输层\"><a class=\"anchor\" href=\"#第八章-传输层\">#</a> 第八章 【传输层】</h1>\n<h1 id=\"第九章-应用层\"><a class=\"anchor\" href=\"#第九章-应用层\">#</a> 第九章 【应用层】</h1>\n<h1 id=\"第十章-因特网的多媒体应用服务\"><a class=\"anchor\" href=\"#第十章-因特网的多媒体应用服务\">#</a> 第十章 【因特网的多媒体应用服务】</h1>\n<h1 id=\"第十一章-无线网络\"><a class=\"anchor\" href=\"#第十一章-无线网络\">#</a> 第十一章 【无线网络】</h1>\n<h1 id=\"第十二章-计算机网络的管理与安全\"><a class=\"anchor\" href=\"#第十二章-计算机网络的管理与安全\">#</a> 第十二章 【计算机网络的管理与安全】</h1>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n</div></details>\n",
            "tags": [
                "技术",
                "数通"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/",
            "url": "https://manshan.top/2021/01/21/%E6%96%B0%E5%8D%8E%E4%B8%89H3C%E5%88%B7%E9%A2%98/",
            "title": "新华三H3C刷题",
            "date_published": "2021-01-21T13:04:39.266Z",
            "content_html": "<h1 id=\"写再前面\"><a class=\"anchor\" href=\"#写再前面\">#</a> 写再前面</h1>\n<div class=\"note warning\">\n<p>注意注意</p>\n</div>\n<ul>\n<li>这是不同的题库，所以没有顺序。</li>\n<li>可能会有重复的题或解析。</li>\n</ul>\n<h1 id=\"第一章\"><a class=\"anchor\" href=\"#第一章\">#</a> 第一章</h1>\n<p>1，AAA 作为一种网络安全管理机制，可以通过如下哪些协议来实现？（选择一项或多项）<br>\nA：TACACS+<br>\nB: 802.1X<br>\nC: RADIUS+<br>\nD: EAPOL<br>\n<span class=\"red\"> 答案：AC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>AAA 包括三种功能：认证、授权、计费，常用 RADIUS 协议和 TACACS + 协议使用远程服务器，或交换机设备本身作为认证服务器.</li>\n</ul>\n<details class=\"primary\"><summary>AAA简介</summary><div>\n<ul>\n<li>\n<p>AAA 是认证（Authentication）、授权（Authorization）和计费（Accounting）的简称，是网络安全中进行访问控制的一种安全管理机制，提供认证、授权和计费三种安全服务。</p>\n</li>\n<li>\n<p>认证（Authentication）：是对用户的身份进行验证，判断其是否为合法用户。</p>\n</li>\n<li>\n<p>授权（Authorization）：是对通过认证的用户，授权其可以使用哪些服务。</p>\n</li>\n<li>\n<p>计费（Accounting）：是记录用户使用网络服务的资源情况，这些信息将作为计费的依据。</p>\n</li>\n<li>\n<p>AAA 一般采用 C/S（客户端 / 服务器）模式，这种模式结构简单、扩展性好，且便于集中管理用户信息，如图所示。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/21/s47bT0.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>AAA 客户端运行于 NAS（Network Access Server，网络接入服务器）上，AAA 服务器用于集中管理用户信息。</p>\n</li>\n<li>\n<p>远程接入用户通过网络（如 ISDN、PSTN 等）与 NAS 建立连接，从而获得访问其它网络（如 Internet）的权利或取得网络资源。</p>\n</li>\n<li>\n<p>NAS 负责把用户的认证、授权、计费信息透传给 AAA 服务器。</p>\n</li>\n<li>\n<p>AAA 服务器负责接收用户的连接请求，并对用户身份进行验证，返回用户配置信息给 NAS。</p>\n</li>\n<li>\n<p>NAS 根据服务器的返回信息进行配置并告知用户结果。</p>\n</li>\n</ul>\n</div></details>\n<p>2，园区网中可以采取如下那些措施来保证网络或者设备的安全？<br>\nA：对于非法访问网络资源，可以部署 ACL 来进行访问控制<br>\n B: 在网络中的交换机上配置 BPDU 保护功能<br>\n C: 部署 IPSEC VPN 来构建专用网络<br>\n D：园区网络通过 NAT 转换访问 INTERNET<br>\n<span class=\"red\"> 答案：ABCD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>ACL简介</summary><div>\n<ul>\n<li>\n<p>访问控制列表 (ACL)：是一种基于包过滤的访问控制技术，它可以根据设定的条件对接口上的数据包进行过滤，允许其通过或丢弃。访问控制列表被广泛地应用于路由器和三层交换机，借助于访问控制列表，可以有效地控制用户对网络的访问，从而最大程度地保障网络安全。</p>\n</li>\n<li>\n<p>功能：限制网络流量、提高网络性能；通信流量的控制，在网络设备接口处，决定哪种类型的通信流量被转发、哪种类型的通信流量被阻塞。</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>BPDU简介</summary><div>\n<ul>\n<li>\n<p>网桥协议数据单元 (BPDU,Bridge Protocol Data Unit) 生成树协议是一种桥嵌套协议，在 IEEE 802.1d 规范里定义，可以用来消除桥回路。它的工作原理是这样的：生成树协议定义了一个数据包，叫做桥协议数据单元 BPDU。</p>\n</li>\n<li>\n<p>网桥用 BPDU 来相互通信，并用 BPDU 的相关机能来动态选择根桥和备份桥。但是因为从中心桥到任何网段只有一个路径存在，所以桥回路被消除。</p>\n</li>\n<li>\n<p>在一个生成树环境里，桥不会立即开始转发功能，它们必须首先选择一个桥为根桥，然后建立一个指定路径。在一个网络里边拥有最低桥 ID 的将变成一个根桥，全部的生成树网络里面只有一个根桥。</p>\n</li>\n<li>\n<p>功能：根桥的主要职责是定期发送配置信息，然后这种配置信息将会被所有的指定桥发送。这在生成树网络里面是一种机制，一旦网络结构发生变化，网络状态将会重新配置。</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>IPSEC VPN简介</summary><div>\n<ul>\n<li>\n<p>指采用 IPSec 协议来实现远程接入的一种 VPN 技术，IPSec 全称为 Internet Protocol Security，是由 Internet Engineering Task Force (IETF) 定义的安全标准框架，在公网上为两个私有网络提供安全通信通道，通过加密通道保证连接的安全 —— 在两个公共网关间提供私密数据封包服务</p>\n</li>\n<li>\n<p>IPSEC 是一套比较完整成体系的 VPN 技术，它规定了一系列的协议标准。</p>\n</li>\n<li>\n<p>相关协议：</p>\n</li>\n<li>\n<p>1，VPN 作为一项成熟的技术，广泛应用于组织总部和分支机构之间的组网互联，其利用组织已有的互联网出口，虚拟出一条 “专线”，将组织的分支机构和总部连接起来，组成一个大的局域网。</p>\n</li>\n<li>\n<p>2，VPN 用户访问内网资源还需为拨入到 UTM25 的用户分配一个虚拟的私有 IP，使 SSL VPN 客户端的用户可以像局域网用户一样能正常访问局域网内的资源。</p>\n</li>\n<li>\n<p>导入 IPsec 协议原因：</p>\n</li>\n<li>\n<p>1，原因有 2 个，一个是原来的 TCP/IP 体系中间，没有包括基于安全的设计，任何人，只要能够搭入线路，即可分析所有的通讯数据。IPSEC 引进了完整的安全机制，包括加密、认证和数据防篡改功能。</p>\n</li>\n<li>\n<p>2，IPSEC 协议通过包封装技术，能够利用 Internet 可路由的地址，封装内部网络的 IP 地址，实现异地网络的互通。</p>\n</li>\n</ul>\n</div></details>\n<p>3，SSH 协议作为一种安全的远程登录协议，被广泛应用，关于 SSH 的描述正确的是____<br>\nA：SSH 采用额外的加密技术确保登录安全性<br>\n B:SSH 采用 TCP 端口 22 传输数据，端口 23 建立连接<br>\n C：SSH 还可以为 FTP 提供安全的传输通道<br>\n D：SSH 即 Secure Shell，可以采用 DES 认证方式保证数据的安全性<br>\n<span class=\"red\">答案：ACD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>SSH简介</summary><div>\n<ul>\n<li>\n<p>SSH (Secure Shell) 是一种安全远程登录协议，SSH 协议基于 TCP 进行传输，端口是 22。</p>\n</li>\n<li>\n<p>通过使用 SSH 协议，远程登录访问的安全性得到了很大提升，此外，SSH 还提供 SFTP (SSH File Transfer Protocol)，对在公共的 Internet 上的数据传输进行了安全保护。</p>\n</li>\n<li>\n<p>SSH 协议的特点：</p>\n</li>\n<li>\n<p>1，支持 DES、3DES 数据加密算法</p>\n</li>\n<li>\n<p>2，支持公钥验证方式、密钥改变、不验证方式</p>\n</li>\n<li>\n<p>3，支持 RSA 认证，具有防篡改功能</p>\n</li>\n</ul>\n</div></details>\n<p>4，关于 POE 系统，说法正确的是_____________<br>\nA：POE 系统包含 PSE 设备和 PD 设备两部分，其中 PD 为供电设备，PSE 为受电设备<br>\n B：POE 通常采用 mid-span 和 end-span 两种供电方法<br>\n C：通常 PSE 可以支持 mid-span 和 end-span 两种方法，PD 只能支持一种<br>\n D：POE 电源提供的电压为 48V，输出功率通常不超过 13W<br>\n<span class=\"red\"> 答案：BD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>POE简介</summary><div>\n<ul>\n<li>\n<p>POE (Power Over Ethernet) 指的是在现有的以太网 Cat.5 布线基础架构不作任何改动的情况下，在为一些基于 IP 的终端（如 IP 电话机、无线局域网接入点 AP、网络摄像机等）传输数据信号的同时，还能为此类设备提供直流供电的技术。POE 技术能在确保现有结构化布线安全的同时保证现有网络的正常运作，最大限度地降低成本。</p>\n</li>\n<li>\n<p>POE 也被称为基于局域网的供电系统 (PoL, Power over LAN) 或有源以太网 (ActiveEthernet)，有时也被简称为以太网供电。</p>\n</li>\n<li></li>\n<li>\n<p>PSE 供电设备，PD 受电设备</p>\n</li>\n<li>\n<p>mid-span 和 end-span 的区别在于</p>\n</li>\n<li>\n<p>1，mid-span 是普通交换机（无内置 POE 模块），需要外接 POE 电源的方式。</p>\n</li>\n<li>\n<p>2，end-span 是具有 POE 功能的交换机供电模式。</p>\n</li>\n</ul>\n</div></details>\n<p>5，在 NTP 客户端 / 服务器模式中，有关配置验证的说法正确的有____<br>\nA：在使能验证的同时必须同时配置验证密钥和可信密钥，否则无法正常启动验证<br>\n B：应在客户端上将制定密钥玉服务器关联，才可以成功完成验证<br>\n C：客户端未使能验证，而服务器使能验证的情况下，客户端的时钟也能同步<br>\n D: 客户端和服务器端的验证必须保持一致，否则时钟同步失败<br>\n<span class=\"red\">答案：ABC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>NTP简介</summary><div>\n<ul>\n<li>\n<p>NTP 服务器【Network Time Protocol（NTP）】是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS 等等) 做同步化，它可以提供高精准度的时间校正（LAN 上与标准间差小于 1 毫秒，WAN 上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。时间按 NTP 服务器的等级传播。按照离外部 UTC 源的远近把所有服务器归入不同的 Stratum（层）中。</p>\n</li>\n<li>\n<p>NTP 验证功能可以分为客户端的 NTP 验证和服务器端的 NTP 验证两个部分。在应用 NTP 验证功能时，应注意以下原则：</p>\n</li>\n<li>\n<p>1、对于所有同步模式，如果使能了 NTP 验证功能，应同时配置验证密钥并将密钥设为可信密钥，否则，无法正常启动 NTP 验证功能。</p>\n</li>\n<li>\n<p>对于客户端 / 服务器模式和对等体模式，还应在客户端（对等体模式中的主动对等体）将指定密钥与对应的 NTP 服务器（对等体模式的被动对等体）关联；对于广播服务器模式和组播服务器模式，应在广播服务器或组播服务器上将指定密钥与对应的 NTP 服务器关联。否则，无法正常启动 NTP 验证功能。</p>\n</li>\n<li>\n<p>对于客户端 / 服务器同步模式，如果客户端没有成功启动 NTP 验证功能，不论服务器端是否使能 NTP 验证，客户端均可以与服务器同步；如果客户端上成功启用了 NTP 验证功能，则客户端只会同步到提供可信密钥的服务器，如果服务器提供的密钥不是可信的密钥，那么客户端不会与其同步。</p>\n</li>\n<li>\n<p>对于所有同步模式，服务器端的配置与客户端的配置应保持一致。</p>\n</li>\n</ul>\n</div></details>\n<p>6，路由器 IGMP 协议的版本可以在___视图中配置<br>\n A：用户视图<br>\n B：系统全局视图<br>\n C：IGMP 视图<br>\n D：接口视图<br>\n<span class=\"red\">答案：CD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>IGMP协议简介</summary><div>\n<ul>\n<li>\n<p>Internet 组管理协议称为 IGMP 协议（Internet Group Management Protocol），是因特网协议家族中的一个组播协议。该协议运行在主机和组播路由器之间。IGMP 协议共有三个版本，即 IGMPv1、v2 和 v3。</p>\n</li>\n<li>\n<p>IGMP（Internet Group Management Protocol）因特网组管理协议，是 TCP/IP 协议族中负责 IPv4 组播成员管理的协议，用来在 IP 主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系。</p>\n</li>\n<li>\n<p>在配置路由器的 IGMP 具体参数之前，需要指定 IGMP 协议的版本，IGMP 的版本可以在 IGMP 视图配置也可以在接口视图配置。</p>\n</li>\n<li>\n<p>在 IGMP 视图配置全局 IGMP 版本的命令为：</p>\n</li>\n<li>\n<p>[H3C-igmp]version version-number</p>\n</li>\n<li>\n<p>在接口视图配置 IGMP 版本的命令为：</p>\n</li>\n<li>\n<p>[H3C-Vlan-interface100]igmp version version-number</p>\n</li>\n</ul>\n</div></details>\n<p>7，关于交换机的端口模式和 IP 电话语音流类型的配合关系，说法正确的有___<br>\nA: 如果 IP 电话语音流为 tagged 语音流，则交换机端口可以工作在自动和手动模式 B：如果 IP 电话语音流在 untagged 语音流，则交换机端口只能工作在手动模式<br>\n C：自动模式下，端口不能为 access 端口<br>\n D：手动模式下，端口只能为 trunk 端口<br>\n<span class=\"red\">答案：ABC</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>端口模式和IP电话语音流类型的配合关系简介</summary><div>\n<ul>\n<li>端口模式与 IP 电话语音流类型配合关系：</li>\n<li>1，自动模式：</li>\n<li>(1) 如果是 tagged 语音流 ：</li>\n<li>access: 不支持，</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须存在且不能是 voice VLAN，同时接入端口允许缺省 VLAN 通过</li>\n<li>hybrid: 支持，但是接入端口的缺省 VLAN 必须存在且不能是 voice VLAN，同时缺省 VLAN 应在接入端口允许通过的 tagged VLAn 列表中。</li>\n<li>(2) 如果是 untagged 语音流：</li>\n<li>access、Trunk、hybrid: 不支持</li>\n<li>2，手动模式：</li>\n<li>(1) 如果是 tagged 语音流</li>\n<li>access；不支持</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须存在，且不能那个是 voice vlan，同时接入端口允许该缺省 VLAN 通过</li>\n<li>hybrid: 支持，但接入端口的缺省 VLAN 必须存在且不能是 voice vlan，同时 voice vlan 应在接入端口允许通过的 tagged vlan 列表中</li>\n<li>(2) 如果是 untagged 语音流</li>\n<li>access: 支持，但接入端口的缺省 VLAN 必须是 voice vlan</li>\n<li>trunk: 支持，但接入端口的缺省 VLAN 必须是 voice vlan，且接入端口允许 voice vlan 通过</li>\n<li>hybrid: 支持，但接入端口的缺省 VLAN 必须是 voice vlan, 且在接入端口允许通过 untagged vlan 列表中</li>\n</ul>\n</div></details>\n<p>8，下面说法正确的是__（选择一项或多项）<br>\nA.MSTP 和 RSTP 能够互相识别对方的协议报文，可以互相兼容<br>\n B. 在 STP 兼容模式下，设备的各个端口将向外发送 STP BPDU 报文<br>\n C. 在 RSTP 模式下，设备的各个端口将向外发送 RSTP BPDU 报文，当发现与 STP 设备相连时，该端口会自动迁移到 STP 兼容模式下工作<br>\n D. 在 MSTP 模式下，设备的各个端口将向外发送 MSTP BPDU 报文，当发现某端口与 STP 设备相连时，该端口会自动迁移到 STP 兼容模式下工作<br>\n<span class=\"red\">答案：BCD</span></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>MSTP与RSTP，STP的简介</summary><div>\n<ul>\n<li>MSTP-RSTP-STP  这样的兼容顺序，不能从 STP 向 MSTP 兼容。</li>\n<li>MSTP 是多生成树协议，是在有多个 vlan 的情况下使用的一种生成树协议</li>\n<li>RSTP 是快速生成树协议，是从 STP 生成树协议简化升级而来，去掉了 2 种状态，从而提高计算时间。</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>MSTP简介</summary><div>\n<ul>\n<li>\n<p>MSTP 是多生成树协议，允许一个交换环境中运行多个生成树，每个生成树称为一个实例，MSTP 将路由环路网络修剪成一个无环的树形网络，避免广播风暴的产生，同时还提供了数据转发的多个冗余路径，在数据转发过程中实现 VLAN 数据的负载均衡，MSTP 还兼容 STP 和 RSTP。</p>\n</li>\n<li>\n<p>MSTP 的基本原理：</p>\n</li>\n<li>\n<p>1，MSTP 的网络层次：</p>\n</li>\n<li>\n<p>一个二层交换网络可以划分多个 MST 域，每个生成树域可以划分多个 MSTI，每个实例中可以映射多个 VLAN</p>\n</li>\n<li>\n<p>2，MST 域：</p>\n</li>\n<li>\n<p>MST 域是多生成树域，由局域网中的多台交换机他们之间的网段构成一个局域网可以存在多个 MST 域，各 MST 域之间在物理上直接或间接相连。</p>\n</li>\n<li>\n<p>3，MSTI：</p>\n</li>\n<li>\n<p>一个 MSTI 域内可以运行多个 MSTI，MSTI 之间彼此独立，MSTI 可以与一个或者多个 VLAN 对应，但一个 VLAN 只能与一个 MSTI 对应。</p>\n</li>\n<li>\n<p>4，端口角色：</p>\n</li>\n<li>\n<p>MSTP 中的角色主要有根端口，指定端口，预备端口，备份端口和边缘端口，除边缘端口外其他端口角色都参与 MSTP 的计算过程。</p>\n</li>\n<li>\n<p>5，MSTP 的端口状态主要有三种：</p>\n</li>\n<li>\n<p>Forwarding：转发状态</p>\n</li>\n<li>\n<p>Learning：学习状态</p>\n</li>\n<li>\n<p>Discarding：阻塞状态</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>RSTP简介</summary><div>\n<ul>\n<li>\n<p>RSTP（rapid spanning Tree Protocol ），即快速生成树协议，这种协议在网络结构发生变化时，能更快的收敛网络。它比 802.1d 多了一种端口类型：备份端口（backup port）类型，用来做指定端口的备份。 STP（Spanning Tree Protocol ）是生成树协议的英文缩写。该协议可应用于环路网络，通过一定的算法实现路径冗余，同时将环路网络修剪成无环路的树型网络，从而避免报文在环路网络中的增生和无限循环。</p>\n</li>\n<li>\n<p>快速生成树协议（Rapid Spanning Tree Protocol ，RSTP） 用于在局域网中消除数据链路层物理环路，其核心是快速生成树算法。</p>\n</li>\n<li>\n<p>RSTP 完全向下兼容 STP 协议除了和传统的 STP 协议一样具有避免回路、动态管理冗余链路的功能外，RSTP 极大的缩短了拓扑收敛时间，在理想的网络拓扑规模下，所有交换设备均支持 RSTP 协议且配置得当时，拓扑发生变化（链路 UP/DOWN）后恢复稳定的时间可以控制在秒级，而传统的拓扑稳定且能正常工作所需时间为 50 秒。</p>\n</li>\n<li>\n<p>RSTP 的主要功能可以归纳如下：</p>\n</li>\n<li>\n<p>1、 发现并生成局域网的一个最佳树型拓扑结构；</p>\n</li>\n<li>\n<p>2、 发现拓扑故障并随之进行恢复，自动更新网络拓扑结构，启用备份链路，同时保持最佳树型结构；</p>\n</li>\n<li>\n<p>运行 RSTP 协议的网络交换设备通过对自身网桥信息和接收到的 BPDU 中来自其他网桥的信息进行比较，利用 RSTP 算法进行计算，更新系统状态机，选举端口角色并阻塞某些端口，将环形网络裁剪成树形网络，防止环形网络中的报文增生和无限循环产生的广播风暴，避免因此带来的报文处理能力下降问题的发生</p>\n</li>\n</ul>\n</div></details>\n<details class=\"primary\"><summary>STP简介</summary><div>\n<ul>\n<li>\n<p>STP（Spanning Tree Protocol）是生成树协议的英文缩写，可应用于计算机网络中树形拓扑结构建立，主要作用是防止网桥网络中的冗余链路形成环路工作。但某些特定因素会导致 STP 失败，要排除故障可能非常困难，这取决于网络设计 [1]  。生成树协议适合所有厂商的网络设备，在配置上和体现功能强度上有所差别，但是在原理和应用效果是一致的。</p>\n</li>\n<li>\n<p>STP 的基本原理是，通过在交换机之间传递一种特殊的协议报文，网桥协议数据单元（Bridge Protocol Data Unit，简称 BPDU），来确定网络的拓扑结构。BPDU 有两种，配置 BPDU（Configuration BPDU）和 TCN BPDU。前者是用于计算无环的生成树的，后者则是用于在二层网络拓扑发生变化时产生用来缩短 MAC 表项的刷新时间的（由默认的 300s 缩短为 15s）。</p>\n</li>\n<li>\n<p>Spanning Tree Protocol（STP）是在 IEEE 802.1D 文档中定义，该协议的原理是按照树的结构来构造网络拓扑，消除网络中的环路，避免由于环路的存在而造成广播风暴问题。</p>\n</li>\n</ul>\n</div></details>\n<p>9，以太网交换机的二层转发基本流程包括__<br>\nA. 根据接收到的以太网帧的源 MAC 地址和 VLAN ID 信息添加或刷新 MAC 地址表项；<br>\nB. 根据目的 MAC 地址查找 MAC 地址表如果没有找到匹配项，那么在报文对应的 VLAN 内广播；<br>\nC. 如果找到匹配项，但是表项对应的端口并不属于报文对应的 VLAN，那么丢弃该帧；<br>\nD. 如果找到匹配项，且表项对应的端口属于报文对应的 VLAN，那么将报文转发到该端口，但是如果表项对应端口与收到以太网帧的端口相同，则丢弃该帧。</p>\n",
            "tags": [
                "技术",
                "H3C"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/",
            "url": "https://manshan.top/2021/01/18/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%88%B0%E9%AB%98%E7%BA%A7/",
            "title": "Python爬虫入门到高级",
            "date_published": "2021-01-18T11:36:46.777Z",
            "content_html": "<h1 id=\"第一章爬虫的概念\"><a class=\"anchor\" href=\"#第一章爬虫的概念\">#</a> 第一章【爬虫的概念】</h1>\n<p class=\"red\">1，什么是爬虫？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，程序员：写程序，然后去互联网上<em><strong>抓取数据</strong></em>的过程。</p>\n</li>\n<li>\n<p>2，互联网：庞大的网，有好多 a 链接组成的，网的节点就是一个 a 链接 ——&gt;URL (统一资源定位符)。</p>\n</li>\n</ul>\n<p class=\"red\">2，哪些语言可以实现爬虫？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，PHP：可以做，但对多进程，多线程支持的不好。</p>\n</li>\n<li>\n<p>2，JAVA：可以做，做的不错，最主要的竞争对手。但，代码臃肿，重构成本大。</p>\n</li>\n<li>\n<p>3，C，C++：可以做，但对个人能力要求高。</p>\n</li>\n<li>\n<p>4，Python：可以做，语法简单，代码优美，成本低，支持的模块多，强大的框架 Scrapy，最好的选择。</p>\n</li>\n</ul>\n<p class=\"red\">3，爬虫的两个概念</p>\n<div class=\"note info\">\n<p>通用爬虫</p>\n</div>\n<ul>\n<li>1，有：</li>\n<li>百度，360，谷歌，搜狐，Bing。</li>\n<li>2，原理：</li>\n<li>抓取网页</li>\n<li>采集数据</li>\n<li>数据处理</li>\n<li>提供检索服务</li>\n<li>3，通用爬虫如何抓取新网站？</li>\n<li>主动提交 URL</li>\n<li>设置友情链接</li>\n<li>百度会和 DNS 服务商合作，抓取新网站</li>\n<li>4，检索排名：</li>\n<li>竞价排名</li>\n<li>根据 pagerank 值，访问量，点击量 (SEO: 负责提升网站排名）</li>\n<li>5，robots.txt:</li>\n<li>限制哪些可以爬取，哪些不可以爬取，<span>是一个口头上的协议。自己写的爬虫程序不需要遵循。</span>{.red</li>\n</ul>\n<div class=\"note info\">\n<p>聚焦爬虫</p>\n</div>\n<ul>\n<li>1，简介：</li>\n<li>根据特定的需求，抓取指定的数据。</li>\n<li>2，思路：</li>\n<li>代替浏览器上网</li>\n<li>给一个 URL</li>\n<li>写程序，模拟浏览器访问 URL</li>\n<li>解析内容，提取数据</li>\n<li>3，网页的特点：</li>\n<li>网页都有自己唯一的 URL</li>\n<li>网页内容都是 HTML 结构</li>\n<li>使用的都是 http，https 协议</li>\n<li></li>\n</ul>\n",
            "tags": [
                "技术",
                "爬虫"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/",
            "url": "https://manshan.top/2021/01/18/Python%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/",
            "title": "Python高级编程",
            "date_published": "2021-01-18T11:34:34.882Z",
            "content_html": "<h1 id=\"第一章python基本语法\"><a class=\"anchor\" href=\"#第一章python基本语法\">#</a> 第一章【Python 基本语法】</h1>\n<h2 id=\"基本语法一\"><a class=\"anchor\" href=\"#基本语法一\">#</a> 基本语法 (一)</h2>\n<p class=\"red\">1，Python 程序的构成：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>1）命令的路径：</li>\n<li>#！/usr/bin/python</li>\n<li>2）中文编码的说明：</li>\n<li># -<em>- coding: UTF-8 -</em>- 或者 #coding=utf-8</li>\n<li>3）导入模块或模块的部分：</li>\n<li>import sys</li>\n<li>from modname import name</li>\n</ul>\n<p class=\"red\">2，第一个 Python 程序：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：&quot;HELLO XXX&quot;(XXX 为你的名字)</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># _*_coding:utf-8_*_</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>name <span class=\"token operator\">=</span> input<span class=\"token punctuation\">(</span>\"what`s your name ? <span class=\"token string\">\")</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>print(\"HELLO,%s\" % <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">))</span></pre></td></tr></table></figure><ul>\n<li>②：python 脚本语句的特点：</li>\n<li>一般情况下，每行一条语句，不需要用 &quot;;&quot; 结尾，也可以每行多条语句，语句之间用 &quot;;&quot; 分割，如下：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/usr/bin/python</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">import</span> sys<span class=\"token punctuation\">;</span> x <span class=\"token operator\">=</span> <span class=\"token string\">'runoob'</span><span class=\"token punctuation\">;</span> sys.stdout.write<span class=\"token punctuation\">(</span>x + <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>语句的缩进非常重要，同一子部分的语句缩进要相同用:</li>\n<li>for i in name:</li>\n<li>print(i)</li>\n<li>单行注释用 #，多行注释使用三个单引号 (''') 或三个双引号 (&quot;&quot;&quot;)。</li>\n</ul>\n<p class=\"red\">3，Python 序列：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>①：列表</li>\n<li>列表是 python 序列的重要组成之一，列表中的所有元素都放在 [] 中，相邻元素之间使用逗号分隔。</li>\n<li>当列表增加或者删除元素时，列表对象自动进行内存的扩展或发点红包，从而保证元素之间没有缝隙。</li>\n<li>同一列表中元素的数据可以各不相同。</li>\n<li>应用案例：</li>\n<li>自动生成一个列表 lst1，里面包含数字 1-10；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lst <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>i <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">i</span> <span class=\"token keyword\">in</span> range<span class=\"token punctuation\">(</span><span class=\"token number\">1,11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>print<span class=\"token punctuation\">(</span>lst<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>将你的学号的最后两位数字添加到列表 lst 的末尾；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lst.append<span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>print<span class=\"token punctuation\">(</span>lst<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>对列表 lst 进行降序排序；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lst.sort<span class=\"token punctuation\">(</span>reverse<span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>print<span class=\"token punctuation\">(</span>lst<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>从列表 lst 第一个位置开始，每隔一个位置取一个元素，生成一个新的列表 lst0；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lst0 <span class=\"token operator\">=</span> lst<span class=\"token punctuation\">[</span><span class=\"token number\">1</span>:-1:2<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul>\n<li>取 lst 的第二到倒数第二个元素，添加到 lst0；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lst1 <span class=\"token operator\">=</span> lst<span class=\"token punctuation\">[</span><span class=\"token number\">2</span>:-1<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lst0.extend<span class=\"token punctuation\">(</span>lst1<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>删除 lst0；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>del lst0</pre></td></tr></table></figure><ul>\n<li>创建列表：</li>\n<li>使用 “=” 直接将一个列表赋值给变量即可创建列表。</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>student <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'number'</span>,<span class=\"token string\">'name'</span>,age<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul>\n<li>使用 list () 函数将数组，range 对象，字符串，字典，集合或其他类型的数据转换\t为列表。</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>num <span class=\"token operator\">=</span> list<span class=\"token variable\"><span class=\"token punctuation\">((</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">))</span></span></pre></td></tr></table></figure><ul>\n<li>访问列表：</li>\n<li>访问整个列表。</li>\n<li>直接使用列表名</li>\n<li>访问列表 lst 中的元素。</li>\n<li>列表名 [索引]</li>\n<li><img data-src=\"https://z3.ax1x.com/2021/04/01/cZlDnx.png\" alt=\"图片\"></li>\n<li>返回元素 X 在列表 lst 中出现的次数。</li>\n<li>lst.count(x)</li>\n<li>对列表 lst 中的元素进行排序，key 用来指定排序的依据，reverse 决定升序 (False) 还是降序 (True)。</li>\n<li>lst.sort(key=None,reverse=False)</li>\n<li>对列表 lst 中的元素进行逆序。</li>\n<li>lst.reverse()</li>\n<li>删除列表 lst。</li>\n<li>del lst</li>\n<li>删除列表 lst 中第 i 个元素。</li>\n<li>del lst[i]</li>\n<li>删除列表 lst 中首次出现的 x 元素，该元素之后和所有元素前移一个位置。</li>\n<li>lst.remove(x)</li>\n<li>删除并返回列表 lst 中下标为 i 的元素 (如果不指定下标，默认为 - 1)</li>\n<li>lst.pop(i)</li>\n<li>清除列表 lst 中的所有元素，但保留列表对象。</li>\n<li>lst.clear()</li>\n<li>向列表 lst 末尾添加元素 x。</li>\n<li>lst.append(x)</li>\n<li>将列表 L 添加到列表 lst 的末尾。</li>\n<li>lst.extend(L)</li>\n<li>向列表 lst 的第 i 位添加元素 x。</li>\n<li>lst.insert(i, x)</li>\n<li></li>\n</ul>\n",
            "tags": [
                "技术",
                "Python"
            ]
        },
        {
            "id": "https://manshan.top/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/",
            "url": "https://manshan.top/2021/01/14/%E6%B7%B1%E4%BF%A1%E6%9C%8DSCSA/",
            "title": "深信服SCSA",
            "date_published": "2021-01-14T12:46:30.884Z",
            "content_html": "<h1 id=\"数通基础\"><a class=\"anchor\" href=\"#数通基础\">#</a> 数通基础</h1>\n<h2 id=\"帧结构及wireshark使用\"><a class=\"anchor\" href=\"#帧结构及wireshark使用\">#</a> 帧结构及 Wireshark 使用</h2>\n<p class=\"red\">1，网络三要素：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1]，设备：</li>\n<li>中间设备：路由器，交换机，HUB。</li>\n<li>终端设备：PC，服务器。</li>\n<li>[2]，介质：</li>\n<li>铜介质：同轴电缆，双绞线。</li>\n<li>直通线：两端线序一样，不同设备直通，T568/B： 白橙 橙 白绿 蓝 白蓝 绿 白棕 棕</li>\n<li>交叉线：两端线序不一样，同类设备交叉，T568/A：  1 3 换 2 6 换。</li>\n<li>MDI/MDIX：端口自动反转，端口自适应。几乎不再分交叉线，直通线。</li>\n<li>[3] 协议：</li>\n<li>TCP，IP，UDP，HTTP，DNS，FTP。</li>\n<li>[4] 组网结构，组网模型：</li>\n<li>总线型，树形，星形，网状。</li>\n<li>[5]CSMA/CD:</li>\n<li>在冲突域中使用的技术，防止冲突的产生。</li>\n<li>利用路由器进行多协议转换。</li>\n<li>[6] 一个数据帧大小的取值范围在 64——1518 字节之间。</li>\n<li>[7] 单播：MAC 地址第八个比特为 0。</li>\n<li>[8] 广播：MAC 地址全为 FF。</li>\n<li>[9] 组播：MAC 地址第八个比特为 1。</li>\n</ul>\n<p class=\"red\">2，以太网卡的工作方式：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 正常情况下网卡应该只接收这样的包：</li>\n<li>MAC 地址与自己相匹配的数据帧 (单播包)</li>\n<li>广播包 (Broadcast) 和属于自己的组播包 (Multicast)</li>\n<li>[2] 网卡完成收发数据包的工作，两种接受模式：</li>\n<li>混杂模式：不管数据帧中的目的地址是否与自己的地址匹配。都接受下来。</li>\n<li>非混杂模式：只接收目的地址相匹配的数据帧，以及广播数据包和组播数据包。</li>\n<li>[3] 在 Wireshark 中有两种过滤器：</li>\n<li>捕捉过滤器：在抓包前设置，让 Wireshark 只抓取过滤器指定的包。</li>\n<li>显示过滤器：在抓包之前或者抓包之后都可，不影响抓包，只是方便查看。</li>\n</ul>\n<h2 id=\"ip编址与子网划分\"><a class=\"anchor\" href=\"#ip编址与子网划分\">#</a> IP 编址与子网划分</h2>\n<h2 id=\"tcpip协议栈\"><a class=\"anchor\" href=\"#tcpip协议栈\">#</a> TCP/IP 协议栈</h2>\n<h2 id=\"交换网络与stp协议\"><a class=\"anchor\" href=\"#交换网络与stp协议\">#</a> 交换网络与 STP 协议</h2>\n<h2 id=\"静态路由协议与ospf\"><a class=\"anchor\" href=\"#静态路由协议与ospf\">#</a> 静态路由协议与 OSPF</h2>\n<h2 id=\"vlan技术原理与配置\"><a class=\"anchor\" href=\"#vlan技术原理与配置\">#</a> VLAN 技术原理与配置</h2>\n<h2 id=\"dhcptelnet\"><a class=\"anchor\" href=\"#dhcptelnet\">#</a> DHCP&amp;TELNET</h2>\n<h2 id=\"交换机高级特性\"><a class=\"anchor\" href=\"#交换机高级特性\">#</a> 交换机高级特性</h2>\n<h1 id=\"第一章信息安全概念\"><a class=\"anchor\" href=\"#第一章信息安全概念\">#</a> 第一章【信息安全概念】</h1>\n<h2 id=\"写在前面\"><a class=\"anchor\" href=\"#写在前面\">#</a> 写在前面</h2>\n<div class=\"note success\">\n<p>提示</p>\n</div>\n<ul>\n<li>缓存较大，图片需要加载一会。</li>\n<li>第一章关于伦理基础，只是截屏概括。</li>\n</ul>\n<h2 id=\"安全概念与网络层攻击\"><a class=\"anchor\" href=\"#安全概念与网络层攻击\">#</a> <strong>安全概念与网络层攻击：</strong></h2>\n<p>1，信息安全：通过采用<em><strong>软硬件技术，网络技术，密钥技术</strong></em>等安全技术和各种组织管理措施，来保护信息在其生命周期内的产生，传输，交换，处理和存储的各个环节中，信息的<em><strong>机密性，完整性和可用性</strong></em>不被破环。</p>\n<p>2，信息安全四个阶段：<em><strong>1，通信保密阶段。2，计算机安全阶段。3，信息技术安全阶段。4，信息保障阶段。</strong></em></p>\n<p>3，信息安全五要素：<em><strong>保密性，完整性，可用性，可控性，不可否认性。</strong></em></p>\n<p>4，五要素具体介绍：<br>\n- 保密性：确保信息不暴露给未授权的实体或进程。目的：即使信息被窃听或者截获，攻击者也无法知晓信息的真实内容，可以对抗网络攻击中的被动攻击。通过加密技术保障信息的保密性。<br>\n- 完整性：只有得到允许的人才能修改实体或进程，并且能够判别出实体或进程是否以被修改。完整性鉴别机制，保障只有允许的人才能修改数据，可以防篡改。靠 HASH。<br>\n- 可用性：得到授权的实体可获得服务，用访问控制机制，阻止非授权用户进入网络，使静态・信息可见，动态信息可操作，防止业务突然中断。<br>\n- 可控性：对信息进行监视审查，实现对网络资源及信息的可控性。<br>\n- 不可否认性：对出现的安全问题提供调查的依据和手段，使用审计，监控，防抵赖等安全机制，实现信息安全法的可审查性。</p>\n<p class=\"red\">5，信息安全风险有：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s0UmD0.png\" alt=\"图片\"><br>\n<img data-src=\"https://s3.ax1x.com/2021/01/15/s0wkCD.png\" alt=\"图片\"></p>\n<p>6，网络安全：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>计算机网络环境下的信息安全，指<span class=\"red\">网络系统的硬件，软件及其系统中的数据</span>受到保护，不因偶然的或者恶意的原因而遭到<span class=\"red\">破坏，更改，泄露，</span>系统连续可靠正常的运行，网络服务不中断。</li>\n</ul>\n<p class=\"red\">7，常见的网络安全风险：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s0woxH.png\" alt=\"图片\"></p>\n<p class=\"red\">8，常见的网络安全术语：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/15/s00AoV.png\" alt=\"图片\"></p>\n<p class=\"red\">9，网络的基本攻击模式：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssQqcq.png\" alt=\"图片\"></p>\n<p class=\"red\">10，网络的基本攻击模式有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，物理攻击</li>\n<li>2，流量型攻击</li>\n<li>3，单包攻击</li>\n</ul>\n<p class=\"red\">物理攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss1MoF.png\" alt=\"图片\"></p>\n<p class=\"red\">流量型攻击有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>(1)，网络层攻击，</li>\n<li>(2)，应用层攻击。</li>\n</ul>\n<p class=\"red\">流量攻击类型：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss1yQI.png\" alt=\"图片\"></p>\n<p class=\"red\">单包攻击有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>(1)，畸形报文攻击，</li>\n<li>(2)，特殊报文攻击，</li>\n<li>(3)，扫描窥探攻击。</li>\n</ul>\n<p class=\"red\">单包攻击类型：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss8lvR.png\" alt=\"图片\"></p>\n<p class=\"red\">单包攻击的种类：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ss8xMR.png\" alt=\"图片\"></p>\n<p class=\"red\">11，地址扫描攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssJKXR.png\" alt=\"图片\"></p>\n<p class=\"red\">12 端口扫描攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssJIEV.png\" alt=\"图片\"></p>\n<p class=\"red\">13，SMURF 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYp4O.png\" alt=\"图片\"></p>\n<p class=\"red\">14，LAND 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYlvj.png\" alt=\"图片\"></p>\n<p class=\"red\">15，Fraggle 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssYfRe.png\" alt=\"图片\"></p>\n<p class=\"red\">16，IP Fragment (分片) 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/sst1JO.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li class=\"red\">DF 位为 1 时，表示不能分片。</li>\n</ul>\n<p class=\"red\">17，IP Spoofing 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssNsN6.png\" alt=\"图片\"></p>\n<p class=\"red\">18，Teardrop (泪滴) 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssUOJK.png\" alt=\"图片\"></p>\n<p class=\"red\">19，WinNuke 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/17/ssaYy4.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，URG（紧急位）：设置为 1 时，首部中的紧急指针有效；为 0 时，紧急指针没有意义。</li>\n<li>2，PSH（推位）：当设置为 1 时，要求把数据尽快的交给应用层，不做处理。</li>\n<li>3，通常的数据中都会带有 PSH 但 URG 只在紧急数据的时设置，也称 “带外数据”，解释如下：</li>\n<li>URG 标志设置为 1 时，紧急指针才有效，紧急方式是向对方发送紧急数据的一种方式，表示数据要优先处理。</li>\n<li>URG=1，表示紧急指针指向包内数据段的某个字节（数据从第一字节到指针所指向字节就是紧急数据）不进入</li>\n<li>缓冲区（一般不都是待发送的数据要先进入发送缓存吗) 就直接交个上层进程，</li>\n<li>余下的数据都是要进入接收缓冲的；一般来说 TCP 是要等到整个缓存都填满了后在向上交付，</li>\n<li>但是如果 PSH=1 的话，就不用等到整个缓存都填满，直接交付，</li>\n<li>但是这里的交付仍然是从缓冲区交付的，URG 是不要经过缓冲区的。</li>\n</ul>\n</div></details>\n<p class=\"red\">20，超大 ICMP 报文攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sRH7h4.png\" alt=\"图片\"></p>\n<p class=\"red\">21，ICMP 重定向与不可达攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sRqeMR.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，ICMP 重定向：如上图，攻击者 1.5，被攻击者 100.2。攻击者截获其他主机发往网关 1.1 的数据包，攻击者修改完之后，在转发到互联网上。互联网回包时再发给攻击者 1.5</li>\n<li>2，ICMP 不可达：如上图，攻击者，向其他主机发送目的主机不可达信息，告诉其他主机 100.2 不可达，这样其他主机不会给 100.2 发包。</li>\n</ul>\n</div></details>\n<p class=\"red\">简介：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW3GyF.png\" alt=\"图片\"></p>\n<p class=\"red\">22，Tracert 报文攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW3HmQ.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>\n<p>1，Tracert 工作原理：利用 ICMP 协议，Tracert 命令用 IP 生存时间 (TTL) 字段和 ICMP 错误消息来确定从一个主机到网络上其他主机的路由。首先，tracert 送出一个 TTL 是 1 的 IP 数据包到目的地，当路径上的第一个路由器收到这个数据包时，它将 TTL 减 1。此时，TTL 变为 0，所以该路由器会将此数据包丢掉，并送回一个「ICMP time exceeded」消息（包括发 IP 包的源地址，IP 包的所有内容及路由器的 IP 地址），</p>\n</li>\n<li>\n<p>tracert 收到这个消息后，便知道这个路由器存在于这个路径上，接着 tracert 再送出另一个 TTL 是 2 的数据包，发现第 2 个路由器…… tracert 每次将送出的数据包的 TTL 加 1 来发现另一个路由器，这个重复的动作一直持续到某个数据包 抵达目的地。当数据包到达目的地后，该主机则不会送回 ICMP time exceeded 消息，一旦到达目的地，由于 tracert 通过 UDP 数据包向不常见端口 (30000 以上) 发送数据包，因此会收到「ICMP port unreachable」消息，故可判断到达目的地。</p>\n</li>\n<li>\n<p>tracert 有一个固定的时间等待响应 (ICMP TTL 到期消息)。如果这个时间过了，它将打印出一系列的 * 号表明：在这个路径上，这个设备不能在给定的时间内发出 ICMP TTL 到期消息的响应。然后，Tracert 给 TTL 记数器加 1，继续进行。</p>\n</li>\n<li>\n<p>2，Traceruote 工作原理：利用 UDP 协议，通过 traceroute 我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。当然每次数据包由某一同样的出发点（source）到达某一同样的目的地 (destination) 走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的。linux 系统中，我们称之为 traceroute, 在 MS Windows 中为 tracert。 traceroute 通过发送小的数据包到目的设备直到其返回，来测量其需要多长时间。</p>\n</li>\n<li>\n<p>一条路径上的每个设备 traceroute 要测 3 次。输出结果中包括每次测试的时间 (ms) 和设备的名称（如有的话）及其 IP 地址</p>\n</li>\n</ul>\n</div></details>\n<h2 id=\"应用层攻击防护\"><a class=\"anchor\" href=\"#应用层攻击防护\">#</a> <strong>应用层攻击防护：</strong></h2>\n<p class=\"red\">1，URPF 技术：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWaJaD.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>参考信息</summary><div>\n<ul>\n<li>1，严格模式： 数据包必须和路由器的路由表中的出接口一一对应，1 号口进 1 号口出。</li>\n<li>2，松散模式：如果是默认路由，由于没有公网的路由表，主要匹配到默认路由 1 号口就行。</li>\n</ul>\n</div></details>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<details class=\"primary\"><summary>URPF简介</summary><div>\n<ul>\n<li>1，基本概念：</li>\n<li>通常情况下，网络中的路由器接收到报文后，获取报文的目的地址，针对目的地址查找路由，如果查找到则进行正常的转发，否则丢弃该报文。由此得知，路由器转发报文时，并不关心数据包的源地址，这就给源地址欺骗攻击有了可乘之机。</li>\n<li>源地址欺骗攻击就是入侵者通过构造一系列带有伪造源地址的报文，频繁访问目的地址所在设备或者主机，即使受害主机或网络的回应报文不能返回到入侵者，也会对被攻击对象造成一定程度的破坏。</li>\n<li>URPF 通过检查数据包中源 IP 地址，并根据接收到数据包的接口和路由表中是否存在源地址路由信息条目，来确定流量是否真实有效，并选择数据包是转发或丢弃。</li>\n<li>2，检查方式：</li>\n<li>uRPF 对报文源地址的合法性检查主要有两种：严格型（strict）和松散型（loose）。另外还支持忽略缺省路由的 uRPF 检查以及配置了 ACL 规则的 uRPF 检查。</li>\n<li>在接口上设置严格模式的 uRPF：路由器对从该接口进入的数据包源地址进行查询，如果报文的源地址在路由表中存在（为正常的源地址路由或者缺省路由），并且报文的入接口等于路由的出接口，则认为该报文合法，否则丢弃该报文。</li>\n<li>在接口上设置松散模式的 uRPF：路由器仅检查报文的源地址是否在路由表中存在（正常的源地址路由或者缺省路由），而不再检查报文的入接口与路由表是否匹配。这使得 uRPF 既可以有效地阻止网络攻击，又可以避免错误的拦截合法用户的报文。</li>\n<li>当路由器上配置了缺省路由后，会导致 uRPF 根据路由表检查源地址路由时，对查不到源地址路由的报文自动检查到缺省路由。针对这种情况，用户可以配置 uRPF 忽略缺省路由的检查。</li>\n<li>通过 ACL 规则的引入，uRPF 给用户提供了一种更加灵活的定制方案。配置了 ACL 后，在 uRPF 检查失败的情况下，路由器按照 ACL 规则 permit 或者 deny 报文进行操作。</li>\n<li>3，作用：</li>\n<li>通信网络中，诸如 DoS 攻击、TCP SYN 洪泛攻击、UDP 洪泛攻击和 ICMP 洪泛攻击等，都可能通过借助源地址欺骗的方式攻击目标设备或者主机，造成被攻击者系统性能严重的降低，甚至导致系统崩溃。uRPF 技术就是网络设备为了防范此类攻击而使用的一种常用技术。</li>\n</ul>\n</div></details>\n<p class=\"red\">2，链路层 ——MAC 泛洪攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWDiHP.png\" alt=\"图片\"></p>\n<p class=\"red\">3，DDOS 通用攻击防范技术：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWss6H.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用阻断和限流来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWsOA0.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用过滤器来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWyKud.png\" alt=\"图片\"></p>\n<p class=\"red\">还可以使用黑白名单来防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWygv4.png\" alt=\"图片\"></p>\n<p class=\"red\">4，SYN Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sW6BsH.png\" alt=\"图片\"></p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>预防：限制断开连接数。</li>\n</ul>\n<p class=\"red\">5，SYN-ACK Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWgiHs.png\" alt=\"图片\"></p>\n<p class=\"red\">6，ACK Flood 攻击防范：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/20/sWcx9f.png\" alt=\"图片\"></p>\n<p class=\"red\">7，一个完整的网络攻击链：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>情报收集 —— 工具准备 —— 载荷投递 —— 漏洞利用 —— 释放载荷 —— 建立通道 —— 目标达成。</li>\n</ul>\n<p class=\"red\">8，协议栈自身的脆弱性：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>缺乏数据源验证机制</li>\n<li>缺乏机密性保障机制</li>\n<li>缺乏完整性验证机制</li>\n</ul>\n<p class=\"red\">9，DDOS 攻击风险防护方案：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTcsoD.png\" alt=\"图片\"></p>\n<p class=\"red\">10，应用层 ——DNS 欺骗攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTcRSA.png\" alt=\"图片\"></p>\n<p class=\"red\">11，缓冲区溢出攻击：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTc7Fg.png\" alt=\"图片\"></p>\n<p>防范：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/23/sTcOln.png\" alt=\"图片\"></p>\n<p class=\"red\">12，勒索病毒攻击链分析：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>感染媒介：钓鱼软件，蠕虫病毒，恶意邮件。</li>\n<li>C&amp;C 通信：匿名通信，下载载荷，DGA 通信。</li>\n<li>文件加密：混合加密体系，弹出勒索对话框。</li>\n<li>横向移动：弱点横向探测，蠕虫式传播，MS17-010 永恒之蓝漏洞。</li>\n</ul>\n<p class=\"red\">13，勒索病毒特点：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>针对攻击者：传播入口多，传播技术隐蔽，勒索产业化发展。</li>\n<li>针对受害者：安全状况看不清，安全设备防不住，问题处置不及时。</li>\n</ul>\n<p class=\"red\">14，终端安全防范措施：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>不点击来历不明的邮件附件，不从不明的网站下载软件。</li>\n<li>及时给主机打补丁，修复相应的高危病毒。</li>\n<li>对重要的数据进行定期备份。</li>\n<li>关闭不必要的端口。</li>\n<li>RDP 远程服务器等连接尽量使用强密码。</li>\n<li>安装专业的防病毒软件，定期检查。</li>\n</ul>\n<h2 id=\"整体安全解决方案\"><a class=\"anchor\" href=\"#整体安全解决方案\">#</a> <strong>整体安全解决方案</strong></h2>\n<p class=\"red\">1，企业信息安全建设规划目标：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>风险可视化</li>\n<li>防御主动化</li>\n<li>运行自动化</li>\n<li>安全智能化</li>\n</ul>\n<p class=\"red\">2，网络安全行业对风险的应对：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>检测</li>\n<li>相应</li>\n<li>防御</li>\n</ul>\n<p class=\"red\">3，深信服 ARDRO 智安全架构：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT28C4.png\" alt=\"图片\"></p>\n<p class=\"red\">4，企业级安全体系整体框架：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT2UDx.png\" alt=\"图片\"></p>\n<p class=\"red\">5，安全产品矩阵及说明：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sT2y2d.png\" alt=\"图片\"></p>\n<p class=\"red\">6，网络安全 —— 设备规划：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRis1.png\" alt=\"图片\"></p>\n<p class=\"red\">7，网络安全 —— 减少内部风险：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRnRH.png\" alt=\"图片\"></p>\n<p class=\"red\">8，网络安全 —— 边界最佳实践：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRlLt.png\" alt=\"图片\"></p>\n<p class=\"red\">9，网络安全 —— 构建统一的安全接入平台：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRwyn.png\" alt=\"图片\"></p>\n<p class=\"red\">10，端点安全 —— 巩固最后一道防线：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRhO1.png\" alt=\"图片\"></p>\n<p class=\"red\">11，网络安全 —— 端到端的安全重构：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRX6A.png\" alt=\"图片\"></p>\n<p class=\"red\">12，网络安全 —— 构建安全大脑：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTRxmt.png\" alt=\"图片\"></p>\n<p class=\"red\">13，网络安全拓扑参考：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/23/sTW9k8.png\" alt=\"图片\"></p>\n<h1 id=\"第二章数据传输安全\"><a class=\"anchor\" href=\"#第二章数据传输安全\">#</a> 第二章【数据传输安全】</h1>\n<h2 id=\"vpn技术概念\"><a class=\"anchor\" href=\"#vpn技术概念\">#</a> <strong>VPN 技术概念：</strong></h2>\n<h3 class=\"blue\" id=\"vpn需求背景\"><a class=\"anchor\" href=\"#vpn需求背景\">#</a> VPN 需求背景</h3>\n<p class=\"red\">1，VPN 需求场景：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/24/sHbi5j.png\" alt=\"图片\"></p>\n<p class=\"red\">2，需求背景：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 企业，组织，商家等，对专用网有强大的需求。</li>\n<li>[2] 高性能，高速度和高安全性是专用网明显的优势。</li>\n<li>[3] 物理专用网价格昂贵，物理架构实施有难度，传统的通过租用专线或拨号网络的方式越来越不适用。(性价比较低)</li>\n<li>[4] TCP/IP 协议的本身的局限性，不能保障信息直接传输的保密性，存在许多固有的安全缺陷。</li>\n<li>[5] VPN = 对专用网的需求越来越高 + 物理专用网络架设难，性价比低。</li>\n</ul>\n<p class=\"red\">3，VPN 概述：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>[1] VPN (虚拟专用网)：指依靠 ISP 或其他 NSP 在公用网络基础设施之上构建专用的安全数据通信网络。只不过这个专线网络是逻辑上的而不是物理的。所以称为虚拟专用网。</p>\n</li>\n<li>\n<p>[2] 虚拟：用户不再需要拥有实际的长途数据线路，而是使用公共网络资源建立自己的私有网络。</p>\n</li>\n<li>\n<p>[3] 专用：用户可以定制最符合自身需求的网络。</p>\n</li>\n<li>\n<p>[4] 核心技术：隧道技术。</p>\n</li>\n</ul>\n<h3 class=\"blue\" id=\"vpn分类\"><a class=\"anchor\" href=\"#vpn分类\">#</a> VPN 分类</h3>\n<p class=\"red\">1，按业务型分类有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li class=\"red\">\n<p>1，Client——LAN VPN(Access VPN)</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sL2h9K.png\" alt=\"图片\"></p>\n</li>\n<li class=\"red\">\n<p>2，LAN——LAN VPN</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLRCHs.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，按网络层次分类有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 应用层 ——SSL VPN 等</li>\n<li>[2] 传输层 ——Sangfor VPN</li>\n<li>[3] 网络层 ——IPSec，GRE 等</li>\n<li>[4] 物理接口层 ——L2F/L2TP，PPTP 等</li>\n</ul>\n<h3 class=\"blue\" id=\"vpn常用技术\"><a class=\"anchor\" href=\"#vpn常用技术\">#</a> VPN 常用技术</h3>\n<p class=\"red\">1，常用技术有：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 隧道技术</li>\n<li>[2] 加解密技术</li>\n<li>[3] 身份认证技术</li>\n<li>[4] 数据认证技术</li>\n<li>[5] 密钥管理技术</li>\n</ul>\n<p class=\"red\">2，隧道技术详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>[1] 隧道：是在公共通信网络上构建的一条数据路径，可以提供与专用通信线路等同的连接特性。</p>\n</li>\n<li>\n<p>[2] 隧道技术：指在隧道的两端通过封装以及解封装技术在公网上建立的一条数据通道，使用这条通道对数据报文进行传输，隧道是由隧道协议构建形成的，<ins class=\"wavy\">隧道技术是 VPN 技术中最关键的技术。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLhwVJ.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLhIPI.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">3，加解密技术详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 目的：即使信息被窃听或者截取，攻击者也无法知晓信息的真实内容。<ins class=\"wavy\">可以对抗网络攻击中的被动攻击。</ins></li>\n<li>[2] 通常使用<ins class=\"wavy\">加密机制</ins>来保护信息的<ins class=\"wavy\">保密性</ins>，防止信息泄露。<ins class=\"wavy\">信息的加密机制通常是建立在密码学的基础上。</ins></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/25/sLICbF.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">4，密码学基础：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>[1] 从明文到密文的过程，一般是通过加密算法加密进行的。</li>\n<li>[2] 从变明文到密文，称为脱密 (解密) 变换。</li>\n<li>[3] 主流的加密算法有：</li>\n<li>对称加密算法</li>\n<li>非对称加密算法 (公钥加密算法)</li>\n</ul>\n<p class=\"red\">5，对称加密算法详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1, 对称加密过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sLoOlq.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，常见的对称加密算法有：</p>\n</li>\n<li>\n<p>[1] IDEA: 国际数据加密算法，使用 128 位密钥提供非常强的安全性。</p>\n</li>\n<li>\n<p>[2] DES/3DES 算法: DES 加密采用的是<ins class=\"wavy\">分组加密</ins>的方法，<ins class=\"wavy\">使用 56 位密钥加密 64 位明文，最后产生 64 位密文。</ins></p>\n</li>\n<li>\n<p>[3] RC 系列算法：包括<ins class=\"wavy\"> RC2，RC4，RC5，RC6 算法，</ins>其中<ins class=\"wavy\"> RC4 是序列密码算法，其他三种是分组序列算法。</ins></p>\n</li>\n<li>\n<p>[4] AES 算法: AES 为分组密码：<ins class=\"wavy\">分组密码也就是把明文分层一组一组的，每组长度相等，每次加密一组数据，直到加密完整个明文。高级加密标准，是下一代的加密算法标准，速度快，安全级别高，在 21 世纪 AES 标准的一个实现是 Rijndael 算法。</ins></p>\n</li>\n<li>\n<p>3，对称算法的缺陷：</p>\n</li>\n<li>\n<p>[1] 密钥传输风险</p>\n</li>\n<li>\n<p>[2] 密钥多，难管理。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOipf1.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">6，弥补对称加密的缺陷思路：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOinfI.png\" alt=\"图片\"></p>\n<p class=\"red\">7，非对称加密算法详解：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，简介：</p>\n</li>\n<li>\n<p>加密和解密使用的是不同的密钥 (公钥，私钥)，<ins class=\"wavy\">两个密钥之间存在相互依存关系。(用其中任一个密钥加密的信息只能用另一个密钥进行解密：即用公钥加密，用私钥解密就可以得到明文。)</ins></p>\n</li>\n<li>\n<p>这使得通信双方<ins class=\"wavy\">无需事先交换密钥</ins>就可以进行保密通信。</p>\n</li>\n<li>\n<p>2，非对称加密过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOF6r8.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，常见的非对称加密算法：</p>\n</li>\n<li>\n<p>[1] ECC: 椭圆曲线加密。</p>\n</li>\n<li>\n<p>[2] RSA: 是一个<ins class=\"wavy\">支持变长密钥的公共密钥算法，需要加密的文件块的长度也是可变的</ins>，非对称算法。</p>\n</li>\n<li>\n<p>[3] Rabin: 基于计算模合数平方根困难性问题的公钥密码算法。</p>\n</li>\n<li>\n<p>[4] Elgamal: 其基础是 Diffie—Hellman 密钥交换算法，后者使通信双方能通过公开通信来推导出只有他们知道的密钥。</p>\n</li>\n</ul>\n<p class=\"red\">8，对称加密 VS 非对称加密：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOkweU.png\" alt=\"图片\"></p>\n<p class=\"red\">9，身份认证技术：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，简介：</p>\n</li>\n<li>\n<p>身份认证：<ins class=\"wavy\">通过标识和鉴别用户的身份</ins>，防止攻击者假冒合法用户来获取访问权限。</p>\n</li>\n<li>\n<p>身份认证技术：是在网络中确认操作者身份的过程而产生的有效解决方法。</p>\n</li>\n<li>\n<p>2，应用场景：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOAwct.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>上图 Alice 生成数字签名过程：</p>\n</li>\n<li>\n<p>原始信息 + HASH 生成信息摘要。信息摘要 + Alice 的私钥签名 生成数字签名。</p>\n</li>\n<li>\n<p>复杂情况出现：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOe9ET.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>Bob 无法确认公钥的真实性。</p>\n</li>\n<li>\n<p>3，解决方案：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/25/sOmZWQ.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>BOb 使用 CA 的公钥解开数字证书，这样得到的 Alice 的公钥才是 Alice 的。</p>\n</li>\n<li>\n<p>4，PKI 体系 (CA)：</p>\n</li>\n<li>\n<p>[1] PKI (公开密钥体系) 是一种遵循标准的利用<ins class=\"wavy\">非对称加密</ins>技术为电子商务的开展提供一套安全基础平台的技术和防范。</p>\n</li>\n<li>\n<p>[2] 简单来说，<ins class=\"wavy\">PKI 就是利用公钥理论和技术建立的提供安全服务的基础设施，</ins>用户可以利用 PKI 平台提供的服务进行安全的电子交易，通信和互联网上的各种活动。</p>\n</li>\n<li>\n<p>[3] PKI 技术采用证书管理公钥，通过第三方的可信任机构 ——CA 认证中心，<ins class=\"wavy\">把用户的公钥和用户的其他标识信息捆绑在一起放在用户证书中</ins>，在互联网上验证用户的身份。</p>\n</li>\n<li>\n<p>[4] 目前，通用的办法是采用建立在 PKI 基础之上的数字证书，通过把要传输的数字信息进行加密何签名，保证信息传输的机密性，真实性，完整性和不可否认性，从而保证信息的安全传输。</p>\n</li>\n<li>\n<p>5，PKI 体系的组成：</p>\n</li>\n<li>\n<p>[1] PKI 是创建，颁发，管理，注销公钥证书所涉及到的所以软件，硬件的集合体。其核心元素是<ins class=\"wavy\">数字证书</ins>，核心执行者是<ins> CA 认证机构</ins> {}。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uVlKs.png\" alt=\"tp\"></p>\n</li>\n<li>\n<p>6，CA 中心：</p>\n</li>\n<li>\n<p>[1] 简介：</p>\n</li>\n<li>\n<p>证书授权中心或称证书授权机构，作为电子商务交易中受信用的第三方。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uVRRe.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[2] 作用：</p>\n</li>\n<li>\n<p>颁发证书，规定证书的有效期和通过发布证书废除列表 (CRL) 确保必要时可以废除证书，以及对证书和密钥进行管理。</p>\n</li>\n<li>\n<p>CA 中心为每个使用公开密钥的用户发放一个数字证书，数字证书的作用是证明证书中列出的用户合法拥有证书中列出的公钥。</p>\n</li>\n<li>\n<p>CA 中心的数字签名使得攻击者不能伪造和篡改证书</p>\n</li>\n<li>\n<p>7，数字证书认证技术原理：</p>\n</li>\n<li>\n<p>[1] 数字证书：</p>\n</li>\n<li>\n<p>一个经证书授权中心数字签名的包含公开密钥拥有者信息和公开密钥的文件。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uZndx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[2] 数字证书是一般包含：</p>\n</li>\n<li>\n<p>用户身份信息。</p>\n</li>\n<li>\n<p>用户公钥信息</p>\n</li>\n<li>\n<p>身份验证机构数字签名的数据</p>\n</li>\n<li>\n<p>[3] 从证书的用途来看，数字证书可分为签名证书和加密证书。</p>\n</li>\n<li>\n<p>签名证书：</p>\n</li>\n<li>\n<p>主要用于对用户信息进行签名，以保证信息的真实性和不可否认性。</p>\n</li>\n<li>\n<p>加密证书：</p>\n</li>\n<li>\n<p>主要用于对用户传送的信息进行加密，以保证信息的机密性和完整性。</p>\n</li>\n<li>\n<p>8，常见的证书类型：</p>\n</li>\n<li>\n<p>数字证书</p>\n</li>\n<li>\n<p>根证书</p>\n</li>\n<li>\n<p>用户证书</p>\n</li>\n<li>\n<p>设备证书</p>\n</li>\n<li>\n<p>9，数据传输安全案例：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6uefHI.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>10，数字证书实列 ——HTTPS 协议：</p>\n</li>\n<li>\n<p>[1] HTTP 是常用的 eb 协议，用来交互网页数据。</p>\n</li>\n<li>\n<p>[2] 由于 HTTP 是不加密的，在公网上明文传输，缺少保密性。所以出现安全加密的 HTTP 协议 ————HTTPS 协议。</p>\n</li>\n<li>\n<p>[3] HTTPS 是在 SSL 协议的基础上的 HTTP 协议。</p>\n</li>\n<li>\n<p>[4] SSL 协议的握手过程需要传输服务器的证书，并验证证书的可靠性。</p>\n</li>\n<li>\n<p>11，证书的请求和发送：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/06/6ulJaj.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<h2 id=\"ipsec协议详解\"><a class=\"anchor\" href=\"#ipsec协议详解\">#</a> <strong>IPSec 协议详解：</strong></h2>\n<h3 class=\"blue\" id=\"ipsec协议族安全框架\"><a class=\"anchor\" href=\"#ipsec协议族安全框架\">#</a> IPSEC 协议族安全框架</h3>\n<p class=\"red\">1，需求背景：</p>\n<ul>\n<li>[1] 对保密性的需求越来越高。</li>\n<li>[2] GRE，L2TP 等 VPN 技术不支持保密性的要求。</li>\n<li class=\"red\">[3] 所以产生了 IPSEC 技术。<br>\n2，IPSec VPN 简介：</li>\n<li>[1] IPSec (Internet Protocol Security): 是一组基于<ins class=\"wavy\">网络层</ins>的，应用密码学的安全通信协议族，<ins class=\"wavy\">IPSec 不是具体指哪一个协议，而是一个开放的协议族。</ins></li>\n<li>[2] IPSec 协议的设计目标：是在 IPV4 和 IPV6 环境中为网络层流量提供灵活的安全服务。</li>\n<li>[3] IPSec VPN：是基于 IPSec 协议族构建的在 IP 层实现的安全虚拟专用网，通过在数据包中插入一个预定义头部的方式，来保障 OSI 上层协议数据的安全，主要用于保护 TCP，UDP，ICMP 和隧道的 IP 数据包。<br>\n3，IPSec 提供的安全服务：{.red</li>\n<li>[1] 机密性</li>\n<li>[2] 完整性</li>\n<li>[3] 数据源鉴别</li>\n<li>[4] 重传攻击保护</li>\n<li>[5] 不可否认性</li>\n<li class=\"red\">[6] 访问控制，有限的流量保密等其他安全服务。<br>\n4，IPSec 协议族安全体系框架：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uGuTg.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，IPSec 协议族：</p>\n<ul>\n<li>[1] 两种工作模式：</li>\n<li>传输模式 (transport)</li>\n<li>隧道模式 (Tunnel)</li>\n<li>[2] 两个通信保护协议：</li>\n<li>鉴别头 (AH)</li>\n<li>封装安全载荷 (ESP)</li>\n<li>[3] 密钥交换管理协议：</li>\n<li>阶段一 (两种基本模式)：主模式，野蛮模式</li>\n<li>阶段二：快速模式 (Quick mode)</li>\n<li>[4] 两个数据库：</li>\n<li>安全策略数据库 SPD</li>\n<li>安全关联数据库 SAD</li>\n<li>[5] 解释域 DOI</li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec工作模式\"><a class=\"anchor\" href=\"#ipsec工作模式\">#</a> IPSEC 工作模式：</h3>\n<p class=\"red\">1，传输模式 (Transport mode)：</p>\n<ul>\n<li>[1] 应用场景：</li>\n<li>经常用于主机和主机之间端到端通信的数据保护。</li>\n<li>[2] 封装方式：</li>\n<li>不改变原有的 IP 包头，在数据包头后面插入 IPsec 包头，将原来的数据封装成被保护的数据。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6utG6I.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，隧道模式 (Tunnel mode)：</p>\n<ul>\n<li>[1] 应用场景：</li>\n<li>经常用于私网与私网之间通过公网进行通信，建立安全 VPN 通道。</li>\n<li>[2] 封装方式：</li>\n<li>增加新的 IP (外网 IP) 头，其后是 IPSec 包头，之后再将原来的整个数据包封装。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6utz3d.png\" alt=\"图片\"></li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec通信协议\"><a class=\"anchor\" href=\"#ipsec通信协议\">#</a> IPSEC 通信协议：</h3>\n<p class=\"red\">1，AH 协议：</p>\n<ul>\n<li>[1] 通信保护协议 AH-AH (Authentication Header，认证报头)。</li>\n<li>[2] AH 提供的安全服务有：</li>\n<li>无连接数据完整性 ———— 通过哈希函数 (如 MD5，SHA1) 产生的校验来保证。</li>\n<li>数据源认证 ———— 通过在计算验证码时加入一个共享密钥来实现。</li>\n<li>抗重放服务 ————AH 报头中的序列号可以防止重放攻击。</li>\n<li>[3] AH 不提供任何保密性服务，它不加密所保护的数据包。</li>\n<li>[4]<ins class=\"wavy\"> 无论是传输模式还是隧道模式下，AH 提供对数据包的保护时，它保护的是整个 IP 数据包 (易变的字段除外，如 IP 头中的 TTL 和 TOS 字段)。</ins></li>\n<li>[5] AH 头：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uU6oT.png\" alt=\"图片\"></li>\n<li>[6] AH 在传输模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uaU76.png\" alt=\"图片\"></li>\n<li>[7] AH 在隧道模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uacnI.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，ESP 协议：</p>\n<ul>\n<li>[1] ESP (Encapsulating Security Payload, 封装安全有效载荷)。</li>\n<li>[2] ESP 提供的安全服务有：</li>\n<li>无连接数据完整性 ———— 通过哈希函数 (如 MD5，SHA1) 产生的校验来保证。</li>\n<li>数据源认证 ———— 通过在计算验证码时加入一个共享密钥来实现。</li>\n<li>抗重放服务 ————AH 报头中的序列号可以防止重放攻击。</li>\n<li>数据保密</li>\n<li>有限的数据流保护</li>\n<li>[3] 保密服务通过使用密码算法加密 IP 数据包的相关部分来实现。</li>\n<li>[4] 数据流保密由隧道模式下的保密服务提供。</li>\n<li>[5] ESP 通常使用 DES，3DES，AES 等加密算法实现数据加密，使用 MD5 或 SHA1 来实现数据完整性认证。</li>\n<li>[6] ESP 头：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6udLMd.png\" alt=\"图片\"></li>\n<li>[7] ESP 在传输模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uw9JS.png\" alt=\"图片\"></li>\n<li>[8] ESP 在隧道模式下封装：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uwFMj.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，AH 与 ESP 对比：</p>\n<ul>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/06/6uwKWF.png\" alt=\"图片\"></li>\n</ul>\n<h3 class=\"blue\" id=\"ipsec建立阶段\"><a class=\"anchor\" href=\"#ipsec建立阶段\">#</a> IPSEC 建立阶段：</h3>\n<p class=\"red\">1，IKE (Internet Key Exchange) 协商阶段：</p>\n<ul>\n<li>\n<p>[1] 安全联盟 SA：</p>\n</li>\n<li>\n<p>是通信对等体间对某些要素的约定，通信的双方符合 SA 约定的内容，就可以建立 SA。</p>\n</li>\n<li>\n<p>[2] SA 由三元组来唯一标识，包括：</p>\n</li>\n<li>\n<p>安全参数索引，目的 IP 地址，安全协议号。</p>\n</li>\n<li>\n<p>[3] IKE 的产生背景：</p>\n</li>\n<li>\n<p>用 IPSec 保护一个 IP 包之前，必须先建立安全联盟 SA</p>\n</li>\n<li>\n<p>IPSec 的安全联盟可以通过手工配置的方式建立，但是当网络中节点较多时，手工配置将非常困难，而且难以保证安全性，这时就可以使用 IKE 自动进行安全联盟建立与密钥交换的过程，Internet 密钥交换 (IKE) 就用于动态建立 SA，代表 IPsec 对 SA 进行协商。</p>\n</li>\n<li>\n<p>[4] IKE 的用途：</p>\n</li>\n<li>\n<p>IKE 为 IPSEC 协商生成密钥，供 AH/ESP 加解密和验证使用。</p>\n</li>\n<li>\n<p>在 IPSEC 通信双方之间，动态地建立安全关联 (SA), 对 SA 进行管理和维护。</p>\n</li>\n<li>\n<p>[5] IKE 的工作过程：</p>\n</li>\n<li>\n<p>IKE 经过两个阶段为 IPSEc 进行密钥协商并建立安全联盟。</p>\n</li>\n<li>\n<p><ins class=\"dot\">第一阶段交换：</ins></p>\n</li>\n<li>\n<p>通信各方彼此间建立了一个已通过身份验证和安全保护的通道，此阶段的交换建立了一个 ISAKMP 安全联盟，即 ISAKMP SA (也可称为 IKE SA)。第一阶段有两种协商模式：<ins class=\"wavy\">主模式协商与野蛮模式协商。</ins></p>\n</li>\n<li>\n<p><ins class=\"dot\">第二阶段交换：</ins></p>\n</li>\n<li>\n<p>用已经建立的安全联盟 (IKE SA) 为 IPSec 协商安全服务，即为 IPSec 协商具体的安全联盟，建立 IPSec SA，产生真正可以用来加密数据流的密钥，IPSec SA 用于最终的 IP 数据安全传送。</p>\n</li>\n<li>\n<p>[6] IKE 阶段一：</p>\n</li>\n<li>\n<p><ins class=\"dot\">主模式：</ins></p>\n</li>\n<li>\n<p>默认使用 IP 地址作为身份标识，默认是传递自己的出口地址做身份标识，校验对端的公网 IP 做对端身份识别。(自动生成双方的身份 ID)</p>\n</li>\n<li>\n<p><ins class=\"dot\">野蛮模式：</ins></p>\n</li>\n<li>\n<p>可以使用用户名或 IP 等作为双方身份识别，即可手动配置身份 ID。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/616Jw8.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[7] IKE 阶段一协商过程：</p>\n</li>\n<li>\n<p>如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/616aWj.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[8] IKE 阶段一：主模式协商：</p>\n</li>\n<li>\n<p>如图：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61cogs.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[9] IKE 阶段一：主模式交互过程：</p>\n</li>\n<li>\n<p>主模式下 IKEv1 采用三个步骤 6 条 ISAKMP 建立 IKE SA。下面是主动发起 IKE 协商为例的整个构成。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61cTvn.png\" alt=\"如图\"></p>\n</li>\n<li>\n<p>[10] 野蛮模式 IKE 交互过程：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">野蛮模式下有三个交互包：</ins></p>\n</li>\n<li>\n<p>1) 第一个交互包发起方建议 SA，发起 DH 交换</p>\n</li>\n<li>\n<p>2) 第二个交互包接收方接受 SA</p>\n</li>\n<li>\n<p>3) 第三个交互包发起方认证接收方</p>\n</li>\n<li>\n<p>++ 注：野蛮模式交互过程少，所以在传输过程中，其传输的数据比较多，并且，前两个数据为明文传输，仅消息三为加密传输。</p>\n</li>\n<li>\n<p>[11] 野蛮模式 IKE 交互过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61gNxs.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[12] IKE 阶段一两张模式对比：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/61gfqx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[13] IKE 阶段二协商过程：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/63V0o9.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>[14] 标准 IPsec VPN 建立过程：</p>\n</li>\n<li>\n<p>IKE 阶段 2</p>\n</li>\n<li>\n<p>双方协商 IPSec 安全参数，称为变换集 transform set，包括：</p>\n</li>\n<li>\n<p>加密算法</p>\n</li>\n<li>\n<p>Hash 算法</p>\n</li>\n<li>\n<p>安全协议</p>\n</li>\n<li>\n<p>封装模式</p>\n</li>\n<li>\n<p>存活时间</p>\n</li>\n<li>\n<p>[15] 标准 IPSEc 第二阶段：</p>\n</li>\n<li>\n<p>ISAKMP/IKE 阶段只有一种消息交换模式 - 快速模式，它定义了受保护数据链接是如何在两个 IPSE 对等体之间构成的。</p>\n</li>\n<li>\n<p>深信服的标准 IPSECyo 有几对的 chu 出站如站，在 DLANyu 运行状态里面 jiu 就会显示几条链接，<ins class=\"wavy\">每一对快快速模式交互的包都是三个，第一个包由主链接发起方发起响应.</ins></p>\n</li>\n<li>\n<p><ins class=\"dot\">快速模式有两个主要的功能：</ins></p>\n</li>\n<li>\n<p>1）协商安全参数来保护数据连接。</p>\n</li>\n<li>\n<p>2）周期性的对数据连接更新密钥信息。第二阶段的效果为协商出 IPsec 单项 SA，为保护 IPSec 数据流而创建，第二阶段整个协商过程受第一阶段 ISAKMP/IKE SA 保护。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">注：第二阶段数据都经过了加密，在公网抓取的数据如下：</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/03/09/63VtMT.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，数据传输阶段：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 数据传输阶段是通过 AH 或者 ESP 通信协议进行数据的传输。</li>\n<li>[2] 数据传输建立在网络层</li>\n<li>[3] VPN 黑洞的产生：</li>\n<li>可能情况：</li>\n<li>1）对端的 VPN 连接已经断开而我方还处在 SA 的有效生存时间内，从而形成了 VPN 隧道的黑洞。</li>\n<li>2）我方不停地发送加密后的 VPN 数据过去，但对方拒绝接受。</li>\n<li>[4] DPD 解决 VPN 隧道黑洞：</li>\n<li><ins class=\"wavy\">DPD：死亡对等体检测 (Dead Peer Detevtion), 检测对端的 ISAKMP SA 是否存在，当 VPN 隧道异常的时候，能检测到并重新发送协商，来维持 VPN 隧道。</ins></li>\n<li><ins class=\"wavy\">DPD 主要是为了防止标准 IPSEC 出现 “隧道黑洞”。</ins></li>\n<li><ins wavy>DPD 只对第一阶段生效，如果第一阶段本身已经超时断开，则不会再发 DPD 包。</ins></li>\n<li>[5] DPD 概述：</li>\n<li>1）DPD 包并不是连续发送，而是采用空闲计时器机制。</li>\n<li>2）每接收到一个 IPSec 加密的包后就重置这个包对应 IKE SA 的空闲计时器。</li>\n<li>3）如果空闲定时器计时开始到计时结束 m'y 没有接受到该 SA 对应的加密包，那么下一次有 IP 包要被这个 SA 加密发送或接收到加密包之前就需要使用 DPD 来检测对方是否存活。</li>\n<li>4）DPD 检测主要考超时计时器，超时计时器用于判断是否再次发起请求，默认是发出 5 次请求 (请求 -》超时 -》请求 -》超时 -》请求 -》超时) 都没有收到如何 DPD 应答就会删除 SA。</li>\n</ul>\n<h2 id=\"ipsec-vpn解决方案\"><a class=\"anchor\" href=\"#ipsec-vpn解决方案\">#</a> <strong>IPSec VPN 解决方案：</strong></h2>\n<h3 id=\"ipsec-vpn网关部署场景\"><a class=\"anchor\" href=\"#ipsec-vpn网关部署场景\">#</a> IPSEC VPN 网关部署场景</h3>\n<p class=\"red\">1，网关部署场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63Mq9H.png\" alt=\"图片\"></li>\n<li>[2] 企业的分支与总部都安放了 VPN 设备，分支机构希望通过 VPN 同步企业总部的研发资源。</li>\n<li>[3] 研发资源属于商业机密，必须要在公网上能够安全保密传输。</li>\n<li><ins class=\"wavy\">解决方案：可以直接用 IPSec VPN 的隧道工作模式进行传输，使用 IPSEc VPN 的 ESP 通信协议来保障数据传输的保密性。</ins></li>\n<li>[4] 具体过程如下：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63lofe.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63lX0P.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/63ljTf.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，NAT 下的 VPN 部署场景：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/631QXR.png\" alt=\"图片\"></li>\n<li>[2] 企业为了内部局域网安全考虑，在网络出口安放了防火墙，要求内网所有设备通过防火墙代理上网 (NAT:Network Addess Translation)</li>\n</ul>\n<p class=\"red\">3，SANGFOR IPsec VPN 协商：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] 如图：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68GHYV.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">4，IKE 协商总结：</p>\n<div class=\"note info\">\n<p>如下如下</p>\n</div>\n<ul>\n<li>[1] SANGFOR 的 IPSEC VPN 主模式身份 ID 是默认配置的，不能修改，在 NAT 环境下会出现上述协商问题，所以只能选用野蛮模式。</li>\n<li>[2] 其他厂商的 IPSEC 主模式身份 ID 如果可以自由配置，在 NAT 环境下则可以协商成功。</li>\n<li>[3] IKE 第一阶段的身份识别：</li>\n<li>IPV4_ADDR,FQDN,USER_FQDN 只是三种不同类型的身份认证方式，可以理解为 SANGFOR 设备中 VPN 的用户名，主要用来确认对端身份。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68tX6S.png\" alt=\"图片\"></li>\n<li>[4] 协商建立 VPN 隧道：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68Nm79.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68wIi9.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/680SJA.png\" alt=\"图片\"></li>\n<li>[5] NAT 下的数据传输可行性：</li>\n<li>1) AH 传输模式：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/680Go4.png\" alt=\"图片\"></li>\n<li>2) ESP 传输模式：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68BW4J.png\" alt=\"图片\"></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68DBIe.png\" alt=\"图片\"></li>\n<li>[6] TCP/UDP 伪首部校验机制：</li>\n<li>1) 伪首部是为了增加校验和的检错能力。</li>\n<li>2) 伪首部校验 12 个字节的内容，如下：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68BEX6.png\" alt=\"图片\"></li>\n<li>[7] NAT 下的数据传输总结：</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/03/09/68rPQ1.png\" alt=\"图片\"></li>\n</ul>\n<h2 id=\"sangfor-vpn解决方案\"><a class=\"anchor\" href=\"#sangfor-vpn解决方案\">#</a> <strong>SANGFOR VPN 解决方案：</strong></h2>\n<h1 id=\"第三章上网行为安全\"><a class=\"anchor\" href=\"#第三章上网行为安全\">#</a> 第三章【上网行为安全】</h1>\n<h2 id=\"ac概念与部署\"><a class=\"anchor\" href=\"#ac概念与部署\">#</a> <strong>AC 概念与部署：</strong></h2>\n<p>1，什么是上网行为管理？对那些行为管控，为什么要管控？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>前提：身份认证。</li>\n<li>1，访问网站：hhttp/https</li>\n<li>2，应用管控</li>\n<li>3，流量管控：流控，以色列 allot，SCE。</li>\n<li>4，行为审计：</li>\n<li>AC —— 全网行为管理。</li>\n</ul>\n<ul>\n<li>\n<p><strong>用户认证技术：</strong></p>\n</li>\n<li>\n<p><strong>应用控制技术：</strong></p>\n</li>\n<li>\n<p><strong>终端与流量管理：</strong></p>\n</li>\n<li>\n<p><strong>审计与 BA 部署：</strong></p>\n</li>\n<li>\n<p><strong>全网行为管理：</strong></p>\n</li>\n<li>\n<p><strong>AC 知识串讲：</strong></p>\n</li>\n</ul>\n<h1 id=\"第四章网络边界安全\"><a class=\"anchor\" href=\"#第四章网络边界安全\">#</a> 第四章【网络边界安全】</h1>\n<h2 id=\"ngaf概述与组网方案\"><a class=\"anchor\" href=\"#ngaf概述与组网方案\">#</a> <strong>NGAF 概述与组网方案：</strong></h2>\n<h3 class=\"blue\" id=\"ngaf概念\"><a class=\"anchor\" href=\"#ngaf概念\">#</a> NGAF 概念</h3>\n<p class=\"red\">1，什么是防火墙？</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>企业内网隔离</li>\n<li>数据中心隔离</li>\n<li>互联网边界防护</li>\n<li>企业分支互联</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/27/svyOmQ.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">2，防火墙分类：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，按物理特性划分：</p>\n</li>\n<li>\n<p>软件防火墙</p>\n</li>\n<li>\n<p>硬件防火墙</p>\n</li>\n<li>\n<p>2，按性能分：</p>\n</li>\n<li>\n<p>百兆级防火墙</p>\n</li>\n<li>\n<p>千兆级防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n<li>\n<p>3，按防火墙结构分：</p>\n</li>\n<li>\n<p>单一主机防火墙</p>\n</li>\n<li>\n<p>路由集成防火墙</p>\n</li>\n<li>\n<p>分布式防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n<li>\n<p>4，按防火墙技术分：</p>\n</li>\n<li>\n<p>包过滤防火墙</p>\n</li>\n<li>\n<p>应用代理防火墙</p>\n</li>\n<li>\n<p>状态检测防火墙</p>\n</li>\n<li>\n<p>。。。。</p>\n</li>\n</ul>\n<p class=\"red\">3，防火墙的功能：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，访问控制。</li>\n<li>2，地址转换</li>\n<li>3，网络环境支持。</li>\n<li>4，带宽管理功能。</li>\n<li>5，入侵检测和攻击防御。</li>\n<li>6，用户认证。</li>\n<li>7，高可用性。</li>\n</ul>\n<p class=\"red\">4，防火墙安全策略：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>\n<p>1，定义：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">安全策略是按一定规则，控制设备对流量转发以及对流量进行内容安全一体化检测的策略。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy\">规则的本质是包过滤。</ins></p>\n</li>\n<li>\n<p>2，主要应用：</p>\n</li>\n<li>\n<p>对跨防火墙的网络互访进行控制。</p>\n</li>\n<li>\n<p>对设备本身的访问进行控制。</p>\n</li>\n<li>\n<p>3，作用：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">根据定义的规则对经过防火墙的流量进行过滤筛选，在进行下一步操作。</ins></p>\n</li>\n</ul>\n<p class=\"red\">5，防火墙安全策略的原理：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svcVKS.png\" alt=\"图片\"></p>\n<p class=\"red\">6，安全策略分类：</p>\n<div class=\"note info\">\n<p>如下</p>\n</div>\n<ul>\n<li>域间安全策略</li>\n<li>域内安全策略</li>\n<li>接口包过滤</li>\n</ul>\n<p class=\"red\">7，防火墙的发展进程：</p>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svcNVJ.png\" alt=\"图片\"></p>\n<p class=\"red\">8，传统防火墙 (包过滤防火墙)—— 一个严格的规则表：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>数据包的源 IP 地址，目的 IP 地址，源端口，目的端口，协议类型。(五元组)</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>网络层，传输层。</p>\n</li>\n<li>\n<p>3，和路由器的区别：</p>\n</li>\n<li>\n<p>普通的路由器只检查数据包的目的地址，并选择一个到达目的地址的最佳路径。防火墙除了要解决目的路径以外还需要根据已经设置的规则进行判断 “是与否”。</p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>包过滤技术。</p>\n</li>\n<li>\n<p>5，优势：</p>\n</li>\n<li>\n<p>对于小型站点容易实现，处理速度快，价格便宜。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>规则表很快变得复杂，难运维，只能基于五元组。</p>\n</li>\n</ul>\n<p class=\"red\">9，传统防火墙 (应用代理防火墙)—— 每个应用添加代理：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>所有应用层的数据包。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>应用层。</p>\n</li>\n<li>\n<p>3，和包过滤防火墙的区别：</p>\n</li>\n<li>\n<p>包过滤防火墙工作基于 3-4 层，通过检验报头进行规则表匹配。应用代理防火墙工作在 7 层，检查所有的应用层数据包，每个应用需要添加对应的代理服务。</p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>应用代理技术。</p>\n</li>\n<li>\n<p>5，优势：</p>\n</li>\n<li>\n<p>检查了应用层的数据。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>检查效率低，配置运维难度极高，可伸缩性差。</p>\n</li>\n</ul>\n<p class=\"red\">10，传统防火墙 (状态检测防火墙)—— 首次检查建立会话表：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>IP 地址，端口号，TCP 标记。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>数据链路层，网络层，传输层。</p>\n</li>\n<li>\n<p>3，和包过滤防火墙的区别：</p>\n</li>\n<li>\n<p>包过滤防火墙工作在 3-4 层，通过检查报头进行规则表匹配。<ins class=\"wavy\">是包过滤防火墙的升级版，一次检查建立会话表，后期直接按会话表放行。</ins></p>\n</li>\n<li>\n<p>4，技术应用：</p>\n</li>\n<li>\n<p>状态检测技术。</p>\n</li>\n<li>\n<p>5，优势</p>\n</li>\n<li>\n<p>主要检查 3-4 层，能够保障效率，对 TCP 防御较好。</p>\n</li>\n<li>\n<p>6，劣势：</p>\n</li>\n<li>\n<p>应用层控制较弱，不检查数据区。</p>\n</li>\n</ul>\n<p class=\"red\">11，入侵检测系统 (IDS)—— 网络摄像头：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，部署方式：</p>\n</li>\n<li>\n<p>旁路部署，可多点部署。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，工作特点：</p>\n</li>\n<li>\n<p>根据部署位置监控到的流量进行攻击事件监控，<ins class=\"wavy\">属于一个事后呈现的系统，</ins>相当于网络上的摄像头。</p>\n</li>\n<li>\n<p>4，目的：</p>\n</li>\n<li>\n<p>传统防火墙只能基于规则执行 &quot;是&quot; 与 &quot;否&quot; 的策略，IDS 主要为了管理员清晰地了解到网络环境中发生了什么事情。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/svgUOS.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">12，入侵防御系统 (IPS)—— 抵御 2-7 层已知威胁：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，部署方式：</p>\n</li>\n<li>\n<p>串联部署。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，工作特点：</p>\n</li>\n<li>\n<p>根据已知的安全威胁生成对应的过滤器 (规则)，对于识别为流量的阻断，对于未识别的放通。</p>\n</li>\n<li>\n<p>4，目的：</p>\n</li>\n<li>\n<p><ins class=\"wavy\">IDS 只能对网络环境进行检测，但却无法进行防御，IPS 主要是针对已知的威胁进行防御。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sv2ets.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">13，防病毒网关 (AV)—— 基于网络侧识别病毒文件：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>数据包</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>防止病毒文件通过外网络进入到内网环境。</p>\n</li>\n<li>\n<p>和防火墙区别：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxI2Af.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">14，Web 应用防火墙 (WAF)—— 专门用来保护 web 应用：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，判断信息：</p>\n</li>\n<li>\n<p>http 协议数据的<ins class=\"wavy\"> request 和 response。</ins></p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>应用层。</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>防止基于应用层的攻击・影响 Web 应用系统。</p>\n</li>\n<li>\n<p>4，主要技术原理：</p>\n</li>\n<li>\n<p>(1) 代理服务：会话双向代理，用户与服务器不产生直接连接，对于 DDOS 攻击可以抑制。</p>\n</li>\n<li>\n<p>(2) 特征识别：通过正则表达式的特征库进行特征识别。</p>\n</li>\n<li>\n<p>(3) 算法识别：针对攻击方式进行模糊化识别，如 SQL 注入，DDOS，XSS 等。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxT5mn.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">15，统一威胁管理 (UTM)—— 多合一安全网关：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，包含功能：</p>\n</li>\n<li>\n<p>FW，IDS，IPS，AV。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层，(但不具备 Web 应用防控能力)</p>\n</li>\n<li>\n<p>3，目的：</p>\n</li>\n<li>\n<p>将多种安全问题通过一台设备解决。</p>\n</li>\n<li>\n<p>4，优点：</p>\n</li>\n<li>\n<p>功能多合一，有效降低了硬件成本，人力成本，时间成本。</p>\n</li>\n<li>\n<p>5，缺点：</p>\n</li>\n<li>\n<p>模块串联检测效率低，性能消耗大。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sx7rjJ.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">16，下一代防火墙 (NGFW)—— 升级版的 UTM：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，包含功能：</p>\n</li>\n<li>\n<p>FW，IDS，IPS，AV，WAF。</p>\n</li>\n<li>\n<p>2，工作范围：</p>\n</li>\n<li>\n<p>2-7 层。</p>\n</li>\n<li>\n<p>3，和 UTM 的区别：</p>\n</li>\n<li>\n<p>与 UTM 相比增加的 Web 应用防控功能。</p>\n</li>\n<li>\n<p>UTM 是串行处理机制，NGFW 是并行处理机制。</p>\n</li>\n<li>\n<p>NGFW 性能更强，管理更高效。</p>\n</li>\n</ul>\n<p class=\"red\">17，防火墙的性能指标：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，性能指标 1—— 吞吐量：</p>\n</li>\n<li>\n<p>吞吐量：防火墙能同时处理的最大数据量。</p>\n</li>\n<li>\n<p>有效吞吐量：除掉 TCP 因为丢包和超时重发的数据，实际的每秒传输有效速率。</p>\n</li>\n<li>\n<p>衡量标准：吞吐量越大，性能越高。</p>\n</li>\n<li>\n<p>2，性能指标 2—— 时延：</p>\n</li>\n<li>\n<p>定义：数据包的第一个比特进入防火墙到最后一个比特传出防火墙的时间间隔指标。</p>\n</li>\n<li>\n<p>用于测量防火墙处理数据的速度理想情况，测试的是其存储转发的性能。</p>\n</li>\n<li>\n<p>衡量标准：时延越小，性能越高。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxjZ26.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，性能指标 3—— 丢包率：</p>\n</li>\n<li>\n<p>定义：在连续负载的情况下，防火墙由于资源不足，应该转发但是未转发的百分比。</p>\n</li>\n<li>\n<p>衡量标准：丢包率越小，防火墙的性能越高。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxj6zV.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>4，性能指标 4—— 背靠背：</p>\n</li>\n<li>\n<p>衡量标准：背靠背主要是指防火墙缓存容量的大小，网络上常会出现一些突发的大流量，(NFS，备份，路由更新等)，而且这样的数据包的丢失可能会产生更多的数据包丢失。强大的缓冲能力可以减小对这种突发网络情况造成的影响。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxxS74.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>5，性能指标 5—— 并发连接数：</p>\n</li>\n<li>\n<p>定义：由于防火墙是针对连接进行处理的，并发连接数目是指防火墙可以同时容纳的最大链接数目，一个连接就是一个 TCP/UDP 的访问。</p>\n</li>\n<li>\n<p>衡量标准：并发链接数指标越大，抗攻击能力越强。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/sxzgQP.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">18，传统防火墙防御模式：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>通过防御设备划分边界，基于 IP / 端口和特征进行判断。</li>\n<li>以隔离为基础，基于信任原则构建安全框架。</li>\n<li>以防护为核心，基于静态特征的攻击检测。</li>\n</ul>\n<p class=\"red\">19，传统安全产品的形态：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>&quot;串糖葫芦式&quot;，&quot;打补丁式&quot; 建设。</li>\n<li>成本高：环境，空间，重复采购。</li>\n<li>管理难：多设备，多厂商，安全风险无法分析。</li>\n<li>效率低：重复解析，单点故障。</li>\n</ul>\n<p class=\"red\">20，深信服 AF 的核心价值：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>安全的基础是风险全面可视化。</li>\n<li>安全的目标是保障企业业务安全。</li>\n<li>安全的未来是抵御未知风险。</li>\n</ul>\n<h3 class=\"blue\" id=\"组网方案\"><a class=\"anchor\" href=\"#组网方案\">#</a> 组网方案</h3>\n<p class=\"red\">1，部署模式简介：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，AF 基本应用场景：</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szPSHK.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，下一代防火墙具备灵活的网络适应能力，支持：<ins class=\"wavy\">路由模式，透明模式，虚拟网线模式，混合模式，旁路模式。</ins></p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szQQc6.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">2，接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，根据接口属性分为：物理接口，子接口，VLAN 接口，聚合接口。</p>\n</li>\n<li>\n<p>其中物理接口可选择为：路由口，透明口，虚拟网线口，旁路镜像口。</p>\n</li>\n<li>\n<p>2，根据接口不同的工作层面，可以划分为：二层区域，三层区域，虚拟网线区域。</p>\n</li>\n<li>\n<p>3，AF 的部署模式是根据各个接口的属性决定的。</p>\n</li>\n</ul>\n<p class=\"red\">3，物理接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，物理接口与 AF 设备面板上的接口一一对应 (eth0 为 manage 口)，根据网口数据转发特性的不同，可选择路由，透明，虚拟网线和旁路镜像 4 种类型，前三种接口又可设置 WAN 或非 WAN 属性。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/27/szlxWn.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，物理接口无法删除或新增，物理接口的数目由硬件决定 (个别平台支持可拓展)。</p>\n</li>\n</ul>\n<p class=\"red\">4，路由接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，路由接口：如果设置为路由接口，则需要给该接口配置 IP 地址，且，该接口具备路由转发功能。</li>\n<li>2，ADSL 拨号：如果设置为路由接口，并且是 ADSL 拨号，需要选上添加默认路由选项，默认勾选。</li>\n<li>3，管理口：Eth0 为固定的管理口，接口类型为路由口，无法修改，Eth0 可增加管理 IP 地址，<ins class=\"wavy\">默认的管理 IP 10.251.251.251/24. 如需修改，AF8.0.13 版本后，可在 [系统]-[通用配置]-[网络参数] 中进行修改。</ins></li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/27/sz1mS1.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">5，透明接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>透明接口：相当于普通的交换网口，不需要配置 IP 地址，不支持路由转发，根据 MAC 地址表转发数据。</li>\n</ul>\n<p class=\"red\">6，虚拟网线接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，虚拟网线接口：也是普通的交换接口，不能配置 IP 地址，不支持路由转发，转发数据时，也无需检查 MAC 表，直接从虚拟网线配对的接口转发。</li>\n<li>2，<ins class=\"wavy\">虚拟网线口的转发性能高于透明接口，单进单出，双进双出等成对的网桥的环境下，推荐使用虚拟网线接口部署。</ins></li>\n</ul>\n<p class=\"red\">7，旁路镜像接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，<ins class=\"wavy\">不能配置 IP 地址，也不支持数据转发。</ins>只是用来接收从外部镜像过来的镜像数据。</li>\n<li>2，镜像接口可以配置多个，根据现场实际业务场景，需要接受的数据情况进行选择。</li>\n</ul>\n<p class=\"wavy\">8，聚合接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>将多个以太网接口捆绑在一起所形成的逻辑接口，创建的聚合接口成为一个逻辑接口，而不是底层的物理接口。</li>\n</ul>\n<p class=\"wavy\">9，子接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，<ins class=\"wavy\">应用于路由接口，需要启用 VLAN 或 TRUNK 的场景。</ins></li>\n<li>2，<ins class=\"wavy\">子接口是逻辑接口，只能在路由口下添加子接口。</ins></li>\n<li>3，子接口的下一跳网关和链路状态检测根据实际情况进行配置。</li>\n</ul>\n<p class=\"red\">10，VLAN 接口：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，为 VLAN 定义 IP 地址，则会产生 VLAN 接口，VLAN 接口也是逻辑接口。</li>\n<li>2，根据实际情况配置。</li>\n</ul>\n<p class=\"red\">11，接口设置注意事项：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，设备支持配置多个 WAN 属性的路由接口连接多条外网线路，但是，需要开通多条线路的授权。</li>\n<li>2，管理口不支持设置成透明接口或虚拟网线接口，如果要设置两对或两对以上的虚拟网线接口，则必须要求设备不少于五个物理接口，预留一个专门的管理口 Eth0。</li>\n<li>3，一个路由接口下可以配置多个子接口，路由接口的 IP 地址不能与子接口的 IP 地址在同一网段。</li>\n</ul>\n<p class=\"red\">12，区域：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，什么是区域？</li>\n<li>是本地逻辑安全区域的概念</li>\n<li>一个或多个接口所连接的网络</li>\n<li>用于定义和归类接口，以供各类安全策略等模块调用</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/28/ySPPJg.png\" alt=\"图片\"></li>\n<li>2，定义区域时，需根据控制的需求来规划，可以将一个接口划分到一个区域，或将几个相同需求接口划分到同一区域。</li>\n<li>3，<ins class=\"wavy\">一个接口只能属于一个区域，而，一个区域可以有多个接口。</ins></li>\n<li>4，可以在区域中选择接口，也可以预先设置好区域名称，在接口中选择区域。</li>\n<li>5，二层区域 —— 只能选择所有的透明接口</li>\n<li>6，三层区域 —— 只能选择所有的三层接口</li>\n<li>7，虚拟网线区域 —— 只能选择所有的虚拟网线接口</li>\n</ul>\n<p class=\"red\">13，路由模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>现有的拓扑图如下，使用 AF 代替现有防火墙，部署在出口，实现内网用户和服务器安全防护。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9b5kj.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，需求分析 —— 部署前我们需要做哪些准备工作？</p>\n</li>\n<li>\n<p>现有设备的接口配置。</p>\n</li>\n<li>\n<p>内网网段规划，好写回包路由。</p>\n</li>\n<li>\n<p>是否有服务器要映射。</p>\n</li>\n<li>\n<p>是否需要代理内网用户上网。</p>\n</li>\n<li>\n<p>进行内外网哪些访问权限的控制。</p>\n</li>\n<li>\n<p>进行哪些安全策略配置，实现用户需求。</p>\n</li>\n<li>\n<p>现在拓扑是否完整。</p>\n</li>\n</ul>\n<p class=\"red\">14，单臂路由模式：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>单臂路由时指在路由器的一个接口上通过配置子接口 (逻辑接口，并不存在真正物理接口) 的方式，实现原来相互隔离的不同 VLAN (虚拟局域网) 之间的通信。</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/28/y9qt4s.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">15，路由模式总结：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，在此组网方式时，防火墙位于内部网络和外部网络之间，负责在内部网络，外部网络进行路由寻址，相当于路由器，与其内部网络，外部网络相连的上下行业务接口均工作在三层，需要分别配置不同网段的 IP 地址。</li>\n<li>2，此组网方式支持更多的安全特性，如：NAT，策略路由选择，动态路由协议 (OSPF,BGP,RIP 等)。</li>\n<li>需要修改原网络拓扑，对现有环境改动大。</li>\n<li>一般部署在需要进行路由转发的位置，如，出口路由器，或替换已有路由器，老防火墙等场景。</li>\n</ul>\n<p class=\"red\">16，透明模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>部署一台 AF 设备进行安全防护，但是，又不改动现有的网络环境。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9xBK1.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，需求分析 —— 部署前我们需要做哪些准备工作？</p>\n</li>\n<li>\n<p>接口定义</p>\n</li>\n<li>\n<p>管理地址配置</p>\n</li>\n<li>\n<p>配置路由，一般缺省路由用作防火墙上网，回程路由用作防火墙管理。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">不用配置地址转换。</ins></p>\n</li>\n<li>\n<p>应用控制，进行访问权限控制。</p>\n</li>\n<li>\n<p>安全防护策略实现用户安全防护需求。</p>\n</li>\n</ul>\n<p class=\"red\">17，虚拟网线部署：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，用户需求：</p>\n</li>\n<li>\n<p>路由器和交换机聚合口对接，要求透明部署防火墙设备，即，从 1 号口进来的数据，只能从 2 号口出，不再转发到其他接口，其他接口的效果也一样，同时，防火墙设备可以被日常管理。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/28/y9zeqx.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，虚拟网线部署是透明部署中另外一种特殊情况：</p>\n</li>\n<li>\n<p>和透明部署一样，接口也是二层接口，但是被定义为虚拟网线接口</p>\n</li>\n<li>\n<p><ins class=\"wavy\">虚拟网线接口必须成对存在，转发数据时无需检查 MAC 表，直接从虚拟网线配的的接口转发。</ins></p>\n</li>\n<li>\n<p><ins class=\"wavy\">虚拟网线接口的转发性能高于透明接口。</ins>单进单出网桥的环境下，推荐使用虚拟网线接口部署。</p>\n</li>\n</ul>\n<p class=\"wavy\">18，混合模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，用户需求：</p>\n</li>\n<li>\n<p>某用户内网有服务器群，服务器均配置公网 IP 地址，提供所有用户直接通过公网 IP 地址接入访问，内网用户使用私网地址，通过 NAT 转换代理上网，希望将 AF 设备部署在公网出口的位置，实现内外部数据通信的同时，保护服务器群和内网上网数据的安全。</p>\n</li>\n<li>\n<p>2，部署方式推荐：</p>\n</li>\n<li>\n<p>推荐使用混合模式部署，AF 设备连接公网和服务器群的 2 个接口使用透明 access 口，连接内网网段使用路由接口。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/29/yCUdW6.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>3，部署分析：</p>\n</li>\n<li>\n<p>用于服务器均有公网 IP 地址，所以 AF 连接公网线路的接口 Eth1 与连接服务器群的 Eth2 接口，使用透明 acces 口，并设置相同的 VLAN ID。皆可实现所有用户使用公网 IP 直接访问服务器群。</p>\n</li>\n<li>\n<p>新增 VLAN1 口，分配一个公网 IP，划分区域为外网区。</p>\n</li>\n<li>\n<p>AF 设备与内网相连的接口 Eth3 使用路由接口，设置与内网交换机同网段的 IP 地址，并设置静态路由，与内网通信。</p>\n</li>\n<li>\n<p>内网用户上网时，转换原 IP 地址为 VLAN1 接口的 IP 地址，根据需求划分一个二层区域选择网口 eth1 和 eth2，划分两个三层区域，其中，” 外网区域 “选择 VLAN 接口 VLAN1，“内网区域” 选择接口 eth3。</p>\n</li>\n</ul>\n<p class=\"red\">19，旁路模式组网：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，需求背景：</p>\n</li>\n<li>\n<p>使用 AF 来实现对各区域之前数据进行安全分析，同时不改动已有环境。</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/20sz21/01/29/yCav4I.png\" alt=\"图片\"></p>\n</li>\n<li>\n<p>2，思考总结：</p>\n</li>\n<li>\n<p>设备旁挂在现有的网络设备上，不影响现有的网络结构，通过端口镜像技术，把流量镜像到下一代防护，实现对数据的分析与处理。</p>\n</li>\n<li>\n<p>需要另外设置单独管理接口才能对设备进行管理。</p>\n</li>\n<li>\n<p><ins class=\"wavy\">启用管理口 reset 功能</ins></p>\n</li>\n<li>\n<p>旁路模式支持的功能仅有：</p>\n</li>\n<li>\n<p>APT (僵尸网络)。</p>\n</li>\n<li>\n<p>PVS (实时漏洞分析)。</p>\n</li>\n<li>\n<p>WAF (web 应用防护)。</p>\n</li>\n<li>\n<p>入侵防御系统。</p>\n</li>\n<li>\n<p>DLP (数据泄密防护)。</p>\n</li>\n<li>\n<p>网站防篡改部分功能 (客户端保护)。</p>\n</li>\n</ul>\n<p class=\"red\">20，策略路由解决方案：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，策略路由：</p>\n</li>\n<li>\n<p>是路由的一种。</p>\n</li>\n<li>\n<p>静态路由的匹配条件相对较少：匹配目的 IP，子网掩码与下一跳网关。</p>\n</li>\n<li>\n<p>策略路由可以弥补静态路由的不足，更灵活多样的匹配条件，根据相应策略来进行匹配，包括：匹配源，目的，协议，应用等。出口在外网多条线路情况下，建议匹配策略路由。</p>\n</li>\n<li>\n<p>2，策略路由分为：</p>\n</li>\n<li>\n<p>源地址策略路由：可指定内网哪些 IP 地址走指定线路出公网。</p>\n</li>\n<li>\n<p>多线路负载路由：可指定多条线路进行负载选路。</p>\n</li>\n<li>\n<p>3，总结思考：</p>\n</li>\n<li>\n<p>AF 路由的优先级默认是：[VPN 路由]&gt;[静态路由 / 动态路由]&gt;[策略路由]&gt;[默认路由]。</p>\n</li>\n<li>\n<p>AF6.8 新增了【VPN 专线互备路由】功能，开启该功能后，路由优先级调整为：【静态路由 / 动态路由】&gt;【策略路由】&gt;【VPN 路由】&gt;【默认路由】。</p>\n</li>\n<li>\n<p>每一条外网线路必须至少有一条策略路由与之对应，源地址策略路由或多线路负载路由均可。</p>\n</li>\n<li>\n<p>源地址策略路由，通过直接填写路由的下一跳，可以实现从设备非 WAN 属性的接口转发数据。</p>\n</li>\n<li>\n<p>多线路负载路由选择的接口，必须开启链路故障检测功能，才能实现线路故障自动切换。</p>\n</li>\n<li>\n<p>多条策略路由，按照从上往下的顺序匹配，一旦匹配到某条策略路由后，不再往下匹配。</p>\n</li>\n</ul>\n<h2 id=\"终端安全检测和防御技术\"><a class=\"anchor\" href=\"#终端安全检测和防御技术\">#</a> <strong>终端安全检测和防御技术：</strong></h2>\n<h3 class=\"blue\" id=\"终端安全风险\"><a class=\"anchor\" href=\"#终端安全风险\">#</a> 终端安全风险</h3>\n<p class=\"red\">1，风险：</p>\n<div class=\"note info\">\n<p>提示提示</p>\n</div>\n<ul>\n<li>1，APT 攻击最常采用的跳板就是僵尸网络，黑客利用僵尸网络来实现：渗透，监视，窃取敏感数据等目的，危害非常大。</li>\n<li>2，僵尸网络的主要危害有：</li>\n<li>看不见的风险。</li>\n<li>高级持续威胁。</li>\n<li>本地渗透扩散。</li>\n<li>敏感信息窃取。</li>\n<li>脆弱信息收集。</li>\n</ul>\n<h3 class=\"blue\" id=\"终端上网安全可视可控技术\"><a class=\"anchor\" href=\"#终端上网安全可视可控技术\">#</a> 终端上网安全可视可控技术</h3>\n<p>1，背景：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiVsde.png\" alt=\"图片\"></p>\n<p class=\"red\">2，方案：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>基于七层应用的深度数据包检测可实现终端安全可控</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/29/yiZQfA.png\" alt=\"图片\"></li>\n</ul>\n<p class=\"red\">3，应用控制策略简介：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，应用控制策略可对<ins class=\"wavy\">应用 / 服务</ins>的访问做双向控制。AF 存在一条默认拒绝所有应用 / 服务的控制策略。</p>\n</li>\n<li>\n<p>2，基于应用的控制策略：</p>\n</li>\n<li>\n<p>通过匹配数据包特征来进行过滤动作，需要一定数量的数据包通行后，才能判断应用类型，然后进行拦截动作的判断。</p>\n</li>\n<li>\n<p>3，基于服务的控制策略：</p>\n</li>\n<li>\n<p>通过匹配数据包的五元组 (源地址，目的地址，源端口，目的端口，协议号) 来进行过滤动作，对于任何包可以立即进行拦截动作判断。</p>\n</li>\n</ul>\n<p class=\"red\">4，Web 过滤：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，WEB 过滤是指针对符合设定条件的访问网页数据进行过滤。包括 URL 过滤，文件过滤，根据 HTTP 不同的动作进行区分，可以针对 HTTPS URL 进行过滤。</li>\n</ul>\n<h3 class=\"blue\" id=\"计算机病毒\"><a class=\"anchor\" href=\"#计算机病毒\">#</a> 计算机病毒</h3>\n<p class=\"red\">1，计算机病毒：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，1994 年 2 月 18 日颁布实施的《中华人民共和国计算机信息系统安全保护条例》中明确指出：“计算机病毒，是编制或者在计算机程序中能插入的破坏计算机功能或者毁坏数据，影响计算机使用，并能自我复制的一组计算机指令或者程序代码”</li>\n<li><img data-src=\"https://s3.ax1x.com/2021/01/29/yinfhQ.png\" alt=\"图片\"></li>\n</ul>\n<p>2，计算机病毒工作步骤：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiKpGQ.png\" alt=\"图片\"></p>\n<p class=\"red\">3，杀毒防御产品的发展：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>\n<p>1，发展过程：</p>\n</li>\n<li>\n<p>单机版杀毒软件 —— 网络版杀毒软件 —— 杀毒软件 + 杀毒网关。</p>\n</li>\n<li>\n<p>2，网络杀毒功能的优势 (防病毒网关)</p>\n</li>\n<li>\n<p>基于应用层过滤病毒</p>\n</li>\n<li>\n<p>过滤出入网关的数据</p>\n</li>\n<li>\n<p>网关阻断病毒传输，主动防御病毒于网络之外</p>\n</li>\n<li>\n<p>部署简单，方便管理，维护成本低</p>\n</li>\n<li>\n<p>与杀毒软件联动，建立多层防护</p>\n</li>\n<li>\n<p><img data-src=\"https://s3.ax1x.com/2021/01/29/yiMCFO.png\" alt=\"图片\"></p>\n</li>\n</ul>\n<p class=\"red\">4，网关杀毒实现方式：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，代理扫描方式：</li>\n<li>将所有经过网关的需要进行病毒检测的数据报文透明地交给网关自身的协议栈，通过网关的自身的协议栈将全部文件缓存下来后，再送入病毒检测引擎进行病毒检测。</li>\n<li>2，流扫描方式：</li>\n<li>依赖于状态检测技术以及协议解析技术，简单的提取文件的特征与本地前面库进行匹配。</li>\n</ul>\n<p>5，AF 网关杀毒实现方式：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/29/yiMbHP.png\" alt=\"图片\"></p>\n<p class=\"red\">6，AF 网关杀毒优势：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，支持各类主流协议文件传播杀毒，包括 SMB v1/v2/v3 协议，通过采用 SAVE 智能文件检测引擎 (杀毒)，大幅提高恶意文件识别率。</li>\n<li>2，支持对邮件正文中的恶意域名，URL 进行检测。</li>\n<li>3，提供覆盖更广的杀毒能力，支持文档类，脚本类的非 PE 文件检测，office 宏病毒的杀毒能力。</li>\n<li>4，杀毒文件的大小限制，可以灵活调整，界面可调整的大小限制为 1-20M。</li>\n<li>5，支持对压缩文件的检测，且可设置层级，界面可调整的层级最多 16 层。</li>\n</ul>\n<p class=\"red\">7，SAVE 引擎优势：</p>\n<div class=\"note info\">\n<p>简介</p>\n</div>\n<ul>\n<li>1，基于 Ai 技术提取稳定可靠的高层次特征，拥有强大的泛化能力，能够识别未知病毒或者已知病毒的新变种。</li>\n<li>2，对勒索病毒检测效果达到业内领先，影响广泛的如：Wannacry，BadRabbit，Globelposter 等勒索病毒，Save 均有检测出新变种的案例，同时，对非勒索病毒也有较好的检出效果。</li>\n<li>3，轻量级，资源占用少，隔离网环境检测能力业内领先。</li>\n<li>4，云 + 边界设备 + 端联动，依托于深信服安全云脑海量的安全数据，SAVE 能够持续进化，不断更新模型并提示检测能力，未知威胁能够再云端分钟级返回检测结果并全网同步，构成了深信服的安全云脑 + 安全网关 AF/SIP/AC + 终端安全 EDR 的整体解决方案。</li>\n</ul>\n<p>8，网关杀毒配置思路：{.red}<br>\n<img data-src=\"https://s3.ax1x.com/2021/01/31/yAh7xP.png\" alt=\"图片\"></p>\n<ul>\n<li>\n<p><strong>服务器安全检测和防御技术：</strong></p>\n</li>\n<li>\n<p><strong>安全评估与动态检测技术：</strong></p>\n</li>\n</ul>\n<h1 id=\"第五章移动接入安全\"><a class=\"anchor\" href=\"#第五章移动接入安全\">#</a> 第五章【移动接入安全】</h1>\n<ul>\n<li><strong>移动接入方案概述：</strong></li>\n<li><strong>移动接入身份认证技术：</strong></li>\n<li><strong>资源发布与安全接入策略：</strong></li>\n</ul>\n<h1 id=\"第六章终端安全\"><a class=\"anchor\" href=\"#第六章终端安全\">#</a> 第六章【终端安全】</h1>\n<ul>\n<li><strong>EDR 部署与终端管理：</strong></li>\n<li><strong>EDR 策略配置及联动管理：</strong></li>\n<li><strong>EDR 知识串讲：</strong></li>\n</ul>\n<h1 id=\"第七章网络安全可视\"><a class=\"anchor\" href=\"#第七章网络安全可视\">#</a> 第七章【网络安全可视】</h1>\n<ul>\n<li><strong>态势感知概述与 SIP 部署：</strong></li>\n<li><strong>SIP 功能介绍与配置：</strong></li>\n</ul>\n<h1 id=\"实验部分\"><a class=\"anchor\" href=\"#实验部分\">#</a> 实验部分</h1>\n<h2 id=\"第二章-数据传输安全\"><a class=\"anchor\" href=\"#第二章-数据传输安全\">#</a> 第二章 - 数据传输安全</h2>\n<h3 id=\"22ipsec-vpn解决方案\"><a class=\"anchor\" href=\"#22ipsec-vpn解决方案\">#</a> 2.2IPsec VPN 解决方案</h3>\n",
            "tags": [
                "技术",
                "SANGFOR"
            ]
        }
    ]
}